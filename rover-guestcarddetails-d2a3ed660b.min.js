"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("rvGuestDetailsController",["$scope","contactInfo","countries","$stateParams","$state","$filter","$rootScope","RVGuestCardSrv","RVContactInfoSrv","RVSearchSrv","rvPermissionSrv","RVGuestCardsSrv","$timeout","$window",function(e,t,a,r,n,o,i,s,c,d,u,l,f,m){BaseCtrl.call(this,e),GuestCardBaseCtrl.call(this,e,d,c,u,i);var p=e.$on("detect-hlps-ffp-active-status",function(t,a){a.userMemberships.use_hlp||a.userMemberships.use_ffp?e.loyaltyTabEnabled=!0:e.loyaltyTabEnabled=!1});e.isFromMenuGuest=r.isFromMenuGuest,e.$on("$destroy",p);var v=e.$on("loyaltyLevelAvailable",function(t,a){e.guestCardData.selectedLoyaltyLevel=a});e.$on("$destroy",v);var _=function(){var t=["birthday","country","is_opted_promotion_email","job_title","passport_expiry","passport_number","postal_code","reservation_id","title","user_id","works_at","birthday"],a=dclone(e.guestCardData.contactInfo,t);return a},y=function(e,t){var a={};return a.contactInfo=e,a.contactInfo.vip=t?e.vip:"",a.userId=t,a.guestId=t,a.contactInfo.birthday=t?e.birthday:null,a.contactInfo.user_id=t?t:"",a.contactInfo.guest_id=t?t:"",a.contactInfo.genderTypeList=e.gender_list,a.contactInfo.guest_admin_settings=e.guest_admin_settings,a};e.guestCardTabSwitch=function(t){"guest-contact"===e.current&&"guest-contact"!==t&&(e.viewState.isAddNewCard?e.$broadcast("showSaveMessage"):e.$broadcast("saveContactInfo")),"guest-like"===e.current&&"guest-like"!==t&&e.$broadcast("SAVELIKES",{isFromGuestCardSection:!0}),"guest-wallet"===t?e.$broadcast("PAYMENTSCROLL"):"guest-like"===t?(e.$broadcast("GUESTLIKETABACTIVE"),e.$broadcast("REFRESHLIKESSCROLL")):"guest-contact"===t?e.$broadcast("CONTACTINFOLOADED"):"activity-log"===t?e.$broadcast("GUEST_ACTIVITY_LOADED"):"guest-statistics"===t&&e.$broadcast("LOAD_GUEST_STATISTICS"),e.viewState.isAddNewCard||(e.current=t)},e.$on("contactInfoError",function(t,a){a&&(e.current="guest-contact")});var g=function(){var t=o("translate")("FIND GUESTS");r.isMergeViewSelected&&(t=o("translate")("MERGE_CARDS")),r.fromStaycard&&(t=o("translate")("STAY_CARD")),i.setPrevState={title:t,callback:"navigateBack",scope:e}},h=function(){var t=o("translate")("GUEST_CARD");e.viewState.isAddNewCard&&(t=o("translate")("NEW_GUEST")),e.heading=t,e.setTitle(t)};e.navigateBack=function(){r.fromStaycard?n.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:r.reservationId,confirmationId:r.confirmationNo}):f(function(){n.go("rover.guest.search",{textInQueryBox:r.query,selectedIds:r.selectedIds,isMergeViewSelected:r.isMergeViewSelected})},100)};var D=function(t){var a=t.user_id,r=t.guest_id,n=function(t){e.$emit("hideLoader");var n={data:t,user_id:a,guest_id:r};e.paymentData=n},o={params:a,successCallBack:n};e.callAPI(s.fetchGuestPaymentData,o)},C=function(t){t.id&&(e.guestCardData.userId=t.id,e.guestCardData.guestId=t.id,l.setGuest(t.id))};e.newGuestAdded=function(t){e.viewState.isAddNewCard=!1,C({id:t})},e.clickedSaveGuestCard=function(){e.$broadcast("saveContactInfo")},e.clickedDiscardGuestCard=function(){e.viewState.isAddNewCard=!1,e.navigateBack()},e.updateContactInfo=function(){var t=this;t.newUpdatedData=_();var a=function(){e.updateSearchCache(),e.isGuestCardSaveInProgress=!1,e.$broadcast("RESETCONTACTINFO",t.newUpdatedData)};if(JSON.stringify(e.getContactInfo(e.currentGuestCardHeaderData))!==JSON.stringify(e.getContactInfo(t.newUpdatedData))){e.currentGuestCardHeaderData=t.newUpdatedData;var r={data:e.currentGuestCardHeaderData,userId:e.guestCardData.contactInfo.user_id};if("undefined"!=typeof r.userId&&""!==r.userId){var n={successCallBack:a,params:r};e.isGuestCardSaveInProgress=!0,e.callAPI(c.updateGuest,n)}}};var S=e.$on("RESETHEADERDATA",function(t,a){e.currentGuestCardHeaderData.address=a.address,e.currentGuestCardHeaderData.phone=a.phone,e.currentGuestCardHeaderData.email=a.email,e.currentGuestCardHeaderData.first_name=a.first_name,e.currentGuestCardHeaderData.last_name=a.last_name});e.$on("$destroy",S);var A=function(){e.callAPI(l.fetchGuestAdminSettingsAndGender,{successCallBack:function(t){e.guestCardData.contactInfo.guest_admin_settings=t.guest_admin_settings,e.idTypeList=t.idTypeList,e.guestCardData.contactInfo.genderTypeList=t.genderTypeList},failureCallBack:function(t){e.errorMessage=t,e.$emit("hideLoader")}})},I=function(){e.viewState={isAddNewCard:!r.guestId},e.isGuestCardFromMenu=!0,e.shouldShowStatisticsTab=!!r.guestId,e.guestImage=r.guestId?t.image_url:"",r.guestId?e.guestCardData=y(t,r.guestId):(e.guestCardData={},e.guestCardData.contactInfo={},e.guestCardData.contactInfo.user_id="",e.guestCardData.contactInfo.first_name=r.firstName,e.guestCardData.contactInfo.last_name=r.lastName,A()),e.idTypeList=t.id_type_list,e.countries=a;var n={user_id:e.guestCardData.contactInfo.user_id,guest_id:null};e.declonedData=_(),e.currentGuestCardHeaderData=e.declonedData,n.user_id&&D(n),e.guestCardData.selectedLoyaltyLevel="",e.loyaltyTabEnabled=!1,e.loyaltiesStatus={ffp:!1,hlps:!1},r.isBackToStatistics?e.current="guest-statistics":e.current="guest-contact",e.paymentData={},h(),g(),e.printState={clicked:!1},e.$on("$destroy",e.guestCardTabSwitch)},T=e.$on("SET_GUEST_CARD_DATA",function(t,a){e.guestCardData.contactInfo=e.getUpdatedContactInfo(a.contactInfo,a.guestId)});e.$on("$destroy",T);var b=e.$on("UPDATE_GUEST_CARD_ACTIONS_BUTTON_STATUS",function(t,a){e.manageCardState.isOpen=a.status});e.$on("$destroy",b),e.createReservationFromGuestCard=function(){n.go("rover.reservation.search",{guestId:e.guestCardData.contactInfo.user_id})};var P=function(){$("head").append("<style id='print-orientation'>@page { size: portrait; }</style>")},E=function(){$("#print-orientation").remove()};e.printGuestCard=function(){e.printState.clicked=!0,e.manageCardState.isOpen=!1,$("header .logo").addClass("logo-hide"),$("header .h2").addClass("text-hide"),P();var t=function(){f(function(){e.printState.clicked=!1,$("header .logo").removeClass("logo-hide"),$("header .h2").addClass("text-hide"),E()},200)};f(function(){sntapp.cordovaLoaded?cordova.exec(t,function(){t()},"RVCardPlugin","printWebView",[]):(m.print(),t())},200)},e.uploadGuestImage=function(){f(function(){angular.element("#uploadImage").trigger("click")},0,!1)},e.onImageUpload=function(){e.guestImage=e.guestCardData.contactInfo.guestImageBase64},I()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVGuestCardActivityLogController",["$scope","$rootScope","$stateParams","$timeout","RVGuestCardActivityLogSrv",function(e,t,a,r,n){BaseCtrl.call(this,e);var o=this,i=1e3,s=function(){r(function(){e.refreshScroller("rvGuestCardActivityLogScroll")},500)},c=function(){e.activityLogObj={response:{},perPage:50,page:1,sortField:"DATE",sortOrder:"asc",accountId:""},e.activityLogFilter={user:"",date:"asc",action:""},e.activityLogPagination={id:"GUEST_ACTIVITY_LOG",api:o.loadAPIData,perPage:e.activityLogObj.perPage},e.setScroller("rvGuestCardActivityLogScroll",{}),s()};e.showPagination=function(){var t=!1,a=e.activityLogObj.response;return"undefined"!=typeof a&&"undefined"!=typeof a.results&&a.results.length<a.total_count&&a.results.length>0&&(t=!0),t},o.loadAPIData=function(t){if(e.guestCardData&&e.guestCardData.guestId||a.guestId){e.activityLogObj.page=t?t:1,e.activityLogObj.accountId="undefined"==typeof e.guestCardData?a.guestId:e.guestCardData.guestId;var o={params:{page:e.activityLogObj.page,per_page:e.activityLogObj.perPage,sort_field:e.activityLogObj.sortField,sort_order:e.activityLogObj.sortOrder,id:e.activityLogObj.accountId},successCallBack:function(t){e.activityLogObj.response=t,e.errorMessage="",s(),r(function(){e.$broadcast("updatePagination","GUEST_ACTIVITY_LOG")},i)},failureCallBack:function(t){e.errorMessage=t}};e.callAPI(n.fetchActivityLog,o)}};var d=function(t){e.activityLogObj.sortField=t;var a=e.activityLogFilter;switch(t){case"USERNAME":""===a.user||"asc"===a.user?a.user="desc":a.user="asc",e.activityLogObj.sortOrder=a.user;break;case"DATE":""===a.date||"asc"===a.date?a.date="desc":a.date="asc",e.activityLogObj.sortOrder=a.date;break;case"ACTION":""===a.action||"asc"===a.action?a.action="desc":a.action="asc",e.activityLogObj.sortOrder=a.action}o.loadAPIData()};e.sortByAction=function(e){d(e)};var u=e.$on("GUEST_ACTIVITY_LOADED",function(){r(function(){o.loadAPIData()},i)});e.isOldValue=function(e){var t=!0;return""!==e&&"undefined"!=typeof e&&null!==e||(t=!1),t},c(),e.$on("$destroy",u)}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVAllContactInfoDatePickerController",["$scope","$rootScope","ngDialog","dateFilter",function(e,t,a,r){e.setUpData=function(){e.dateOptions={changeYear:!0,changeMonth:!0,maxDate:tzIndependentDate(t.businessDate),yearRange:"-100:+0",onSelect:function(t,r){t=moment(t,"MM/DD/YYYY").format("YYYY-MM-DD"),"idDate"===e.calenderFor&&(e.guestCardData.contactInfo.id_issue_date=t),"entryDate"===e.calenderFor&&(e.guestCardData.contactInfo.entry_date=t),"birthday"===e.calenderFor&&(e.guestCardData.contactInfo.birthday=t),"validate"===e.calenderFor&&(e.saveData.birth_day=t),e.datePicker?a.close(e.datePicker.id):a.close()}},"idExpirationDate"!==e.calenderFor&&"idExpirationDateValidate"!==e.calenderFor||(e.dateOptions={changeYear:!0,changeMonth:!0,yearRange:"-100:+10",onSelect:function(t,r){t=moment(t,"MM/DD/YYYY").format("YYYY-MM-DD"),e.guestCardData.contactInfo.id_expiration_date=t,"idExpirationDateValidate"===e.calenderFor&&(e.saveData.id_expiration_date=t),e.datePicker?a.close(e.datePicker.id):a.close()}})},e.setUpData()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("rvAddLoyaltyProgramController",["$scope","$rootScope","$filter","RVLoyaltyProgramSrv","ngDialog",function(e,t,a,r,n){BaseCtrl.call(this,e),e.availableFFPS=[],e.availableHLPS=[],e.loyaltyPrograms=[{name:"Frequent Flyer Program",code:"FFP"},{name:"Hotel Loyalty Program",code:"HLP"}],e.selectedLoyaltyProgram="",e.selectedLoyaltyType="",e.selectedLevel="",e.loyaltyCode="",e.dimissLoaderAndDialog=function(){e.$emit("hideLoader"),e.closeDialog()},e.addLoyaltyProgram=function(){var a={};a.reservation_id=e.$parent.reservationData.reservation_card.reservation_id,a.user_id=e.$parent.$parent.guestCardData.userId,a.user_membership={},a.user_membership.membership_type=e.selectedLoyaltyType,a.user_membership.membership_card_number=e.loyaltyCode,a.user_membership.membership_class=e.selectedLoyaltyProgram,a.user_membership.membership_level=e.selectedLevel,e.newLoyalty=a.user_membership;var n=function(a){e.newLoyalty.id=a.id,e.dimissLoaderAndDialog(),t.$broadcast("loyaltyProgramAdded",e.newLoyalty,"fromReservationCard")},o=function(t){e.errorMessage=t},i={params:a,successCallBack:n,failureCallBack:o};e.callAPI(r.addLoyaltyProgram,i)},e.setupLoyaltyPrograms=function(){if(e.$parent.reservationData){var t=e.$parent.reservationData.use_ffp,a=e.$parent.reservationData.use_hlp;t===!0&&a===!1?e.loyaltyPrograms=[{name:"Frequent Flyer Program",code:"FFP"}]:t===!1&&a===!0?e.loyaltyPrograms=[{name:"Hotel Loyalty Program",code:"HLP"}]:t===!0&&a===!0?e.loyaltyPrograms=[{name:"Frequent Flyer Program",code:"FFP"},{name:"Hotel Loyalty Program",code:"HLP"}]:t===!1&&a===!1&&(e.loyaltyPrograms=[])}e.getFFPS(),e.getHLPS()},e.getFFPS=function(){var t=function(t){e.setAvailableFFPS(t),e.$emit("hideLoader")},a=function(t){e.$emit("hideLoader"),e.errorMessage=t};e.invokeApi(r.getAvailableFFPS,"",t,a)},e.getHLPS=function(){var t=function(t){e.setAvailableHLPS(t),e.$emit("hideLoader")},a=function(t){e.$emit("hideLoader"),e.errorMessage=t};e.invokeApi(r.getAvailableHLPS,"",t,a)},e.setAvailableFFPS=function(t){for(var a,r=0;r<t.length;r++)a={},a.name=t[r].ff_description,a.code=t[r].ff_value,a.levels=t[r].levels,e.availableFFPS.push(a)},e.setAvailableHLPS=function(t){for(var a,r=0;r<t.length;r++)a={},a.name=t[r].hl_description,a.code=t[r].hl_value,a.levels=t[r].levels,e.availableHLPS.push(a)},e.getLoyaltyTypes=function(){if(e.selectedLoyaltyProgram)return"HLP"===e.selectedLoyaltyProgram?e.availableHLPS:"FFP"===e.selectedLoyaltyProgram?e.availableFFPS:[]},e.getLoyaltyLevels=function(){if(e.$parent.reservationData){var t=e.$parent.reservationData.use_ffp,a=e.$parent.reservationData.use_hlp;if(t===!0&&a===!1){if(e.selectedLoyaltyProgram===e.loyaltyPrograms[0].code)return e.getLoyaltyLevelsfromCode()}else if(t===!1&&a===!0){if(e.selectedLoyaltyProgram===e.loyaltyPrograms[0].code)return e.getLoyaltyLevelsfromCode()}else{if(t===!0&&a===!0)return e.selectedLoyaltyProgram===e.loyaltyPrograms[1].code?e.getLoyaltyLevelsfromCode():e.getLoyaltyLevelsfromCode();t===!1&&a===!1&&(e.loyaltyPrograms=[])}}},e.getLoyaltyLevelsfromCode=function(){var t,a=[];if(e.selectedLoyaltyProgram){"HLP"===e.selectedLoyaltyProgram?t=e.availableHLPS:"FFP"===e.selectedLoyaltyProgram&&(t=e.availableFFPS);for(var r=0;r<t.length;r++)if(e.selectedLoyaltyType===t[r].code){a=t[r].levels;break}}return a},e.setupLoyaltyPrograms()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVGuestCardLoyaltyController",["$scope","$rootScope","RVGuestCardLoyaltySrv","ngDialog","RVLoyaltyProgramSrv",function(e,t,a,r,n){BaseCtrl.call(this,e);var o={};e.init=function(){var r=function(a){e.$emit("hideLoader"),t.$broadcast("detect-hlps-ffp-active-status",a),e.loyaltyData=a,e.checkForHotelLoyaltyLevel(),setTimeout(function(){e.refreshScroller("loyaltyList")},3e3),s()},n=function(t){e.$emit("hideLoader"),e.errorMessage=t},i={userID:e.$parent.guestCardData.userId};e.invokeApi(a.fetchLoyalties,i,r,n,"NONE"),o.guestInfo=e.$parent.guestCardData.contactInfo},e.reloadOnSet=!1,e.reloadOnSet&&(t.$on("reload-loyalty-section-data",function(t,a){e.init()}),e.reloadOnSet=!0),e.$watch(function(){return""!==e.$parent.$parent.guestCardData.userId},function(t){t&&e.init()}),e.addListener("reload-loyalty-section-data",function(a,r){r&&r.reload&&t.goToReservationCalled&&(e.init(),t.goToReservationCalled=!1)}),e.checkForHotelLoyaltyLevel=function(){if(e.$parent.$parent.guestCardData.use_hlp)for(var t=0;t<e.loyaltyData.userMemberships.hotelLoyaltyProgram.length;t++)if(""!==e.loyaltyData.userMemberships.hotelLoyaltyProgram.membership_level){e.$emit("loyaltyLevelAvailable",e.loyaltyData.userMemberships.hotelLoyaltyProgram[t].membership_level);break}},e.addListener("clearNotifications",function(){e.errorMessage="",e.successMessage=""});var i={preventDefault:!1};e.setScroller("loyaltyList",i),e.addListener("REFRESHLIKESSCROLL",function(){e.refreshScroller("loyaltyList")}),e.addNewFreaquentLoyality=function(){r.open({template:"/assets/partials/guestCard/rvGuestCardaddFreaquentLoyaltyPopup.html",controller:"RVAddNewFreaquentLoyaltyContrller",className:"",scope:e})},e.addNewHotelLoyality=function(){var t={template:"/assets/partials/reservationCard/rvGMSLoyality.html",controller:"rvGMSLoyalityController",className:"ngdialog-theme-default",scope:e,data:o,preCloseCallback:e.loadLoyaltyPrograms},a={template:"/assets/partials/guestCard/rvGuestCardaddHotelLoyaltyPopup.html",controller:"RVAddNewHotelLoyaltyController",className:"",scope:e};o.GMSSettings.membership_feature&&o.GMSSettings.enabled?r.open(t):r.open(a)},e.showDeleteModal=function(t,a,n){e.loaytyID=t,e.loyaltyIndexToDelete=a,e.loyaltyProgramToDelete=n,r.open({template:"/assets/partials/guestCard/rvGuestCardDeleteLoyaltyModal.html",controller:"rvDeleteLoyaltyModalController",className:"ngdialog-theme-default",scope:e})},e.addListener("loyaltyProgramAdded",function(t,a,r){"undefined"!=typeof e.loyaltyData&&("HLP"===a.membership_class?e.loyaltyData.userMemberships.hotelLoyaltyProgram.push(a):e.loyaltyData.userMemberships.frequentFlyerProgram.push(a))}),e.loyaltyProgramDeleted=function(t,a,r){"undefined"!=typeof e.loyaltyData&&("FFP"===r?e.loyaltyData.userMemberships.frequentFlyerProgram.splice(a,1):e.loyaltyData.userMemberships.hotelLoyaltyProgram.splice(a,1))},e.addListener("loyaltyDeletionError",function(t,a){e.$parent.myScroll.loyaltyList.scrollTo(0,0),e.errorMessage=a}),e.addListener("detect-hlps-ffp-active-status",function(t,a){a.userMemberships.use_hlp?(e.loyaltyProgramsActive(!0),e.$parent.guestCardData.use_hlp=!0):(e.loyaltyProgramsActive(!1),e.$parent.guestCardData.use_hlp=!1),a.userMemberships.use_ffp?(e.ffpProgramsActive(!0),e.$parent.guestCardData.use_ffp=!0):(e.ffpProgramsActive(!1),e.$parent.guestCardData.use_ffp=!1)}),e.loyaltyProgramsActive=function(t){e.hotelLoyaltyProgramEnabled=t,e.$parent.guestCardData.use_ffp=t},e.ffpProgramsActive=function(t){e.hotelFrequentFlyerProgramEnabled=t,e.$parent.guestCardData.use_ffp=t};var s=function(){var t={},a=function(e){o.GMSSettings=e},r={params:t,successCallBack:a};e.callAPI(n.getGMSSettings,r)}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("rvGMSLoyalityController",["$scope","$rootScope","$filter","RVLoyaltyProgramSrv","ngDialog","$sce","$timeout","sntActivity",function(e,t,a,r,n,o,i,s){BaseCtrl.call(this,e);var c,d={},u={},l={},f=function(t){"gms-iframe"===t.target.id&&e.iframe.contentWindow.postMessage({messageType:"membership-lookup",credentials:d,content:u||{}},e.GMSiFrameSrc),s.stop("GMS_IFRAME_LOAD")},m=function(t){if(e.GMSiFrameSrc.includes(t.origin)){var a,r=t.data;switch(r.messageType){case"error":a=r.content,v(r.timestamp||Date.now(),a.code);break;case"details":a=r.content,h(a);break;case"cancel":e.closeGMSDialog()}}},p=function(){e.iframe.removeEventListener("load",f),e.iframe.removeEventListener("error",y)},v=function(t,a){e.errorMessage="GMS Error code:"+a},_=function(){p(),window.removeEventListener("message",m)},y=function(t){"gms-iframe"===t.target.id&&(v(Date.now(),"GMS-XXX",e.GMSiFrameSrc+" failed to load ",t),_())},g=function(){d={username:e.ngDialogData.GMSSettings.user_name,password:e.ngDialogData.GMSSettings.password,buildingCode:e.ngDialogData.GMSSettings.hotel_code,identifier:t.hotelDetails.current_user.email,lname:e.userInfo.last_name,fname:e.userInfo.first_name},u={email:e.ngDialogData.guestInfo.email,firstName:e.ngDialogData.guestInfo.firstName,lastName:e.ngDialogData.guestInfo.lastName}},h=function(a){var n={},o={},i=function(r){r.id&&(o.id=r.id,t.$broadcast("loyaltyProgramAdded",o,"fromReservationCard"),t.$broadcast("updateEmailFromGMS",a.details.email),e.closeGMSDialog()),"failure"===r.status&&(e.errorMessage=r.errors)};n.reservation_id=e.$parent.reservationData.reservation_card.reservation_id,n.user_id=e.$parent.$parent.guestCardData.userId,o.membership_type=a.progamCode,o.membership_card_number=a.memberNumber,o.membership_class=c,n.user_membership=o;var s={params:n,successCallBack:i};e.callAPI(r.addLoyaltyProgram,s)},D=function(){s.start("GMS_IFRAME_LOAD"),e.trustSrc=o.trustAsResourceUrl,l=e.ngDialogData.guestInfo,c="HLP",g(),e.iframe=null,i(function(){e.iframe=document.getElementById("gms-iframe"),e.GMSiFrameSrc=e.ngDialogData.GMSSettings.iframe_end_point,e.iframe&&(e.iframe.addEventListener("load",f,!1),e.iframe.addEventListener("error",y,!1),window.addEventListener("message",m,!1))},3e3)};e.closeGMSDialog=function(){_(),e.closeDialog()},D()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVContactInfoController",["$scope","$rootScope","RVContactInfoSrv","ngDialog","dateFilter","$timeout","RVSearchSrv","$stateParams","rvPermissionSrv","RVReservationCardSrv","$state","RVGuestCardsSrv","rvUtilSrv",function(e,t,a,r,n,o,i,s,c,d,u,l,f){BaseCtrl.call(this,e);var m;GuestCardBaseCtrl.call(this,e,i,a,c,t);var p="rover.reservation.staycard.reservationcard.reservationdetails",v=JSON.parse(JSON.stringify(e.guestCardData.contactInfo));e.errorMessage="",e.$on("clearNotifications",function(){e.successMessage="",e.$emit("contactInfoError",!1)}),e.$on("RESETCONTACTINFO",function(e,t){v.address=t.address,v.phone=t.phone,v.email=t.email,v.first_name=t.first_name,v.last_name=t.last_name});var y=function(t){e.$emit("hideLoader"),e.errorMessage=t,e.saveGuestCardInfoInProgress=!1},g=function(t){""!==t.mandatory_field_missing_message&&null!==t.mandatory_field_missing_message&&(e.errorMessage=t.mandatory_field_missing_message,e.$emit("contactInfoError",!0)),e.reservationData&&(e.reservationData.guest.email=e.guestCardData.contactInfo.email,e.reservationData.guest.email&&e.reservationData.guest.email.length>0?e.otherData.isGuestPrimaryEmailChecked=!0:e.otherData.isGuestPrimaryEmailChecked=!1);var a=getAvatharUrl(e.guestCardData.contactInfo.title);e.$emit("CHANGEAVATAR",a),e.$emit("RESETHEADERDATA",e.guestCardData.contactInfo),e.updateSearchCache(a),e.$emit("hideLoader")},h=function(t){e.$emit("hideLoader"),e.errorMessage=t,e.$emit("GUESTCARDVISIBLE",!0),e.$emit("contactInfoError",!0)},D=function(t,a,r,n){var o=function(){};e.callAPI(d.attachGuestToReservation,{onSuccess:o,params:{reservation_id:t,guest_detail_id:a,is_primary:r,guest_type:n}})};e.saveContactInfo=function(t){var r=function(t){""!==t.mandatory_field_missing_message&&null!==t.mandatory_field_missing_message&&(e.errorMessage=t.mandatory_field_missing_message,e.$emit("contactInfoError",!0)),e.$emit("hideLoader"),"undefined"!=typeof e.guestCardData.contactInfo.user_id&&""!==e.guestCardData.userId&&null!==e.guestCardData.userId&&"undefined"!=typeof e.guestCardData.userId||("STAY_CARD"===e.viewState.identifier||"CREATION"===e.viewState.identifier&&e.viewState.reservationStatus.confirm)&&(e.viewState.pendingRemoval.status=!1,e.viewState.pendingRemoval.cardType="",e.reservationDetails.guestCard.futureReservations<=0?e.replaceCardCaller("guest",{id:t.id},!1):e.checkFuture("guest",{id:t.id})),e.guestCardData.contactInfo.user_id=t.id,e.reservationDetails&&(e.reservationDetails.guestCard.id=t.id,e.reservationDetails.guestCard.futureReservations=0),e.saveGuestCardInfoInProgress=!1,e.reservationData&&e.reservationData.guest&&(e.reservationData.guest.id=t.id,e.reservationData.guest.firstName=e.guestCardData.contactInfo.first_name,e.reservationData.guest.lastName=e.guestCardData.contactInfo.last_name,e.reservationData.guest.phone=e.guestCardData.contactInfo.phone,e.reservationData.guest.mobile=e.guestCardData.contactInfo.mobile,e.reservationData.guest.is_vip=e.guestCardData.contactInfo.vip,e.reservationData.guest.email=e.guestCardData.contactInfo.email,e.reservationData.guest.image=e.guestCardData.contactInfo.avatar,e.reservationData.guest.address=e.guestCardData.contactInfo.address,e.reservationData.guest.loyaltyNumber=e.guestLoyaltyNumber,u.current.name!==p&&e.reservationData.reservationId&&D(e.reservationData.reservationId,e.reservationData.guest.id,!0)),e.guestCardData.userId=t.id,e.isGuestCardFromMenu||e.showGuestPaymentList(e.guestCardData.contactInfo),e.newGuestAdded(t.id),""===e.errorMessage&&"rover.guest.details"!==u.current.name&&e.closeGuestCard(),e.guestCardData.contactInfo.can_guest_details_anonymized=!0,e.guestCardData.contactInfo.can_guest_card_delete=!0,s.fromStaycard&&!s.guestId&&D(s.reservationId,t.id,s.isPrimary,s.guestType)};v=a.completeContactInfoClone?JSON.parse(JSON.stringify(a.completeContactInfoClone)):{};var n=JSON.parse(JSON.stringify(e.guestCardData.contactInfo)),i=!1;if(angular.equals(n,v))i=!0;else{a.completeContactInfoClone=JSON.parse(JSON.stringify(n)),e.guestCardData.contactInfo.birthday?n.birthday=moment(e.guestCardData.contactInfo.birthday).format("MM-DD-YYYY"):n.birthday=null,e.guestCardData.contactInfo.id_issue_date?n.id_issue_date=moment(e.guestCardData.contactInfo.id_issue_date).format("YYYY-MM-DD"):n.id_issue_date=null,e.guestCardData.contactInfo.entry_date?n.entry_date=moment(e.guestCardData.contactInfo.entry_date).format("YYYY-MM-DD"):n.entry_date=null,e.guestCardData.contactInfo.id_expiration_date?n.id_expiration_date=moment(e.guestCardData.contactInfo.id_expiration_date).format("YYYY-MM-DD"):n.id_expiration_date=null;var c=["guestImageBase64"];"Invalid date"===n.birthday&&(n.birthday=null,e.guestCardData.contactInfo.birthday=null),n.avatar=n.guestImageBase64?n.guestImageBase64:"",n=dclone(n,c)}"undefined"==typeof n.address&&(n.address={});var d=e.guestCardData.userId||e.guestCardData.contactInfo.user_id;""===n.email||f.isEmailValid(n.email)||o(function(){e.guestCardData.contactInfo.email=e.reservationData.guest.email},100);var C={data:n,userId:d};_.isUndefined(e.viewState.identifier)?C.data.current_page="always":C.data.current_page="CREATION"===e.viewState.identifier||"CONFIRM"===e.viewState.identifier?"at_booking":"at_checkin",e.invokeApi(l.fetchGuestAdminSettings,"",function(o){C.data.guest_admin_settings=o,t&&!n.user_id?("undefined"==typeof C.data.is_opted_promotion_email&&(C.data.is_opted_promotion_email=!1),s.guestType&&(C.data.guest_type=s.guestType),e.invokeApi(a.createGuest,C,r,y)):i||angular.equals(n,m)||(m=dclone(n,["confirmation_num"]),(e.isGuestCardVisible||e.isFromMenuGuest)&&e.invokeApi(a.updateGuest,C,g,h))},function(){})},e.$on("saveContactInfo",function(){e.errorMessage="",e.reservationData&&!e.reservationData.guest.id&&!e.guestCardData.contactInfo.user_id||e.viewState.isAddNewCard?e.saveGuestCardInfoInProgress||e.isGuestCardSaveInProgress||(e.saveGuestCardInfoInProgress=!0,e.saveContactInfo(!0)):e.isGuestCardSaveInProgress||e.saveContactInfo()}),e.$on("updateEmailFromGMS",function(t,r){e.guestCardData.contactInfo.email=r;var n=JSON.parse(JSON.stringify(e.guestCardData.contactInfo)),o={data:n,userId:e.guestCardData.contactInfo.user_id};e.invokeApi(a.updateGuest,o,g,h)}),e.$on("showSaveMessage",function(){e.errorMessage=["Please save the Guest Card first"]}),e.popupCalendarForGuestContactInfoDate=function(t){e.calenderFor=t,r.open({template:"/assets/partials/guestCard/contactInfoCalendarPopup.html",controller:"RVAllContactInfoDatePickerController",className:"single-date-picker",scope:e})},e.setScroller("contact_info");var C=function(){o(function(){e.refreshScroller("contact_info")},700)};e.$on("CONTACTINFOLOADED",C),e.$on("REFRESHLIKESSCROLL",C);var S=function(t){e.$emit("hideLoader"),e.languageData=t},A=function(){e.invokeApi(a.fetchGuestLanguages,{},S)},I=function(){A();var t=["confirmation_num"];m=dclone(e.guestCardData.contactInfo,t),e.hasPermissionToFlagGuest=c.getPermissionValue("FLAG_GUEST")},T=e.$on("UPDATE_STAY_COUNT",function(e,t){m.stayCount=t.stayCount});e.$on("$destroy",T),e.getStyleClassForPrint=function(e,t){return t=t||"",(""===e||null===e||_.isUndefined(e))&&(t+=" no-print"),t},e.onBlackListToggle=function(){e.guestCardData.contactInfo.is_flagged=!e.guestCardData.contactInfo.is_flagged,e.guestCardData.contactInfo.is_flagged||(e.guestCardData.contactInfo.flagged_reason="")},e.addMarginClass=function(){if(e.guestCardData.contactInfo.guest_admin_settings.id_place_of_issue.is_visible&&!$("#place-of-issue").hasClass("margin"))return!0},e.addMarginClassForExpirationDate=function(){if(!e.guestCardData.contactInfo.guest_admin_settings.id_country_of_issue.is_visible){var t=e.addMarginClass();return t}if(!$("#country-of-issue").hasClass("margin"))return!0},e.addMarginClassForEntryDate=function(){if(!e.guestCardData.contactInfo.guest_admin_settings.id_expiration_date.is_visible){var t=e.addMarginClassForExpirationDate();return t}if(!$("#expiry-date").hasClass("margin"))return!0},I()}])},{}]},{},[1]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("rvCardAllomentsContentCtrl",["$scope","rvUtilSrv",function(e,t){BaseCtrl.call(this,e),e.isEmpty=t.isEmpty,e.stringify=t.stringify,e.getClassAgainstHoldStatus=function(e){return"true"===e.is_take_from_inventory?"":"tentative"};var a=function(e){return"cancel"===e.hold_status.toLowerCase()};e.getGuestClassForArrival=function(e){var t=a(e)?"cancel":"check-in";return t},e.getClassAgainstPickedStatus=function(e){var t="";return e.total_picked_count>0&&(t="green"),a(e)&&(t+=" red"),t},e.getGuestClassForDeparture=function(e){var t=a(e)?"cancel":"check-out";return t},e.formatDateForUI=function(e){var t="undefined"==typeof e?"undefined":_typeof(e),a="";switch(t){case"string":a=$filter("date")(new tzIndependentDate(e),$rootScope.dateFormat);break;case"object":a=$filter("date")(e,$rootScope.dateFormat)}return a},e.$on("NG_REPEAT_COMPLETED_RENDERING",function(t){$timeout(function(){n()},300),e.$emit("hideLoader")});var r=function(){var t={tap:!0,preventDefault:!1,deceleration:1e-4,
shrinkScrollbars:"clip"};e.setScroller("result_showing_area",t)},n=function(){e.refreshScroller("result_showing_area")};e.$on("GROUP_SEARCH_STARTED",function(){e.searchingAllotment=!0,n()}),e.$on("GROUP_SEARCH_END",function(){e.searchingAllotment=!1,n()}),e.$on("FETCH_ALLOTMENT_SEARCH_DATA",function(){i()});var o=function(t){e.searchingAllotment=!0,e.allotmentList=data.allotments},i=function(){var t=e.searchData.groupCard,a=e.reservationData;if(t.name||t.code){var r={name:t.name,code:t.code,from_date:a.arrivalDate,to_date:a.departureDate},n={params:r,successCallBack:o};e.callAPI(rvGroupSrv.searchGroupCard,n)}else e.searchingAllotments=!1,e.searchedAllotments=[]};(function(){e.allotmentList=[],e.totalResultCount=0,e.searchMode=!0,r()})()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("rvCardAllotmentsHeaderCtrl",["$scope",function(e){BaseCtrl.call(this,e);(function(){e.searchMode=!0})()}])},{}]},{},[1]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("rvGuestCardNotesCtrl",["$scope","rvGuestCardNotesSrv","RVDashboardSrv","$timeout","$filter","$rootScope",function(e,t,a,r,n,o){BaseCtrl.call(this,e);var i=null,s=function(){var t=e.getScroller("guestcard_notes_scroller");r(function(){t.scrollTo(0,0,300)},0)},c=function(t){e.notes=t,e.refreshScroller("guestcard_notes_scroller")},d=function(){var a={guestID:i},r={params:a,successCallBack:c};e.callAPI(t.fetchNotesForGuest,r)},u=function(t,a){var r=a.index;e.notes.splice(r,1),e.refreshScroller("guestcard_notes_scroller"),e.guestCardData.contactInfo.notes_count=e.notes.length},l=function(t){e.errorMessage=t,d()};e.deleteGuestcardNote=function(a,r,n){a.stopPropagation(),e.cancelEditMode(),e.errorMessage="";var o={noteID:r,guestID:i},s={params:o,successCallBack:u,failureCallBack:l,successCallBackParameters:{index:n}};e.callAPI(t.deleteNoteFromGuestCard,s)};var f=function(t){var r=a.getUserDetails(),n={posted_user_first_name:r.first_name,posted_user_last_name:r.last_name,posted_user_image_url:r.user_image_url,text:e.noteText,time:t.time,date:t.date,id:t.id};e.notes.unshift(0),e.notes[0]=n,e.noteText="",e.refreshScroller("guestcard_notes_scroller"),s(),e.guestCardData.contactInfo.notes_count=e.notes.length};e.createGuestcardNote=function(){var a={guestID:i,text:e.noteText};e.errorMessage="";var r={params:a,successCallBack:f};e.callAPI(t.createNoteFromGuestCard,r)};var m=function(t){var a=_.findIndex(e.notes,{id:e.editingNote.id})+1;e.cancelEditMode(),d();var n=e.getScroller("guestcard_notes_scroller");r(function(){n.scrollToElement(".notes.wrapper li:nth-child("+a+")",300)},0)};e.updateActiveNote=function(){if(null===e.editingNote)return void(e.errorMessage=["Something went wrong, please switch tab and comeback"]);e.errorMessage="";var a={noteID:e.editingNote.id,guestID:i,text:e.noteText},r={params:a,successCallBack:m};e.callAPI(t.updateNoteFromGuestCard,r)},e.clickedOnNote=function(t){e.editingNote=t,e.noteText=t.text},e.cancelEditMode=function(){e.editingNote=null,e.noteText=""},e.formatDateForUI=function(e){var t="undefined"==typeof e?"undefined":_typeof(e),a="";switch(t){case"string":a=n("date")(new tzIndependentDate(e),o.dateFormat);break;case"object":a=n("date")(e,o.dateFormat)}return a};(function(){i=e.guestCardData.userId,e.editingNote=null,e.notes=[],e.noteText="",e.setScroller("guestcard_notes_scroller",{}),d()})()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVCompanyCardCtrl",["$scope","$rootScope","RVCompanyCardSrv","$timeout","ngDialog","$filter","$stateParams","rvPermissionSrv","rvFileCloudStorageSrv",function(e,t,a,r,n,o,i,s,c){e.searchMode=!0,e.account_type="COMPANY",e.currentSelectedTab="cc-contact-info",e.isGlobalToggleReadOnly=!s.getPermissionValue("GLOBAL_CARD_UPDATE"),e.companySearchIntiated=!1,e.companies=[];var d={},u=!1;e.arAccountDetails={},e.switchTabTo=function(t,a){t.stopPropagation(),t.stopImmediatePropagation();var r=!!e.contactInformation.account_details.accounts_receivable_number;"cc-contact-info"===e.currentSelectedTab&&"cc-contact-info"!==a&&(e.viewState.isAddNewCard?e.$broadcast("setCardContactErrorMessage",[o("translate")("COMPANY_SAVE_PROMPT")]):p()),"cc-contracts"===e.currentSelectedTab&&"cc-contracts"!==a?(e.$broadcast("contactTabActive"),e.$broadcast("saveContract")):"cc-ar-accounts"===e.currentSelectedTab&&"cc-ar-accounts"!==a&&e.$broadcast("saveArAccount"),"cc-ar-accounts"===a?e.$broadcast("arAccountTabActive"):"cc-contracts"===a?e.$broadcast("contractTabActive"):"cc-contact-info"===a?e.$broadcast("contactTabActive"):"cc-ar-transactions"===a&&r?(e.$broadcast("arTransactionTabActive"),e.isWithFilters=!1):"cc-notes"===a?e.$broadcast("fetchNotes"):"wallet"===a?e.$broadcast("wallet"):"statistics"===a&&e.$broadcast("LOAD_STATISTICS"),"cc-activity-log"===a&&e.$broadcast("activityLogTabActive"),"cc-ar-transactions"!==a||r?e.viewState.isAddNewCard||(e.currentSelectedTab=a):console.warn("Save AR Account and Navigate to AR Transactions")},e.$on("ARTransactionSearchFilter",function(t,a){e.isWithFilters=a}),e.shouldShowARMandatoryPopup=function(){var t=(!e.contactInformation.mandatoryFields.address_line1_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.address_line1_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.street1))&&(!e.contactInformation.mandatoryFields.city_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.city_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.city))&&(!e.contactInformation.mandatoryFields.postal_code_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.postal_code_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.postal_code))&&(!e.contactInformation.mandatoryFields.country_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.country_mandatory.is_mandatory||""!==e.contactInformation.address_details.country_id&&null!==e.contactInformation.address_details.country_id)&&(!e.contactInformation.mandatoryFields.contact_phone_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_phone_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.phone))&&(!e.contactInformation.mandatoryFields.contact_email_address_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_email_address_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.email_address)&&isValidEmail(e.contactInformation.address_details.email_address))&&(!e.contactInformation.mandatoryFields.e_invoice_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.e_invoice_mandatory.is_mandatory||!isEmpty(e.contactInformation.e_invoice_address))&&(!e.contactInformation.mandatoryFields.organization_id_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.organization_id_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.organization_id))&&(!e.contactInformation.mandatoryFields.tax_id_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.tax_id_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.tax_number))&&(!e.contactInformation.mandatoryFields.regd_tax_office_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.regd_tax_office_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.reg_tax_office))&&(!e.contactInformation.mandatoryFields.contact_name_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_name_mandatory.is_mandatory||!isEmpty(e.contactInformation.primary_contact_details.contact_first_name)&&!isEmpty(e.contactInformation.primary_contact_details.contact_last_name))&&(!!e.arAccountDetails.is_auto_assign_ar_numbers||""!==e.arAccountDetails.ar_number&&null!==e.arAccountDetails.ar_number)&&(!e.contactInformation.mandatoryFields.payment_due_days_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.payment_due_days_mandatory.is_mandatory||""!==e.arAccountDetails.payment_due_days&&null!==e.arAccountDetails.payment_due_days);return t},e.$on("saveArAccountFromMandatoryPopup",function(t,a){e.arAccountDetails=a,e.isArTabAvailable=!0,e.shouldSaveArDataFromPopup=!0,e.contactInformation.account_details.accounts_receivable_number=a.ar_number}),e.openCompanyTravelAgentCardMandatoryFieldsPopup=function(){e.shouldSaveArDataFromPopup=!1,n.open({template:"/assets/partials/companyCard/rvCompanyTravelAgentCardMandatoryFieldsPopup.html",className:"ngdialog-theme-default1 calendar-single1",controller:"companyTravelAgentMandatoryFieldsController",closeByDocument:!1,scope:e})},e.clickedCreateArAccountButton=function(){e.shouldShowARMandatoryPopup()?(u=!0,e.showARTab()):(e.isMandatoryPopupOpen=!0,e.openCompanyTravelAgentCardMandatoryFieldsPopup())},e.$on("UPDATE_MANDATORY_POPUP_OPEN_FLAG",function(){e.isMandatoryPopupOpen=!1}),e.showARTab=function(t){p(e.contactInformation)},e.$on("ARNumberChanged",function(t,a){e.contactInformation.account_details.accounts_receivable_number=a.newArNumber}),e.deleteArAccount=function(){n.open({template:"/assets/partials/companyCard/rvCompanyCardDeleteARaccountPopup.html",className:"ngdialog-theme-default1 calendar-single1",closeByDocument:!1,scope:e})},e.deleteARAccountConfirmed=function(t){var r=function(t){e.$emit("hideLoader"),e.isArTabAvailable=!1,e.$broadcast("ArAccountDeleted"),e.contactInformation.account_details.accounts_receivable_number="",e.$broadcast("setgenerateNewAutoAr",!1),n.close()},o={id:e.reservationDetails.companyCard.id};e.invokeApi(a.deleteArAccount,o,r)},e.clikedDiscardDeleteAr=function(){n.close()};var l=function(){var t={id:e.reservationDetails.companyCard.id},r=function(t){e.$emit("hideLoader"),e.arAccountNotes=t,e.$broadcast("ARDetailsRecieved")},n=function(){e.invokeApi(a.fetchArAccountNotes,t,r)},o=function(t){e.$emit("hideLoader"),e.arAccountDetails=t,e.arAccountDetails.is_use_main_contact!==!1&&(e.arAccountDetails.is_use_main_contact=!0),e.arAccountDetails.is_use_main_address!==!1&&(e.arAccountDetails.is_use_main_address=!0),n()};e.invokeApi(a.fetchArAccountDetails,t,o)};e.$on("companyCardAvailable",function(t,a){e.searchMode=!1,e.contactInformation=e.companyContactInformation,e.currentSelectedTab="cc-contact-info",d=angular.copy(e.contactInformation),a===!0&&(e.contactInformation.account_details.account_name=e.searchData.companyCard.companyName,e.contactInformation.address_details.city=e.searchData.companyCard.companyCity,e.contactInformation.account_details.account_number=e.searchData.companyCard.companyCorpId),e.$broadcast("contactTabActive"),e.$broadcast("UPDATE_CONTACT_INFO"),r(function(){e.$emit("hideLoader")},1e3),a||l()}),e.$on("companyCardDetached",function(){e.searchMode=!0,e.isArTabAvailable=!1,e.$broadcast("setgenerateNewAutoAr",!1)}),e.$on("companySearchInitiated",function(){e.companySearchIntiated=!0,e.companies=e.searchedCompanies,e.$broadcast("refreshCompaniesScroll")}),e.$on("companySearchStopped",function(){e.companySearchIntiated=!1,e.companies=[],e.$broadcast("refreshCompaniesScroll")}),e.$on("newCardSelected",function(t,a){e.searchMode=!1,e.$emit("hideLoader")}),e.toggleGlobalButton=function(){s.getPermissionValue("GLOBAL_CARD_UPDATE")&&(e.contactInformation.is_global_enabled=!e.contactInformation.is_global_enabled)},e.isUpdateEnabled=function(){var t=!1;return e.contactInformation.is_global_enabled?s.getPermissionValue("GLOBAL_CARD_UPDATE")||(t=!0):s.getPermissionValue("EDIT_COMPANY_CARD")||(t=!0),t},e.companyCardClicked=function(a){a.stopPropagation(),null!==document.getElementById("cc-contact-info")&&getParentWithSelector(a,document.getElementById("cc-contact-info"))&&"cc-contact-info"===e.currentSelectedTab||null!==document.getElementById("cc-contracts")&&getParentWithSelector(a,document.getElementById("cc-contracts"))&&"cc-contracts"===e.currentSelectedTab||null!==document.getElementById("cc-ar-accounts")&&getParentWithSelector(a,document.getElementById("cc-ar-accounts"))&&"cc-ar-accounts"===e.currentSelectedTab||(!e.viewState.isAddNewCard&&null!==document.getElementById("company-card-header")&&getParentWithSelector(a,document.getElementById("company-card-header"))&&(e.$emit("saveContactInformation"),t.$broadcast("saveArAccount")),c.activeCardType="ACCOUNT_COMPANY")},e.$on("saveContactInformation",function(e){e.preventDefault(),e.stopPropagation(),p()}),e.$on("saveCompanyContactInformation",function(e){e.preventDefault(),p()}),e.$on("OUTSIDECLICKED",function(a,r){a.preventDefault(),p(),e.checkOutsideClick(r),t.$broadcast("saveArAccount"),t.$broadcast("saveContract")});var f=function(a){e.reservationDetails.companyCard.id=a.id,e.contactInformation.id=a.id,t.$broadcast("IDGENERATED",{id:a.id}),e.shouldSaveArDataFromPopup&&(e.shouldSaveArDataFromPopup=!1,e.$broadcast("UPDATE_AR_ACCOUNT_DETAILS",e.arAccountDetails),e.$broadcast("saveArAccount")),l(),e.viewState.isAddNewCard&&"undefined"!=typeof a.id&&(("STAY_CARD"===e.viewState.identifier||"CREATION"===e.viewState.identifier&&e.viewState.reservationStatus.confirm)&&(e.viewState.pendingRemoval.status=!1,e.viewState.pendingRemoval.cardType="",e.reservationDetails.companyCard.futureReservations<=0?e.replaceCardCaller("company",{id:a.id},!1):e.checkFuture("company",{id:a.id}),e.reservationDetails.companyCard.futureReservations=0),e.viewState.isAddNewCard=!1,e.closeGuestCard(),e.cardSaved(),e.reservationDetails.companyCard.id=a.id,e.reservationData&&e.reservationData.company&&(e.reservationData.company.id=a.id,e.reservationData.company.name=e.contactInformation.account_details.account_name))};e.clickedSaveCard=function(e){p()};var m=function(t){e.errorMessage=t,e.currentSelectedTab="cc-contact-info"},p=function(t){var r=!1;if(t=t||e.contactInformation,angular.equals(_.omit(t,["commission_details"]),_.omit(d,["commission_details"]))||(r=!0,d=angular.copy(e.contactInformation)),"undefined"!=typeof t&&(r||e.viewState.isAddNewCard)){var n=JSON.parse(JSON.stringify(t));"undefined"!=typeof n.countries&&delete n.countries,""===n.account_details.account_number&&(n.account_details.account_number=null),"undefined"==typeof n.primary_contact_details?(n.primary_contact_details={},n.primary_contact_details.contact_email=null):""===n.primary_contact_details.contact_email&&(n.primary_contact_details.contact_email=null),"undefined"==typeof n.address_details&&(n.address_details={}),n.account_type=e.account_type;var o={params:n,successCallBack:f,failureCallBack:m};e.callAPI(a.saveContactInformation,o)}else e.shouldSaveArDataFromPopup&&(e.shouldSaveArDataFromPopup=!1,e.$broadcast("UPDATE_AR_ACCOUNT_DETAILS",e.arAccountDetails),e.$broadcast("saveArAccount")),u&&(e.$broadcast("setgenerateNewAutoAr",!0),e.$broadcast("saveArAccount"),e.isArTabAvailable=!0),u=!1};e.hasPermissionToCreateArAccount=function(){return s.getPermissionValue("CREATE_AR_ACCOUNT")}}]),angular.module("sntRover").controller("companyResults",["$scope","$timeout",function(e,t){BaseCtrl.call(this,e);var a={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("companyResultScroll",a),e.$on("refreshCompaniesScroll",function(){t(function(){e.refreshScroller("companyResultScroll")},500)})}])},{}]},{},[1]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVGroupCardCtrl",["$scope","$rootScope","RVCompanyCardSrv","$timeout","ngDialog","$filter","$stateParams","rvGroupSrv","rvUtilSrv","$controller",function(e,t,a,r,n,o,i,s,c,d){e.searchMode=!0,e.$on("groupCardAvailable",function(t,a){e.searchMode=!1,r(function(){e.groupSummaryMemento=angular.copy(e.groupConfigData.summary),e.$emit("hideLoader")},500)}),e.$on("allotmentCardAvailable",function(t,a){e.searchMode=!1,r(function(){e.$emit("hideLoader")},500)}),e.isInAddMode=function(){return!1},e.getMoveDatesActions=function(){return{setToDefaultMode:function(){return!1}}},e.fetchGroupAllotmentCardId=function(t){var a="HEAD"===t?"header":"content";return e.reservationData.group.id?"group-card-"+a:e.reservationData.allotment.id?"allotment-card-"+a:"group-allotment-card-"+a},e.$on("groupCardDetached",function(){e.searchMode=!0}),e.$on("GROUP_SEARCH_ON",function(){e.searchingGroups=!0,e.$broadcast("refreshGroupsListScroller")}),e.$on("GROUP_SEARCH_OFF",function(){e.searchingGroups=!1,e.$broadcast("refreshGroupsListScroller")}),e.$on("newCardSelected",function(t,a){e.searchMode=!1,e.$emit("hideLoader")}),e.companyCardClicked=function(a){a.stopPropagation(),null!==document.getElementById("cc-contact-info")&&getParentWithSelector(a,document.getElementById("cc-contact-info"))&&"cc-contact-info"===e.currentSelectedTab||null!==document.getElementById("cc-contracts")&&getParentWithSelector(a,document.getElementById("cc-contracts"))&&"cc-contracts"===e.currentSelectedTab||null!==document.getElementById("cc-ar-accounts")&&getParentWithSelector(a,document.getElementById("cc-ar-accounts"))&&"cc-ar-accounts"===e.currentSelectedTab||!e.viewState.isAddNewCard&&null!==document.getElementById("company-card-header")&&getParentWithSelector(a,document.getElementById("company-card-header"))&&(e.$emit("saveContactInformation"),t.$broadcast("saveArAccount"))},e.$on("saveContactInformation",function(t){t.preventDefault(),t.stopPropagation(),f(e.contactInformation)}),e.$on("saveCompanyContactInformation",function(t){t.preventDefault(),f(e.contactInformation)}),e.$on("OUTSIDECLICKED",function(a,r){a.preventDefault(),e.checkOutsideClick(r),t.$broadcast("saveArAccount"),t.$broadcast("saveContract")});var u=function(a){e.$emit("hideLoader"),e.reservationDetails.companyCard.id=a.id,e.contactInformation.id=a.id,t.$broadcast("IDGENERATED",{id:a.id}),callCompanyCardServices(),e.viewState.isAddNewCard&&"undefined"!=typeof a.id&&(("STAY_CARD"===e.viewState.identifier||"CREATION"===e.viewState.identifier&&e.viewState.reservationStatus.confirm)&&(e.viewState.pendingRemoval.status=!1,e.viewState.pendingRemoval.cardType="",e.reservationDetails.companyCard.futureReservations<=0?e.replaceCardCaller("company",{id:a.id},!1):e.checkFuture("company",{id:a.id}),e.reservationDetails.companyCard.futureReservations=0),e.viewState.isAddNewCard=!1,e.closeGuestCard(),e.cardSaved(),e.reservationDetails.companyCard.id=a.id,e.reservationData&&e.reservationData.company&&(e.reservationData.company.id=a.id,e.reservationData.company.name=e.contactInformation.account_details.account_name)),presentContactInfo=angular.copy(e.contactInformation)};e.clickedSaveCard=function(t){f(e.contactInformation)};var l=function(t){e.$emit("hideLoader"),e.errorMessage=t,e.currentSelectedTab="cc-contact-info"};e.getClassAgainstPickedStatus=s.getClassAgainstPickedStatus,e.getGuestClassForArrival=s.getGuestClassForArrival,e.getGuestClassForDeparture=s.getGuestClassForDeparture,e.getClassAgainstHoldStatus=s.getClassAgainstHoldStatus,e.stringify=c.stringify,e.isEmpty=_.isEmpty,e.formatDateForUI=function(e){var a="undefined"==typeof e?"undefined":_typeof(e),r="";switch(a){case"string":r=o("date")(new tzIndependentDate(e),t.dateFormat);break;case"object":r=o("date")(e,t.dateFormat)}return r};var f=function(t){var r=!1;if(angular.equals(t,presentContactInfo)||(r=!0),"undefined"!=typeof t&&(r||e.viewState.isAddNewCard)){var n=JSON.parse(JSON.stringify(t));for(key in n)if("undefined"!=typeof n[key]&&null!==t[key]&&""!==t[key]){if("{}"!==JSON.stringify(presentContactInfo))for(subDictKey in n[key])"undefined"!=typeof n[key][subDictKey]&&n[key][subDictKey]!==presentContactInfo[key][subDictKey]||delete n[key][subDictKey]}else delete n[key];"undefined"!=typeof n.countries&&delete n.countries,""===n.account_details.account_number&&(n.account_details.account_number=null),n.account_type=e.account_type,e.invokeApi(a.saveContactInformation,n,u,l)}}}]),angular.module("sntRover").controller("groupResults",["$scope","$timeout",function(e,t){BaseCtrl.call(this,e);var a={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("groupResultsScroll",a),e.$on("refreshGroupsListScroller",function(){t(function(){e.refreshScroller("groupResultsScroll")},500)})}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVGuestCardCtrl",["$scope","RVCompanyCardSrv","$timeout","RVContactInfoSrv","RVSearchSrv","rvPermissionSrv","$rootScope",function(e,t,a,r,n,o,i){GuestCardBaseCtrl.call(this,e,n,r,o,i),e.searchMode=!0,e.guestCardData.selectedLoyaltyLevel="",e.loyaltyTabEnabled=!1,e.reservationDetails.guestCard.id&&(e.searchMode=!1),e.$on("guestSearchInitiated",function(){e.guestSearchIntiated=!0,e.guests=e.searchedGuests,e.$broadcast("refreshGuestScroll")}),e.$on("guestSearchStopped",function(){e.guestSearchIntiated=!1,e.guests=[],e.$broadcast("refreshGuestScroll")}),e.$on("guestCardDetached",function(){e.searchMode=!0}),e.$on("guestCardAvailable",function(){e.searchMode=!1,a(function(){e.$emit("hideLoader")},1e3)}),e.$on("detect-hlps-ffp-active-status",function(t,a){a.userMemberships.use_hlp||a.userMemberships.use_ffp?e.loyaltyTabEnabled=!0:e.loyaltyTabEnabled=!1}),e.$on("loyaltyLevelAvailable",function(t,a){e.guestCardData.selectedLoyaltyLevel=a}),e.loyaltiesStatus={ffp:!1,hlps:!1},e.$setLoyaltyStatus=function(t,a){e.loyaltiesStatus[a]=t.active,e.loyaltiesStatus.ffp||e.loyaltiesStatus.hlps?e.loyaltyTabEnabled=!0:e.loyaltyTabEnabled=!1,e.loyaltiesStatus.hlps?e.guestCardData.loyaltyInGuestCardEnabled=!0:e.guestCardData.loyaltyInGuestCardEnabled=!1},e.fetchLoyaltyStatus=function(){var a=function(t){e.$setLoyaltyStatus(t,"hlps"),e.$emit("hideLoader")},r=function(t){e.$setLoyaltyStatus(t,"ffp"),e.$emit("hideLoader")};e.invokeApi(t.fetchHotelLoyaltiesHlps,{},a),e.invokeApi(t.fetchHotelLoyaltiesFfp,{},r)};var s=e.$on("UPDATE_GUEST_CARD_ACTIONS_BUTTON_STATUS",function(t,a){e.manageCardState.isOpen=a.status});e.$on("$destroy",s)}]),angular.module("sntRover").controller("guestResults",["$scope","$timeout",function(e,t){BaseCtrl.call(this,e);var a={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("guestResultScroll",a),e.$on("refreshGuestScroll",function(){t(function(){e.refreshScroller("guestResultScroll")},500)})}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVAddNewFreaquentLoyaltyContrller",["$scope","$rootScope","RVGuestCardLoyaltySrv","ngDialog",function(e,t,a,r){BaseCtrl.call(this,e),e.userMembershipTypes=e.loyaltyData.freaquentLoyaltyData,e.userMembershipNumber="",e.userMembershipType="",e.userMembershipClass="FFP",e.save=function(){var r=function(a){e.newLoyalty.id=a.id,e.$emit("hideLoader"),e.cancel(),t.$broadcast("loyaltyProgramAdded",e.newLoyalty,"fromGuestCard")},n=function(t){e.$emit("hideLoader"),e.errorMessage=t},o={};o.membership_card_number=e.userMembershipNumber,o.membership_class=e.userMembershipClass,o.membership_type=e.userMembershipType,o.membership_level="",e.newLoyalty=o;var i=e.reservationData&&e.reservationData.reservationId?e.reservationData.reservationId:"",s={user_id:e.$parent.guestCardData.userId,guest_id:e.$parent.guestCardData.guestId,user_membership:o,reservation_id:i},c={params:s,successCallBack:r,failureCallBack:n};e.callAPI(a.createLoyalties,c)},e.cancel=function(){e.closeDialog()}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVAddNewHotelLoyaltyController",["$scope","$rootScope","RVGuestCardLoyaltySrv","ngDialog",function(e,t,a,r){BaseCtrl.call(this,e),e.userMembershipTypes=e.loyaltyData.hotelLoyaltyData,e.userMembershipNumber="",e.userMembershipType="",e.userMembershipClass="HLP",e.userMembershipLevels=[],e.userMembershipLevel="",e.isLevelsAvailable=!1,e.memberShipTypeChanged=function(){angular.forEach(e.userMembershipTypes,function(t,a){e.userMembershipType===t.hl_value&&(e.userMembershipLevels=t.levels,e.userMembershipLevels.length>0?e.isLevelsAvailable=!0:e.isLevelsAvailable=!1)})},e.save=function(){var r=function(a){e.newLoyalty.id=a.id,e.$emit("hideLoader"),e.cancel(),t.$broadcast("loyaltyProgramAdded",e.newLoyalty),e.$emit("REFRESH_CONTACT_INFO",{guestId:e.$parent.guestCardData.guestId})},n=function(t){e.$emit("hideLoader"),e.errorMessage=t},o={};o.membership_card_number=e.userMembershipNumber,o.membership_class=e.userMembershipClass,o.membership_type=e.userMembershipType,o.membership_level=e.userMembershipLevel,e.newLoyalty=o;var i=e.reservationData&&e.reservationData.reservationId?e.reservationData.reservationId:"",s={user_id:e.$parent.guestCardData.userId,guest_id:e.$parent.guestCardData.guestId,user_membership:o,reservation_id:i},c={params:s,successCallBack:r,failureCallBack:n};e.callAPI(a.createLoyalties,c)},e.cancel=function(){e.closeDialog()}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("rvDeleteLoyaltyModalController",["$scope","$rootScope","$filter","RVGuestCardLoyaltySrv","ngDialog",function(e,t,a,r,n){BaseCtrl.call(this,e),e.closeDialog=function(){n.close()},e.dimissLoaderAndDialog=function(){e.$emit("hideLoader"),e.closeDialog()},e.deleteLoyalty=function(){var a=function(){e.loyaltyProgramDeleted(e.loaytyID,e.loyaltyIndexToDelete,e.loyaltyProgramToDelete),t.$broadcast("loyaltyProgramDeleted",e.loaytyID,e.loyaltyIndexToDelete,e.loyaltyProgramToDelete),e.$emit("REFRESH_CONTACT_INFO",{guestId:e.$parent.guestCardData.userId}),e.dimissLoaderAndDialog()},n=function(t){e.dimissLoaderAndDialog(),e.$emit("loyaltyDeletionError",t)};e.invokeApi(r.deleteLoyalty,e.loaytyID,a,n)},e.validate=function(){}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("stayCardMainCtrl",["$rootScope","$scope","RVCompanyCardSrv","$stateParams","RVReservationCardSrv","RVGuestCardSrv","RVGuestCardsSrv","ngDialog","$state","RVReservationSummarySrv","$timeout","dateFilter","RVContactInfoSrv","$q","RVReservationStateService","RVReservationDataService","rvGroupConfigurationSrv","rvAllotmentConfigurationSrv","RVReservationPackageSrv",function(e,t,a,r,n,o,i,s,c,d,u,l,f,m,p,v,y,g,h){function D(e){var a,r;t.idTypeList=e.id_type_list,t.otherData.isGuestPrimaryEmailChecked=!!(e.email&&e.email.length>0),e.stayCount||(e.stayCount=t.guestCardData&&t.guestCardData.contactInfo&&t.guestCardData.contactInfo.stayCount),a={contactInfo:e,countries:t.countries,userId:t.reservationDetails.guestCard.id||t.reservationData.guest.id,avatar:t.guestCardData.cardHeaderImage,guestId:t.reservationDetails.guestCard.id||t.reservationData.guest.id,vip:e.vip},t.guestCardData.contactInfo=a.contactInfo,null!==t.guestCardData.contactInfo.birthday&&(t.guestCardData.contactInfo.birthday=moment(t.guestCardData.contactInfo.birthday).format("YYYY-MM-DD")),null!==t.guestCardData.contactInfo.id_issue_date&&(t.guestCardData.contactInfo.id_issue_date=moment(t.guestCardData.contactInfo.id_issue_date).format("YYYY-MM-DD")),null!==t.guestCardData.contactInfo.entry_date&&(t.guestCardData.contactInfo.entry_date=moment(t.guestCardData.contactInfo.entry_date).format("YYYY-MM-DD")),null!==t.guestCardData.contactInfo.id_expiration_date&&(t.guestCardData.contactInfo.id_expiration_date=moment(t.guestCardData.contactInfo.id_expiration_date).format("YYYY-MM-DD")),t.guestCardData.contactInfo.avatar=a.avatar,t.guestCardData.contactInfo.vip=a.vip,t.countriesList=t.countries,t.guestCardData.userId=a.userId,t.guestCardData.guestId=a.guestId,t.guestCardData.contactInfo.genderTypeList=e.gender_list,r={user_id:a.userId,guest_id:null},t.searchData.guestCard.guestFirstName="",t.searchData.guestCard.guestLastName="",t.searchData.guestCard.guestCity="",t.searchData.guestCard.guestLoyaltyNumber="",t.searchData.guestCard.email="",t.guestCardData.contactInfo.user_id=a.userId,
t.reservationData.guest.email=e.email,t.showGuestPaymentList(r),f.completeContactInfoClone=JSON.parse(JSON.stringify(t.guestCardData.contactInfo)),t.$broadcast("guestSearchStopped"),t.$broadcast("guestCardAvailable"),t.$broadcast("resetGuestTab"),t.$emit("hideLoader")}BaseCtrl.call(this,t),t.addNewCards=!0;var C=this;void 0!==t.guestCardData.cardHeaderImage&&""!==t.guestCardData.cardHeaderImage||(t.guestCardData.cardHeaderImage="/ui/pms-ui/images/avatar-trans.png"),t.pendingRemoval={status:!1,cardType:""},t.$on("parentShowError",function(e,a){t.errorMessage=a});var S="rover.reservation.staycard.mainCard.room-rates",A="rover.reservation.staycard.reservationcard.reservationdetails";t.setHeadingTitle=function(e){t.heading=e,t.setTitle(e)},t.cardSaved=function(){t.viewState.isAddNewCard=!1};var I=function(e){t.countries=e};t.invokeApi(a.fetchCountryList,{},I),t.initGuestCard=function(a){if(a||(a={id:""}),a.id||t.reservationDetails.guestCard.id||t.reservationData.guest.id){var n={id:a.id||t.reservationDetails.guestCard.id||t.reservationData.guest.id};t.guestCardData.userId=n.id,t.guestCardData.guestId=n.id,angular.merge(t.guestCardData.contactInfo,_defineProperty({first_name:t.reservationData.guest.firstName,last_name:t.reservationData.guest.lastName,phone:t.reservationData.guest.phone,mobile:t.reservationData.guest.mobile,vip:t.reservationData.guest.is_vip,email:t.reservationData.guest.email,avatar:t.reservationData.guest.image,address:t.reservationData.guest.address,notes_count:t.reservationData.guest.notes_count,user_id:n.id,nationality_id:t.guestCardData.nationality_id},"address",{country_id:void 0!==t.guestCardData.contactInfo.address?t.guestCardData.contactInfo.address.country_id:""})),u(function(){t.$broadcast("loyaltyLevelAvailable",t.reservationData.guest.membership_type)},1e3),i.setGuest(n.id),t.$broadcast("guestCardAvailable"),("EDIT_HOURLY"===r.mode||e.isHourlyRateOn&&"rover.reservation.staycard.reservationcard.reservationdetails"!==c.current.name)&&t.callAPI(i.fetchGuestDetailsInformation,{successCallBack:function(e){D(e)},failureCallBack:function(e){t.errorMessage=e,t.$emit("hideLoader")},params:n.id})}},t.$on("UPDATE_GUEST_CARD_DETAILS",function(e,t){D(t)});var T=function(e){_.extend(t.groupConfigData,{activeTab:"SUMMARY",summary:e.groupSummary,selectAddons:!1,addons:{},selectedAddons:[]})},b=function(e){_.extend(t.allotmentConfigData,{activeTab:"SUMMARY",summary:e.allotmentSummary,selectAddons:!1,addons:{},selectedAddons:[]})},P=function(e){_.extend(t.allotmentConfigData,{holdStatusList:e.data.hold_status})},E=function(e){_.extend(t.groupConfigData,{holdStatusList:e.data.hold_status})},N=function(e){t.$broadcast("groupCardAvailable"),t.$broadcast("groupSummaryDataChanged",t.groupConfigData),t.$emit("hideLoader")},L=function(e){t.$broadcast("allotmentCardAvailable"),t.$broadcast("allotmentSummaryDataChanged",t.allotmentConfigData),t.$emit("hideLoader")},$=function(e){t.errorMessage=e,t.$emit("hideLoader")},R=function(e){t.invokeApi(h.getReservationPackages,t.reservationData.reservationId,function(a){t.$emit("hideLoader");var n=t.reservationData.rooms[0];n.addons=[],angular.forEach(a.existing_packages,function(e){n.addons.push({quantity:e.addon_count,id:e.id,price:parseFloat(e.amount),amountType:e.amount_type,postType:e.post_type,title:e.name,totalAmount:e.addon_count*parseFloat(e.amount),is_inclusive:e.is_inclusive,taxes:e.taxes,is_rate_addon:e.is_rate_addon,allow_rate_exclusion:e.allow_rate_exclusion,excluded_rate_ids:e.excluded_rate_ids})}),e?t.navigateToRoomAndRates(e):t.reservationData.keepExistingRate?c.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:"undefined"==typeof r.id?t.reservationData.reservationId:r.id,confirmationId:r.confirmationId}):t.navigateToRoomAndRates(e)})};t.initGroupCard=function(e){var a=[];if(t.$emit("showLoader"),t.groupConfigData={activeScreen:"STAY_CARD"},e){var r={groupId:e};a.push(y.getGroupSummary(r).then(T));var n={is_group:!0};a.push(y.getHoldStatusList(n).then(E)),m.all(a).then(N,$)}},t.initAllotmentCard=function(e){var a=[];t.$emit("showLoader"),t.allotmentConfigData={activeScreen:"STAY_CARD"},a.push(g.getAllotmentSummary({allotmentId:e}).then(b)),a.push(y.getHoldStatusList({is_allotment:!0}).then(P)),m.all(a).then(L,$)},t.initCompanyCard=function(){var e=function(e){t.$emit("hideLoader"),e.id=t.reservationDetails.companyCard.id,t.companyContactInformation=e,t.$broadcast("companyCardAvailable")};if(""!==t.reservationDetails.companyCard.id&&null!==t.reservationDetails.companyCard.id){var r={id:t.reservationDetails.companyCard.id};t.invokeApi(a.fetchContactInformationAndMandatoryFields,r,e)}},t.initTravelAgentCard=function(){var e=function(e){t.$emit("hideLoader"),e.id=t.reservationDetails.travelAgent.id,t.travelAgentInformation=e,t.$broadcast("travelAgentFetchComplete")};if(""!==t.reservationDetails.travelAgent.id&&null!==t.reservationDetails.travelAgent.id){var r={id:t.reservationDetails.travelAgent.id};t.invokeApi(a.fetchContactInformationAndMandatoryFields,r,e)}},t.$on("cardIdsFetched",function(a,r){t.viewState.pendingRemoval.status=!1,t.viewState.pendingRemoval.cardType="";var n=0;r.guest||(t.$broadcast("guestCardDetached"),t.initGuestCard(),n+=300),!r.group&&e.isStandAlone&&(u(function(){t.$broadcast("groupCardDetached"),t.initGroupCard(t.reservationDetails.group.id)},n),n+=300),!r.allotment&&e.isStandAlone&&(u(function(){t.$broadcast("groupCardDetached"),t.initAllotmentCard(t.reservationDetails.allotment.id)},n),n+=300),r.company||(u(function(){t.$broadcast("companyCardDetached"),t.initCompanyCard()},n),n+=300),r.agent||u(function(){t.$broadcast("travelAgentDetached"),t.initTravelAgentCard()},n);var o=t.reservationListData.future_reservation_counts;t.reservationDetails.guestCard.futureReservations=null===o.guest?0:o.guest,t.reservationDetails.companyCard.futureReservations=null===o.company?0:o.company,t.reservationDetails.travelAgent.futureReservations=null===o.travel_agent?0:o.travel_agent}),t.navigateToRoomAndRates=function(e){var a,r=t.reservationData,n=e&&e.disableBackToStaycard,o=e&&e.isGroupDetachmentRequested;c.go(S,(a={from_date:r.arrivalDate,to_date:r.departureDate,fromState:function(){return"rover.reservation.staycard.reservationcard.reservationdetails"===c.current.name?"STAY_CARD":c.current.name}(),company_id:r.company.id,allotment_id:r.allotment.id,travel_agent_id:r.travelAgent.id,group_id:r.group&&r.group.id},_defineProperty(a,"allotment_id",r.allotment&&r.allotment.id),_defineProperty(a,"disable_back_staycard",n),_defineProperty(a,"view","ROOM_RATE"),_defineProperty(a,"room_type_id",t.$parent.reservationData.tabs[t.viewState.currentTab].roomTypeId),_defineProperty(a,"adults",t.$parent.reservationData.tabs[t.viewState.currentTab].numAdults),_defineProperty(a,"children",t.$parent.reservationData.tabs[t.viewState.currentTab].numChildren),_defineProperty(a,"isGroupDetachmentRequested",o),a))},t.reloadTheStaycard=function(e){e?c.reload(c.current.name):c.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:"undefined"==typeof r.id?t.reservationData.reservationId:r.id,confirmationId:r.confirmationId||t.reservationData.confirmNum,isrefresh:!1})},t.isInStayCardScreen=function(){return"STAY_CARD"===t.viewState.identifier},function(){var e=null,r=function(a){t.$emit("hideLoader"),t.cardRemoved(e),t.$broadcast("CARD_REMOVED",e),a.contracted_rate_was_present&&"guest"!==e?R({disableBackToStaycard:!0}):C.reloadStaycard()},n=function(e){if(t.$emit("hideLoader"),e.hasOwnProperty("httpStatus"))if(470===e.httpStatus){var a={errorMessages:e.errorMessage};s.open({template:"/assets/partials/cards/popups/detachCardsAPIErrorPopup.html",className:"ngdialog-theme-default stay-card-alerts",scope:t,closeByDocument:!1,closeByEscape:!1,data:JSON.stringify(a)})}else t.errorMessage=e},o=function(e){},i=function(e,t,i){var s=[];_.each(e.reservationIds,function(e){var r={reservation:e,cardType:t,cardId:i};s.push(a.removeCard(r).then(o))}),m.all(s).then(r,n)},c=function(e,o){var i={reservation:t.reservationData.reservationId,cardType:e,cardId:o};t.invokeApi(a.removeCard,i,r,n)};t.removeCard=function(a,r){var r=r||null,n=_.filter(t.reservationDetails,function(e){return!!e.id}).length;if(e=a,n>1&&""!==a){var o=t.reservationData,d=o&&o.reservationIds&&o.reservationIds.length>1;d?(t.$emit("showLoader"),i(o,a,r)):c(a,r)}else(t.viewState.pendingRemoval.status||r)&&(t.viewState.pendingRemoval.status=!1,t.viewState.pendingRemoval.cardType="",t.viewState.lastCardSlot={cardType:a,cardId:r},u(function(){s.open({template:"/assets/partials/cards/alerts/cardRemoval.html",className:"ngdialog-theme-default stay-card-alerts",scope:t,closeByDocument:!1,closeByEscape:!1})},300))}}(),t.noRoutingToReservation=function(){s.close(),C.useCardRate?t.navigateToRoomAndRates():C.reloadStaycard()},t.applyRoutingToReservation=function(){var e=function(e){t.$emit("hideLoader"),s.close(),C.useCardRate?t.navigateToRoomAndRates():C.reloadStaycard(),t.$broadcast("paymentTypeUpdated")},a=function(e){t.errorMessage=e,t.$emit("hideLoader")},r={};r.account_id="TRAVEL_AGENT"===t.contractRoutingType?t.reservationData.travelAgent.id:t.reservationData.company.id,r.reservation_ids=[],r.reservation_ids.push(t.reservationData.reservationId),t.invokeApi(d.applyDefaultRoutingToReservation,r,e,a)},t.okClickedForConflictingRoutes=function(){s.close(),C.useCardRate?t.navigateToRoomAndRates():C.reloadStaycard()},this.showConfirmRoutingPopup=function(e,a){s.open({template:"/assets/partials/reservation/alerts/rvBillingInfoConfirmPopup.html",className:"ngdialog-theme-default",scope:t})},this.showConflictingRoutingPopup=function(e,a){s.open({template:"/assets/partials/reservation/alerts/rvBillingInfoConflictingPopup.html",className:"ngdialog-theme-default",scope:t})},this.attachCompanyTACardRoutings=function(e,a){if(t.reservationData.group.id)return!1;var r=function(a){return t.$emit("hideLoader"),t.routingInfo=a,a.has_conflicting_routes?(t.conflict_cards=[],"travel_agent"===e&&a.travel_agent.routings_count>0&&t.conflict_cards.push(t.reservationData.travelAgent.name),"company"===e&&a.company.routings_count>0&&t.conflict_cards.push(t.reservationData.company.name),C.showConflictingRoutingPopup(),!1):"travel_agent"===e&&a.travel_agent.routings_count>0?(t.contractRoutingType="TRAVEL_AGENT",C.showConfirmRoutingPopup(t.contractRoutingType,t.reservationData.travelAgent.id),!1):"company"===e&&a.company.routings_count>0?(t.contractRoutingType="COMPANY",C.showConfirmRoutingPopup(t.contractRoutingType,t.reservationData.company.id),!1):("company"===e&&0===a.company.routings_count||"travel_agent"===e&&0===a.travel_agent.routings_count||!a.has_conflicting_routes)&&C.useCardRate?(t.navigateToRoomAndRates(),!1):void C.reloadStaycard()},n={};n.reservation_id=t.reservationData.reservationId,"travel_agent"===e?n.travel_agent_id=t.reservationDetails.travelAgent.id:"company"===e&&(n.company_id=t.reservationDetails.companyCard.id),t.invokeApi(d.fetchDefaultRoutingInfo,n,r)},t.newCardData={},t.replaceCard=function(e,r,n,o){C.useCardRate=o,"company"===e?(t.reservationData.company.id=r.id,t.reservationData.company.name=r.account_name):"travel_agent"===e&&(t.reservationData.travelAgent.id=r.id,t.reservationData.travelAgent.name=r.account_name);var i=function(a){t.cardRemoved(e),t.cardReplaced(e,r),t.viewState.lastCardSlot&&t.viewState.lastCardSlot.cardType&&e!==t.viewState.lastCardSlot.cardType&&t.removeCard(t.viewState.lastCardSlot.cardType,t.viewState.lastCardSlot.cardId,!0),"travel_agent"===e&&t.$broadcast("travelagentcardreplaced",a.data),"company"===e&&t.$broadcast("COMPANY_ADDED"),t.viewState.lastCardSlot="",t.$emit("hideLoader"),t.newCardData=r,C.attachCompanyTACardRoutings(e,r),s.close(),c.current.name===A&&("company"===e?t.$broadcast("UPDATE_COMPANY_NAME_IN_STAYCARD",{name:r.account_name}):"travel_agent"===e&&t.$broadcast("UPDATE_TA_NAME_IN_STAYCARD",{name:r.account_name}))},d=function(a){t.cardRemoved(),480===a.httpStatus?(t.cardReplaced(e,r),t.viewState.lastCardSlot&&t.viewState.lastCardSlot.cardType&&(t.removeCard(t.viewState.lastCardSlot),t.viewState.lastCardSlot=""),t.newCardData=r,C.attachCompanyTACardRoutings(e,r),p.setReservationFlag("RATE_CHANGE_FAILED",!0),s.close()):t.$broadcast("SHOWERRORMESSAGE",a),t.$emit("hideLoader")},u=function(){};if(n&&t.reservationData&&t.reservationData.reservationIds&&t.reservationData.reservationIds.length>1){var l=[];t.$emit("showLoader"),_.each(t.reservationData.reservationIds,function(t){l.push(a.replaceCard({reservation:t,cardType:e,id:r.id,future:"undefined"!=typeof n&&n,useCardRate:o}).then(u))}),m.all(l).then(i,d)}else t.invokeApi(a.replaceCard,{reservation:t.reservationData.reservationId,cardType:e,id:r.id,future:"undefined"!=typeof n&&n,useCardRate:o},i,d)},this.reloadStaycard=function(){t.newCardData.hasOwnProperty("isMultipleContracts")&&1==t.newCardData.isMultipleContracts&&c.current.name!==S&&!t.reservationData.group.id?R():"STAY_CARD"!==t.viewState.identifier||"undefined"==typeof r.confirmationId||t.viewState.lastCardSlot||(p.getReservationFlag("RATE_CHANGE_FAILED")?(p.setReservationFlag("RATE_CHANGE_FAILED",!1),s.open({template:"/assets/partials/cards/alerts/contractedRateChangeFailure.html",scope:t,closeByDocument:!1,closeByEscape:!1})):c.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:"undefined"==typeof r.id?t.reservationData.reservationId:r.id,confirmationId:r.confirmationId}))},t.cardRemoved=function(e){if(t.viewState.pendingRemoval.status=!1,t.viewState.pendingRemoval.cardType="","guest"===e){t.reservationDetails.guestCard.id="",t.reservationDetails.guestCard.futureReservations=0;var a={contactInfo:{},countries:t.countries,userId:"",avatar:"",guestId:"",vip:""};t.guestCardData.contactInfo=a.contactInfo,t.guestCardData.contactInfo.avatar=a.avatar,t.guestCardData.contactInfo.vip=a.vip,t.countriesList=a.countries,t.guestCardData.userId=a.userId,t.guestCardData.guestId=a.guestId,t.guestCardData.contactInfo.birthday=null}"company"===e?(t.reservationData.company.id="",t.reservationDetails.companyCard.id="",t.reservationDetails.companyCard.futureReservations=0):"travel_agent"===e&&(t.reservationData.travelAgent.id="",t.reservationDetails.travelAgent.id="",t.reservationDetails.travelAgent.futureReservations=0,t.$broadcast("travelagentcardremoved"))},t.cardReplaced=function(e,a){"company"===e?(t.reservationDetails.companyCard.id=a.id,t.reservationData.company.id=a.id,t.initCompanyCard(),t.searchData.companyCard.companyName="",t.searchData.companyCard.companyCity="",t.searchData.companyCard.companyCorpId="",t.showContractedRates({companyCard:a.id,travelAgent:t.reservationDetails.travelAgent.id}),t.$broadcast("companySearchStopped")):"travel_agent"===e?(t.reservationDetails.travelAgent.id=a.id,t.reservationData.travelAgent.id=a.id,t.initTravelAgentCard(),t.searchData.travelAgentCard.travelAgentName="",t.searchData.travelAgentCard.travelAgentCity="",t.searchData.travelAgentCard.travelAgentIATA="",t.showContractedRates({companyCard:t.reservationData.company.id,travelAgent:a.id}),t.$broadcast("travelAgentSearchStopped")):"guest"===e&&(t.reservationDetails.guestCard.id=a.id,t.searchData.guestCard.guestFirstName="",t.searchData.guestCard.guestLastName="",t.searchData.guestCard.guestCity="",t.searchData.guestCard.guestLoyaltyNumber="",t.searchData.guestCard.email="",t.initGuestCard(a),t.callAPI(i.fetchGuestDetailsInformation,{successCallBack:function(e){t.reservationData.guest&&t.reservationData.guest.id&&(t.reservationData.guest.id=a.id),D(e)},failureCallBack:function(e){t.errorMessage=e,t.$emit("hideLoader")},params:a.id}),t.$broadcast("guestSearchStopped"))},t.showGuestPaymentList=function(e){var a=e.user_id,r=e.guest_id,n=function(e){t.$emit("hideLoader");var e={data:e,user_id:a,guest_id:r};t.$emit("GUESTPAYMENTDATA",e),t.$emit("SHOWGUESTLIKES")};t.invokeApi(o.fetchGuestPaymentData,a,n,"","NONE")},t.showContractedRates=function(e){t.$broadcast("cardChanged",e)};var w=function(e,a){var r=function(){t.reservationData.guest.id||t.reservationData.company.id||t.reservationData.travelAgent.id?t.saveReservation():t.$emit("PROMPTCARD")};t.otherData.taxesMeta=e.tax_codes,t.otherData.hourlyTaxInfo=e.tax_information,p.metaData.taxDetails=angular.copy(e.tax_codes),t.reservationData.totalTax=0,a&&(t.reservationData.guest.id||t.reservationData.company.id||t.reservationData.travelAgent.id?t.saveReservation():(t.$emit("PROMPTCARD"),t.$watch("reservationData.guest.id",r),t.$watch("reservationData.company.id",r),t.$watch("reservationData.travelAgent.id",r))),u(function(){t.$emit("hideLoader")},500)};t.populateDatafromDiary=function(e,a,r){var n=[];this.rooms=[],angular.forEach(a.rooms,function(t){t.roomTypeId=parseInt(e[t.room_id].room_type_id,10),t.roomTypeName=e[t.room_id].room_type_name,t.roomNumber=e[t.room_id].room_no,n.push(parseInt(t.roomTypeId,10))}),n=_.uniq(n),t.reservationData.tabs=v.getTabDataModel(n.length,n),t.reservationData.rooms=[],_.each(t.reservationData.tabs,function(e){var r=_.filter(a.rooms,function(t){return parseInt(t.roomTypeId,10)===parseInt(e.roomTypeId,10)});e.roomCount=r.length,t.reservationData.rooms=t.reservationData.rooms.concat(r)}),t.reservationData.arrivalDate=l(new tzIndependentDate(a.arrival_date),"yyyy-MM-dd"),t.reservationData.departureDate=l(new tzIndependentDate(a.departure_date),"yyyy-MM-dd");var o=a.arrival_time.split(":");t.reservationData.checkinTime.hh=o[0],t.reservationData.checkinTime.mm=o[1].split(" ")[0],1===t.reservationData.checkinTime.mm.length&&(t.reservationData.checkinTime.mm="0"+t.reservationData.checkinTime.mm),t.reservationData.checkinTime.ampm=o[1].split(" ")[1],"AM"!==t.reservationData.checkinTime.ampm&&"PM"!==t.reservationData.checkinTime.ampm&&(parseInt(t.reservationData.checkinTime.hh)>=12?(t.reservationData.checkinTime.hh=Math.abs(parseInt(t.reservationData.checkinTime.hh)-12)+"",t.reservationData.checkinTime.ampm="PM"):t.reservationData.checkinTime.ampm="AM"),0!==Math.abs(parseInt(t.reservationData.checkinTime.hh)-12)&&"00"!==t.reservationData.checkinTime.hh&&"0"!==t.reservationData.checkinTime.hh||(t.reservationData.checkinTime.hh="12"),1===t.reservationData.checkinTime.hh.length&&(t.reservationData.checkinTime.hh="0"+t.reservationData.checkinTime.hh);var i=a.departure_time.split(":");t.reservationData.checkoutTime.hh=i[0],t.reservationData.checkoutTime.mm=i[1].split(" ")[0],1===t.reservationData.checkoutTime.mm.length&&(t.reservationData.checkoutTime.mm="0"+t.reservationData.checkoutTime.mm),t.reservationData.checkoutTime.ampm=i[1].split(" ")[1],"AM"!==t.reservationData.checkoutTime.ampm&&"PM"!==t.reservationData.checkoutTime.ampm&&(parseInt(t.reservationData.checkoutTime.hh)>=12?(t.reservationData.checkoutTime.hh=Math.abs(parseInt(t.reservationData.checkoutTime.hh)-12)+"",t.reservationData.checkoutTime.ampm="PM"):t.reservationData.checkoutTime.ampm="AM"),"0"!==Math.abs(parseInt(t.reservationData.checkoutTime.hh)-12)&&"00"!==t.reservationData.checkoutTime.hh&&"0"!==t.reservationData.checkoutTime.hh||(t.reservationData.checkoutTime.hh="12"),1===t.reservationData.checkoutTime.hh.length&&(t.reservationData.checkoutTime.hh="0"+t.reservationData.checkoutTime.hh);var s=a.rooms[0];this.reservationId=s.reservation_id,this.confirmNum=s.confirmation_id,this.reservationId?t.viewState.identifier="CONFIRM":(t.viewState.identifier="CREATION",t.viewState.reservationStatus.confirm=!1),t.reservationDetails.guestCard={},t.reservationDetails.guestCard.id=s.guest_card_id,t.reservationDetails.travelAgent={},t.reservationDetails.travelAgent.id=s.travel_agent_id,t.reservationDetails.companyCard={},t.reservationDetails.companyCard.id=s.company_card_id,t.reservationData.guest={},t.reservationData.guest.id=s.guest_card_id,t.reservationData.travelAgent={},t.reservationData.travelAgent.id=s.travel_agent_id,t.reservationData.company={},t.reservationData.company.id=s.company_card_id,t.reservationData.guest.id&&t.initGuestCard({id:t.reservationData.guest.id}),t.reservationData.company.id&&t.initCompanyCard(),t.reservationData.travelAgent.id&&t.initTravelAgentCard(),this.totalStayCost=0;var c=[],u=this;angular.forEach(t.reservationData.rooms,function(e){var r=_.findWhere(a.rooms,{roomNumber:e.roomNumber});e.stayDates={},c.push(r.rateId),e.numAdults=r.numAdults,e.numChildren=r.numChildren,e.numInfants=r.numInfants,e.roomTypeId=r.roomTypeId,e.amount=r.amount,e.room_id=r.room_id,e.room_no=r.room_no,e.room_type=r.room_type,a.addons&&(e.addons=[],angular.forEach(a.addons,function(t){e.addons.push({quantity:t.addon_count,id:t.id,price:parseFloat(t.amount),amountType:t.amount_type,postType:t.post_type,title:t.name,totalAmount:t.addon_count*parseFloat(t.amount),is_inclusive:t.is_inclusive,taxes:t.taxes,is_rate_addon:t.is_rate_addon})})),e.rateId=r.rateId,e.roomAmount=r.amount,e.demographics={market:"undefined"!=typeof r.demographics&&r.demographics.market_segment_id?r.demographics.market_segment_id:"",source:"undefined"!=typeof r.demographics&&r.demographics.source_id?r.demographics.source_id:"",reservationType:"undefined"!=typeof r.demographics&&r.demographics.reservation_type_id?r.demographics.reservation_type_id:"",origin:"undefined"!=typeof r.demographics&&r.demographics.booking_origin_id?r.demographics.booking_origin_id:"",segment:"undefined"!=typeof r.segment&&r.demographics.segment_id?r.demographics.segment_id:""},u.demographics=angular.copy(e.demographics),u.totalStayCost=parseFloat(u.totalStayCost)+parseFloat(r.amount);var n=function(a){e.rateName=a.name,t.reservationData.demographics.market||(t.reservationData.demographics.market=a.market_segment_id?a.market_segment_id:""),t.reservationData.demographics.source||(t.reservationData.demographics.source=a.source_id?a.source_id:""),t.reservationData.demographics.origin||(t.reservationData.demographics.origin=a.booking_origin_id?a.booking_origin_id:""),angular.forEach(t.reservationData.rooms,function(e,t){e.demographics.market||(e.demographics.market=a.market_segment_id?a.market_segment_id:""),e.demographics.source||(e.demographics.source=a.source_id?a.source_id:""),e.demographics.origin||(e.demographics.origin=a.booking_origin_id?a.booking_origin_id:"")}),(a.deposit_policy&&a.deposit_policy.id||a.deposit_policy_id)&&(t.reservationData.depositData={},t.reservationData.depositData.isDepositRequired=!0,t.reservationData.depositData.description=a.deposit_policy.description,t.reservationData.depositData.depositSuccess=!t.reservationData.depositData.isDepositRequired,t.reservationData.depositData.attempted=!1,t.reservationData.depositData.depositAttemptFailure=!1,t.$broadcast("UPDATEDEPOSIT"))},o=parseFloat(e.roomAmount).toFixed(2);t.invokeApi(d.getRateDetails,{id:e.rateId},n);for(var i=1*new tzIndependentDate(t.reservationData.arrivalDate),s=1*new tzIndependentDate(t.reservationData.departureDate);i<=s;i+=864e5)e.stayDates[l(new tzIndependentDate(i),"yyyy-MM-dd")]={guests:{adults:e.numAdults,children:e.numChildren,infants:e.numInfants},rate:{id:e.rateId},rateDetails:{actual_amount:o,modified_amount:o,is_discount_allowed:"true"}},e.contract_id&&(e.stayDates[l(new tzIndependentDate(i),"yyyy-MM-dd")].contractId=e.contract_id,delete e.contract_id)}),t.invokeApi(d.getTaxDetails,{rate_ids:c},w)}.bind(t.reservationData),t.loadPrevState=function(){e.loadPrevState(),e.$broadcast("OUTSIDECLICKED")},t.staycardClicked=function(){t.$broadcast("saveContactInfo")}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVTravelAgentCardCtrl",["$scope","$rootScope","$timeout","RVCompanyCardSrv","rvCompanyCardContractsSrv","ngDialog","$filter","$stateParams","rvPermissionSrv","rvFileCloudStorageSrv",function(e,t,a,r,n,o,i,s,c,d){e.searchMode=!0,e.account_type="TRAVELAGENT",e.currentSelectedTab="cc-contact-info",e.isGlobalToggleReadOnly=!c.getPermissionValue("GLOBAL_CARD_UPDATE");var u=[];e.hasPermissionToViewCommissionTab=function(){return c.getPermissionValue("VIEW_COMMISSIONS_TAB")},e.isCommissionTabAvailable=e.hasPermissionToViewCommissionTab(),e.switchTabTo=function(t,a){t.stopPropagation(),t.stopImmediatePropagation();var r=!!e.contactInformation.account_details.accounts_receivable_number;"cc-contact-info"===e.currentSelectedTab&&"cc-contact-info"!==a&&(e.viewState.isAddNewCard?e.$broadcast("setCardContactErrorMessage",[i("translate")("TA_SAVE_PROMPT")]):(g(e.contactInformation),e.$broadcast("contractTabActive"))),"cc-contracts"===e.currentSelectedTab&&"cc-contracts"!==a?(e.$broadcast("contactTabActive"),e.$broadcast("saveContract")):"cc-ar-accounts"===e.currentSelectedTab&&"cc-ar-accounts"!==a&&e.$broadcast("saveArAccount"),"cc-ar-accounts"===a?e.$broadcast("arAccountTabActive"):"cc-contracts"===a?e.$broadcast("contractTabActive"):"cc-contact-info"===a?e.$broadcast("contactTabActive"):"cc-ar-transactions"===a&&r?(e.$broadcast("arTransactionTabActive"),e.isWithFilters=!1):"cc-notes"===a?(e.$broadcast("fetchNotes"),e.isWithFilters=!1):"statistics"===a?e.$broadcast("LOAD_STATISTICS"):"wallet"===a?e.$broadcast("wallet"):"cc-commissions"===a?e.$broadcast("commissionsTabActive"):"cc-activity-log"===a&&e.$broadcast("activityLogTabActive"),"cc-ar-transactions"!==a||r?e.viewState.isAddNewCard||(e.currentSelectedTab=a):console.warn("Save AR Account and Navigate to AR Transactions")},e.$on("ARTransactionSearchFilter",function(t,a){e.isWithFilters=a});var l={},f=!1;e.shouldShowARMandatoryPopup=function(){var t=(!e.contactInformation.mandatoryFields.address_line1_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.address_line1_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.street1))&&(!e.contactInformation.mandatoryFields.city_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.city_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.city))&&(!e.contactInformation.mandatoryFields.postal_code_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.postal_code_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.postal_code))&&(!e.contactInformation.mandatoryFields.country_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.country_mandatory.is_mandatory||""!==e.contactInformation.address_details.country_id&&null!==e.contactInformation.address_details.country_id)&&(!e.contactInformation.mandatoryFields.contact_phone_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_phone_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.phone))&&(!e.contactInformation.mandatoryFields.contact_email_address_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_email_address_mandatory.is_mandatory||!isEmpty(e.contactInformation.address_details.email_address)&&isValidEmail(e.contactInformation.address_details.email_address))&&(!e.contactInformation.mandatoryFields.e_invoice_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.e_invoice_mandatory.is_mandatory||!isEmpty(e.contactInformation.e_invoice_address))&&(!e.contactInformation.mandatoryFields.organization_id_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.organization_id_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.organization_id))&&(!e.contactInformation.mandatoryFields.tax_id_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.tax_id_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.tax_number))&&(!e.contactInformation.mandatoryFields.regd_tax_office_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.regd_tax_office_mandatory.is_mandatory||!isEmpty(e.contactInformation.account_details.reg_tax_office))&&(!e.contactInformation.mandatoryFields.contact_name_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.contact_name_mandatory.is_mandatory||!isEmpty(e.contactInformation.primary_contact_details.contact_first_name)&&!isEmpty(e.contactInformation.primary_contact_details.contact_last_name))&&(!!e.arAccountDetails.is_auto_assign_ar_numbers||""!==e.arAccountDetails.ar_number&&null!==e.arAccountDetails.ar_number)&&(!e.contactInformation.mandatoryFields.payment_due_days_mandatory.is_mandatory_on_ar_account_creation&&!e.contactInformation.mandatoryFields.payment_due_days_mandatory.is_mandatory||""!==e.arAccountDetails.payment_due_days&&null!==e.arAccountDetails.payment_due_days);return t},e.$on("saveArAccountFromMandatoryPopup",function(t,a){e.arAccountDetails=a,e.isArTabAvailable=!0,e.shouldSaveArDataFromPopup=!0}),e.openCompanyTravelAgentCardMandatoryFieldsPopup=function(){e.shouldSaveArDataFromPopup=!1,o.open({template:"/assets/partials/companyCard/rvCompanyTravelAgentCardMandatoryFieldsPopup.html",className:"ngdialog-theme-default1 calendar-single1",controller:"companyTravelAgentMandatoryFieldsController",closeByDocument:!1,scope:e})},e.clickedCreateArAccountButton=function(){e.shouldShowARMandatoryPopup()?(f=!0,e.showARTab()):(e.isMandatoryPopupOpen=!0,e.openCompanyTravelAgentCardMandatoryFieldsPopup())},e.$on("UPDATE_MANDATORY_POPUP_OPEN_FLAG",function(){e.isMandatoryPopupOpen=!1}),e.showARTab=function(t){g(e.contactInformation)},e.$on("ARNumberChanged",function(t,a){e.contactInformation.account_details.accounts_receivable_number=a.newArNumber}),e.deleteArAccount=function(){o.open({template:"/assets/partials/companyCard/rvCompanyCardDeleteARaccountPopup.html",className:"ngdialog-theme-default1 calendar-single1",closeByDocument:!1,scope:e})},e.deleteARAccountConfirmed=function(){var t=function(t){e.$emit("hideLoader"),e.isArTabAvailable=!1,e.$broadcast("setgenerateNewAutoAr",!1),e.$broadcast("ArAccountDeleted"),e.contactInformation.account_details.accounts_receivable_number="",o.close()},a={id:e.reservationDetails.travelAgent.id};e.invokeApi(r.deleteArAccount,a,t)},e.clikedDiscardDeleteAr=function(){o.close()};var m=function(){var t={id:e.reservationDetails.travelAgent.id},a=function(t){e.$emit("hideLoader"),e.arAccountNotes=t,e.$broadcast("ARDetailsRecieved")},n=function(){e.invokeApi(r.fetchArAccountNotes,t,a)},o=function(t){e.$emit("hideLoader"),e.arAccountDetails=t,e.arAccountDetails.is_use_main_contact!==!1&&(e.arAccountDetails.is_use_main_contact=!0),e.arAccountDetails.is_use_main_address!==!1&&(e.arAccountDetails.is_use_main_address=!0),n()};e.invokeApi(r.fetchArAccountDetails,t,o)};e.$on("travelAgentFetchComplete",function(t,r){e.searchMode=!1,e.contactInformation=e.travelAgentInformation,e.contactInformation.id=e.reservationDetails.travelAgent.id,e.currentSelectedTab="cc-contact-info",l=angular.copy(e.contactInformation),r===!0&&(e.contactInformation.account_details.account_name=e.searchData.travelAgentCard.travelAgentName,e.contactInformation.address_details.city=e.searchData.travelAgentCard.travelAgentCity,e.contactInformation.account_details.account_number=e.searchData.travelAgentCard.travelAgentIATA),e.$broadcast("contactTabActive"),e.$broadcast("UPDATE_CONTACT_INFO"),a(function(){e.$emit("hideLoader")},1e3),r||m(),e.contactInformation.commission_details&&(e.displayShowPropertiesButton=!e.contactInformation.commission_details.is_global_commission)}),e.$on("travelAgentSearchInitiated",function(){e.companySearchIntiated=!0,e.travelAgents=e.searchedtravelAgents,e.$broadcast("refreshTravelAgentScroll")}),e.$on("travelAgentSearchStopped",function(){e.companySearchIntiated=!1,e.travelAgents=[],e.$broadcast("refreshTravelAgentScroll")}),e.$on("travelAgentDetached",function(){
e.searchMode=!0,e.isArTabAvailable=!1,e.$broadcast("setgenerateNewAutoAr",!1)}),e.travelAgentCardClicked=function(a){a.stopPropagation(),null!==document.getElementById("cc-contact-info")&&getParentWithSelector(a,document.getElementById("cc-contact-info"))&&"cc-contact-info"===e.currentSelectedTab||null!==document.getElementById("cc-contracts")&&getParentWithSelector(a,document.getElementById("cc-contracts"))&&"cc-contracts"===e.currentSelectedTab||null!==document.getElementById("cc-ar-accounts")&&getParentWithSelector(a,document.getElementById("cc-ar-accounts"))&&"cc-ar-accounts"===e.currentSelectedTab||(!e.viewState.isAddNewCard&&null!==document.getElementById("travel-agent-card-header")&&getParentWithSelector(a,document.getElementById("travel-agent-card-header"))&&(e.$emit("saveContactInformation"),t.$broadcast("saveArAccount")),d.activeCardType="ACCOUNT_TRAVELAGENT")},e.$on("saveContactInformation",function(t,a){t.preventDefault(),t.stopPropagation(),a&&a.other_hotels_info?(e.contactInformation.commission_details.other_hotels_info=a.other_hotels_info,g(e.contactInformation,a.hotel_info_changed_from_popup)):g(e.contactInformation)}),e.$on("saveTravelAgentContactInformation",function(t){t.preventDefault(),g(e.contactInformation)}),e.toggleGlobalButton=function(){c.getPermissionValue("GLOBAL_CARD_UPDATE")&&(e.contactInformation.is_global_enabled=!e.contactInformation.is_global_enabled,e.contactInformation.account_type=e.account_type)},e.shouldShowCommissionsTab=function(){return"TRAVELAGENT"===e.account_type},e.isUpdateEnabledForTravelAgent=function(){if(void 0!==e.contactInformation.is_global_enabled){var t=!1;return e.contactInformation.is_global_enabled?c.getPermissionValue("GLOBAL_CARD_UPDATE")||(t=!0):c.getPermissionValue("EDIT_TRAVEL_AGENT_CARD")||(t=!0),t}},e.isUpdateEnabledForName=function(){var e=n.getContractedRates(),t=!0;return(e.current_contracts&&e.current_contracts.length>0||e.future_contracts&&e.future_contracts.length>0||e.history_contracts&&e.history_contracts.length>0)&&(t=!1),t},e.$on("OUTSIDECLICKED",function(a,r){a.preventDefault(),g(e.contactInformation),e.checkOutsideClick(r),t.$broadcast("saveArAccount"),t.$broadcast("saveContract")});var p=function(a,r){r&&o.close(),e.contactInformation.commission_details&&e.contactInformation.commission_details.is_global_commission&&angular.forEach(e.contactInformation.commission_details.other_hotels_info,function(t){t.commission_type=e.contactInformation.commission_details.commission_type,t.type=e.contactInformation.commission_details.type,t.value=e.contactInformation.commission_details.value,t.is_prepaid=e.contactInformation.commission_details.is_prepaid}),e.contactInformation.id=a.id,e.reservationDetails.travelAgent.id=a.id,t.$broadcast("IDGENERATED",{id:a.id}),e.shouldSaveArDataFromPopup&&(e.shouldSaveArDataFromPopup=!1,e.$broadcast("UPDATE_AR_ACCOUNT_DETAILS",e.arAccountDetails),e.$broadcast("saveArAccount")),m(),e.viewState.isAddNewCard&&"undefined"!=typeof a.id&&(("STAY_CARD"===e.viewState.identifier||"CREATION"===e.viewState.identifier&&e.viewState.reservationStatus.confirm)&&(e.viewState.pendingRemoval.status=!1,e.reservationDetails.travelAgent.futureReservations<=0?e.replaceCardCaller("travel_agent",{id:a.id},!1):e.checkFuture("travel_agent",{id:a.id}),e.reservationDetails.travelAgent.futureReservations=0,e.viewState.pendingRemoval.cardType=""),e.viewState.isAddNewCard=!1,e.closeGuestCard(),e.cardSaved(),e.reservationDetails.travelAgent.id=a.id,e.reservationData&&e.reservationData.travelAgent&&(e.reservationData.travelAgent.id=a.id,e.reservationData.travelAgent.name=e.contactInformation.account_details.account_name)),l=angular.copy(e.contactInformation)},v=function(a){t.$broadcast("setCardContactErrorMessage",a),e.currentSelectedTab="cc-contact-info"};e.clickedSaveCard=function(t){"travel_agent"===t&&"CHECKEDOUT"===e.reservationData.status&&new Date(e.userInfo.business_date)>new Date(e.reservationData.departureDate)?o.open({template:"/assets/partials/cards/popups/rvNewTACommissionsWarningPopup.html",className:"",closeByDocument:!1,closeByEscape:!1,scope:e}):g(e.contactInformation)},e.saveNewTACard=function(t){t.stopPropagation(),o.close(),g(e.contactInformation)};var y=function(e,t){return e&&e.commission_details&&t&&t.commission_details},g=function(t,a){var n=!1;if(u=[],y(t,l)&&!angular.equals(t,l)&&(n=!0,angular.forEach(t.commission_details.other_hotels_info,function(e){angular.forEach(l.commission_details.other_hotels_info,function(t){e.id!==t.id||_.isMatch(e,t)||u.push(e)})})),"undefined"!=typeof t&&(n||e.viewState.isAddNewCard)){var i=JSON.parse(JSON.stringify(t));i.commission_details&&(i.commission_details.other_hotels_info=angular.copy(u)),"undefined"!=typeof i.countries&&delete i.countries,""===i.account_details.account_number&&(i.account_details.account_number=null),"undefined"==typeof i.primary_contact_details?(i.primary_contact_details={},i.primary_contact_details.contact_email=null):""===i.primary_contact_details.contact_email&&(i.primary_contact_details.contact_email=null),"undefined"==typeof i.address_details&&(i.address_details={}),i.account_type=e.account_type;var s={params:i,successCallBack:function(e){p(e,a)},failureCallBack:v};e.callAPI(r.saveContactInformation,s)}else e.shouldSaveArDataFromPopup&&(e.shouldSaveArDataFromPopup=!1,e.$broadcast("UPDATE_AR_ACCOUNT_DETAILS",e.arAccountDetails),e.$broadcast("saveArAccount")),f&&(e.$broadcast("setgenerateNewAutoAr",!0),e.$broadcast("saveArAccount"),e.isArTabAvailable=!0),f=!1,a&&o.close()};e.hasPermissionToCreateArAccount=function(){return c.getPermissionValue("CREATE_AR_ACCOUNT")}}]),angular.module("sntRover").controller("travelAgentResults",["$scope","$timeout",function(e,t){BaseCtrl.call(this,e);var a={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("travelAgentResultScroll",a),e.$on("refreshTravelAgentScroll",function(){t(function(){e.refreshScroller("travelAgentResultScroll")},500)})}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVLikesController",["$scope","RVLikesSrv","RVGuestCardsSrv","dateFilter","$stateParams",function(e,t,a,r,n){e.errorMessage="",e.guestCardData.likes={},e.guestLikesData={},e.setScroller("likes_info"),e.calculatedHeight=274;var o={},i={},s=!1;e.$on("clearNotifications",function(){e.errorMessage="",e.successMessage=""}),e.init=function(){BaseCtrl.call(this,e);var a=function(t){e.$emit("hideLoader"),e.errorMessage=t},r={userId:e.guestCardData.contactInfo.user_id,isRefresh:n.isrefresh||!0};e.guestCardData.contactInfo&&e.guestCardData.contactInfo.user_id&&e.invokeApi(t.fetchLikes,r,e.fetchLikesSuccessCallback,a,"NONE")},e.fetchLikesSuccessCallback=function(t){e.$emit("hideLoader"),e.guestLikesData=t;var a,r,n,o,i,s,c;for(a=0,r=e.guestLikesData.preferences.length;a<r;a++)for(i=e.guestLikesData.preferences[a],s=i.values,"dropdown"!=i.type&&"radio"!=i.type||(e.guestLikesData.user_preference.length?(c=_.find(s,function(t){return _.contains(e.guestLikesData.user_preference,t.id)}),c?i.isChecked=c.id:i.isChecked=""):i.isChecked=""),n=0,o=s.length;n<o;n++)s[n].isChecked=!1,_.contains(e.guestLikesData.user_preference,s[n].id)&&(s[n].isChecked=!0);var d=0;angular.forEach(e.guestLikesData.room_features,function(t,a){angular.forEach(t.values,function(a,r){d++,d>6&&e.guestLikesData.preferences.length<=2&&(e.calculatedHeight+=50);var n=t.user_selection;n.indexOf(a.id)!==-1?a.isSelected=!0:a.isSelected=!1})}),e.guestCardData.likes=e.guestLikesData,setTimeout(function(){e.refreshScroller("likes_info")},1e3)},e.$on("SHOWGUESTLIKESINFO",function(){e.init()}),e.$on("REFRESHLIKESSCROLL",function(){e.refreshScroller("likes_info")}),e.$on("$viewContentLoaded",function(){e.refreshScroller("likes_info")});var c=function(){var t;return e.reservationData&&e.reservationData.guest&&e.reservationData.guest.id?t=e.reservationData.guest.id:e.guestCardData&&e.guestCardData.contactInfo&&e.guestCardData.contactInfo.user_id&&(t=e.guestCardData.contactInfo.user_id),t};e.saveLikes=function(r){var n=function(t){e.$emit("hideLoader")},s=function(t){e.$emit("hideLoader"),e.errorMessage=t,e.$emit("likesInfoError",!0)};o=JSON.parse(JSON.stringify(i)),i.guest_id=e.guestCardData.contactInfo.guest_id,i.preference=[],angular.forEach(e.guestLikesData.newspapers,function(t,a){var r={};t.id===e.guestLikesData.user_newspaper&&(r.type="NEWSPAPER",r.value=t.name,i.preference.push(r))}),angular.forEach(e.guestLikesData.roomtype,function(t,a){var r={};t.id===e.guestLikesData.user_roomtype&&(r.type="ROOM TYPE",r.value=t.name,i.preference.push(r))}),angular.forEach(e.guestLikesData.room_features,function(e,t){angular.forEach(e.values,function(e,t){var a={};e.isSelected&&(a.type="ROOM FEATURE",a.value=e.details,i.preference.push(a))})}),angular.forEach(e.guestLikesData.preferences,function(e,t){angular.forEach(e.values,function(t,a){t.isChecked&&i.preference.push({type:e.name,value:t.details})})});var d=JSON.parse(JSON.stringify(i)),u=!!angular.equals(d,o),l=c(),f=!(!r||!r.isFromGuestCardSection)||a.isGuestFetchComplete(l),m={userId:l,data:i};l&&f&&!u&&e.invokeApi(t.saveLikes,m,n,s)};var d=e.$on("SAVELIKES",function(t,a){e.saveLikes(a)});e.$on("$destroy",d),e.changedCheckboxPreference=function(t,a){angular.forEach(e.guestLikesData.preferences[t].values,function(e,t){t!==a&&(e.isChecked=!1)})},e.changedRadioComboPreference=function(t){_.each(e.guestLikesData.preferences[t].values,function(a){a.id===e.guestLikesData.preferences[t].isChecked?(a.isChecked=!a.isChecked,a.isChecked||(e.guestCardData.likes.preferences[t].isChecked="")):a.isChecked=!1})},e.getHalfArray=function(e){var t=new Array(Math.ceil(e.length/2));return t},e.showLabel=function(e){var t=!0;return""!==e&&void 0!==e||(t=!1),t},e.getHalfArrayPref=function(e){var t=new Array(Math.ceil(e.length/2));return t},e.shouldShowRoomFeatures=function(e){var t=!1;return angular.forEach(e,function(e,a){e.values.length>0&&(t=!0)}),t};var u=e.$on("GUESTLIKETABACTIVE",function(){s||(s=!0,e.init())});e.$on("$destroy",u),e.hasRoomFeatures=function(){var t=!1;return _.each(e.guestLikesData.room_features,function(e,a){_.each(e.values,function(e,a){e.isSelected&&(t=!0)})}),t},e.init()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVBillPayCtrl",["$scope","RVBillPaymentSrv","RVPaymentSrv","RVGuestCardSrv","RVReservationCardSrv","ngDialog","$rootScope","$timeout","$filter","rvPermissionSrv",function(e,t,a,r,n,o,i,s,c,d){BaseCtrl.call(this,e);var u=function(){e.renderData={},e.saveData={},e.errorMessage="",e.saveData.payment_type_id="",e.cardsList=[],e.newPaymentInfo={},e.newPaymentInfo.addToGuestCard=!1,e.renderData.billNumberSelected="",e.renderData.defaultPaymentAmount="",e.renderData.defaultPaymentCurrencyAmount="",e.copyOfdefaultPaymentAmount="",e.defaultRefundAmount=0,e.currentActiveBillNumber=parseInt(e.currentActiveBill)+parseInt(1),e.renderData.billNumberSelected=e.currentActiveBillNumber,e.billsArray=e.reservationBillData.bills,e.passData={},e.passData.details={},e.passData.details.firstName=e.guestCardData.contactInfo.first_name,e.passData.details.lastName=e.guestCardData.contactInfo.last_name,e.setScroller("cardsList",{click:!0,tap:!0}),e.showCancelCardSelection=!0,e.renderData.referanceText="",e.swipedCardDataToSave={},e.cardData={},e.newCardAdded=!1,e.shouldShowWaiting=!1,e.depositPaidSuccesFully=!1,e.saveData.paymentType="",e.defaultPaymentTypeOfBill="",e.shouldShowMakePaymentButton=!0,e.splitSelected=!1,e.disableMakePaymentButton=!1,e.splitBillEnabled=!1,e.showDBconfirmation=!1,e.billPaymentReceiptData={},e.billPaymentReceiptData.allBillReceiptsList={},e.shouldDisableSplit=!1},l=0,f=function(){s(function(){e.refreshScroller("cardsList")},2e3)};e.feeData={};var m=parseFloat("0.00");e.isShowFees=function(){var t=!1,a=e.feeData;return"undefined"==typeof a||"undefined"==typeof a.feesInfo||null===a.feesInfo?t=!1:a.defaultAmount>=a.minFees&&e.isStandAlone&&a.feesInfo.amount&&e.renderData.defaultPaymentAmount>=0&&(t=!("sixpayments"===i.paymentGateway&&!e.isManual&&"CC"===e.saveData.paymentType||""===e.saveData.paymentType)),t},e.handleCloseDialog=function(){e.reservationBillData.isCheckout=!1,e.paymentModalOpened=!1,e.$emit("HANDLE_MODAL_OPENED"),e.closeDialog()},e.$on("CLOSE_DIALOG",e.handleCloseDialog),e.showGuestCreditCardList=function(){e.showCCPage=!0,e.swippedCard=!0,f()},e.changeOnsiteCallIn=function(){e.isManual?e.showGuestCreditCardList():"",f()},e.$on("changeOnsiteCallIn",function(t){e.isManual=!e.isManual,e.changeOnsiteCallIn()}),e.getPaymentListSuccess=function(t){e.$emit("hideLoader"),e.renderData.paymentTypes=t,e.renderData.billNumberSelected=e.currentActiveBillNumber,e.renderDefaultValues(),e.creditCardTypes=[],angular.forEach(e.renderData.paymentTypes,function(t,a){"CC"===t.name&&(e.creditCardTypes=t.values)}),e.shouldDisableSplit=e.renderData.defaultPaymentAmount<0},e.cardsListSuccess=function(t){e.$emit("hideLoader"),0===t.length?e.cardsList=[]:(e.cardsList=[],angular.forEach(t.existing_payments,function(t,a){t.is_credit_card&&e.cardsList.push(t)}),angular.forEach(e.cardsList,function(e,t){e.mli_token=e.ending_with,e.card_expiry=e.expiry_date,delete e.ending_with,delete e.expiry_date}),e.addmode=!(e.cardsList.length>0),angular.forEach(e.cardsList,function(t,a){t.isSelected=!1,isEmptyObject(e.billsArray[e.currentActiveBill].credit_card_details)||e.billsArray[e.currentActiveBill].credit_card_details.payment_type&&"CC"===e.billsArray[e.currentActiveBill].credit_card_details.payment_type.toUpperCase()&&e.billsArray[e.currentActiveBill].credit_card_details.card_number===t.mli_token&&e.billsArray[e.currentActiveBill].credit_card_details.card_code.toLowerCase()===t.card_code.toLowerCase()&&(t.isSelected=!0)}),f())},e.resetSplitPaymentDetailForGiftCard=function(){e.splitBillEnabled=!1,e.splitePaymentDetail={totalNoOfsplits:1,completedSplitPayments:0,totalAmount:0,splitAmount:0,carryAmount:0},e.messageOfSuccessSplitPayment="",e.paymentErrorMessage="",e.splitBillEnabled||(e.renderData.defaultPaymentAmount=angular.copy(l),e.splitSelected=!1)};var p=function(){var t=e.billsArray[e.currentActiveBill].total_fees,a=m;a=t.length<=0?m:"SR"===t[0].balance_amount?t[0].masked_balance_amount:t[0].balance_amount;var r=parseFloat(a).toFixed(2),n=t[0].default_payment_amount;e.renderData.defaultPaymentAmount=r,e.renderData.defaultPaymentCurrencyAmount=n,e.copyOfdefaultPaymentAmount=r,e.splitePaymentDetail.totalAmount=r,e.defaultRefundAmount=-1*parseFloat(e.renderData.defaultPaymentAmount)};e.resetSplitPaymentDetail=function(){e.splitBillEnabled="undefined"!=typeof e.splitBillEnabled&&!e.splitBillEnabled,e.splitePaymentDetail={totalNoOfsplits:1,completedSplitPayments:0,totalAmount:0,splitAmount:0,carryAmount:0},e.messageOfSuccessSplitPayment="",e.paymentErrorMessage="",e.splitBillEnabled||(e.billsArray&&p(),e.renderData.defaultPaymentAmount=angular.copy(e.copyOfdefaultPaymentAmount),e.splitSelected=!1)},e.hasPermissionToDirectBillPayment=function(){return d.getPermissionValue("DIRECT_BILL_PAYMENT")},e.getReceiptsListSuccess=function(t){e.billPaymentReceiptData.allBillReceiptsList=t.data,e.billPaymentReceiptData.receiptsList=_.find(e.billPaymentReceiptData.allBillReceiptsList.payment_receipts,{bill_number:e.billsArray[e.currentActiveBill].bill_number})},e.init=function(){e.resetSplitPaymentDetail(),"undefined"==typeof e.reservationData.reservationId&&(e.reservationData.reservationId=e.reservationData.reservation_id),u(),e.referenceTextAvailable=!1,e.showInitalPaymentScreen=!0;var t={reservation_id:e.reservationData.reservationId,is_checkout:e.reservationBillData.isCheckout},r=e.reservationBillData.isCheckout?t:{};if(e.billsArray[e.currentActiveBill].is_account_attached&&e.billsArray[e.currentActiveBill].allow_db_refund&&e.hasPermissionToDirectBillPayment()?r.direct_bill=!0:r.direct_bill=!1,r.bill_id=e.billsArray[e.currentActiveBill].bill_id,e.invokeApi(a.renderPaymentScreen,r,e.getPaymentListSuccess),e.invokeApi(a.getPaymentList,e.reservationData.reservationId,e.cardsListSuccess),"tax_payment_receipt"===i.selectedReceiptTypeValue){var n={bill_holder_id:e.reservationData.reservationId,bill_holder_type:"Reservation"};e.invokeApi(a.getReceiptsList,n,e.getReceiptsListSuccess)}e.disableRefund=e.billPaymentReceiptData.receiptsList&&e.billPaymentReceiptData.receiptsList.length>0&&!e.payment.receipt_id},e.init(),e.renderDefaultValues=function(){var t=!1;e.renderData.paymentTypes.length>0&&(isEmptyObject(e.billsArray[e.currentActiveBill].credit_card_details)||(e.defaultPaymentTypeOfBill=e.billsArray[e.currentActiveBill].credit_card_details.payment_type.toUpperCase(),e.saveData.payment_type_id=e.billsArray[e.currentActiveBill].credit_card_details.payment_id,angular.forEach(e.renderData.paymentTypes,function(e,a){"CC"===e.name&&(t=!0)}),e.saveData.paymentType=e.defaultPaymentTypeOfBill,"CC"===e.defaultPaymentTypeOfBill&&(t||(e.saveData.paymentType=""),e.isExistPaymentType=!0,e.showCreditCardInfo=!0,e.isfromBill=!0,e.defaultPaymentTypeCard=e.billsArray[e.currentActiveBill].credit_card_details.card_code.toLowerCase(),e.defaultPaymentTypeCardNumberEndingWith=e.billsArray[e.currentActiveBill].credit_card_details.card_number,e.defaultPaymentTypeCardExpiry=e.billsArray[e.currentActiveBill].credit_card_details.card_expiry,"sixpayments"===i.paymentGateway&&(e.isManual=!0)))),p(),e.renderData.defaultPaymentAmount<0&&(e.shouldShowMakePaymentButton=!1),e.isStandAlone&&(e.feeData.feesInfo=e.billsArray[e.currentActiveBill].credit_card_details.fees_information)},e.billNumberChanged=function(){e.currentActiveBill=parseInt(e.renderData.billNumberSelected)-parseInt(1),e.billPaymentReceiptData.receiptsList=_.find(e.billPaymentReceiptData.allBillReceiptsList.payment_receipts,{bill_number:e.billsArray[e.currentActiveBill].bill_number}),e.renderDefaultValues()},e.$on("AMOUNT_UPDATED",function(t,a){e.shouldDisableSplit=a<0}),e.spliteButtonClicked=function(t){e.splitePaymentDetail.totalNoOfsplits=t,e.splitSelected||(e.splitSelected=!0,l=angular.copy(e.renderData.defaultPaymentAmount)),v()};var v=function(){e.splitePaymentDetail.splitAmount=parseFloat(c("number")(l/e.splitePaymentDetail.totalNoOfsplits,2).replace(/,/g,"")),e.splitePaymentDetail.carryAmount=parseFloat(c("number")(l-e.splitePaymentDetail.splitAmount*e.splitePaymentDetail.totalNoOfsplits,2)),e.renderData.defaultPaymentAmount=(parseFloat(e.splitePaymentDetail.splitAmount)+parseFloat(e.splitePaymentDetail.carryAmount)).toFixed(2)},y=function(){e.splitePaymentDetail.completedSplitPayments+=1,e.splitePaymentDetail.completedSplitPayments===e.splitePaymentDetail.totalNoOfsplits&&(e.depositPaidSuccesFully=!0)};e.classForPaymentSplitButton=function(t){return 1===t&&0===e.splitePaymentDetail.completedSplitPayments?"checked":t<=e.splitePaymentDetail.completedSplitPayments?"paid":t<=e.splitePaymentDetail.totalNoOfsplits?"checked":"disabled"};var g=function(){e.messageOfSuccessSplitPayment=e.messageOfSuccessSplitPayment+"SPLIT # "+e.splitePaymentDetail.completedSplitPayments+" OF "+c("number")(e.renderData.defaultPaymentAmount.toString().replace(/,/g,""),2)+" PAID SUCCESSFULLY !<br/>",e.clearPaymentErrorMessage()},h=function(){e.renderData.defaultPaymentAmount=c("number")(e.splitePaymentDetail.splitAmount,2)},D={},C=function(){if(D.billNumber=e.renderData.billNumberSelected,e.$emit("BILL_PAYMENT_SUCCESS",D),y(),g(),h(),e.newPaymentInfo.addToGuestCard){var t=e.defaultPaymentTypeCard,a=e.defaultPaymentTypeCardNumberEndingWith,r={card_code:t,mli_token:a,card_expiry:e.defaultPaymentTypeCardExpiry,card_name:e.newPaymentInfo.cardDetails.userName,id:D.id,isSelected:!0,is_primary:!1,payment_type:"CC",payment_type_id:1};e.cardsList.push(r),i.$broadcast("ADDEDNEWPAYMENTTOGUEST",r)}},S=function(t,a){e.errorMessage="",e.authorizedCode=a.authorization_code,D=a,e.paymentDetails={paymentSuccess:!0,authorizationCode:a.authorizationCode||a.authorization_code,amount:a.amountPaid,feePaid:parseFloat(a.feePaid),showFee:a.showFee,selectedPaymentType:a.selectedPaymentType,amountWithoutFee:parseFloat(a.amountPaid)-parseFloat(a.feePaid)},C()},A=function(t,a){e.disableMakePaymentButton=!1,e.$emit("hideLoader"),e.splitBillEnabled?e.paymentErrorMessage="SPLIT # "+(e.splitePaymentDetail.completedSplitPayments+1)+" PAYMENT OF "+e.renderData.defaultPaymentAmount+" FAILED !<br/>":e.errorMessage=a};e.clearPaymentErrorMessage=function(){e.paymentErrorMessage=""},e.$on("SWIPED_DATA_TO_SAVE",function(t,r){e.swipedCardDataToSave=r;var n=r;n.reservation_id=e.reservationData.reservationId,n.payment_credit_type=r.cardType,n.credit_card=r.cardType,n.card_expiry="20"+r.cardExpiryYear+"-"+r.cardExpiryMonth+"-01",e.invokeApi(a.savePaymentDetails,n,successNewPayment)}),e.setCreditCardFromList=function(t){e.isExistPaymentType=!0,e.showCreditCardInfo=!0,e.defaultPaymentTypeCard=e.cardsList[t].card_code.toLowerCase(),e.defaultPaymentTypeCardNumberEndingWith=e.cardsList[t].mli_token,e.defaultPaymentTypeCardExpiry=e.cardsList[t].card_expiry,angular.forEach(e.cardsList,function(e,t){e.isSelected=!1}),e.cardsList[t].isSelected=!0,e.saveData.payment_type_id=e.cardsList[t].value,e.swippedCard=!1,e.showCCPage=!1,e.isStandAlone&&(e.feeData.feesInfo=e.cardsList[t].fees_information,e.setupFeeData()),e.newCardAdded=!1},e.$on("cardSelected",function(t,a){e.setCreditCardFromList(a.index)}),e.$on("TOKEN_CREATED",function(t,a){e.showGuestAddCard=!0,e.newPaymentInfo=a,e.showCCPage=!1,e.swippedCard=!1,setTimeout(function(){savePayment(a)},200)}),e.$on("MLI_ERROR",function(t,a){e.errorMessage=a}),e.$on("cancelCardSelection",function(t,a){e.showCCPage=!1,e.swippedCard=!1,e.isManual=!1,e.saveData.paymentType=""}),e.$on("SHOW_SWIPED_DATA_ON_PAY_SCREEN",function(t,a){e.showCCPage=!0,e.swippedCard=!0,e.addmode=!0,e.$broadcast("RENDER_SWIPED_DATA",a)});var I=e.$on("PAYMENT_SUCCESS",S),T=e.$on("PAYMENT_FAILED",A),b=function(){_.each(e.reservationBillData.bills,function(e){var t=e.credit_card_details;e.selectedCC={card_code:t.card_code,ending_with:t.card_number,expiry_date:t.card_expiry,fees_information:t.fees_information,holder_name:t.card_name,is_credit_card:"CC"===t.payment_type,value:t.payment_id,auth_code:t.auth_code}})},P=function(){e.splitBillEnabled=!1,e.splitePaymentDetail={totalNoOfsplits:1,completedSplitPayments:0,totalAmount:0,splitAmount:0,carryAmount:0},e.messageOfSuccessSplitPayment="",e.paymentErrorMessage="",e.renderData.defaultPaymentAmount=0,e.splitSelected=!1},E=function(){e.splitBillEnabled=!1,e.splitePaymentDetail={totalNoOfsplits:1,completedSplitPayments:0,totalAmount:0,splitAmount:0,carryAmount:0},e.messageOfSuccessSplitPayment="",e.paymentErrorMessage="",e.splitSelected=!1};e.$on("PAYMENT_TYPE_CHANGED",function(t,a){e.showCCPage="CC"===a,"GIFT_CARD"===a?P():"DB"===a&&E()}),e.$on("HIDE_BILL_PAYMENT_POPUP",function(){e.showDBconfirmation=!0}),e.$on("SHOW_BILL_PAYMENT_POPUP",function(){e.showDBconfirmation=!1}),e.$watch("reservationBillData.bills",b),e.$on("$destroy",T),e.$on("$destroy",I)}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVAccountReceivableMessagePopupCtrl",["$rootScope","$scope","$state","ngDialog","$timeout","RVCompanyCardSrv","rvPermissionSrv",function(e,t,a,r,n,o,i){BaseCtrl.call(this,t),t.isCreateNewARAccountMode=!1,t.data={},t.isCreateButtonDisabled=!1,t.createAccountAction=function(){if("undefined"!=typeof t.reservationBillData&&"true"===t.reservationBillData.is_auto_assign_ar_numbers||"undefined"!=typeof t.is_auto_assign_ar_numbers&&t.is_auto_assign_ar_numbers){var e=!0;t.createAccountReceivable(e)}else t.isCreateNewARAccountMode=!0},t.successCreate=function(a){"undefined"!=typeof t.reservationBillData&&(t.reservationBillData.ar_number=a.ar_number,t.reservationBillData.bills[t.currentActiveBill].ar_number=a.ar_number,t.reservationBillData.bills[t.currentActiveBill].has_ar_account=!0),r.close(),n(function(){e.$emit("arAccountCreated")},500)},t.failureCreate=function(e){t.$emit("hideLoader"),t.errorMessage=e,t.isCreateButtonDisabled=!1,"Please complete required AR Account Information"===t.errorMessage[0]&&(t.isCreateButtonDisabled=!0)},t.createAccountReceivable=function(e){var a={id:t.reservationBillData.bills[t.currentActiveBill].account_id,ar_number:e?"":t.data.ar_number};t.invokeApi(o.saveARDetails,a,t.successCreate,t.failureCreate)},t.closeDialog=function(){r.close()},t.cancelButtonClick=function(){t.errorMessage="",t.isCreateNewARAccountMode=!1},t.hasPermissionToCreateArAccount=function(){return i.getPermissionValue("CREATE_AR_ACCOUNT")}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVAddPaymentMethodCrtl",["$scope","$rootScope",function(e,t){}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVPaymentCompanyCardCtrl",["$rootScope","$scope","$state","RVPaymentSrv","RVCompanyCardSrv","ngDialog",function(e,t,a,r,n,o){BaseCtrl.call(this,t),t.$on("clearNotifications",function(){t.errorMessage="",t.successMessage=""});var i={data:[],paymentTypes:[]};t.paymentData=i,t.updateErrorMessage=function(e){t.errorMessage=e},t.openAddNewPaymentModel=function(){t.callAPI(r.renderPaymentScreen,{params:{direct_bill:!1},onSuccess:function(e){var a=_.find(e,function(e){return"CC"===e.name}),r={fromView:"companyTravelAgent",isFromWallet:!0,accountId:t.contactInformation.id,details:{}},n=t.paymentData;n.paymentTypes=[a],t.openPaymentDialogModal(r,n)}})},t.fetchAttachedPaymentTypes=function(){var e=function(e){t.paymentData=e,t.$parent.$emit("hideLoader")},a=function(e){t.$parent.$emit("hideLoader"),t.$emit("displayErrorMessage",e)};t.invokeApi(n.fetchCompanyPaymentData,t.contactInformation.id,e,a)},t.addListener("wallet",function(){t.fetchAttachedPaymentTypes()}),t.openDeleteSetAsPrimaryModal=function(e,a){t.paymentData.payment_id=e,t.paymentData.index=a,t.paymentData.accountId=t.contactInformation.id,t.paymentData.isFromWallet=!0,o.open({template:"/assets/partials/payment/rvDeleteSetAsPrimary.html",controller:"RVDeleteSetAsPrimaryCtrl",scope:t})},t.$on("ADDEDNEWPAYMENTTOCOTA",function(e,a){"undefined"==typeof t.paymentData.data&&(t.paymentData.data=[]),_.find(t.paymentData.data,{id:a.id})||t.paymentData.data.push(a),t.refreshScroller("paymentList")}),function(){var e={preventDefault:!1};t.setScroller("paymentList",e),t.$on("$viewContentLoaded",function(){t.refreshScroller("paymentList")}),t.$on("REFRESHLIKESSCROLL",function(){t.refreshScroller("paymentList")})}()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVCreateAccountReceivableCtrl",["$rootScope","$scope","$state","RVCompanyCardSrv","ngDialog",function(e,t,a,r,n){BaseCtrl.call(this,t),t.ar_number="",t.createAccountReceivable=function(){var e={id:t.account_id,ar_number:t.ar_number};t.invokeApi(r.saveARDetails,e,t.successCreate,t.failureCreate)},t.closeDialog=function(){n.close()}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVDeleteSetAsPrimaryCtrl",["$rootScope","$scope","$state","RVPaymentSrv","RVCompanyCardSrv","ngDialog",function(e,t,a,r,n,o){BaseCtrl.call(this,t),t.successSetAsPrimary=function(){angular.forEach(t.paymentData.data,function(e,t){e.is_primary=!1}),t.paymentData.data[t.paymentData.index].is_primary=!0,t.refreshScroller("paymentList"),t.$emit("hideLoader"),o.close()},t.successDelete=function(){t.paymentData.data.splice(t.paymentData.index,1),t.$emit("hideLoader"),o.close()},t.failureCallBack=function(e){t.$emit("hideLoader"),t.updateErrorMessage(e),t.refreshScroller("paymentList"),t.closeDialog()},t.setAsPrimary=function(){if(t.paymentData.isFromWallet){var e={associated_payment_method_id:t.paymentData.payment_id,account_id:t.paymentData.accountId};t.invokeApi(n.setAsPrimary,e,t.successSetAsPrimary,t.failureCallBack)}else{var e={id:t.paymentData.payment_id,user_id:t.paymentData.user_id};t.invokeApi(r.setAsPrimary,e,t.successSetAsPrimary,t.failureCallBack)}},t.deletePayment=function(){if(t.paymentData.isFromWallet){var e={associated_payment_method_id:t.paymentData.payment_id,account_id:t.paymentData.accountId};t.invokeApi(n.deletePayment,e,t.successDelete,t.failureCallBack)}else{var e={id:t.paymentData.payment_id};t.invokeApi(r.deletePayment,e,t.successDelete,t.failureCallBack)}}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVPaymentGuestCtrl",["$rootScope","$scope","$state","RVPaymentSrv","ngDialog",function(e,t,a,r,n){BaseCtrl.call(this,t),t.$on("clearNotifications",function(){t.errorMessage="",t.successMessage=""}),t.updateErrorMessage=function(e){t.errorMessage=e},t.openAddNewPaymentModel=function(){t.callAPI(r.renderPaymentScreen,{
params:{direct_bill:!1},onSuccess:function(e){var a=_.find(e,function(e){return"CC"===e.name}),r={guest_id:t.guestCardData.contactInfo.user_id,isFromGuestCard:!0,details:{firstName:t.guestCardData.contactInfo.first_name,lastName:t.guestCardData.contactInfo.last_name}},n=t.paymentData;n.paymentTypes=[a],t.openPaymentDialogModal(r,n)}})},t.openDeleteSetAsPrimaryModal=function(e,a){t.paymentData.payment_id=e,t.paymentData.index=a,n.open({template:"/assets/partials/payment/rvDeleteSetAsPrimary.html",controller:"RVDeleteSetAsPrimaryCtrl",scope:t})},t.$on("ADDEDNEWPAYMENTTOGUEST",function(e,a){"undefined"==typeof t.paymentData.data&&(t.paymentData.data=[]),_.find(t.paymentData.data,{id:a.id})||t.paymentData.data.push(a),t.refreshScroller("paymentList")}),function(){var e={preventDefault:!1};t.setScroller("paymentList",e),t.$on("$viewContentLoaded",function(){t.refreshScroller("paymentList")}),t.$on("REFRESHLIKESSCROLL",function(){t.refreshScroller("paymentList")})}()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVShowPaymentListCtrl",["$rootScope","$scope","$state","RVPaymentSrv","ngDialog","rvPermissionSrv",function(e,t,a,r,n,o){BaseCtrl.call(this,t),t.showNoValues=!1;var i=o.getPermissionValue("REMOVE_CREDIT_CARD_FROM_STAYCARD");t.paymentListSuccess=function(e){t.$emit("hideLoader"),t.paymentListData=e,angular.forEach(t.paymentListData.existing_payments,function(e,a){if(!e.is_credit_card)return void t.paymentListData.existing_payments.splice(a,1)}),t.paymentListLength=t.paymentListData.existing_payments.length,0===t.paymentListLength&&(t.showNoValues=!0)};var s="",c=1;"billCard"===t.dataToPaymentList.currentView?(s=t.dataToPaymentList.reservation_id,c=t.dataToPaymentList.bills[t.dataToPaymentList.currentActiveBill].bill_number):s=t.dataToPaymentList.reservation_card.reservation_id;var d={reservation_id:s,bill_number:c};t.invokeApi(r.getExistingPaymentsForBill,d,t.paymentListSuccess),t.clickPaymentItem=function(a,o,i,c,d,u){var l={reservation_id:s,user_payment_type_id:a};"billCard"===t.dataToPaymentList.currentView&&(l.bill_number=t.dataToPaymentList.bills[t.dataToPaymentList.currentActiveBill].bill_number);var f=function(e){t.$emit("hideLoader"),t.errorMessage=e},m=function(a){var r;t.$emit("hideLoader"),e.$emit("UPDATECCATTACHEDBILLSTATUS",a.has_any_credit_card_attached_bill),n.close(),"billCard"===t.dataToPaymentList.currentView?(r=t.dataToPaymentList.currentActiveBill,t.dataToPaymentList.bills[r].credit_card_details.card_code=o.toLowerCase(),t.dataToPaymentList.bills[r].credit_card_details.card_number=i,t.dataToPaymentList.bills[r].credit_card_details.card_expiry=c,t.dataToPaymentList.bills[r].credit_card_details.is_swiped=d,t.dataToPaymentList.bills[r].credit_card_details.auth_color_code=u,t.dataToPaymentList.bills[r].credit_card_details.payment_id=a.id,t.dataToPaymentList.bills[r].credit_card_details.token=a.token,0===r&&e.$emit("UPDATEDPAYMENTLIST",t.dataToPaymentList.bills[r].credit_card_details)):(t.dataToPaymentList.reservation_card.payment_details.card_type_image="images/"+o.toLowerCase()+".png",t.dataToPaymentList.reservation_card.payment_details.card_number=i,t.dataToPaymentList.reservation_card.payment_details.card_expiry=c,t.dataToPaymentList.reservation_card.payment_method_used="CC",t.dataToPaymentList.reservation_card.payment_method_description="Credit Card",t.dataToPaymentList.reservation_card.payment_details.is_swiped=d,t.dataToPaymentList.reservation_card.payment_details.auth_color_code=u,t.dataToPaymentList.reservation_card.payment_details.id=a.id,t.dataToPaymentList.reservation_card.restrict_post=a.restrict_post)};t.invokeApi(r.mapPaymentToReservation,l,m,f)},t.$parent.myScrollOptions={paymentList:{scrollbars:!0,snap:!1,hideScrollbar:!1,preventDefault:!1}},t.$on("$viewContentLoaded",function(){setTimeout(function(){t.$parent.myScroll.paymentList.refresh()},3e3)}),t.openAddNewPaymentModel=function(){t.closeDialog(),e.$broadcast("OPENPAYMENTMODEL")},t.deleteCreditCard=function(e){var a=function(){t.closeDialog()},n=function(e){t.errorMessage=e};t.callAPI(r.deleteCreditCard,{onSuccess:a,onFailure:n,params:{reservation_id:s,payment_method_id:e}})},t.shouldShowCreditCardDeleteBtn=function(){return e.isStandAlone&&i&&"rover.reservation.staycard.reservationcard.reservationdetails"===a.current.name}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVPleaseSwipeCtrl",["$rootScope","$scope","sntPaymentSrv",function(e,t,a){BaseCtrl.call(this,t),t.state={numAttempts:0},t.addCardOWS=function(){t.$emit("SHOW_SIX_PAY_LOADER"),t.callAPI(a.getSixPaymentToken,{params:{reservation_id:t.reservationBillData.reservation_id,workstation_id:t.workstation_id},successCallBack:function(){t.$emit("REFRESH_BILLCARD_VIEW"),t.$emit("HIDE_SIX_PAY_LOADER"),t.closeDialog()},failureCallBack:function(e){t.state.numAttempts++,t.errorMessage=e,t.$emit("HIDE_SIX_PAY_LOADER")}})}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("reservationPaymentController",["$scope","$rootScope","RVReservationSummarySrv","rvPermissionSrv",function(e,t,a,r){e.getHasButtonClass=function(){var t=e.reservationData.reservation_card.has_any_credit_card_attached_bill,a="has-button";return t&&e.showCCAuthButton()&&(a="has-buttons"),a},e.displayButton=function(){var t=e.reservationData.reservation_card.reservation_status,a=!0;return"NOSHOW"!==t&&"CHECKEDOUT"!==t&&"CANCELED"!==t||(a=!1),a},e.showCCAuthButton=function(){return!(!e.reservationData.reservation_card.has_any_credit_card_attached_bill||!e.isStandAlone)};var n=function(){e.reservationData.reservation_card.restrict_post=!e.reservationData.reservation_card.restrict_post};e.setAllowPostWithNoCredit=function(){if(r.getPermissionValue("ALLOW_POST_WHEN_RESTRICTED")){var t={restrict_post:!e.reservationData.reservation_card.restrict_post,reservationId:e.reservationData.reservation_card.reservation_id},o={params:t,successCallBack:n};e.callAPI(a.updateRestrictPost,o)}},e.showPostWithNoCreditButton=function(){var a=!0;return t.isStandAlone&&""!==e.reservationData.reservation_card.payment_method_used&&null!==e.reservationData.reservation_card.payment_method_used||(a=!1),a},t.$on("UPDATEDPAYMENTLIST",function(t,a){e.reservationData.reservation_card.payment_details.card_type_image=a.card_code+".png",e.reservationData.reservation_card.payment_details.card_number=a.card_number,e.reservationData.reservation_card.payment_details.card_expiry=a.card_expiry,e.reservationData.reservation_card.payment_details.is_swiped=a.is_swiped}),t.$on("UPDATECCATTACHEDBILLSTATUS",function(t,a){e.reservationData.reservation_card.has_any_credit_card_attached_bill=a})}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVPaymentAddPaymentCtrl",["$rootScope","$scope",function(e,t){BaseCtrl.call(this,t),t.savePayment={},t.isFromGuestCard=!("undefined"==typeof t.passData.isFromGuestCard||!t.passData.isFromGuestCard),t.initCardSwipeRenderData=function(){t.isNewCardAdded=!1,t.shouldShowIframe=!1,t.addmode=!0,t.isGiftCard=!1,t.useDepositGiftCard=!1,t.hideCancelCard=!1,t.depositWithGiftCard=!1,setTimeout(function(){t.$broadcast("addNewCardClicked"),t.$broadcast("hidePayCardToggles",{isFromSwipe:!0})},100)},t.$on("CLOSE_DIALOG",function(){t.closeDialog()}),t.getAddActionType=function(){return t.isFromGuestCard?"ADD_PAYMENT_GUEST_CARD":t.paymentData.isFromBillCard||"billcard"===t.passData.fromView?"ADD_PAYMENT_BILL":"companyTravelAgent"===t.passData.fromView?"ADD_PAYMENT_CO_TA":"ADD_PAYMENT_STAY_CARD"};var a=function(a,r,n){var o=t.billNumber-1;"CC"===r?(_.extend(t.paymentData.bills[o].credit_card_details,{card_code:n.card_code,card_number:n.ending_with,card_expiry:n.expiry_date,payment_id:a.id,is_swiped:n.is_swiped,auth_color_code:n.auth_color_code,token:n.token}),t.paymentData.bills[o].credit_card_details.payment_type=r,1===t.billNumber&&e.$emit("UPDATEDPAYMENTLIST",t.paymentData.bills[o].credit_card_details),e.$broadcast("BALANCECHANGED",{balance:a.reservation_balance,confirm_no:t.paymentData.confirm_no}),e.$broadcast("paymentChangedToCC"),t.$emit("UPDATECCATTACHEDBILLSTATUS",a.has_any_credit_card_attached_bill),a.addToGuestCard&&e.$broadcast("ADDEDNEWPAYMENTTOGUEST",{card_code:n.card_code,mli_token:n.ending_with,card_expiry:n.expiry_date,card_name:n.card_name,id:a.guest_payment_method_id,isSelected:!0,is_primary:!1,payment_type:r||"CC",payment_type_id:1})):(t.paymentData.bills[o].credit_card_details.payment_type=r,t.paymentData.bills[o].credit_card_details.payment_type_description=a.payment_type),t.closeDialog(t.ngDialogId)},r=function(a,r,n){e.$broadcast("ADDEDNEWPAYMENTTOGUEST",{card_code:n.card_code,mli_token:n.ending_with,card_expiry:n.expiry_date,card_name:n.card_name,id:a.id,isSelected:!0,is_primary:!1,payment_type:r||"CC",payment_type_id:1}),t.closeDialog()},n=function(a,r,n){"CC"===r?(t.paymentData.reservation_card.payment_method_used=r,_.extend(t.paymentData.reservation_card.payment_details,{card_type_image:"images/"+n.card_code+".png",card_number:n.ending_with,card_expiry:n.expiry_date,is_swiped:n.is_swiped,auth_color_code:n.auth_color_code})):(t.paymentData.reservation_card.payment_method_description=a.payment_type,t.paymentData.reservation_card.payment_method_used=r),t.paymentData.reservation_card.restrict_post=a.restrict_post,e.$broadcast("UPDATERESERVATIONTYPE",a.reservation_type_id,a.id),t.$emit("UPDATECCATTACHEDBILLSTATUS",a.has_any_credit_card_attached_bill||a.usedEMV&&"CC"===r),a.addToGuestCard&&e.$broadcast("ADDEDNEWPAYMENTTOGUEST",{card_code:n.card_code,mli_token:n.ending_with,card_expiry:n.expiry_date,card_name:n.card_name,id:a.guest_payment_method_id,isSelected:!0,is_primary:!1,payment_type:r||"CC",payment_type_id:1}),t.closeDialog()},o=function(a,r,n){e.$broadcast("ADDEDNEWPAYMENTTOCOTA",{card_code:n.card_code,mli_token:n.ending_with,card_expiry:n.expiry_date,card_name:n.card_name,id:a.id,isSelected:!0,is_primary:!1,payment_type:r||"CC",payment_type_id:1}),t.closeDialog()};t.$on("SUCCESS_LINK_PAYMENT",function(e,i){switch(t.getAddActionType()){case"ADD_PAYMENT_BILL":a(i.response,i.selectedPaymentType,i.cardDetails);break;case"ADD_PAYMENT_GUEST_CARD":r(i.response,i.selectedPaymentType,i.cardDetails);break;case"ADD_PAYMENT_CO_TA":o(i.response,i.selectedPaymentType,i.cardDetails);break;default:n(i.response,i.selectedPaymentType,i.cardDetails)}}),t.$on("ERROR_OCCURED",function(e,a){t.errorMessage=a}),t.$on("PAYMENT_FAILED",function(e,a){t.errorMessage=a}),function(){isEmptyObject(t.passData.details.swipedDataToRenderInScreen)||(t.selectedPaymentType="CC",t.swipedCardData=t.passData.details.swipedDataToRenderInScreen),t.billNumber=t.passData.fromBill||1}()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){sntRover.controller("RVCardOptionsCtrl",["$rootScope","$scope","$state","ngDialog","$location","$document","RVPaymentSrv","RVReservationCardSrv",function(e,t,a,r,n,o,i,s){BaseCtrl.call(this,t),t.showAddtoGuestCard=!1,t.renderDataFromSwipe=function(a){t.cardData.cardNumber=a.cardNumber,t.cardData.userName=a.nameOnCard,t.cardData.expiryMonth=a.cardExpiryMonth,t.cardData.expiryYear=a.cardExpiryYear,t.cardData.cardType=a.cardType,"guestCard"===a.swipeFrom&&e.$broadcast("swipeAtGuestCard"),"guestCard"===a.swipeFrom?t.showAddtoGuestCard=!1:t.showAddtoGuestCard=!0,"guestCard"!==a.swipeFrom&&"stayCard"!==a.swipeFrom||setTimeout(function(){t.clickedAddNewCard()},100)},t.refreshIframe=function(){if($("#sixIframe").length){var e=document.getElementById("sixIframe");e.src=e.src}},t.$on("REFRESH_IFRAME",function(e){t.refreshIframe()}),e.$on("depositModalAllowGiftCard",function(){t.allowPmtWithGiftCard=!0}),t.checkForGiftCard=function(){t.isGiftCard=!1,e.isStandAlone||t.invokeApi(i.fetchAvailPayments,{},t.cardsListSuccess)},t.hideCardToggles=function(){return!!(t.isFromGuestCard||t.hasAccompanyguest||t.cardsList&&0===t.cardsList.length)},t.$on("isFromGuestCardFalse",function(){t.showAddtoGuestCard=!0,t.isFromGuestCard=!0}),t.$on("hidePayCardToggles",function(e,a){t.isFromGuestCard=!0,a&&a.isFromSwipe&&"guestCard"!==a.swipeFrom&&(t.isFromGuestCard=!1)}),t.$on("giftCardSelectedFromGroups",function(){t.clickedGiftCardToggle()}),t.$on("CLICK_ADD_NEW_CARD",function(){t.clickedAddNewCard()}),t.$on("SHOW_SWIPED_DATA_ON_PAY_SCREEN",function(){t.clickedAddNewCard(),t.$$phase?"":t.$apply()}),t.$on("SHOW_SWIPED_DATA_ON_BILLING_SCREEN",function(){t.clickedAddNewCard(),t.$$phase?"":t.$apply()}),t.$on("SHOW_SWIPED_DATA_ON_DEPOSIT_BALANCE_SCREEN",function(){t.clickedAddNewCard(),t.$$phase?"":t.$apply()}),t.clickedAddNewCard=function(){t.shouldShowIframe=!1,t.addmode=!0,t.isGiftCard=!1,t.useDepositGiftCard=!1,t.hideCancelCard=!1,t.depositWithGiftCard=!1},t.clickedExistingCard=function(){t.shouldShowIframe=!0,t.addmode=!1,t.isGiftCard=!1,t.useDepositGiftCard=!1,t.hideCancelCard=!1,t.depositWithGiftCard=!1},t.clickedGiftCardToggle=function(){t.shouldShowIframe=!0,t.useDepositGiftCard=!0,t.addmode=!1,t.isGiftCard=!0,t.depositWithGiftCard=!0},t.showExistingCards=function(){return!t.addmode&&!t.useDepositGiftCard},t.showGiftCardToggle=function(){return!(t.isStandAlone||!t.allowPmtWithGiftCard)},t.existingSelected=function(){return!t.addmode&&!t.isGiftCard},t.addNewSelected=function(){return!(!t.addmode||t.isGiftCard)},t.hideMLINewCard=function(){return!!("sixpayments"===t.paymentGateway&&t.addmode||t.isManual||t.isGiftCard||t.depositWithGiftCard||t.shouldShowIframe)},t.showAddToGuestCardBox=function(){return t.existingSelected()||t.isGiftCard?t.showAddtoGuestCard=!1:t.addNewSelected()&&(t.showAddtoGuestCard=!0),!!t.showAddtoGuestCard},t.showMLIAddNewCC=function(){return!!t.addNewSelected()||!(!t.isGiftCard||t.showingDepositModal||t.depositWithGiftCard||t.useDepositGiftCard)},e.$on("giftCardSelected",function(){t.shouldShowIframe=!1,e.isStandAlone&&$("#cc-new-card").addClass("ng-hide")}),e.$on("creditCardSelected",function(){e.isStandAlone||(t.shouldShowIframe=!0,$("#cc-new-card").removeClass("ng-hide")),e.isStandAlone&&($("#cc-new-card").removeClass("ng-hide"),t.clickedAddNewCard())}),t.hideIfFromStayCardDirect=function(){e.isStandAlone||(t.swippedCard?t.shouldShowIframe=!1:t.shouldShowIframe=!0)},e.$on("validatedGiftCardPmt",function(e,a){a?t.validPayment=!0:t.validPayment=!1}),t.showMakePaymentButtonStatus=function(){var e="";return e=t.depositBalanceMakePaymentData&&"undefined"!=typeof t.depositBalanceMakePaymentData.payment_type?t.depositBalanceMakePaymentData.payment_type.length>0&&t.validPayment?"green":"grey":t.validPayment?"grey":"grey overlay"},t.useDepositGiftCard=!1,t.cardsListSuccess=function(a){t.allowPmtWithGiftCard=!1,e.allowPmtWithGiftCard=!1,t.$emit("hideLoader");for(var r in a)"GIFT_CARD"===a[r].name&&(t.allowPmtWithGiftCard=!0,t.$parent.allowPmtWithGiftCard=!0,t.$parent.$parent.allowPmtWithGiftCard=!0,t.$parent.$parent.$parent.allowPmtWithGiftCard=!0,e.allowPmtWithGiftCard=!0,e.$broadcast("depositModalAllowGiftCard",!0));e.initFromCashDeposit?t.initFromCashDeposit=!0:t.initFromCashDeposit=!1},t.isGiftCard=!1,t.allowPmtWithGiftCard=!1,e.$on("depositUsingGiftCardChange",function(a,r){e.depositUsingGiftCard?(t.isGiftCard=!0,t.hideCancelCard=!0):(t.isGiftCard=!1,t.hideCancelCard=!1)}),t.refreshIframeWithGuestData=function(e){var t=(new Date).getTime(),a=e.fname,r=e.lname;iFrameUrl=domainUrl+"/api/ipage/index.html?card_holder_first_name="+a+"&card_holder_last_name="+r+"&service_action=createtoken&time="+t;var n=document.getElementById("sixIframe");try{n.src=iFrameUrl}catch(e){console.warn(e.name,e.message)}},t.$on("refreshIframe",function(e,a){t.refreshIframeWithGuestData(a)});var c=n.$$absUrl;domainUrl=c.split("/staff#/")[0],t.cardData={},t.cardData.addToGuestCard=!1,t.cardData.cardNumber="",t.cardData.CCV="",t.cardData.expiryMonth="",t.cardData.expiryYear="",t.cardData.userName="";var d=(new Date).getTime();if(t.shouldShowAddNewCard=!0,"undefined"!=typeof t.passData)var u="undefined"==typeof t.passData.details.firstName?"":t.passData.details.firstName,l="undefined"==typeof t.passData.details.lastName?"":t.passData.details.lastName;if(t.iFrameUrl=domainUrl+"/api/ipage/index.html?card_holder_first_name="+u+"&card_holder_last_name="+l+"&service_action=createtoken&time="+d,"sixpayments"===e.paymentGateway){t.shouldShowAddNewCard=!1;var f=o.find("sixIframe");f.attr("src",t.iFrameUrl),t.showAddtoGuestCard=!1}else t.isFromGuestCard||(t.showAddtoGuestCard=!0);"undefined"==typeof t.passData||isEmptyObject(t.passData.details.swipedDataToRenderInScreen)||t.renderDataFromSwipe(t.passData.details.swipedDataToRenderInScreen),t.shouldShowIframe=!1,t.changeOnsiteCallIn=function(){t.shouldShowIframe=!t.shouldShowIframe,t.isFromGuestCard||(t.shouldShowIframe?(t.showAddtoGuestCard=!0,t.refreshIframe()):t.showAddtoGuestCard=!1)};var m=function(){t.cardData.cardNumber="",t.cardData.CCV="",t.cardData.expiryMonth="",t.cardData.expiryYear=""};t.$on("clearCardDetails",function(){m()});var p=function(e){var a={};a.cardDetails=angular.copy(t.cardData),a.tokenDetails=e,t.$emit("TOKEN_CREATED",a),t.$digest(),t.refreshIframe()},v=function(e){t.$emit("MLI_ERROR",e)},_=function(){var e={};return e.cardNumber=t.cardData.cardNumber,e.cardSecurityCode=t.cardData.CCV,e.cardExpiryMonth=t.cardData.expiryMonth,e.cardExpiryYear=t.cardData.expiryYear,e};t.getToken=function(e){if(e.preventDefault(),isEmptyObject(t.passData.details.swipedDataToRenderInScreen)){var a=_(),r=function(e){e.isSixPayment=!1,p(e)},n=function(e){v(e)};t.fetchMLI(a,r,n)}else{var o=new SwipeOperation,i=o.createSWipedDataToSave(t.passData.details.swipedDataToRenderInScreen);i.addToGuestCard=t.cardData.addToGuestCard,i.card_name&&""!==i.card_name||(i.card_name=t.cardData.userName),t.$emit("SWIPED_DATA_TO_SAVE",i)}},t.$on("six_token_recived",function(e,a){a.six_payment_data.isSixPayment=!0,t.shouldShowAddNewCard=!1,p(a.six_payment_data)}),t.setCreditCardFromList=function(e){t.$emit("cardSelected",{index:e}),t.cardselectedIndex=e},t.setToShowCancelCard=function(){t.hideCancelCard=!1,t.depositWithGiftCard=!1},t.setToHideCancelCard=function(){t.hideCancelCard=!0},t.showCancelCardSelection=function(){return!t.hideCancelCard&&!t.depositWithGiftCard},t.isSixPayPayment=function(){return!!("sixpayments"===t.paymentGateway&&t.addmode||t.isManual)},t.cancelCardSelection=function(){e.isStandAlone?(t.$emit("cancelCardSelection"),t.cardselectedIndex=-1,t.refreshIframe()):r.close()},t.$on("cancelCardSelection",function(){t.depositWithGiftCard=!1,t.isGiftCard=!1,t.hideCancelCard=!1}),t.$on("showCancelCreditCardButton",function(){t.setToShowCancelCard()}),t.giftCardAmountAvailable=!1,t.giftCardAvailableBalance=0,t.$on("giftCardAvailableBalance",function(e,a){t.giftCardAvailableBalance=a.amount}),t.timer=null,t.cardNumberInput=function(a,r,n){if(n?(t.isGiftCard=!0,t.useDepositGiftCard=!0,e.useDepositGiftCard=!0):e.useDepositGiftCard=!1,t.isGiftCard||n){var o=a.length;t.num=a,o>=8&&o<=22?$("[name=card-number]").keydown(function(){clearTimeout(t.timer),t.timer=setTimeout(t.fetchGiftCardBalance,1500)}):t.giftCardAmountAvailable=!1}},t.num,t.fetchGiftCardBalance=function(){if(t.isGiftCard){var e=function(e){t.giftCardAvailableBalance=e.amount,t.giftCardAmountAvailable=!0,t.$emit("giftCardAvailableBalance",e),t.$emit("hideLoader")};t.invokeApi(s.checkGiftCardBalance,{card_number:t.num},e)}else t.giftCardAmountAvailable=!1},t.$on("addNewCardClicked",function(){t.clickedAddNewCard()}),t.$on("existingCardClicked",function(){t.clickedExistingCard()}),t.$on("RENDER_SWIPED_DATA",function(e,a){t.swippedCard=!0,t.renderDataFromSwipe(a),t.passData.details.swipedDataToRenderInScreen=a,setTimeout(function(){t.clickedAddNewCard()},100)})}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){window.GuestCardBaseCtrl=function(e,t,a,r,n){e.manageCardState={isOpen:!1},e.getContactInfo=function(e){var t=["first_name","last_name","mobile","phone","email","vip"],a=_.pick(e,t);return a.address={state:e.address&&e.address.state?e.address.state:"",city:e.address&&e.address.city?e.address.city:""},a},e.updateSearchCache=function(a){var r=e.guestCardData.contactInfo,n={firstname:r.first_name,lastname:r.last_name,vip:r.vip,is_flagged:r.is_flagged};a&&(n.avatar=a),r.address&&(""!==e.escapeNull(r.address.city).toString().trim()||""!==e.escapeNull(r.address.state).toString().trim()?n.location=r.address.city+", "+r.address.state:n.location=!1),t.updateGuestDetails(e.guestCardData.contactInfo.user_id,n)},e.removeGuestDetails=function(t){var r=e.guestCardData.contactInfo.can_guest_card_delete,o=e.guestCardData.contactInfo.can_guest_details_anonymized,i=function(){r?e.navigateBack():o&&(e.$broadcast("REFRESH_CONTACT_INFO",{guestId:t}),n.$broadcast("UPDATE_GUEST_CARD_ACTIONS_BUTTON_STATUS",{status:!1}))},s=function(t){e.errorMessage=t},c={params:t,successCallBack:i,failureCallBack:s};r?e.callAPI(a.deleteGuest,c):o&&e.callAPI(a.removeGuestDetails,c)};var o=function(t){var r=function(e){n.$broadcast("SET_GUEST_CARD_DATA",{contactInfo:e,guestId:t}),n.$broadcast("CONTACTINFOLOADED"),n.$broadcast("RESETCONTACTINFO",e)},o=function(t){e.errorMessage=t},i={params:t,successCallBack:r,failureCallBack:o};e.callAPI(a.getGuestDetailsById,i)},i=e.$on("REFRESH_CONTACT_INFO",function(e,t){o(t.guestId)});e.$on("$destroy",i),e.hasRemoveGuestDetailsPermission=function(){return r.getPermissionValue("REMOVE_GUEST_DETAILS")},e.toggleCardActions=function(){e.manageCardState.isOpen=!e.manageCardState.isOpen},e.shouldDisableRemoveGuestBtn=function(){return!e.guestCardData.contactInfo.can_guest_details_anonymized&&!e.guestCardData.contactInfo.can_guest_card_delete||!e.hasRemoveGuestDetailsPermission()},e.getUpdatedContactInfo=function(e,t){var a=e;return a.avatar=t?"/ui/pms-ui/images/avatar-trans.png":"",a.vip=t?e.vip:"",a.birthday=t?e.birthday:null,a.user_id=t?t:"",a.guest_id=t?t:"",a}}},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){window.StatisticsBaseCtrl=function(e,t){e.getStatusIconClass=function(e){var t="neutral";return e<0?t="icons time check-out rotate-right":e>0&&(t="icons time check-in rotate-right"),t},e.getStatusClass=function(e){var t="";return e>0?t="green":e<0&&(t="red"),t},e.absVal=function(e){return e?Math.abs(e):""},e.getCurrentYear=function(){var e=tzIndependentDate(t.businessDate),a=e.getFullYear();return a},e.populateYearDropDown=function(t){var a,r="";e.yearOptions=[],"summary"===e.activeView?(t=t===e.getCurrentYear()?t-1:t,a=e.getCurrentYear()-1):a=e.getCurrentYear();for(var n=a;n>=t;n--)r=n===a?"summary"===e.activeView?"LAST YEAR ("+n+")":"YEAR TO DATE ("+n+")":n,e.yearOptions.push({name:r,value:n})},e.getReservationClass=function(e){var t={RESERVED:"arrival",CHECKING_IN:"check-in",CHECKEDIN:"inhouse",CHECKING_OUT:"check-out",CHECKEDOUT:"departed",CANCELED:"cancel",NOSHOW:"no-show",NOSHOW_CURRENT:"no-show"};return t[e.reservation_status.toUpperCase()]||""}}},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").controller("RVGuestCardStatisticsController",["$scope","$rootScope","RVGuestCardsSrv","$timeout","$vault","$state","$stateParams",function(e,t,a,r,n,o,i){var s={},c="guest-sidebar-scroller",d="guest-monthly-data-scroller",u="guest-statistics-summary-sidebar-scroller",l="guest-statistics-summary-data-scroller";BaseCtrl.call(this,e),StatisticsBaseCtrl.call(this,e,t);var f=function(){var t=function(t){e.statistics.summary=t,e.activeView="summary",r(function(){D(!0)},200),I()},n=function(){e.statistics.summary={}},o={params:{year:e.filterData.selectedYear,guestId:e.guestID},onSuccess:t,onFailure:n};e.callAPI(a.fetchGuestCardStatisticsSummary,o)},m=function(){var t=function(t){e.statistics.details=t,e.statistics.details.monthly_data=e.statistics.details.monthly_data.reverse(),r(function(){D(!0)},500),A()},n=function(){e.statistics.details=[]},o={params:{year:e.filterData.selectedYear,guestId:e.guestID},onSuccess:t,onFailure:n};e.callAPI(a.fetchGuestCardStatisticsDetails,o)},p=function(){s.LOAD_GUEST_STATISTICS=e.$on("LOAD_GUEST_STATISTICS",function(){f()}),s.UPDATE_CONTACT_INFO=e.$on("UPDATE_CONTACT_INFO",function(){g()})},v=function(){angular.forEach(function(t){e.$on("$destroy",t)})};e.setActiveView=function(t,a){e.activeView=t,"details"===t?(e.filterData.selectedYear=a||e.getCurrentYear(),h(),A(),y(),m()):(e.filterData.selectedYear=e.getCurrentYear()-1,h(),I(),y(),f())},e.showMonthlyReservations=function(e){return!_.isEmpty(e.reservations.reservations)&&(e.isOpen=!e.isOpen,void r(function(){D()},200))},e.onChangeYear=function(){"summary"===e.activeView?f():m()},e.navigateToStayCard=function(t){return"rover.guest.details"===o.current.name&&(n.set("guestId",e.guestCardData.userId),n.set("selectedYear",e.filterData.selectedYear),void o.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:t.reservation_id,confirmationId:t.confirmation_no,isrefresh:!0,isFromGuestStatistics:!0}))},e.shouldShowNavigation=function(){var e=!0;return"rover.guest.details"===o.current.name&&(e=!1),e},e.getStyleForExpandedView=function(t){var a={},r=t.reservations_count||t.reservations.reservations&&t.reservations.reservations.length;if(t.isOpen){var n=70*r+30;e.totalResultCount>e.perPage&&(n+=60),a["margin-bottom"]=n+"px"}return a};var y=function(){e.populateYearDropDown(e.guestCardData.contactInfo.first_stay_year)},g=function(){e.statistics={summary:{},details:[]},e.guestID=e.guestCardData.userId,e.filterData={selectedYear:e.getCurrentYear()-1},e.currentYear=e.getCurrentYear(),y()},h=function(){e.setScroller(c,{preventDefault:!1,probeType:3}),e.setScroller(d,{preventDefault:!1,probeType:3,scrollX:!0}),e.setScroller(u,{preventDefault:!1,probeType:3}),e.setScroller(l,{preventDefault:!1,probeType:3,scrollX:!0})},D=function(t){r(function(){e.myScroll.hasOwnProperty(c)&&(e.refreshScroller(c),t&&e.myScroll[c].scrollTo(0,0,100)),e.myScroll.hasOwnProperty(d)&&(e.refreshScroller(d),t&&e.myScroll[d].scrollTo(0,0,100)),e.myScroll.hasOwnProperty(u)&&(e.refreshScroller(u),t&&e.myScroll[u].scrollTo(0,0,100)),e.myScroll.hasOwnProperty(l)&&(e.refreshScroller(l),t&&e.myScroll[l].scrollTo(0,0,100))},200)},C=function(){e.myScroll.hasOwnProperty(c)&&e.myScroll.hasOwnProperty(d)&&(e.myScroll[c].on("scroll",function(){e.myScroll[d].scrollTo(0,this.y)}),e.myScroll[d].on("scroll",function(){e.myScroll[c].scrollTo(0,this.y)}))},S=function(){e.myScroll.hasOwnProperty(u)&&e.myScroll.hasOwnProperty(l)&&(e.myScroll[u].on("scroll",function(){e.myScroll[l].scrollTo(0,this.y)}),e.myScroll[l].on("scroll",function(){e.myScroll[u].scrollTo(0,this.y)}))},A=function t(){e.myScroll.hasOwnProperty(c)&&e.myScroll.hasOwnProperty(d)?C():r(t,1e3)},I=function t(){e.myScroll.hasOwnProperty(u)&&e.myScroll.hasOwnProperty(l)?S():r(t,1e3)},T=function(){e.activeView="summary",g(),h(),A(),I(),p(),v(),i.isBackToStatistics?(e.filterData.selectedYear=i.selectedStatisticsYear?i.selectedStatisticsYear:e.filterData.selectedYear,e.setActiveView("details",e.filterData.selectedYear)):e.setActiveView("summary")};T()}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVBillPaymentSrv",["$http","$q","RVBaseWebSrv","rvBaseWebSrvV2",function(e,t,a,r){}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVGuestCardSrv",["$http","$q","RVBaseWebSrv",function(e,t,a){this.fetchGuestPaymentData=function(e){var r=t.defer(),n="/staff/payments/payment.json?user_id="+e;return a.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",
d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVPaymentSrv",["$http","$q","RVBaseWebSrv","rvBaseWebSrvV2","$rootScope","sntBaseWebSrv",function(e,t,a,r,n,o){var i={PAYMENT_TYPES:{}};this.renderPaymentScreen=function(e){var r=t.defer(),n="/staff/payments/addNewPayment.json",o=angular.toJson(e||"default");return i.PAYMENT_TYPES[o]?r.resolve(i.PAYMENT_TYPES[o]):a.getJSON(n,e).then(function(e){i.PAYMENT_TYPES[o]=e,r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchAvailPayments=function(e){var r=t.defer(),n="/staff/payments/addNewPayment.json";return a.getJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.savePaymentDetails=function(e){var r=t.defer(),n="staff/reservation/save_payment";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.saveGuestPaymentDetails=function(e){var r=t.defer(),n="staff/payments/save_new_payment";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.setAsPrimary=function(e){var r=t.defer(),n="/staff/payments/setCreditAsPrimary";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.deletePayment=function(e){var r=t.defer(),n="/staff/payments/deleteCreditCard";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getPaymentList=function(e){var r=t.defer(),n="/staff/staycards/get_credit_cards.json?reservation_id="+e;return a.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getReceiptsList=function(e){var a=t.defer(),n="/api/bills/payment_receipts";return r.getJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getExistingPaymentsForBill=function(e){var r=t.defer(),n="/staff/staycards/get_credit_cards.json";return a.getJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.mapPaymentToReservation=function(e){var r=t.defer(),n="/staff/reservation/link_payment";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.submitPaymentOnBill=function(e){var a=0,o=function(){a++},i=setInterval(o,1e3),s=t.defer(),c="api/reservations/"+e.reservation_id+"/submit_payment",d=function e(t){if(a>=n.emvTimeout){var o=["Request timed out. Unable to process the transaction"];s.reject(o)}else r.getJSONWithSpecialStatusHandling(t).then(function(a){a.status&&"processing_not_completed"===a.status||"null"===a?setTimeout(function(){console.info("POLLING::-> for emv terminal response"),e(t)},5e3):(clearInterval(i),s.resolve(a))},function(a){"undefined"==typeof a?e(t):(clearInterval(i),s.reject(a))})};return r.postJSONWithSpecialStatusHandling(c,e.postData).then(function(t){e.postData.is_emv_request&&t.status&&"processing_not_completed"===t.status?d(t.location_header):(clearInterval(i),s.resolve(t))},function(e){clearInterval(i),s.reject(e)}),s.promise},this.makePaymentOnDepositBalance=function(e){var r=t.defer(),n="staff/reservation/post_payment";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.chipAndPinGetToken=function(e){var a=0,o=function(){a++},i=setInterval(o,1e3),s=t.defer(),c="/api/cc/get_token.json",d=function e(t){if(a>=n.emvTimeout){var o=["Request timed out. Unable to process the transaction"];s.reject(o)}else r.getJSONWithSpecialStatusHandling(t).then(function(a){a.status&&"processing_not_completed"===a.status||"null"===a?setTimeout(function(){console.info("POLLING::-> for emv terminal response"),e(t)},5e3):(clearInterval(i),s.resolve(a))},function(a){"undefined"==typeof a?e(t):(clearInterval(i),s.reject(a))})};return r.postJSONWithSpecialStatusHandling(c,e).then(function(e){e.status&&"processing_not_completed"===e.status?d(e.location_header):(clearInterval(i),s.resolve(e))},function(e){clearInterval(i),s.reject(e)}),s.promise},this.deleteCreditCard=function(e){var a=t.defer(),r="api/reservations/"+e.reservation_id+"/delete_credit_card";return delete e.reservation_id,o.postJSON(r,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){function r(e,t){function a(e){return t.getJSON("/staff/preferences/likes.json",{user_id:e.userId})}function r(e){return t.postJSON("/staff/guest_cards/"+e.userId+"/update_preferences",e.data)}return{fetchLikes:a,saveLikes:r}}a.__esModule=!0,a.LikesSrv=r},{}],2:[function(e,t,a){angular.module("sntRover").service("RVLikesSrv",["$q","RVBaseWebSrv","$http",e("../../modules/snt/services/likes/rvLikesSrv").LikesSrv])},{"../../modules/snt/services/likes/rvLikesSrv":1}]},{},[2]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVContactInfoSrv",["$q","RVBaseWebSrv","rvBaseWebSrvV2",function(e,t,a){var r=this;r.saveContactInfo=function(a){var r=e.defer(),n=a.data,o=a.userId,i="/staff/guest_cards/"+o;return t.putJSON(i,n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.createGuest=function(t){var r=e.defer(),n=t.data,o="/api/guest_details";return a.postJSON(o,n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.updateGuest=function(t){var r=e.defer(),n="/api/guest_details/"+t.userId;return t.check_validation_only&&(n+="?check_validation_only=true"),a.putJSON(n,t.data).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.fetchGuestLanguages=function(t){var r=e.defer(),n="/api/guest_languages";return a.getJSON(n,t).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.removeGuestDetails=function(t){var r=e.defer(),n="/api/guest_details/"+t+"/anonymize";return a.putJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.getGuestDetailsById=function(t){var r=e.defer(),n="/api/guest_details/"+t;return null===t?r.reject([""]):a.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.parseGuestData=function(e,t){var a={};return a.id=t,a.firstName=e.first_name,a.lastName=e.last_name,a.image=e.image_url,a.vip=e.vip,e.address&&(a.address={},a.address.city=e.address.city,a.address.state=e.address.state,a.address.postalCode=e.address.postal_code),a.stayCount=e.stay_count,a.lastStay={},a.phone=e.home_phone,a.email=e.email,e.last_stay&&(a.lastStay.date=e.last_stay.date,a.lastStay.room=e.last_stay.room,a.lastStay.roomType=e.last_stay.room_type),a},r.deleteGuest=function(t){var r=e.defer(),n="/api/guest_details/"+t;return a.deleteJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.checkIfCommisionWasRecalculated=function(t){var r=e.defer(),n="/api/reservations/"+t.reservation_id+"/commission_transaction_info";return a.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVGuestCardLoyaltySrv",["$q","RVBaseWebSrv","RVCompanyCardSrv",function(e,t,a){var r=this,n={};r.fetchUserMemberships=function(a){var r=e.defer(),n="/staff/user_memberships.json?user_id="+a;return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.fetchLoyalties=function(t){var o=e.defer(),i=[];return i.push(a.fetchHotelLoyaltiesHlps().then(function(e){n.hotelLoyaltyData=e.data})),i.push(a.fetchHotelLoyaltiesFfp().then(function(e){n.freaquentLoyaltyData=e.data})),t.userID&&i.push(r.fetchUserMemberships(t.userID).then(function(e){n.userMemberships=e})),e.all(i).then(function(){o.resolve(n)},function(e){o.reject(e)}),o.promise},r.createLoyalties=function(a){var r=e.defer(),n="/staff/user_memberships";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.deleteLoyalty=function(a){var r=e.defer(),n="/staff/user_memberships/"+a+".json";return t.deleteJSON(n,"").then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVLoyaltyProgramSrv",["$q","RVBaseWebSrv","BaseWebSrvV2",function(e,t,a){var r={ZDIRECT_SETTINGS:null};this.addLoyaltyProgram=function(a){var r=e.defer(),n="/staff/user_memberships";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getGMSSettings=function(){var t=e.defer(),n="/api/integrations/gms_settings";return r.ZDIRECT_SETTINGS?t.resolve(r.ZDIRECT_SETTINGS):a.getJSON(n).then(function(e){r.ZDIRECT_SETTINGS=e,t.resolve(e)},function(e){t.reject(e)}),t.promise},this.getLoyaltyDetails=function(a){var r=e.defer(),n="/staff/user_memberships/new_loyalty";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getAvailableFFPS=function(){var a=e.defer(),r=" /staff/user_memberships/get_available_ffps.json";return t.getJSON(r,"").then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getAvailableHLPS=function(){var a=e.defer(),r="/staff/user_memberships/get_available_hlps.json";return t.getJSON(r,"").then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.selectLoyalty=function(a){var r=e.defer(),n="/staff/user_memberships/link_to_reservation";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("rvGuestCardNotesSrv",["$q","rvBaseWebSrvV2",function(e,t){this.fetchNotesForGuest=function(a){var r="/api/guest_details/"+a.guestID+"/notes",n=e.defer();return t.getJSON(r).then(function(e){n.resolve(e.notes)},function(e){n.reject(e)}),n.promise},this.updateNoteFromGuestCard=function(a){var r="/api/guest_details/"+a.guestID+"/notes/"+a.noteID,n=e.defer(),o={text:a.text};return t.putJSON(r,o).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.deleteNoteFromGuestCard=function(a){var r="/api/guest_details/"+a.guestID+"/notes/"+a.noteID,n=e.defer();return t.deleteJSON(r).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.createNoteFromGuestCard=function(a){var r={text:a.text},n="/api/guest_details/"+a.guestID+"/notes",o=e.defer();return t.postJSON(n,r).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVCCAuthorizationSrv",["$http","$q","RVBaseWebSrv","rvBaseWebSrvV2","$rootScope","$log","$timeout","$interval",function(e,t,a,r,n,o,i,s){var c,d=this,u=0,l=3e3,f=!1,m=function(){u++},p=function t(a,r){if(u>=parseInt(n.emvTimeout,10)){var d=["Request timed out. Unable to process the transaction"];s.cancel(c),a.reject(d)}else e.get(r).then(function(e){var n=e.data,d=e.status;202===d||102===d||250===d?i(function(){o.info("POLLING::-> for emv terminal response"),t(a,r)},l):(s.cancel(c),a.resolve(n))},function(e){e.data?(s.cancel(c),a.reject(e.data)):i(function(){t(a,r)},2e3)})};this.fetchCreditCardAuthInfo=function(e){var a=t.defer(),n="/staff/reservation/"+e.reservation_id+"/credit_card_auth_info";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},d.manualAuthorization=function(e,a){var n,a=a||t.defer(),i="/api/cc/authorize";return f&&o.warn("Authorization attempted when previous call pending!"),f=!0,e.isShift4Request&&(n=!0,delete e.isShift4Request),r.postJSONWithSpecialStatusHandling(i,e).then(function(e){"processing_not_completed"===e.status&&e.location_header?(u=0,c=s(m,1e3),p(a,e.location_header)):(f=!1,a.resolve(e))},function(t){f=!1,n?(e.check_transaction=!0,d.manualAuthorization(e,a)):a.reject(t)}),a.promise},d.manualVoiceAuth=function(e){var a=t.defer(),n="/api/cc/voice_auth";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.releaseAuthorization=function(e){var a=t.defer(),n="/api/cc/reverse";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},d.fetchPendingAuthorizations=function(e){var a=t.defer(),n="/api/reservations/"+e+"/pre_auth";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVCompanyCardSrv",["$q","rvBaseWebSrvV2",function(e,t){var a=this,r={},n=6e4;a.companyTaArDetailsCached=[],a.companyTaNotes=[],a.cachedTime="",this.DEFAULT_PER_PAGE=10,this.DEFAULT_PAGE=1;var o={},i=this;this.fetchContactInformation=function(a){var r=a.id,n=e.defer(),o="/api/accounts/"+r,i=["is_eod_failed","is_eod_in_progress","is_eod_manual_started","is_eod_process_running"];return t.getJSON(o).then(function(e){n.resolve(_.omit(e,i))},function(e){n.reject(e)}),n.promise},this.fetchCompanyPaymentData=function(a){var r=e.defer(),n="/staff/payments/payment.json?account_id="+a;return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.setAsPrimary=function(a){var r=e.defer(),n="api/accounts/"+a.account_id+"/set_wallet_payment_method_primary";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.deletePayment=function(a){var r=e.defer(),n="api/accounts/"+a.account_id+"/delete_wallet_payment_methods";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchContactInformationMandatoryFields=function(){var a=e.defer(),r="/admin/co_ta_settings/current_settings.json";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchAccountPaymentData=function(a){var r=e.defer(),n="/staff/payments/payment.json?account_id="+a;return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchContactInformationAndMandatoryFields=function(t){var a=e.defer(),r={};return e.when().then(function(){return i.fetchContactInformation(t).then(function(e){r=e})}).then(function(){return i.fetchContactInformationMandatoryFields().then(function(e){r.mandatoryFields=e})}).then(function(){a.resolve(r)},function(e){a.reject(e)}),a.promise},this.fetchCommissionDetail=function(){var a=e.defer(),r=" /api/hotel_settings/default_agent_commission_details";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchCommissionDetailsAndMandatoryFields=function(){var t=e.defer(),a={};return e.when().then(function(){return i.fetchCommissionDetail().then(function(e){a=e})}).then(function(){return i.fetchContactInformationMandatoryFields().then(function(e){a.mandatoryFields=e})}).then(function(){t.resolve(a)},function(e){t.reject(e)}),t.promise},this.fetchMultiProperties=function(a){var r=e.defer(),n="/api/accounts/"+a.accountId+"/subscribed_properties";return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise};var s=[];this.fetchCountryList=function(){var a=e.defer(),r="/ui/country_list";return s.length?a.resolve(s):t.getJSON(r).then(function(e){s=e,a.resolve(e)},function(e){a.reject(e)}),a.promise},this.saveContactInformation=function(a){var r,n,i=e.defer(),s="api/accounts/save.json",c=parseInt(a.id,10),d=_.omit(a,["workstation_id"]),u={data:d,deferred:i};return o[c]=o[c]||[],r=o[c],(n=r.find(function(e){return angular.equals(e.data,d)&&!e.resolved}))?n.deferred.promise:(r.push(u),t.postJSON(s,a).then(function(e){u.resolved=!0,i.resolve(e)},function(e){u.resolved=!0,i.reject(e)}),i.promise)},this.fetchRates=function(a){var r=e.defer(),n="/api/rates/contract_rates";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.replaceCard=function(a){var r={old:{type:a.cardType},new:{type:a.cardType,id:a.id,use_card_rate:a.useCardRate},change_all_reservations:a.future},n=e.defer(),o="/api/reservations/"+a.reservation+"/cards/replace";return t.putJSON(o,r).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.removeCard=function(a){var r={type:a.cardType,id:a.cardId},n=e.defer(),o="/api/reservations/"+a.reservation+"/cards/remove";return t.deleteJSON(o,r).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchArAccountDetails=function(r){var o=r.id,i=e.defer(),s="/api/accounts/"+o+"/ar_details";if(!a.companyTaArDetailsCached[o]||a.companyTaArDetailsCached[o].expiry&&Date.now()>a.companyTaArDetailsCached[o].expiry)a.companyTaArDetailsCached[o]=i,t.getJSON(s).then(function(e){a.companyTaArDetailsCached[o]={response:e,expiry:Date.now()+n},i.resolve(e)},function(e){i.reject(e)});else{if(!a.companyTaArDetailsCached[o].response)return a.companyTaArDetailsCached[o].promise;i.resolve(a.companyTaArDetailsCached[o].response)}return i.promise},this.fetchArAccountNotes=function(r){var o=r.id,i=e.defer(),s="/api/accounts/"+o+"/ar_notes";if(!a.companyTaNotes[o]||a.companyTaNotes[o].expiry&&Date.now()>a.companyTaNotes[o].expiry)a.companyTaNotes[o]=i,t.getJSON(s).then(function(e){a.companyTaNotes[o]={response:e,expiry:Date.now()+n},i.resolve(e)},function(e){i.reject(e)});else{if(!a.companyTaNotes[o].response)return a.companyTaNotes[o].promise;i.resolve(a.companyTaNotes[o].response)}return i.promise},this.saveARNote=function(r){var n=e.defer(),o="/api/accounts/save_ar_note",i=r.id;return t.postJSON(o,r).then(function(e){a.companyTaNotes[i]=null,n.resolve(e)},function(e){n.reject(e)}),n.promise},this.saveARDetails=function(r){var n=e.defer(),o="api/accounts/save_ar_details",i=r.id;return t.postJSON(o,r).then(function(e){a.companyTaArDetailsCached[i]=null,n.resolve(e)},function(e){n.reject(e)}),n.promise},this.deleteARNote=function(r){var n=e.defer(),o="/api/accounts/delete_ar_note",i=r.id;return t.postJSON(o,r).then(function(e){a.companyTaNotes[i]=null,n.resolve(e)},function(e){n.reject(e)}),n.promise},this.deleteArAccount=function(r){var n=r.id,o=e.defer(),i="api/accounts/"+n+"/delete_ar_detail";return t.deleteJSON(i).then(function(e){a.companyTaArDetailsCached[n]=null,o.resolve(e)},function(e){o.reject(e)}),o.promise},this.fetchArAccountsList=function(a){var r=e.defer(),n="/api/accounts/"+a.id+"/ar_transactions?paid="+a.paid+"&from_date="+a.from_date+"&to_date="+a.to_date+"&query="+a.query+"&page="+a.page_no+"&per_page="+a.per_page+"&transaction_type="+a.transaction_type;return t.getJSON(n).then(function(e){e.ar_transactions&&e.ar_transactions.length>0&&angular.forEach(e.ar_transactions,function(e){"DEBIT"===e.transaction_type&&(e.active=!1)}),r.resolve(e)},function(e){r.reject(e)}),r.promise},this.addCreditAmount=function(a){var r=e.defer(),n="api/accounts/"+a.id+"/ar_transactions";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.payForReservation=function(a){var r=e.defer(),n="api/accounts/"+a.id+"/ar_transactions/"+a.transaction_id+"/pay";return t.postJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.openForReservation=function(a){var r=e.defer(),n="api/accounts/"+a.id+"/ar_transactions/"+a.transaction_id+"/open";return t.postJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.payAll=function(a){var r=e.defer(),n="api/accounts/"+a.id+"/ar_transactions/pay_all";return t.postJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},a.fetchHotelLoyaltiesHlps=function(){var a=e.defer(),n="/staff/user_memberships/get_available_hlps.json";return r.fetchHotelLoyaltiesHlps?a.resolve(r.fetchHotelLoyaltiesHlps):t.getJSON(n).then(function(e){r.fetchHotelLoyaltiesHlps=e,a.resolve(e)},function(e){a.reject(e)}),a.promise},a.fetchHotelLoyaltiesFfp=function(){var a=e.defer(),n="/staff/user_memberships/get_available_ffps.json";return r.fetchHotelLoyaltiesFfp?a.resolve(r.fetchHotelLoyaltiesFfp):t.getJSON(n).then(function(e){r.fetchHotelLoyaltiesFfp=e,a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchTACommissionDetails=function(a){var r=e.defer(),n=" api/accounts/"+a.accountId+"/commission_details";return t.getJSON(n,a.params).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.saveTACommissionDetails=function(a){var r=e.defer(),n={};n.reservations=a.commissionDetails;var o="api/accounts/"+a.accountId+"/save_commission_details";return t.postJSON(o,n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchTransactionDetails=function(a){var r=e.defer(),n=" /api/bills/"+a.bill_id+"/transactions";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchArStatementPrintData=function(a){var r=e.defer(),n="/api/ar_transactions/print";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.emailArStatement=function(a){var r=e.defer(),n="/api/ar_transactions/email";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchArStatementData=function(a){var r=e.defer(),n="/api/ar_transactions/get_email?id="+a.id;return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.groupChargeDetailsFetch=function(a){var r=e.defer(),n="/staff/reservation/transaction_details";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.recalculateCommission=function(a){var r=e.defer(),n="/api/reservations/recalculate_commission_details";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCompanyTravelAgentStatisticsSummary=function(a){var r=e.defer(),n="/api/accounts/"+a.accountId+"/statistics?view=SUMMARY";return delete a.accountId,t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCompanyTravelAgentStatisticsDetails=function(a){var r=e.defer(),n="/api/accounts/"+a.accountId+"/statistics?view=DETAILED";return delete a.accountId,t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCompanyTravelAgentMonthlyReservations=function(a){var r=e.defer(),n="/api/accounts/"+a.accountId+"/statistics?view=RESERVATIONS";return delete a.accountId,t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.verifyTravelAgentCompanyCardMerge=function(a){var r=e.defer(),n="/api/accounts/validate_card_merge";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.mergeCards=function(a){var r=e.defer(),n="/api/accounts/merge_cards";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}])},{}]},{},[1]),function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVGuestCardsSrv",["$q","rvBaseWebSrvV2","sntBaseWebSrv","$rootScope","$log","$http",function(e,t,a,r,n,o){var i,s={},c=this,d={id:null,isFetched:!1};c.setGuest=function(e){c.resetGuest(),d.id=parseInt(e,10)},c.isGuestFetchComplete=function(e){return e=parseInt(e,10),d.id===e&&d.isFetched},c.resetGuest=function(){d.id=null,d.isFetched=!1},this.PER_PAGE_COUNT=50,c.fetchGuestDetails=function(t){var o=e.defer(),i="/api/guest_details/"+t;return r.isStandAlone||(i+="?sync_with_external_pms=true"),d.id?a.getJSON(i).then(function(e){d.isFetched=!0,o.resolve(e)},function(e){o.reject(e)}):(n.debug("Guest not set!"),o.reject(["Guest not set"])),o.promise},c.fetchGuestAdminSettings=function(){var t=e.defer(),r="/admin/guest_card_settings/current_settings";return a.getJSON(r).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.fetchGuestAdminSettingsAndGender=function(t){var a=e.defer(),r={},n=[];return n.push(e.when().then(function(){return c.fetchGuestAdminSettings(t).then(function(e){r.guest_admin_settings=e})})),n.push(e.when().then(function(){return c.fetchGenderTypes().then(function(e){r.genderTypeList=e})})),n.push(e.when().then(function(){return c.fetchIdTypes().then(function(e){r.idTypeList=e})})),e.all(n).then(function(){a.resolve(r)},function(e){a.reject(e)}),a.promise},this.fetchGuestDetailsInformation=function(t){var a=e.defer(),r={},n=[];return n.push(c.fetchGuestDetails(t)),n.push(c.fetchGuestAdminSettingsAndGender()),e.all(n).then(function(e){r=e[0],r.guest_admin_settings=e[1].guest_admin_settings,r.genderTypeList=e[1].genderTypes,a.resolve(r)},function(e){a.reject(e)}),a.promise},this.fetchGuests=function(t){var r=e.defer(),n="/api/guest_details";return a.getJSON(n,t).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.setGuestFields=function(){return s},this.setGuestFields=function(){return s},this.fetchGuestCardStatisticsSummary=function(a){var r=e.defer(),n="/api/guest_details/"+a.guestId+"/statistics?view=SUMMARY";return delete a.guestId,t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchGuestCardStatisticsDetails=function(a){var r=e.defer(),n="/api/guest_details/"+a.guestId+"/statistics?view=DETAILED";return delete a.guestId,t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise};var u=[];this.fetchNationsList=function(){var a=e.defer(),r="/ui/country_list";return u.length?a.resolve(u):t.getJSON(r).then(function(e){u=e,a.resolve(e)},function(e){a.reject(e)}),a.promise},this.saveGuestIdDetails=function(e){var a="/api/guest_identity";return t.postJSON(a,e)},this.saveFaceImage=function(e){var a="/staff/guest_cards/"+e.guest_id+".json";return t.putJSON(a,e)},this.verifyGuestCardMerge=function(a){var r=e.defer(),n="/api/guest_details/validate_card_merge";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.mergeCards=function(a){var r=e.defer(),n="/api/guest_details/merge_cards";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchGenderTypes=function(){var t=e.defer(),r="api/guest_details/gender_types";return a.getJSON(r).then(function(e){t.resolve(e.gender_list)},function(e){t.resolve(e)}),t.promise},this.fetchIdTypes=function(){var t=e.defer(),r="api/guest_details/government_id_types";return i?t.resolve(i):a.getJSON(r).then(function(e){i=e.id_type_list,t.resolve(i)},function(e){t.resolve(e)}),t.promise},this.fetchGuestList=function(a){var r="/api/guest_details",n=e.defer(),i={method:"GET",url:r,params:a};return o(i).then(function(e){var t={data:e.data,params:e.config&&e.config.params};n.resolve(t)},function(e){t.webserviceErrorActions(r,n,e.data,e.status)}),n.promise}}])},{}]},{},[1]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(t,a,r){function n(i,s){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return n(a||e)},u,u.exports,e,t,a,r)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}return e}()({1:[function(e,t,a){angular.module("sntRover").service("RVReservationCardSrv",["$http","$q","RVBaseWebSrv","rvBaseWebSrvV2","RVGAHelperSrv","$rootScope",function(e,t,a,r,n,o){this.reservationData={};var i=this;this.fetch=function(e){var r=t.defer(),n=e.reservationId,o=e.isRefresh,s=!1;if(angular.forEach(i.reservationIdsArray,function(e,t){o&&null!==o&&""!==o||e===n&&(s=!0)}),s)r.resolve(i.reservationData[n]);else{i.storeReservationIds(n);var c="api/reservations/"+n+".json";a.getJSON(c).then(function(e){i.reservationData[n]=e,r.resolve(e)},function(e){r.reject(e)})}return r.promise},this.reservationDetails={},this.confirmationNumbersArray=[],this.reservationIdsArray=[];var i=this;this.emptyConfirmationNumbers=function(){i.confirmationNumbersArray=[],i.reservationDetails={}},this.storeConfirmationNumbers=function(e){i.confirmationNumbersArray.push(e)},this.storeReservationIds=function(e){i.reservationIdsArray.push(e)},this.fetchReservationDetails=function(e){var r=e.confirmationNumber,o=e.isRefresh,s=!1,c=!0;angular.forEach(i.confirmationNumbersArray,function(e,t){o&&null!==o||e===r&&(s=!0)});var d=t.defer();if(s)d.resolve(i.reservationDetails[r]);else{i.storeConfirmationNumbers(r);var u="/staff/staycards/reservation_details.json?reservation="+r+"&is_dep_date_allowed="+c;a.getJSON(u).then(function(e){i.reservationDetails[r]=e,n.sendEventToGA("LOAD_RESERVATION",r),d.resolve(e)},function(e){
d.reject(e)})}return d.promise},this.updateResrvationForConfirmationNumber=function(e,t){i.reservationDetails[e]=t},this.getResrvationForConfirmationNumber=function(e){return i.reservationDetails[e]},this.guestData="",this.setGuestData=function(e){this.guestData=e},this.getGuestData=function(){return this.guestData},this.fetchGuestcardData=function(e){var r=t.defer(),n="/staff/guestcard/show.json";return a.getJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCancellationPolicies=function(e){var a=t.defer(),n="/api/reservations/"+e.id+"/cancellation_policies";return r.getJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.cancelReservation=function(e){var a=t.defer(),n="/api/reservations/"+e.id+"/cancel";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.tokenize=function(e){var r=t.defer(),n="/staff/payments/tokenize";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getLastRateAdjustmentReason=function(e){var a=t.defer(),n="api/reservations/"+e.reservation_id+"/reason_for_last_adjusted_rate";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.saveReservationNote=function(e){var r=t.defer(),n="/reservation_notes";return a.postJSON(n,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.deleteReservationNote=function(e){var r=t.defer(),n="/reservation_notes/"+e;return a.deleteJSON(n,"").then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateReservationNote=function(e){var a=t.defer(),n="/reservation_notes/"+e.id;return r.putJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getGuestDetails=function(e){var a=t.defer(),n="/api/guest_details/"+e.id;return null===e.id?a.reject([""]):r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.modifyRoomQueueStatus=function(e){var a=t.defer(),n={status:e.status};e.viaAdvancedQueue&&(n.signature=e.signature,n.is_promotions_and_email_set=e.is_promotions_and_email_set);var o="/api/reservations/"+e.reservationId+"/queue";return r.postJSON(o,n).then(function(t){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchDepositDetails=function(e){var a=t.defer(),n="api/reservations/"+e+"/deposit_policy";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.sendConfirmationEmail=function(e){var a=t.defer(),n="/api/reservations/"+e.reservationId+"/email_confirmation";return r.postJSON(n,e.postData).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.validateStayDateChange=function(e){var a=t.defer(),n="/staff/change_stay_dates/validate_stay_dates_change";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.detachGroupReservation=function(e){var a=t.defer(),n="/api/group_reservations/"+e.id+"/detach_group_reservation";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.reinstateReservation=function(e){var a=t.defer(),n="/api/reservations/"+e.reservationId+"/reinstate";return r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.checkReinstationAvailbility=function(e){var a=t.defer(),n="/api/reservations/"+e+"/check_reinstate_availability";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.checkGiftCardBalance=function(e){var a={card_number:e.card_number},n=t.defer(),o="/api/gift_cards/balance_inquiry";return r.postJSON(o,a).then(function(e){e&&_typeof(e.amount)===_typeof(123)&&(e.amount=parseFloat(e.amount).toFixed(2)),n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchGuestIdentity=function(e){var a=t.defer(),n="/api/guest_identity/"+e.reservation_id;return r.getJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.reverseCheckIn=function(e){var a=t.defer(),n="/api/reservations/"+e.reservationId+"/reverse_check_in";return r.postJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.attachGuestToReservation=function(e){var a=t.defer(),n="/api/reservations/"+e.reservation_id+"/reservations_guest_details/attach_guest_details";return delete e.reservation_id,r.postJSON(n,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getConfirmationData=function(e){var a=t.defer(),n="/api/reservations/"+e.reservation_id+"/confirmation_data";return r.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.createActivityLog=function(e){var a=t.defer();return r.postJSON("/api/reservation_actions",e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}])},{}]},{},[1]);