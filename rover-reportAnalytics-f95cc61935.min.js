angular.module("sharedHttpInterceptor",[]).config(["$provide",function(e){e.decorator("$http",["$delegate","$q",function(e,t){function r(e){var t=0,r=e.length;if(0===r)return t;for(var o,n=0;n<r;++n)o=e.charCodeAt(n),t=(t<<5)-t+o,t&=t;return t>>>0}function o(e){var t=e.method+e.url;return e.params&&"object"==typeof e.params&&(t+=angular.toJson(e.params)),e.data&&"object"==typeof e.data&&(t+=angular.toJson(e.data)),r(t)}function n(e,t){var r="background: orange; color: white; display: block;",o=e.method+": "+e.url;console.warn("%c[WARN_DUP_REQ]["+t+"]>>> "+o,r),window.dataLayer&&window.dataLayer.push({event:"sntDuplicateRequest",attributes:{request:e.method+": "+e.url,count:t}})}function s(e){var r=o(e);return e.ignoreDuplicateRequest?u(e):a[r]?(a[r].attempts=a[r].attempts||0,a[r].attempts++,n(e,a[r].attempts),e.rejectDuplicateRequest?t.reject({data:"",headers:{},status:e.rejectDuplicateStatusCode||400,config:e}):a[r]):(a[r]=u(e),a[r].finally(function(){delete a[r]}),a[r])}var a={},u=e;return Object.keys(u).filter(function(e){return"function"==typeof u[e]}).forEach(function(e){s[e]=u[e]}),s}])}]),angular.module("sharedHttpInterceptor").service("sntAuthorizationSrv",["$q","$log",function(e,t){var r=this,o=null;r.status=function(e){t.info(e||"property! "+r.getProperty())},r.setProperty=function(e){o=e},r.unsetProperty=function(){o=null},r.getProperty=function(){return o}}]),angular.module("sharedHttpInterceptor").factory("sharedHttpInterceptor",["$rootScope","$q","$window","sntAuthorizationSrv",function(e,t,r,o){return{request:function(e){var t=o.getProperty(),n=r.localStorage.getItem("jwt");return t&&(e.headers["Hotel-UUID"]=t),n&&(e.headers["Auth-Token"]=n),e},response:function(o){const n=o.headers("Auth-Token");return o.data.is_eod_in_progress&&!e.isCurrentUserChangingBussinessDate&&e.$emit("bussinessDateChangeInProgress"),o.data.hasOwnProperty("is_eod_in_progress")&&(e.isEodRunning=o.data.is_eod_in_progress),o.data.hasOwnProperty("is_eod_failed")&&(e.isEodProcessFailed=o.data.is_eod_failed),o.data.hasOwnProperty("is_eod_process_running")&&(e.isEodProcessRunning=o.data.is_eod_process_running),o.headers("Business-Date")&&e.businessDate&&o.headers("Business-Date")!==e.businessDate&&e.showBussinessDateChangedPopup&&e.showBussinessDateChangedPopup(),n&&r.localStorage.setItem("jwt",n),o||t.when(o)},responseError:function(o){return o.handledCodes=o.handledCodes||[],401!==o.status||o.handledCodes.includes(401)||(r.localStorage.removeItem("jwt"),r.location.href="/logout"),520===o.status&&"/admin/test_pms_connection"!==o.config.url&&e.showOWSError&&e.showOWSError(),503===o.status&&(r.location.href="/500"),502===o.status||504===o.status?void(e.showTimeoutError&&e.showTimeoutError()):t.reject(o)}}}]);