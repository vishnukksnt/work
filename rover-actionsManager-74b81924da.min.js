"use strict";sntRover.controller("RVActionsManagerController",["$scope","$rootScope","ngDialog","rvActionTasksSrv","departments","dateFilter","rvUtilSrv","$state","RVreportsSubSrv","$window","$timeout","$filter","rvPermissionSrv",function(e,t,a,n,s,r,o,i,l,u,c,d,E){BaseCtrl.call(this,e);var A=function(){e.$emit("updateRoverLeftMenu","actionManager"),e.showLeftSideViewForMobile=!0;var t="Actions Manager";e.setScroller("rvActionListScroller",{scrollbars:!0,preventDefault:!1,fadeScrollbars:!0}),e.setScroller("create-action-scroller",{scrollbars:!0,preventDefault:!1,fadeScrollbars:!0}),e.setScroller("actionSummaryScroller",{scrollbars:!0,preventDefault:!1,fadeScrollbars:!0}),e.departments=s.data.departments,i.params.restore&&n.getFilterState()&&(e.filterOptions=n.getFilterState()),T(t),f()},T=function(t){e.heading=t,e.setTitle(t)},p=function(){e.refreshScroller("rvActionListScroller")},S=function(e){var a=angular.copy(e);a.department=a.assigned_to&&a.assigned_to.id||"";var n=a.due_at_str.split("T");return a.dueDate=r(n[0],t.dateFormatForAPI),a.dueTime=r(n[0]+"T"+n[1].split(/[+-]/)[0],"HH:mm"),a.dueTimeAmPm=r(n[0]+"T"+n[1].split(/[+-]/)[0],"hh:mm a"),a},O=function(){e.filterOptions.selectedActionId&&e.callAPI(n.getActionDetails,{params:e.filterOptions.selectedActionId,successCallBack:function(t){e.selectedAction=S(t.data),e.selectedView="list",m()}})},f=function a(){var s={date:r(e.filterOptions.selectedDay,t.dateFormatForAPI),per_page:e.filterOptions.perPage,page:e.filterOptions.page},o=function(t){if(0===t.results.length&&0!==t.total_count&&1!==e.filterOptions.page&&(e.filterOptions.page=1,a()),e.filterOptions.totalCount=t.total_count,e.filterOptions.startRecord=(e.filterOptions.page-1)*e.filterOptions.perPage+1,t.results.length===e.filterOptions.perPage?e.filterOptions.endRecord=e.filterOptions.page*e.filterOptions.perPage:e.filterOptions.endRecord=e.filterOptions.startRecord+t.results.length-1,e.filterOptions.isLastPage=e.filterOptions.endRecord===e.filterOptions.totalCount,e.actions=[],_.each(t.results,function(t){e.actions.push(_.extend(t,{assigned:!!t.department_id,isCompleted:t.action_status===e._actionCompleted,iconClass:t.action_status?"icon-"+t.action_status.toLowerCase():"",departmentName:t.department_id?_.find(e.departments,{value:t.department_id.toString()}).name:""}))}),e.actions.length||(e.selectedView="new"),e.actions.length>0){var n=_.findWhere(e.actions,{id:e.filterOptions.selectedActionId});n||(e.filterOptions.selectedActionId=e.actions[0].id),O()}else e.$broadcast("INIT_NEW_ACTION");p(),e.showLeftSideViewForMobile=!0};e.filterOptions.department&&(s.department_id=e.filterOptions.department.value),"ALL"!==e.filterOptions.selectedStatus&&(s.action_status=e.filterOptions.selectedStatus),e.filterOptions.query&&(s.query=e.filterOptions.query),"GUEST"==e.filterOptions.selectedView?e.callAPI(n.fetchActions,{params:s,successCallBack:o}):"GROUP"==e.filterOptions.selectedView&&e.callAPI(n.fetchGroupActions,{params:s,successCallBack:o})},R=function(){var t=_.find(e.actions,function(t){return t.id===e.filterOptions.selectedActionId}),a=e.selectedAction.assigned_to&&e.selectedAction.assigned_to.id;_.extend(t,{action_status:e.selectedAction.action_status,iconClass:e.selectedAction.action_status?"icon-"+e.selectedAction.action_status.toLowerCase():"",department_id:a,assigned:!!a,departmentName:a?_.find(e.departments,{value:a.toString()}).name:"",isCompleted:!!e.selectedAction.completed_at,description:e.selectedAction.description})},h=function(){angular.element("#ui-datepicker-div").after(angular.element("<div></div>",{id:"ui-datepicker-overlay"}))},D=function(){angular.element("#ui-datepicker-overlay").remove()},N={dateFormat:t.jqDateFormat,numberOfMonths:1,beforeShow:h,onClose:D},C=function(){e.refreshScroller("create-action-scroller")},m=function(){e.refreshScroller("actionSummaryScroller")};e._actionCompleted="COMPLETED",e.timeSelectorList=o.getListForTimeSelector(15,12),e.filterOptions={showFilters:!1,selectedDay:t.businessDate,selectedView:"GUEST",department:"",selectedStatus:"ALL",query:"",page:1,perPage:25,totalCount:0,startRecord:1,endRecord:null,isLastPage:!1,selectedActionId:null},e.selectedAction={dueTime:"00:00"},e.selectDateOptions=_.extend(angular.copy(N),{defaultDate:tzIndependentDate(t.businessDate),onSelect:f}),e.dueDateEditOptions=_.extend(angular.copy(N),{minDate:tzIndependentDate(t.businessDate),onSelect:function(t,a){e.selectedAction.dueDate=new tzIndependentDate(o.get_date_from_date_picker(a)),e.updateAction()}}),e.actionsFilterDateOptions={firstDay:1,changeYear:!0,changeMonth:!0,dateFormat:t.jqDateFormat,yearRange:"0:+10",onSelect:function(t,a){e.closeDateFilter(),f()}},e.queryActions=function(t){t&&(e.filterOptions.query=""),f()},e.initNewAction=function(){e.selectedView="new",e.showLeftSideViewForMobile=!1,C()},e.onSelectAction=function(t){e.filterOptions.selectedActionId=t,e.showLeftSideViewForMobile=!1,O()},e.onGoBack=function(){e.showLeftSideViewForMobile=!0},e.setActiveFilter=function(t){e.filterOptions.selectedStatus=t,f()},e.toggleExtraFilters=function(){e.filterOptions.showFilters=!e.filterOptions.showFilters},e.switchTab=function(t){e.filterOptions.selectedView=t,f()},e.onDepartmentSelectionChange=function(){f()},e.changeAssignment=function(){a.open({template:"/assets/partials/actionsManager/rvActionAssignmentPopup.html",scope:e,closeByDocument:!0,closeByEscape:!0})},e.updateAction=function(){var s={action_task:{id:e.selectedAction.id,description:e.selectedAction.note},due_at:r(e.selectedAction.dueDate,t.dateFormatForAPI)+(e.selectedAction.dueTime?"T"+e.selectedAction.dueTime+":00":"")};e.selectedAction.department?s.assigned_to=e.selectedAction.department.value:s.assigned_to="",e.selectedAction.reservation_id?s.reservation_id=e.selectedAction.reservation_id:e.selectedAction.group_id&&(s.group_id=e.selectedAction.group_id),e.selectedAction.action_status===e._actionCompleted&&(s.is_complete=!0),e.callAPI(n.updateNewAction,{params:s,successCallBack:function(t){e.selectedAction=S(t.data),e.selectedView="list",R(),e.showLeftSideViewForMobile=!0}}),a.close()},e.completeAction=function(){e.selectedAction.action_status=e._actionCompleted,e.updateAction()},e.toStayCard=function(){n.setFilterState(e.filterOptions),i.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:e.selectedAction.reservation_id,confirmationId:e.selectedAction.reservation_confirm_no,isrefresh:!1})},e.toGroup=function(){n.setFilterState(e.filterOptions),i.go("rover.groups.config",{id:e.selectedAction.group_id,isrefresh:!1})},e.loadPrevPage=function(){e.filterOptions.page--,f()},e.loadNextPage=function(){e.filterOptions.page++,f()};var g=e.$on("CLOSE_POPUP",function(){a.close()}),L=e.$on("NEW_ACTION_POSTED",function(){a.close(),e.selectedView="list",f()});e.$on("$destroy",g),e.$on("$destroy",L);var I=function(){$("head").append("<style id='print-orientation'>@page { size: portrait; }</style>")},v=function(){$("#print-orientation").remove()},y=function(){var t={};return t.id=61,t.from_date=d("date")(e.filterOptions.selectedDay,"yyyy/MM/dd"),t.to_date=t.from_date,t.assigned_departments=[],""==e.filterOptions.department?_.each(e.departments,function(e){t.assigned_departments.push(e.value)}):t.assigned_departments.push(e.filterOptions.department.value),"ALL"===e.filterOptions.selectedStatus?t.status=["UNASSIGNED","ASSIGNED","COMPLETED"]:t.status=[e.filterOptions.selectedStatus],t.actions_by=[e.filterOptions.selectedView],t.per_page=1e3,t.page=1,t},U=function(){e.appliedFilter={},e.appliedFilter.date=r(e.filterOptions.selectedDay,t.dateFormatForAPI),"ALL"===e.filterOptions.selectedStatus?e.appliedFilter.completion_status=["ALL STATUS"]:e.appliedFilter.completion_status=[e.filterOptions.selectedStatus],""===e.filterOptions.department?e.appliedFilter.assigned_departments=["ALL DEPARTMENTS"]:e.appliedFilter.assigned_departments=[e.filterOptions.department.name],e.appliedFilter.show=[e.filterOptions.selectedView],e.leftColSpan=2,e.rightColSpan=2};e.printActionManager=function(){var t=function(t){e.$emit("hideLoader"),e.printActionManagerData=t,e.errorMessage="",I();var a=function(){c(function(){$("header .logo").removeClass("logo-hide"),$("header .h2").addClass("text-hide"),v()},200),$("body #loading").html('<div id="loading-spinner" ></div>')};$("body #loading").html(""),c(function(){sntapp.cordovaLoaded?cordova.exec(a,function(){a()},"RVCardPlugin","printWebView",[]):(u.print(),a())},200)},a=function(t){e.$emit("hideLoader"),e.errorMessage=t},s={params:y(),onSuccess:t,onFailure:a};U(),e.callAPI(n.fetchReportDetails,s)},e.shouldShowEditAndCompleteBtn=function(e){return["UNASSIGNED","ASSIGNED"].indexOf(e.action_status)>-1},e.shouldShowDeleteBtn=function(e){return["UNASSIGNED","ASSIGNED","COMPLETED"].indexOf(e.action_status)>-1},e.prepareEditAction=function(){e.selectedView="edit"},e.cancelEdit=function(){e.selectedView="list",e.showLeftSideViewForMobile=!0},e.hasPermissionToEditAction=function(){return E.getPermissionValue("EDIT_ACTION")},e.hasPermissionToDeleteAction=function(){return E.getPermissionValue("DELETE_ACTION")},e.prepareDeletAction=function(){e.selectedAction.originalStatus=e.selectedAction.action_status,e.selectedAction.action_status="delete"},e.deleteAction=function(){var t=function(){f()},a=function(t){t[0]&&(e.errorMessage="Internal Error Occured"),e.showLeftSideViewForMobile=!0},s={params:e.selectedAction.id,onSuccess:t,onFailure:a};e.errorMessage=[],e.callAPI(n.deleteActionTask,s)},e.cancelDelete=function(){e.selectedAction.action_status=e.selectedAction.originalStatus,e.showLeftSideViewForMobile=!0},e.getActionStatusInfo=function(e){var t=e.action_status;return"delete"===t?t="Delete Action?":e.over_due&&"COMPLETED"!==t&&(t="OVERDUE"),t},A()}]),sntRover.controller("RVNewActionCtrl",["$scope","$rootScope","rvUtilSrv","dateFilter","rvActionTasksSrv",function(e,t,a,n,s){BaseCtrl.call(this,e);var r=function(){if(e.__maxLengthOfNotes=255,"edit"===e.selectedView){var r=e.selectedAction.due_at_str.split("T"),o=n(r[0]+"T"+r[1].split(/[+-]/)[0],"HH:mm"),i=e.selectedAction.assigned_to&&e.selectedAction.assigned_to.id,l="";i&&(l=_.findWhere(e.departments,{value:i+""})),_.extend(e.selectedAction,{dueTime:o,note:e.selectedAction.description,department:l})}else e.newAction={reservation:null,group:null,dueDate:t.businessDate,dueTime:"00:00",note:"",department:""};e.dueDateOptions={minDate:tzIndependentDate(t.businessDate),dateFormat:t.jqDateFormat,numberOfMonths:1,onSelect:function(t,n){"edit"===e.selectedView?e.selectedAction.dueDate=new tzIndependentDate(a.get_date_from_date_picker(n)):e.newAction.dueDate=new tzIndependentDate(a.get_date_from_date_picker(n))},beforeShow:function(){angular.element("#ui-datepicker-div").after(angular.element("<div></div>",{id:"ui-datepicker-overlay",class:e.ngDialogId?"transparent":""}))},onClose:function(){angular.element("#ui-datepicker-overlay").remove()}},e.callAPI(s.fetchCurrentTime,{successCallBack:function(t){e.newAction.dueTime=t}})};e.saveNewAction=function(){var a=e.newAction,r={description:a.note,assigned_to:a.department?parseInt(a.department,10):"",due_at:n(a.dueDate,t.dateFormatForAPI)+"T"+a.dueTime+":00"};a.reservation&&a.reservation.id?r.reservation_id=a.reservation.id:a.group&&a.group.id&&(r.group_id=a.group.id),e.callAPI(s.postNewAction,{params:r,successCallBack:function(){e.$emit("NEW_ACTION_POSTED")}})},e.adjustedLength=function(e){return e.replace(/\r(?!\n)|\n(?!\r)/g,"\r\n").length};var o=e.$on("INIT_NEW_ACTION",function(){r()}),i=e.$on("RESERVATION_SELECTED",function(a,n){var s=new tzIndependentDate(t.businessDate),r=new tzIndependentDate(n.arrival_date);e.newAction.dueDate=s>r?s:r}),l=e.$on("GROUP_SELECTED",function(a,n){var s=new tzIndependentDate(t.businessDate),r=new tzIndependentDate(n.arrival_date);e.newAction.dueDate=s>r?s:r});r(),e.$on("$destroy",o),e.$on("$destroy",i),e.$on("$destroy",l)}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("sntRover").service("rvActionTasksSrv",["$q","BaseWebSrvV2","rvUtilSrv","$rootScope","dateFilter","$filter",function(e,t,a,n,s,r){var o=this,i=null,l=[r("translate")("SUNDAY"),r("translate")("MONDAY"),r("translate")("TUESDAY"),r("translate")("WEDNESDAY"),r("translate")("THURSDAY"),r("translate")("FRIDAY"),r("translate")("SATURDAY")];o.searchPerPage=50,o.page=1,o.to_date="",this.getTasksCount=function(a){var n=e.defer(),s="/api/reservations/"+a.id+".json";return t.getJSON(s).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.getActionsTasksList=function(a){var i=e.defer(),l="/api/action_tasks?associated_id="+a.id+"&associated_type=Reservation";return t.getJSON(l).then(function(e){e.data.forEach(function(e){var t,a,o;e.assigned=null!==e.assigned_to,_typeof(e.due_at)===_typeof("string")?(a=e.due_at_str.split("T"),e.due_at_time_str=s(a[0]+"T"+a[1].split(/[+-]/)[0],"hh:mm a"),e.due_at_time=s(a[0]+"T"+a[1].split(/[+-]/)[0],"HH:mm"),e.due_at_date=s(a[0],n.dateFormat),e.hasDate=!0):e.hasDate=!1,"COMPLETED"===e.action_status&&(e.isCompleted=!0,t=moment(e.completed_at),o=e.completed_at.split("T"),e.date_completed=t.format(n.dateFormat.toUpperCase()),e.time_completed=t.format("HH:MM:A"),e.completed_date=s(o[0],n.dateFormat)),e.created_at&&(e.created_at_time=r("date")(e.created_at,"hh:mm a"),e.created_at_date=r("date")(e.created_at,n.dateFormat))}),e.action_count=e.data.length,e.pending_action_count=_.countBy(e.data,"completed_at").null,e.pending_action_count=e.pending_action_count||0,e.className=o.getActionsClassName(e.action_count,e.pending_action_count),i.resolve(e)},function(e){i.reject(e)}),i.promise},this.fetchReportDetails=function(a){var n=e.defer(),s="/api/reports/action_manager_report";return t.postJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.getActionsClassName=function(e,t){var a="";return 0===e?"none":a=0===t?"all-completed":e===t?"only-pending":"pending"},this.syncActionCount=function(a){var n=e.defer(),s="/api/action_tasks/sync_with_external_pms?reservation_id="+a;return t.getJSON(s).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.postNewAction=function(a){var n=e.defer(),s="/api/action_tasks.json";return t.postJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.updateNewAction=function(a){var n=e.defer(),s="/api/action_tasks/"+a.action_task.id+".json";return t.putJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.completeAction=function(a){var n=e.defer(),s="/api/action_tasks/"+a.action_task.id;return t.putJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchDepartments=function(){var a=e.defer(),n="admin/departments.json";return null===o.cache.responses.departments||Date.now()>o.cache.responses.departments.expiryDate?t.getJSON(n).then(function(e){o.cache.responses.departments={data:e,expiryDate:Date.now()+1e3*o.cache.config.lifeSpan},a.resolve(e)},function(e){a.reject(e)}):a.resolve(o.cache.responses.departments.data),a.promise},this.fetchGuestInfo=function(a){var n=e.defer();a&&(a.fakeDataToAvoidCache=new Date),o.toDate=void 0===o.toDate?"":o.toDate;var s="search.json?per_page="+o.searchPerPage+"&page="+o.page;return t.getJSON(s,a).then(function(e){e.data.results;if(a.query){var t,s,r,o=a.query.toLowerCase(),i=0;for(var l in e.data.results)e.data.results[l].is_row_visible=!1,e.data.results[l].firstname&&(t=e.data.results[l].firstname.toLowerCase(),t.indexOf(o)!==-1&&(e.data.results[l].is_row_visible=!0,i++)),e.data.results[l].lastname&&(s=e.data.results[l].lastname.toLowerCase(),s.indexOf(o)!==-1&&(e.data.results[l].is_row_visible=!0,i++)),e.data.results[l].room&&(r=e.data.results[l].room.toLowerCase(),r.indexOf(o)!==-1&&(e.data.results[l].is_row_visible=!0,i++))}e.queryTime=a.queryTime,e.visibleRowCount=i,e.querySent=a.query,n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchActions=function(a){var n=e.defer(),s="api/action_tasks/hotel_actions";return t.getJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.getActionDetails=function(a){var n=e.defer(),s="api/action_tasks/"+a;return t.getJSON(s).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchCurrentTime=function(){var n=e.defer(),s="/api/hotel_current_time";return t.getJSON(s).then(function(e){n.resolve(a.roundToNextQuarter(parseInt(e.hotel_time.hh,10),parseInt(e.hotel_time.mm,10)))},function(e){n.reject(e)}),n.promise},this.fetchGroupActions=function(a){var n=e.defer(),s="api/action_tasks/hotel_group_actions";return t.getJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.deleteActionTask=function(a){var n=e.defer(),s="/api/action_tasks/"+a;return t.deleteJSON(s).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.cache={config:{lifeSpan:900},responses:{departments:null}},o.setFilterState=function(e){i=angular.copy(e)},o.getFilterState=function(){return i},o.clearFilterState=function(){i=null},o.getDateFromDate=function(e){var t=new tzIndependentDate(e),a=t.getDay();return l[t.getDay()]||a},o.getTimeFieldValues=function(){return["0000","0015","0030","0045","0100","0115","0130","0145","0200","0215","0230","0245","0300","0315","0330","0345","0400","0415","0430","0445","0500","0515","0530","0545","0600","0615","0630","0645","0700","0715","0730","0745","0800","0815","0830","0845","0900","0915","0930","0945","1000","1015","1030","1045","1100","1115","1130","1145","1200","1215","1230","1245","1300","1315","1330","1345","1400","1415","1430","1445","1500","1515","1530","1545","1600","1615","1630","1645","1700","1715","1730","1745","1800","1815","1830","1845","1900","1915","1930","1945","2000","2015","2030","2045","2100","2115","2130","2145","2200","2215","2230","2245","2300","2315","2330","2345"]}}]),angular.module("sntRover").service("RVCustomExportSrv",["$q","sntBaseWebSrv","RVreportsSubSrv",function(e,t,a){var n=this,s={BOOKING_ORIGIN_CODE:"booking_origin_code",MARKET_CODE:"market_code",RESERVATION_STATUS:"reservation_status",ROOM_NO:"room_no",ROOM_TYPE:"room_type",SEGMENT_CODE:"segment_code",SOURCE_CODE:"source_code",ARRIVAL_ROOM_TYPE:"arrival_room_type",DEPARTURE_ROOM_TYPE:"departure_room_type",ARRIVAL_RATE_CODE:"arrival_rate_code",CI_AGENT:"ci_agent",CO_AGENT:"co_agent",CI_APPLICATION:"ci_application",CO_APPLICATION:"co_application",NATIONALITY:"nationality",COUNTRY:"country",LANGUAGE:"language",VIP:"vip",PRIMARY_PAYMENT_METHOD:"primary_payment_method",MEMBERSHIP:"membership",MEMBERSHIP_LEVEL:"membership_level",ORIGIN_CODE:"origin_code"},r={timePeriods:[],dataSpaceColumns:{},deliveryTypes:[],exportFrequencies:[],DROP_BOX:[],GOOGLE_DRIVE:[]},o=["DATE","DATE_RANGE","CURRENT_YEAR","NEXT_365_DAYS"],i=this;this.getAvailableDataSpaces=function(){var a=e.defer(),n="api/reports?show_only_redshift_reports=true";return t.getJSON(n).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},this.getScheduledCustomExports=function(){var a=e.defer(),n="admin/export_schedules.json?show_only_redshift_reports=true",s={page:1,per_page:9999};return t.getJSON(n,s).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},this.getCustomExportsAndScheduleFrequencies=function(){var t=e.defer(),a={};return a.customExports=n.getScheduledCustomExports(),a.scheduleFrequencies=n.getExportFrequencies(),e.all(a).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.getRequestData=function(t){var s={},r=e.defer();return s.columns=n.getDataSpaceColumns(t),s.exportFormats=n.getExportFormats(t),s.deliveryTypes=n.getExportDeliveryTypes(t),s.durations=n.getExportDurations(t),s.dropBoxAccounts=n.getCloudDrives("DROP_BOX"),s.googleDriveAccounts=n.getCloudDrives("GOOGLE_DRIVE"),s.ftpServerList=a.fetchFtpServers(),e.all(s).then(function(e){r.resolve(e)},function(){r.resolve([])}),r.promise},this.getExportFormats=function(){var a=e.defer(),n="admin/export_formats.json";return t.getJSON(n).then(function(e){var t=_.filter(e.results,function(e){return"CSV"===e.value||"XML"===e.value||"JSON"===e.value});a.resolve(t)},function(e){a.reject(e)}),a.promise},this.getExportDeliveryTypes=function(){var a=e.defer(),n="admin/export_delivery_types.json";return r.deliveryTypes.length>0?a.resolve(r.deliveryTypes):t.getJSON(n).then(function(e){r.deliveryTypes=e.results,a.resolve(r.deliveryTypes)},function(e){a.reject(e)}),a.promise},this.getExportFrequencies=function(){var a=e.defer(),n="admin/export_frequencies.json";return r.exportFrequencies.length>0?a.resolve(r.exportFrequencies):t.getJSON(n).then(function(e){r.exportFrequencies=e.results,a.resolve(r.exportFrequencies)},function(e){a.reject(e)}),a.promise},this.getCloudDrives=function(a){var n=e.defer(),s="/api/cloud_drives?cloud_drive_type="+a;return r[a].length>0?n.resolve(r[a]):t.getJSON(s).then(function(e){r[a]=e.results,n.resolve(r[a])},function(e){n.reject(e)}),n.promise},this.getDataSpaceColumns=function(a){var n=e.defer(),s="api/reports/"+a.reportId+"/list_data_space_columns";return r.dataSpaceColumns[a.reportId]?n.resolve(r.dataSpaceColumns[a.reportId]):t.getJSON(s).then(function(e){e=e.map(function(e){return{name:e,selected:!1}}),r.dataSpaceColumns[a.reportId]=e,n.resolve(e)},function(e){n.reject(e)}),n.promise},this.getExportDurations=function(){var a=e.defer(),n="admin/export_time_periods.json";return r.timePeriods.length>0?a.resolve(r.timePeriods):t.getJSON(n).then(function(e){var t=_.reject(e.results,function(e){return o.indexOf(e.value)>=0});r.timePeriods=t,a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getRoomNos=function(){var a=e.defer(),n="house/search.json",s={all_employees_selected:!0,page:1,per_page:9999};return t.postJSON(n,s).then(function(e){var t=_.map(e.data.rooms,function(e){return{id:e.id,name:e.room_no}});a.resolve(angular.copy(t))},function(e){a.resolve(e)}),a.promise},this.getGuestLanguages=function(){var a=e.defer(),n="api/guest_languages";return t.getJSON(n).then(function(e){var t=_.map(e.languages,function(e){return{id:e.id,value:e.language}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getPaymentMethods=function(){var a=e.defer(),n="staff/payments/addNewPayment.json";return t.getJSON(n).then(function(e){a.resolve(e.data)},function(e){a.resolve(e)}),a.promise},this.getCountries=function(){var a=e.defer(),n="ui/country_list";return t.getJSON(n).then(function(e){var t=_.map(e,function(e){return{id:e.id,value:e.value,code:e.code}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getCICOAgents=function(){var a=e.defer(),n="admin/users.json?isAdminSnt=false&sort_dir=true&sort_field=name";return t.getJSON(n).then(function(e){var t=_.map(e.users,function(e){return{id:e.id,full_name:e.full_name,email:e.email}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getRateList=function(){var a=e.defer(),n="api/rates/list";return t.postJSON(n).then(function(e){var t=_.map(e.rates,function(e){return{code:e.rate_code,name:e.rate_name}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getCICOApplications=function(){var a=e.defer(),n="api/reference_values?type=application";return t.getJSON(n).then(function(e){a.resolve(e)},function(e){a.resolve(e)}),a.promise},this.getHLP=function(){var a=e.defer(),n="staff/user_memberships/get_available_hlps.json";return t.getJSON(n).then(function(e){var t=_.map(e.data,function(e){return{desc:e.hl_description,value:e.hl_value}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getFFP=function(){var a=e.defer(),n="staff/user_memberships/get_available_ffps.json";return t.getJSON(n).then(function(e){var t=_.map(e.data,function(e){return{desc:e.ff_description,value:e.ff_value}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getHLPLevels=function(){var a=e.defer(),n="staff/user_memberships/get_available_hlps.json";return t.getJSON(n).then(function(e){var t=[];_.each(e.data,function(e){_.each(e.levels,function(e){t.push({value:e.membership_level})})}),a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getFFPLevels=function(){var a=e.defer(),n="staff/user_memberships/get_available_ffps.json";return t.getJSON(n).then(function(e){var t=[];_.each(e.data,function(e){_.each(e.levels,function(e){t.push({value:e.membership_level})})}),a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getMemberShips=function(){var t=e.defer(),a=[];return a.push(n.getHLP()),a.push(n.getFFP()),e.all(a).then(function(e){t.resolve(e[0].concat(e[1]))}),t.promise},this.getMemberShipLevels=function(){var t=e.defer(),a=[];return a.push(n.getHLPLevels()),a.push(n.getFFPLevels()),e.all(a).then(function(e){var a=e[0].concat(e[1]);a=_.uniq(a,function(e){return e.value}),t.resolve(a)}),t.promise},this.getReferenceValuesByType=function(a){var n=e.defer(),s="api/reference_values?type="+a;return t.getJSON(s).then(function(e){n.resolve(e)},function(e){n.resolve(e)}),n.promise},this.getReservationTypes=function(){var a=e.defer(),n="api/reservation_types";return t.getJSON(n).then(function(e){a.resolve(e.reservation_types)},function(e){a.resolve(e)}),a.promise},this.processFilterSelections=function(t){var n=[],r=e.defer();return _.each(t,function(e,t){switch(t){case s.BOOKING_ORIGIN_CODE:case s.ORIGIN_CODE:n.push(a.fetchBookingOrigins());break;case s.MARKET_CODE:n.push(a.fetchMarkets());break;case s.RESERVATION_STATUS:n.push(i.getReferenceValuesByType("reservation_status"));break;case s.ROOM_NO:n.push(i.getRoomNos());break;case s.ROOM_TYPE:case s.ARRIVAL_ROOM_TYPE:case s.DEPARTURE_ROOM_TYPE:n.push(a.fetchRoomTypeList());break;case s.SEGMENT_CODE:n.push(a.fetchSegments());break;case s.SOURCE_CODE:n.push(a.fetchSources());break;case s.ARRIVAL_RATE_CODE:n.push(i.getRateList());break;case s.CI_AGENT:case s.CO_AGENT:n.push(i.getCICOAgents());break;case s.CI_APPLICATION:case s.CO_APPLICATION:n.push(i.getCICOApplications());break;case s.COUNTRY:case s.NATIONALITY:n.push(i.getCountries());break;case s.LANGUAGE:n.push(i.getGuestLanguages());break;case s.PRIMARY_PAYMENT_METHOD:n.push(i.getPaymentMethods());break;case s.MEMBERSHIP:n.push(i.getMemberShips());break;case s.MEMBERSHIP_LEVEL:n.push(i.getMemberShipLevels())}}),e.all(n).then(function(e){r.resolve(e)},function(){r.resolve([])}),r.promise},this.getGroupsList=function(){var a=e.defer(),n="api/groups/group_names_list";return t.getJSON(n).then(function(e){a.resolve(e.groups)},function(e){a.resolve(e)}),a.promise}}]),angular.module("reportsModule").factory("RVCustomExportsUtilFac",["$rootScope","RVCustomExportFilterParamsConst","RVreportsSubSrv","$q","RVCustomExportSrv",function(e,t,a,n,s){var r=[{label:"Yes",value:!0},{label:"No",value:!1}],o=[{label:"D",value:"D"},{label:"N",value:"N"}],i=[{label:"Greater than",value:"greater_than"},{label:"Equal to",value:"equal_to"},{label:"Less than",value:"less_than"}],l={"text-transform":"none"},u=[{label:"Has values",value:"is not null"}],c=function(e){var t={};return _.each(e,function(e){t[e.filter_type]||(t[e.filter_type]=[]),t[e.filter_type].push({label:e.description,value:e.value})}),t},d=function(e,t,a){return a=a||"value",t&&0!==t.length?(_.each(e,function(e){t.indexOf(e[a])!==-1&&(e.selected=!0)}),e):e},E=function(e,t,n,s,r){a.fetchBookingOrigins(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,r),e.options={selectAll:!t||a.length===t.length,hasSearch:!1,key:s,value_key:r},e.isMultiSelect=!0,n.resolve(e)})},A=function(e,t,n,s,r){a.fetchMarkets(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,r),e.options={selectAll:!t||a.length===t.length,hasSearch:!1,key:s,value_key:r},e.isMultiSelect=!0,n.resolve(e)})},T=function(e,t,a){s.getReferenceValuesByType("reservation_status").then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"value",defaultValue:"Select Status",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},p=function(e,t,n,s,r){a.fetchSources(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,r),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:s,value_key:r},e.isMultiSelect=!0,n.resolve(e)})},S=function(e,t,n,s,r){a.fetchSegments(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,r),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:s,value_key:r},e.isMultiSelect=!0,n.resolve(e)})},O=function(e,t,n){a.fetchRoomTypeList().then(function(a){e.secondLevelData=d(angular.copy(a),t,"code"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"code"},e.isMultiSelect=!0,n.resolve(e)})},f=function(e,t,a,n){t.secondLevelData=angular.copy(e),t.hasDualState=!0,t.selectedSecondLevel=a||"",n.resolve(t)},R=function(e,t,a){s.getRoomNos().then(function(n){e.secondLevelData=d(angular.copy(n),t,"name"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,a.resolve(e)})},h=function(e,t,a){s.getRateList().then(function(n){e.secondLevelData=d(angular.copy(n),t,"code"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"name",value_key:"code"},e.isMultiSelect=!0,a.resolve(e)})},D=function(e,t,a){s.getCICOAgents().then(function(n){e.secondLevelData=d(angular.copy(n),t,"full_name"),e.options={hasSearch:!0,selectAll:!t||n.length===t.length,key:"full_name",value_key:"full_name",altKey:"email"},e.isMultiSelect=!0,a.resolve(e)})},N=function(e,t,a){s.getCICOApplications().then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"value",value_key:"value",altKey:"description"},e.isMultiSelect=!0,a.resolve(e)})},C=function(e,t,a,n,r){s.getCountries().then(function(s){e.secondLevelData=d(angular.copy(s),t,r),e.options={hasSearch:!0,selectAll:!t||s.length===t.length,key:n,value_key:r},e.isMultiSelect=!0,a.resolve(e)})},m=function(e,t,a){s.getGuestLanguages().then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!0,selectAll:!t||n.length===t.length,key:"value",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},g=function(e,t,a){s.getPaymentMethods().then(function(n){e.secondLevelData=d(angular.copy(n),t,"description"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"description",value_key:"description"},e.isMultiSelect=!0,a.resolve(e)})},L=function(e,t,a){s.getMemberShips().then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"desc",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},I=function(e,t,a){s.getMemberShipLevels().then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"value",value_key:"value"},e.isMultiSelect=!0,e.entryStyle=l,a.resolve(e)})},v=function(e,t,n){a.fetchChargeNAddonGroups().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,n.resolve(e)})},y=function(e,t,n){a.fetchChargeCodes().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,n.resolve(e)})},U=function(e,t,n){a.fetchChargeCodes().then(function(a){e.secondLevelData=d(angular.copy(a),t,"description"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"description",value_key:"description"},e.isMultiSelect=!0,n.resolve(e)})},P=function(e,t,a){s.getReferenceValuesByType("charge_code_type").then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"description",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},M=function(e,t,n){a.fetchHoldStatus().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},
e.isMultiSelect=!0,n.resolve(e)})},Y=function(e,t,a){s.getReservationTypes().then(function(n){e.secondLevelData=d(angular.copy(n),t,"value"),e.options={hasSearch:!1,selectAll:!t||n.length===t.length,key:"name",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},G=function(e,t,a){s.getGroupsList().then(function(n){e.secondLevelData=d(angular.copy(n),t,"id"),e.options={hasSearch:!0,selectAll:!t||n.length===t.length,key:"name",value_key:"id"},e.isMultiSelect=!0,a.resolve(e)})},k=function(e,t,a,n){t.secondLevelData=d(angular.copy(e),a,"value"),t.options={hasSearch:!1,selectAll:!a||r.length===a.length,key:"label",value_key:"value"},t.isMultiSelect=!0,n.resolve(t)},b=function(e,t,n){a.fetchExternalReferenceList().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,n.resolve(e)})},H=function(e,a,s){var i=n.defer();switch(e){case t.BOOKING_ORIGIN_CODE:case t.ORIGIN_CODE:E(a,s,i,"name","value");break;case t.MARKET_CODE:A(a,s,i,"name","value");break;case t.RESERVATION_STATUS:T(a,s,i);break;case t.SOURCE_CODE:p(a,s,i,"name","value");break;case t.SEGMENT_CODE:S(a,s,i,"name","value");break;case t.ROOM_TYPE:case t.ARRIVAL_ROOM_TYPE:case t.DEPARTURE_ROOM_TYPE:O(a,s,i);break;case t.ACTIVE:case t.VIP:case t.POST_STAY:case t.PRE_STAY:case t.TAX_EXEMPT:case t.GLOBAL:case t.IS_FLAGGED:f(r,a,s,i);break;case t.ROOM_NO:R(a,s,i);break;case t.ARRIVAL_RATE_CODE:case t.RATE_CODE:h(a,s,i);break;case t.CI_AGENT:case t.CO_AGENT:case t.USER_NAME:D(a,s,i);break;case t.CI_APPLICATION:case t.CO_APPLICATION:N(a,s,i);break;case t.COUNTRY:C(a,s,i,"value","value");break;case t.LANGUAGE:m(a,s,i);break;case t.PRIMARY_PAYMENT_METHOD:g(a,s,i);break;case t.MEMBERSHIP:L(a,s,i);break;case t.MEMBERSHIP_LEVEL:I(a,s,i);break;case t.STAY_TYPE:f(o,a,s,i);break;case t.CHARGE_GROUP:v(a,s,i);break;case t.CHARGE_CODE:y(a,s,i);break;case t.CHARGE_CODE_DESC:U(a,s,i);break;case t.ORIGIN:E(a,s,i,"name","name");break;case t.MARKET:A(a,s,i,"name","name");break;case t.SOURCE:p(a,s,i,"name","name");break;case t.SEGMENT:S(a,s,i,"name","name");break;case t.NATIONALITY:C(a,s,i,"value","code");break;case t.CHARGE_TYPE:P(a,s,i);break;case t.HOLD_STATUS:M(a,s,i);break;case t.RESERVATION_TYPE:Y(a,s,i);break;case t.GROUP_NAME:G(a,s,i);break;case t.DO_NOT_MOVE:k(r,a,s,i);break;case t.EXTERNAL_SYSTEM:b(a,s,i)}return i.promise},V=function(e,t,a,n,s){var r=_.filter(a,function(t){return t.selectedFirstLevel===e}),o=_.pluck(r,"selectedSecondLevel"),i=_.filter(B(),function(e){return o.indexOf(e.value)===-1});t.secondLevelData=i,t.selectedSecondLevel=n,t.rangeValue=s},F=function(e,t,a,n){var s=_.filter(a,function(t){return t.selectedFirstLevel===e}),r=_.pluck(s,"selectedSecondLevel"),o=_.filter(u,function(e){return r.indexOf(e.value)===-1});t.secondLevelData=o,t.selectedSecondLevel=n},B=function(){return i},w=function(){return u},x={processFilters:c,populateOptions:H,getRangeOperators:B,populateRangeOperators:V,populateGeneralOperators:F,getGeneralOperators:w};return x}]),angular.module("sntRover").service("RVReportsInboxSrv",["$q","rvBaseWebSrvV2","RVReportApplyIconClass","RVReportApplyFlags","RVReportSetupDates","RVReportParamsConst","RVReportInboxFilterLabelConst","RVReservationBaseSearchSrv","RVreportsSubSrv","$filter","$rootScope","RVReportNamesConst","RVReportUtilsFac",function(e,t,a,n,s,r,o,i,l,u,c,d,E){var A=this;this.PER_PAGE=50;var T=[{id:-2,status:"DUE IN",selected:!0},{id:-1,status:"DUE OUT",selected:!0},{id:1,status:"RESERVED",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],p={is_active:!0,name:"UNDEFINED",value:-1};this.fetchReportInbox=function(a){var n=e.defer(),s="/api/generated_reports";return _.isEmpty(a.generated_date)&&(a.generated_date=u("date")(c.serverDate,"yyyy-MM-dd")),t.getJSON(s,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.processReports=function(e){for(var t=0,n=e.length;t<n;t++)a.init(e[t])},this.fillReportDates=function(e){var t="N/A",a="N/A",n=e.filters;n[r.FROM_DATE]?t=n[r.FROM_DATE]:n[r.CANCEL_FROM_DATE]?t=n[r.CANCEL_FROM_DATE]:n[r.ARRIVAL_FROM_DATE]?t=n[r.ARRIVAL_FROM_DATE]:n[r.GROUP_START_DATE]?t=n[r.GROUP_START_DATE]:n[r.DEPOSIT_FROM_DATE]?t=n[r.DEPOSIT_FROM_DATE]:n[r.PAID_FROM_DATE]?t=n[r.PAID_FROM_DATE]:n[r.CREATE_FROM_DATE]?t=n[r.CREATE_FROM_DATE]:n[r.ADJUSTMENT_FROM_DATE]?t=n[r.ADJUSTMENT_FROM_DATE]:n[r.SINGLE_DATE]&&(t=n[r.SINGLE_DATE]),n[r.TO_DATE]?a=n[r.TO_DATE]:n[r.CANCEL_TO_DATE]?a=n[r.CANCEL_TO_DATE]:n[r.ARRIVAL_TO_DATE]?a=n[r.ARRIVAL_TO_DATE]:n[r.GROUP_END_DATE]?a=n[r.GROUP_END_DATE]:n[r.DEPOSIT_TO_DATE]?a=n[r.DEPOSIT_TO_DATE]:n[r.PAID_TO_DATE]?a=n[r.PAID_TO_DATE]:n[r.CREATE_TO_DATE]?a=n[r.CREATE_TO_DATE]:n[r.ADJUSTMENT_TO_DATE]?a=n[r.ADJUSTMENT_TO_DATE]:n[r.SINGLE_DATE]&&(a=n[r.SINGLE_DATE]),e.fromDate="N/A"!==t?u("date")(tzIndependentDate(t),c.dateFormat):t,e.toDate="N/A"!==a?u("date")(tzIndependentDate(a),c.dateFormat):a},this.filterArrayValues=function(e,t,a){var n=-1,s=_.filter(e,function(e){return n=_.findIndex(t,function(t){return t==e[a]}),n!==-1});return s},this.processRateIds=function(e,t,a,n){_.isArray(e)||(e=[e]);var s={ids:e};a.push(l.fetchRateDetailsByIds(s).then(function(e){n[o[t]]=_.pluck(e,"rate_name").join(", ")}))},this.fillDepartmentNames=function(e,t,a,n){a.push(l.fetchDepartments().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.processMarkets=function(e,t,a,n){a.push(l.fetchMarkets().then(function(e){n[o[t]]=_.pluck(e,"name").join(", ")}))},this.processOptions=function(e,t,a){a[o.OPTIONS]||(a[o.OPTIONS]=[]),e&&a[o.OPTIONS].push(o[t])},this.processDisplayFilter=function(e,t,a){a[o.DISPLAY]||(a[o.DISPLAY]=[]),e&&a[o.DISPLAY].push(o[t])},this.fillTaCCDetails=function(e,t,a,n){a.push(l.fetchAccountsById(e).then(function(e){n[o[t]]=e.account_details.account_name}))},this.processAgingBalance=function(e,t,a){var n=[];_.each(e,function(e){n.push(o[e])}),a[o[t]]=n.join(", ")},this.processArrayValuesWithNoFormating=function(e,t,a){a[o[t]]=e.join(", ")},this.fillOriginInfo=function(e,t,a,n){a.push(l.fetchOrigins().then(function(a){var s=_.filter(a,function(t){return _.contains(e,t.value)});n[o[t]]=_.pluck(s,"description").join(", ")}))},this.processOriginUrls=function(e,t,a,n){a.push(l.fetchURLs().then(function(a){var s=_.filter(a,function(t){return _.contains(e,t.id)});n[o[t]]=_.pluck(s,"name").join(", ")}))},this.fillAddonGroups=function(e,t,a,n){a.push(l.fetchChargeNAddonGroups().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillAddons=function(e,t,a,n){var s={addon_ids:e};a.push(l.fetchAddonsByIds(s).then(function(e){n[o[t]]=e.join(", ")}))},this.fillReservationStatus=function(e,t,a,n,s){s.name===d.DEPOSIT_REPORT||s.name===d.GUEST_BALANCE_REPORT?n[o[t]]=_.pluck(A.filterArrayValues(T,e,"id"),"status").join(", "):a.push(l.fetchReservationStatus().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"status").join(", ")}))},this.fillOptionsWithoutFormating=function(e,t,a){a[o[t]]=e},this.fillCompanyTaGroupDetails=function(e,t,a,n){var s=e.split("_");2===s.length&&"account"===s[0]?a.push(l.fetchAccountsById(s[1]).then(function(e){n[o[t]]=e.account_details.account_name})):2===s.length&&"group"===s[0]&&a.push(l.fetchGroupById(s[1]).then(function(e){n[o[t]]=e.group_name}))},this.fillGroupCodes=function(e,t,a,n){var s=[];_.each(e,function(e){a.push(l.fetchGroupById(parseInt(e)).then(function(e){s.push(e.group_name),n[o[t]]=s.join(", ")}))})},this.fillCompanyTaDetails=function(e,t,a,n){n[o["COMPANY/TA"]]||(n[o["COMPANY/TA"]]=[]),_.each(e,function(e,t){a.push(l.fetchAccountsById(e).then(function(e){n[o["COMPANY/TA"]].push(e.account_details.account_name)}))})},this.fillCheckedInCheckedOut=function(e,t,a){a[o["CHECK IN/ CHECK OUT"]]||(a[o["CHECK IN/ CHECK OUT"]]=[]),e&&a[o["CHECK IN/ CHECK OUT"]].push(o[t])},this.fillShowFields=function(e,t,a){a[o.SHOW]||(a[o.SHOW]=[]),e&&a[o.SHOW].push(o[t])},this.fillValueWithoutFormating=function(e,t,a){a[o[t]]=e},this.fillRateTypes=function(e,t,a,n){a.push(l.fetchRateTypes().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a.results,e,"id"),"name").join(", ")}))},this.fillChargeCodes=function(e,t,a,n){a.push(l.fetchChargeCodes().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillChargeGroups=function(e,t,a,n){a.push(l.fetchChargeNAddonGroups().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"description").join(", ")}))},this.fillGuestAccount=function(e,t,a){a[o["GUEST/ACCOUNT"]]||(a[o["GUEST/ACCOUNT"]]=[]),e&&a[o["GUEST/ACCOUNT"]].push(o[t])},this.fillUserInfo=function(e,t,a,n){a.push(l.fetchActiveUsers().then(function(a){var s=A.filterArrayValues(a,e,"id");s=_.map(s,function(e){return e.full_name||e.email}),n[o[t]]=s.join(", ")}))},this.fillBookingOrigins=function(e,t,a,n){a.push(l.fetchBookingOrigins().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(p),n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillMarkets=function(e,t,a,n){a.push(l.fetchMarkets().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(p),n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSources=function(e,t,a,n){a.push(l.fetchSources().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(p),n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSegments=function(e,t,a,n){a.push(l.fetchSegments().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(p),n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillHoldStatuses=function(e,t,a,n){a.push(l.fetchHoldStatus().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillGroupInfo=function(e,t,a,n){a.push(l.fetchGroupById(e).then(function(e){n[o[t]]=e.group_name}))},this.fillRoomTypes=function(e,t,a,n){var s={"ids[]":e};a.push(A.fetchRoomtypesByIds(s).then(function(e){n[o[t]]=_.pluck(e,"name").join(", ")}))},this.fillFloors=function(e,t,a,n){a.push(l.fetchFloors().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"floor_number").join(", ")}))},this.fillTravelAgentInfo=function(e,t,a,n){var s={"ids[]":e};a.push(l.fetchTravelAgentsByIds(s).then(function(e){n[o[t]]=_.pluck(e,"account_name").join(", ")}))},this.fillVatInfo=function(e,t,a){a[o["COMPANY/TRAVEL_AGENT"]]||(a[o["COMPANY/TRAVEL_AGENT"]]=[]),e&&a[o["COMPANY/TRAVEL_AGENT"]].push(o[t])},this.fillCampaignTypesInfo=function(e,t,a,n){a.push(l.fetchCampaignTypes().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSortDir=function(e,t,a){var n="ASC";e||(n="DESC"),a[o[t]]=n},this.fillSortField=function(e,t,a,n){var s="";if(n.filters.rawData&&_.isArray(n.filters.rawData.sortOptions)){var r=_.find(n.filters.rawData.sortOptions,{value:e});s=r.description}else s=e.replace(/_/g," ");a[o[t]]=s},this.getDateRangeLabelName=function(e,t){var a=o[e];if(e===r.FROM_DATE)switch(t){case d.BOOKING_SOURCE_MARKET_REPORT:a=o.BOOKED_DATE_FROM;break;case d.CANCELLATION_NO_SHOW:a=o.arrival_from_date}else if(e===r.TO_DATE)switch(t){case d.BOOKING_SOURCE_MARKET_REPORT:a=o.BOOKED_DATE_TO;break;case d.CANCELLATION_NO_SHOW:a=o.arrival_to_date}else if(e===r.DEPOSIT_FROM_DATE)switch(t){case d.DEPOSIT_REPORT:a=o.DEPOSIT_DUE_FROM_DATE}else if(e===r.DEPOSIT_TO_DATE)switch(t){case d.DEPOSIT_REPORT:a=o.DEPOSIT_DUE_TO_DATE}return a},A.processDueOut=function(e,t,a,n){if(e){var s=o[t];n.name===d.CREDIT_CHECK_REPORT?a[o.SHOW]?a[o.SHOW].push(s):a[o.SHOW]=[s]:a[o.OPTIONS]?a[o.OPTIONS].push(s):a[o.OPTIONS]=[s]}},this.fillRestrictions=function(e,t,a,n){a.push(l.fetchRestrictionList().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"description").join(",")}))},this.fillGroupByInfo=function(e,t,a){e&&(a[o.GROUP_BY]=o[t])},this.fillAccountInfo=function(e,t,a,n){n[o[t]]||(n[o[t]]=[]),a.push(l.fetchAccounts().then(function(a){n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"account_name").join(",")}))},this.fillSelectedCountries=function(e,t,a,n){n[o[t]]||(n[o[t]]=[]),a.push(l.fetchCountries().then(function(a){e.length===a.length+1?n[o[t]]="All Countries":n[o[t]]=_.pluck(A.filterArrayValues(a,e,"id"),"value").join(",")}))},this.fillShowUpsellsOnly=function(e,t,a){e&&(a[o[t]]="Yes")},this.processFilters=function(t){var a={},n=[],s=e.defer();return _.each(t.filters,function(e,s){switch(s){case r.FROM_DATE:case r.TO_DATE:case r.DEPOSIT_FROM_DATE:case r.DEPOSIT_TO_DATE:a[A.getDateRangeLabelName(s,t.name)]=e?u("date")(tzIndependentDate(e),c.dateFormat):e;break;case r.CANCEL_FROM_DATE:case r.CANCEL_TO_DATE:case r.ARRIVAL_FROM_DATE:case r.ARRIVAL_TO_DATE:case r.GROUP_START_DATE:case r.GROUP_END_DATE:case r.PAID_FROM_DATE:case r.PAID_TO_DATE:case r.CREATE_FROM_DATE:case r.CREATE_TO_DATE:case r.ADJUSTMENT_FROM_DATE:case r.ADJUSTMENT_TO_DATE:case r.SINGLE_DATE:a[o[s]]=e?u("date")(tzIndependentDate(e),c.dateFormat):e;break;case r.FROM_TIME:case r.TO_TIME:case r.INCLUDE_DAYUSE:a[o[s]]=e;break;case r.RATE_IDS:case r.RATE_ID:A.processRateIds(e,s,n,a);break;case r.ASSIGNED_DEPARTMENTS:A.fillDepartmentNames(e,s,n,a);break;case r.CHOOSE_MARKET:A.processMarkets(e,s,n,a);break;case r.DEPOSIT_DUE:case r.DEPOSIT_PAID:case r.DEPOSIT_PAST:case r.INCLUDE_CANCELLED:case r.INCLUDE_CANCELED:case r.INCLUDE_NO_SHOW:case r.INCLUDE_TAX:case r.DUE_IN_ARRIVALS:case r.INCLUDE_ACTIONS:case r.INCLUDE_LEDGER_DATA:case r.INCLUDE_GUEST_NOTES:case r.INCLUDE_RESERVATION_NOTES:case r.SHOW_GUESTS:case r.VIP_ONLY:case r.EXCLUDE_NON_GTD:case r.RESTRICTED_POST_ONLY:case r.ROVER:case r.ZEST:case r.ZEST_WEB:case r.INCLUDE_LAST_YEAR:case r.INCLUDE_VARIANCE:case r.INCLUDE_BOTH:case r.INCLUDE_NEW:case r.SHOW_RATE_ADJUSTMENTS_ONLY:case r.NO_NATIONALITY:case r.DUE_OUT_DEPARTURES:case r.HAS_VEHICLE_REG_NO:case r.SHOW_PHONE_NUMBER:A.processOptions(e,s,a);break;case r.SHOW_DELETED_CHARGES:case r.SHOW_ADJUSTMENTS:case r.INCLUDE_MARKET:case r.INCLUDE_ORIGIN:case r.INCLUDE_SEGMENT:case r.INCLUDE_SOURCE:A.processDisplayFilter(e,s,a);break;case r.ACCOUNT_SEARCH:A.fillAccountInfo(e,s,n,a);break;case r.AGING_BALANCE:A.processAgingBalance(e,s,a);break;case r.COMPLETION_STATUS:case r.SHOW_ACTIONABLES:case r.INCLUDE_GUARANTEE_TYPE:A.processArrayValuesWithNoFormating(e,s,a);break;case r.ORIGIN_VALUES:A.fillOriginInfo(e,s,n,a);break;case r.ORIGIN_URLS:A.processOriginUrls(e,s,n,a);break;case r.ADDONS_GROUPS_IDS:A.fillAddonGroups(e,s,n,a);break;case r.ADDONS_IDS:A.fillAddons(e,s,n,a);break;case r.RESERVATION_STATUS:A.fillReservationStatus(e,s,n,a,t);break;case r.ADDON_GROUP_BY:A.fillOptionsWithoutFormating(e,s,a);break;case r.INCLUDE_COMPANYCARD_TA_GROUP:case r.GROUP_COMPANY_TA_CARD:A.fillCompanyTaGroupDetails(e,s,n,a);break;case r.INCLUDE_COMPANYCARD_TA:case r.TA_CC_CARD:A.fillCompanyTaDetails(e,s,n,a,t);break;case r.GROUP_CODE:A.fillGroupCodes(e,s,n,a,t);break;case r.CHECKED_IN:case r.CHECKED_OUT:A.fillCheckedInCheckedOut(e,s,a);break;case r.SHOW_TRAVEL_AGENT:case r.SHOW_COMPANY:case r.INCLUDE_INHOUSE:case r.OOO:case r.OOS:case r.EXCEEDED_ONLY:A.fillShowFields(e,s,a);break;case r.MIN_REVENUE:case r.MIN_NIGHTS:case r.MIN_NO_OF_DAYS_NOT_OCCUPIED:case r.VAT_YEAR:A.fillValueWithoutFormating(e,s,a);break;case r.RATE_TYPE_IDS:A.fillRateTypes(e,s,n,a);break;case r.CHARGE_CODE_IDS:A.fillChargeCodes(e,s,n,a);break;case r.CHARGE_GROUP_IDS:A.fillChargeGroups(e,s,n,a);break;case r.ACCOUNT:case r.GUEST:A.fillGuestAccount(e,s,a);break;case r.USER_IDS:A.fillUserInfo(e,s,n,a);break;case r.BOOKING_ORIGIN_IDS:A.fillBookingOrigins(e,s,n,a);break;case r.MARKET_IDS:A.fillMarkets(e,s,n,a);break;case r.SOURCE_IDS:A.fillSources(e,s,n,a);break;case r.HOLD_STATUS_IDS:A.fillHoldStatuses(e,s,n,a);break;case r.INCLUDE_GROUP:A.fillGroupInfo(e,s,n,a);break;case r.ROOM_TYPE_IDS:A.fillRoomTypes(e,s,n,a);break;case r.FLOOR:A.fillFloors(e,s,n,a);break;case r.TRAVEL_AGENTS:A.fillTravelAgentInfo(e,s,n,a);break;case r.WITH_VAT_NUMBER:case r.WITHOUT_VAT_NUMBER:A.fillVatInfo(e,s,a);break;case r.CAMPAIGN_TYPES:A.fillCampaignTypesInfo(e,s,n,a);break;case r.SORT_DIR:A.fillSortDir(e,s,a);break;case r.SORT_FIELD:A.fillSortField(e,s,a,t);break;case r.INCLUDE_DUE_OUT:A.processDueOut(e,s,a,t);break;case r.SEGMENT_IDS:A.fillSegments(e,s,n,a);break;case r.RESTRICTION_IDS:A.fillRestrictions(e,s,n,a);break;case r.GROUP_BY_DATE:case r.GROUP_BY_USER:case r.GROUP_BY_GROUP_NAME:A.fillGroupByInfo(e,s,a);break;case r.COUNTRY:A.fillSelectedCountries(e,s,n,a);break;case r.SHOW_UPSELL_ONLY:A.fillShowUpsellsOnly(e,s,a)}}),a[o.OPTIONS]&&a[o.OPTIONS].length>0?a[o.OPTIONS]=a[o.OPTIONS].join(","):delete a[o.OPTIONS],a[o.SHOW]&&(a[o.SHOW]=a[o.SHOW].join(",")),a[o["COMPANY/TRAVEL_AGENT"]]&&(a[o["COMPANY/TRAVEL_AGENT"]]=a[o["COMPANY/TRAVEL_AGENT"]].join(",")),a[o["GUEST/ACCOUNT"]]&&(a[o["GUEST/ACCOUNT"]]=a[o["GUEST/ACCOUNT"]].join(",")),a[o["CHECK IN/ CHECK OUT"]]&&(2===a[o["CHECK IN/ CHECK OUT"]].length?a[o["CHECK IN/ CHECK OUT"]]=o.SHOW_CHECKINS_AND_CHECKOUTS:a[o["CHECK IN/ CHECK OUT"]]=a[o["CHECK IN/ CHECK OUT"]].join(",")),a[o.DISPLAY]&&(a[o.DISPLAY]=a[o.DISPLAY].join(",")),e.all(n).then(function(){A.formatResponseOnPromiseResolve(a),s.resolve(a)},function(){s.reject(a)}),s.promise},A.formatResponseOnPromiseResolve=function(e){e[o["COMPANY/TA"]]&&(e[o["COMPANY/TA"]]=e[o["COMPANY/TA"]].join(", "))},this.formatReportList=function(e,t){var a=void 0;return _.each(e,function(n,s){a=_.find(t,{id:n.report_id}),a?(n.name=a.title,n.reportIconCls=a.reportIconCls,n.shouldShowExport=a.display_export_button,n.shouldDisplayView=a.display_show_button,n.isExpanded=!1,E.parseDatesInObject(n.filters.rawData),n.rawData=n.filters.rawData,n.appliedFilter=n.filters.appliedFilter,A.fillReportDates(n)):delete e[s]}),e},this.fetchRoomtypesByIds=function(a){var n=e.defer(),s="/api/room_types";return t.getJSON(s,a).then(function(e){n.resolve(e.results)},function(e){n.reject(e)}),n.promise}}]),angular.module("reportsModule").factory("dateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,n){var s,r,o={},i={};return a.hasDateFilter&&(a.fromDate&&(s=e.FROM_DATE,o[s]=t("date")(a.fromDate,"yyyy/MM/dd"),n&&(i.fromDate=angular.copy(a.fromDate))),a.untilDate&&(r=e.TO_DATE,o[r]=t("date")(a.untilDate,"yyyy/MM/dd"),n&&(i.toDate=angular.copy(a.untilDate)))),{params:o,filters:i}}}}]).factory("cancelDateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,n){var s,r,o={},i={};return a.hasCancelDateFilter&&(s=e.CANCEL_FROM_DATE,r=e.CANCEL_TO_DATE,o[s]=t("date")(a.fromCancelDate,"yyyy/MM/dd"),o[r]=t("date")(a.untilCancelDate,"yyyy/MM/dd"),n&&(i.cancelFromDate=angular.copy(a.fromCancelDate),i.cancelToDate=angular.copy(a.untilCancelDate))),{params:o,filters:i}}}}]).factory("arrivalDateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,n){var s,r,o={},i={};return a.hasArrivalDateFilter&&a.fromArrivalDate&&a.untilArrivalDate&&(s=e.ARRIVAL_FROM_DATE,r=e.ARRIVAL_TO_DATE,o[s]=t("date")(a.fromArrivalDate,"yyyy/MM/dd"),o[r]=t("date")(a.untilArrivalDate,"yyyy/MM/dd"),n&&(i.arrivalFromDate=angular.copy(a.fromArrivalDate),i.arrivalToDate=angular.copy(a.untilArrivalDate))),{params:o,filters:i}}}}]).service("RVReportParamsAndFiltersSrv",["dateFilterFac",function(e){var t={},a={},n={options:[],display:[],show:[],markets:[],sources:[],origins:[],origin_urls:[],guarantees:[],chargeGroups:[],chargeCodes:[],holdStatuses:[],addonGroups:[],addons:[],reservationStatus:[],guestOrAccount:[],chargeTypes:[],users:[],campaign_types:[],floorList:[],rates:[],assigned_departments:[],completion_status:[]},s=function(e){return a=_.extend(a,e)},r=function(){return a=angular.copy(n)};return{getParams:function(){return t},getFilters:function(){return a},genParamsAndFilters:function(a,n,o,i){var i="boolean"!=typeof i||i;i&&r(),addParam({id:a.id,page:n,per_page:o});var l=e.check(a,i);addParam(l.params),s(l.filters);var _=cancelDateFilterFac.check(a,i);addParam(_.params),s(_.filters);var u=arrivalDateFilterFac.check(a,i);return addParam(u.params),s(u.filters),{params:t,filters:filters}}}}]),angular.module("reportsModule").factory("rvReportsCache",["$cacheFactory",function(e){return e("REPORTS")}]),angular.module("sntRover").service("RVreportsSrv",["$q","sntBaseWebSrv","RVreportsSubSrv","$vault","$http","RVReportApplyFlags","RVReportUtilsFac","RVReportSetupDates","RVCustomExportSrv",function(e,t,a,n,s,r,o,i,l){function u(t,s){var r={},o=[],i=function(e,t){r[e]=angular.copy(t)},l=function(e,t){r[e]=t};r.reportsResponse=angular.copy(s),o.push(a.fetchCodeSettings().then(i.bind(null,"codeSettings"),l.bind(null,"codeSettings",{}))),o.push(a.fetchActiveUsers().then(i.bind(null,"activeUserList"),l.bind(null,"activeUserList",[]))),e.all(o).then(function(){E.payloadCache=angular.copy(r),n.set(R,JSON.stringify(E.payloadCache)),t.resolve(r)},function(){t.resolve(r)})}function c(t){var n=e.defer(),s={},r=9,o=t===S.EXPORT_SCHEDULE,i=function(){var e=_.keys(s).length;e===r&&n.resolve(s)},u=function(e,t){s[e]=angular.copy(t),i()},c=function(e,t,a){s[e]=t,i()};return a.fetchSchedules(o).then(u.bind(null,"schedulesList"),c.bind(null,"schedulesList",[])),a.fetchScheduleFrequency(o).then(u.bind(null,"scheduleFrequency"),c.bind(null,"scheduleFrequency",[])),a.fetchScheduleFormat().then(u.bind(null,"scheduleFormat"),c.bind(null,"scheduleFormat",[])),a.fetchTimePeriods().then(u.bind(null,"scheduleTimePeriods"),c.bind(null,"scheduleTimePeriods",[])),a.fetchSchedulableReports(o).then(u.bind(null,"schedulableReports"),c.bind(null,"schedulableReports",[])),a.fetchDeliveryTypes().then(u.bind(null,"scheduleDeliveryTypes"),c.bind(null,"scheduleDeliveryTypes",[])),a.fetchFtpServers().then(u.bind(null,"ftpServerList"),c.bind(null,"ftpServerList",[])),l.getCloudDrives("DROP_BOX").then(u.bind(null,"dropBoxAccounts"),c.bind(null,"ftpServerList",[])),l.getCloudDrives("GOOGLE_DRIVE").then(u.bind(null,"googleDriveAccounts"),c.bind(null,"ftpServerList",[])),n.promise}var d=this,E={},A={},T={},p={},S={SCHEDULE_REPORT:"SCHEDULE_REPORT",EXPORT_SCHEDULE:"EXPORT_SCHEDULE"},O={"Nationality Statistics":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Financial Transactions":["YESTERDAY"],"Stash Rewards Membership Export":["YESTERDAY"],Reservations:["YESTERDAY"],"Synxis - Reservations":["YESTERDAY"],Rooms:["TODAY"],"Future Reservations":["TODAY"],"Synxis - Upcoming Reservation Export (Future Reservation Export)":["TODAY"],"Last Week Reservations":["LAST_SEVEN_DAYS"],"Past Reservations - Monthly":["ALL","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],Commissions:["ALL","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Journal Export":["YESTERDAY","TODAY","DATE"],"Invoice / Folio Export":["YESTERDAY","TODAY","DATE_RANGE"],"GOBD Export":["DATE_RANGE"],"GOBD Admin Charge Code Actions Export":["DATE_RANGE"],"Clairvoyix Stays Export":["YESTERDAY","ALL"],"Clairvoyix Reservations Export":["TODAY"],"Police Report Export":["TODAY"],"Switzerland Zurich Police Export":["TODAY"],"Spain Barcelona Police Export":["TODAY"],"Belgium Nationality Export":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Austria Residence Country Export":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Criterion Hospitality CC Export":["TODAY","YESTERDAY","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Nationality Export - France":["TODAY","YESTERDAY","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Guest Details by Arrival Date":["YESTERDAY","DATE"],"Cancellations by Arrival Date":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","DATE_RANGE"],"Cancellations by Cancel Date":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","DATE_RANGE"],"HESTA Switzerland":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Ad Notum - Rate of the Day Export":["TODAY"]},f={Arrival:["TODAY","TOMORROW"],Departure:["TODAY","TOMORROW"],"In-House Guests":["TODAY","TOMORROW"],Comparison:["YESTERDAY"],"Guest Balance Report":["ALL"],"Daily Production":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Daily Production by Demographics":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Daily Production by Rate":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Business on the Books":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_MONTH","LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_THIRTY_DAYS","NEXT_THIRTY_DAYS","CURRENT_YEAR","NEXT_365_DAYS"],"Daily Transactions":["YESTERDAY"],"Action Manager":["YESTERDAY","TODAY","TOMORROW","LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS"],"Financial Transactions - Adjustment Report":["YESTERDAY","TODAY","LAST_SEVEN_DAYS","LAST_MONTH","LAST_THIRTY_DAYS","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],Forecast:["LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS","NEXT_MONTH","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","LAST_THIRTY_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","CURRENT_YEAR","NEXT_365_DAYS"],"Rooms OOO/OOS":["CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Reservations By User:CREATE_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Reservations By User:ARRIVAL_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH"],"Rate Adjustment Report:ARRIVAL_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","TOMORROW","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Rate Adjustment Report:ADJUSTMENT_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Occupancy & Revenue Summary":["YESTERDAY","LAST_WEEK","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Add-On Forecast":["TODAY","TOMORROW","NEXT_SEVEN_DAYS","NEXT_TEN_DAYS","NEXT_THIRTY_DAYS"],"Forecast Guests & Groups":["CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","NEXT_SEVEN_DAYS","NEXT_TEN_DAYS","NEXT_THIRTY_DAYS","LAST_MONTH","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_YEAR","NEXT_365_DAYS"],"Market Segment Statistics Report":["YESTERDAY"],"A/R Aging":["YESTERDAY"],"Complimentary Room Report":["TODAY","TOMORROW","YESTERDAY","LAST_WEEK","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_MONTH","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Cancellation & No Show:DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","TOMORROW","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Cancellation & No Show:CANCELATION_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Financial Transaction - Revenue Report":["YESTERDAY","TODAY","DATE_RANGE"],"Financial Transaction - Payment Report":["YESTERDAY","TODAY","DATE_RANGE"],"Financial Transaction - Summary Report":["YESTERDAY","TODAY","DATE"]},R="REPORT_PAYLOAD_CACHE";return E.payloadCache=n.get(R),E.payloadCache?E.payloadCache=JSON.parse(E.payloadCache):E.payloadCache={},E.setChoosenReport=function(e){A=e},E.getChoosenReport=function(){return A},E.reportApiPayload=function(){var t=e.defer(),n=function(e){t.reject(e)};return a.fetchReportList().then(u.bind(null,t),n),
t.promise},E.exportCSV=function(e){return t.download(e.url,e.payload)},E.reportSchedulesPayload=function(){return c(S.SCHEDULE_REPORT)},E.reportExportPayload=function(){return c(S.EXPORT_SCHEDULE)},E.fetchOneSchedule=function(a){var n=e.defer(),s="admin/export_schedules/"+a.id,r=function(e){n.resolve(e)},o=function(e){n.reject(e)};return t.getJSON(s).then(r,o),n.promise},E.updateSchedule=function(a){var n=e.defer(),s="admin/export_schedules/"+a.id,r=function(e){n.resolve(e)},o=function(e){n.reject(e)};return t.putJSON(s,a).then(r,o),n.promise},E.createSchedule=function(a){var n=e.defer(),s="admin/export_schedules",r=function(e){n.resolve(e)},o=function(e){n.reject(e)};return t.postJSON(s,a).then(r,o),n.promise},E.deleteSchedule=function(a){var n=e.defer(),s="admin/export_schedules/"+a.id,r=function(e){n.resolve(e)},o=function(e){n.reject(e)};return t.deleteJSON(s).then(r,o),n.promise},E.runScheduleNow=function(a){var n=e.defer(),s="/admin/export_schedules/"+a.id+"/run_now",r=function(e){n.resolve(e)},o=function(e){n.reject(e)};return t.getJSON(s).then(r,o),n.promise},E.setReportRequestParam=function(e,t){A[e]=t},E.getReportExportTimePeriods=function(e){return O[e]},E.getScheduleReportTimePeriods=function(e){return f[e]},E.setPrintClicked=function(e){d.printClicked=e},E.getPrintClickedState=function(){return d.printClicked},E.processSelectedReport=function(e,t){r.init(e),o.addIncludeUserFilter(e),o.addIncludeOtherFilter(e),i.init(e),_.each(e.filters,function(t){i.execFilter(e,t)}),o.processFilters(e,t),o.reOrderSortBy(e),o.processSortBy(e),o.processGroupBy(e)},E.setSelectedReport=function(e){T=e},E.getSelectedReport=function(){return T},E.saveCofigurationData=function(e){p=e},E.getCofigurationData=function(){return p},E}]),angular.module("sntRover").service("RVreportsSubSrv",["$q","rvBaseWebSrvV2","rvReportsCache","RVReportMsgsConst","RVReportNamesConst","$rootScope",function(e,t,a,n,s,r){var o={},i={};o.availInStore=function(e){return!!i.hasOwnProperty(e)},o.getfromStore=function(e){return!!i.hasOwnProperty(e)&&i[e]},o.setIntoStore=function(e,t){i[e]=t},o.cachedInboxReport={},o.weekendDays=[];var l=function(e){return e===s.DAILY_PRODUCTION_DEMO||e===s.DAILY_PRODUCTION_RATE||e===s.DAILY_PRODUCTION_ROOM_TYPE};o.processResults=function(e){var t,a,n,r=angular.copy(o.cachedInboxReport).results,i=(e.page-1)*e.per_page,u=i+e.per_page,c=!1;if(l(e.reportTitle)&&(c=!0),e.fiterFromDate&&e.filterToDate&&c){a=new Date(e.fiterFromDate),n=new Date(e.filterToDate);var d;r=Object.keys(r).reduce(function(e,t){return d=new Date(t),d>=a&&d<=n&&(e[t]=r[t]),e},{})}if(e.reportTitle===s.TRAVEL_AGENT_COMMISSIONS){if(r.length){var E=r[0].reservation_details.reservations;r[0].reservation_details.reservations=E.length?E.slice(i,u):[]}t=r}else t=_.isArray(r)?r.slice(i,u):r;return t},o.processTotalResultRow=function(e){var t=angular.copy(o.cachedInboxReport),a=t.results_total_row,n=t.total_count,s=!1,r=Math.ceil(n/e.per_page);if(l(e.reportTitle)&&(s=!0),e.fiterFromDate&&e.filterToDate&&s){var i,u=new Date(e.fiterFromDate),c=new Date(e.filterToDate);a=_.filter(a,function(e){return i=new Date(Object.keys(e)[0]),i>=u&&i<=c})}return n<e.per_page||e.page===r?a:null},o.getcachedInboxReportByParams=function(e){var t=angular.copy(o.cachedInboxReport);if(e.reportTitle===s.TRAVEL_AGENT_COMMISSIONS){var a=t.results.length?t.results[0].reservation_details.total_reservations:0;t.results_total_row=a,t.total_count=a}return t.results=o.processResults(e),t.results_total_row=o.processTotalResultRow(e),t.isPaginatedResponse=!0,t};var u=function(s){var r=e.defer(),i=0,l=function(){i++},u=setInterval(l,1e3),c=function e(a){if(i>=300){var n=["Request timed out. Unable to process report !!"];r.reject(n)}else t.getJSONWithSpecialStatusHandling(a).then(function(t){t.status&&"processing_not_completed"===t.status||"null"===t?setTimeout(function(){console.info("POLLING::-> for print response"),e(a)},5e3):(clearInterval(u),r.resolve(t))},function(t){"undefined"==typeof t?e(a):(clearInterval(u),r.reject(t))})},d=function(e){var t;e.status&&"processing_not_completed"===e.status?c(e.location_header):(t=s.resKey2&&s.resKey?e[s.resKey][s.resKey2]:s.resKey?e[s.resKey]:e,s.hasOwnProperty("name")&&o.setIntoStore(s.name,t),clearInterval(u),[n.REPORT_SUBMITED,n.REPORT_UPDATED,n.REPORT_PAGE_CHANGED,n.REPORT_FILTER_CHANGED].indexOf(s.action)>=0&&a.put("LAST_FETCHED_REPORT",t),r.resolve(t))},E=function(e){r.reject(e||{})};return s.url&&s.method&&t.hasOwnProperty(s.method)?o.availInStore(s.name)?r.resolve(o.getfromStore(s.name)):s.params?s.action===n.REPORT_LOAD_LAST_REPORT?r.resolve(a.get("LAST_FETCHED_REPORT")):"Credit Check Report"===s.params.reportTitle?(s.params=_.omit(s.params,"reportTitle"),t.postJSONWithSpecialStatusHandling(s.url,s.params).then(d,E)):(s.params=_.omit(s.params,"reportTitle"),t[s.method](s.url,s.params).then(d,E)):t[s.method](s.url).then(d,E):E(),r.promise};return o.fetchReportList=function(){return u({name:"reportList",method:"getJSON",url:"/api/reports"})},o.fetchReportDetails=function(e){return u({method:"postJSON",url:"/api/reports/"+e.id+"/submit",params:_.omit(e,["id","action"]),action:e.action})},o.fetchGeneratedReportDetails=function(a){var n=e.defer(),s="/api/generated_reports/"+a.id+"/view";return"Tax Output Report - Tax Payment Receipts"===a.reportTitle?t.getJSON(s).then(function(e){99999!==a.per_page&&_.each(e.results,function(e){e.receipt_details&&e.receipt_details.receipts&&e.receipt_details.receipts.length>a.per_page&&(e.receipt_details.receipts=e.receipt_details.receipts.slice(0,a.per_page))}),o.cachedInboxReport=e,o.weekendDays=e.weekend_days||["Saturday","Sunday"],n.resolve(o.getcachedInboxReportByParams(a))},function(e){n.reject(e)}):1===a.page?t.getJSON(s).then(function(e){o.cachedInboxReport=e,o.weekendDays=e.weekend_days||["Saturday","Sunday"],n.resolve(o.getcachedInboxReportByParams(a))},function(e){n.reject(e)}):n.resolve(o.getcachedInboxReportByParams(a)),n.promise},o.getReservationsOfTravelAgents=function(e){return u({method:"getJSON",url:"api/reports/list_travel_agent_reservations",params:e})},o.getReceiptsOfCategories=function(e){return u({method:"getJSON",url:"api/reports/list_tax_payment_receipts",params:e})},o.fetchActiveUsers=function(){return u({name:"activeUsers",method:"getJSON",url:"/api/users/active"})},o.fetchTaxPaymentReceiptTypes=function(){return u({name:"paymentReceiptTypes",method:"getJSON",url:"/api/payment_receipts/tax_payment_receipt_types",resKey:"results"})},o.fetchGuaranteeTypes=function(){return u({name:"guaranteeTypes",method:"getJSON",url:"/api/reservation_types.json?is_active=true",resKey:"reservation_types"})},o.fetchChargeNAddonGroups=function(e){return u({name:"chargeNAddonGroups",method:"getJSON",url:"api/charge_groups",resKey:"results",params:e})},o.fetchChargeCodes=function(){return u({name:"chargeCodes",method:"getJSON",url:"api/charge_codes",resKey:"results"})},o.fetchAllowances=function(){return u({name:"allowances",method:"getJSON",url:"api/addons",params:{allowance_only:!0,no_pagination:!0},resKey:"results"})},o.fetchAddons=function(e){return u({name:"addons",method:"postJSON",url:"api/addons/detail",params:e,resKey:"results"})},o.fetchMarkets=function(e){var t="/api/market_segments?is_active=true";return e&&(t="/api/market_segments"),u({name:"markets",method:"getJSON",url:t,resKey:"markets"})},o.fetchSegments=function(e){var t="/api/segments?is_active=true";return e&&(t="/api/segments"),u({name:"segments",method:"getJSON",url:t,resKey:"segments"})},o.fetchSources=function(e){var t="api/sources?is_active=true";return e&&(t="api/sources"),u({name:"sources",method:"getJSON",url:t,resKey:"sources"})},o.fetchBookingOrigins=function(e){var t="api/booking_origins?is_active=true";return e&&(t="api/booking_origins"),u({name:"bookingOrigins",method:"getJSON",url:t,resKey:"booking_origins"})},o.fetchCodeSettings=function(){return u({name:"codeSettings",method:"getJSON",url:"/api/reports/code_settings"})},o.fetchComTaGrp=function(e,t){var a="?query="+e;return t&&(a+="&exclude_groups=true"),u({method:"getJSON",url:"api/reports/search_by_company_agent_group"+a,resKey:"results"})},o.fetchGroupCode=function(e){var t="?query="+e;return u({method:"getJSON",url:"api/reports/search_group_by_code"+t,resKey:"results"})},o.fetchHoldStatus=function(){return u({name:"holdStatus",method:"getJSON",url:"api/group_hold_statuses",resKey:"data",resKey2:"hold_status"})},o.fetchReservationStatus=function(){return u({name:"reservationStatus",method:"getJSON",url:"api/reservations/status",resKey:"reservation_status"})},o.fetchAddonReservations=function(e){return u({method:"getJSON",url:"/api/reports/"+e.id+"/addon_reservations",params:_.omit(e,"id"),resKey:"results"})},o.fetchRateTypesAndRateList=function(){return u({name:"rateTypeAndRateList",method:"postJSON",url:"/api/rates/list",resKey:"rates"})},o.fetchRateCode=function(){return u({name:"rateCodeList",method:"getJSON",url:"/api/rates/codes",resKey:"rate_codes"})},o.fetchRoomTypeList=function(e){return e=e||{},u({name:"roomTypeList",method:"getJSON",url:"api/room_types",resKey:"results",params:e})},o.fetchRestrictionList=function(){return u({name:"restrictionList",method:"getJSON",url:"/api/restriction_types?is_activated=true",resKey:"results"})},o.fetchOrigins=function(){return u({name:"origins",method:"getJSON",url:"api/reports/origins",resKey:"origins"})},o.fetchURLs=function(){return u({name:"URLs",method:"getJSON",url:"api/guest_web_urls/?application=URL&guest_web_url_type=CHECKIN",resKey:"data"})},o.fetchScheduleFrequency=function(e){var t=e?"admin/export_frequencies.json?export_only=true":"admin/export_frequencies.json";return u({method:"getJSON",url:t,resKey:"results"})},o.fetchScheduleFormat=function(){var e="admin/export_formats.json";return u({method:"getJSON",url:e,resKey:"results"})},o.fetchTimePeriods=function(){return u({name:"scheduleTimePeriods",method:"getJSON",url:"admin/export_time_periods.json",resKey:"results"})},o.fetchSchedules=function(e){var t="admin/export_schedules.json",a={page:1,per_page:9999};return e&&(a.export_only=!0),u({method:"getJSON",url:t,resKey:"results",params:a})},o.fetchOneSchedule=function(e){return u({method:"getJSON",url:"admin/export_schedules/"+e.id})},o.fetchDeliveryTypes=function(e){return u({name:"scheduleDeliveryTypes",method:"getJSON",url:"admin/export_delivery_types.json",resKey:"results"})},o.fetchFtpServers=function(){return u({name:"ftpServerList",method:"getJSON",url:"/api/sftp_servers",resKey:"results"})},o.runNowExport=function(e){var t="admin/export_schedules/"+e.id+".json";return u({method:"putJSON",url:t,resKey:"results"})},o.createExport=function(){var e="admin/export_schedules.json";return u({method:"postJSON",url:e,resKey:"results"})},o.updateAnExport=function(e){var t="admin/export_schedules/"+e.id+".json";return u({method:"putJSON",url:t,resKey:"results"})},o.fetchAnExport=function(e){var t="admin/export_schedules/"+e.id+".json";return u({method:"getJSON",url:t,resKey:"results"})},o.fetchCampaignTypes=function(){return u({name:"campaign_types",method:"getJSON",url:"api/campaigns/campaign_types",resKey:"campaign_types"})},o.fetchSchedulableReports=function(e){var t=e?"admin/export_reports.json?export_only=true":"admin/export_reports.json";return u({method:"getJSON",url:t,resKey:"results"})},o.fetchFloors=function(){return u({name:"houseFloors",method:"getJSON",url:"api/floors.json",resKey:"floors"})},o.fetchDepartments=function(){return u({name:"departments",method:"getJSON",url:"admin/departments.json",resKey:"data",resKey2:"departments"})},o.fetchEmployees=function(){return u({name:"employees",method:"getJSON",url:"/api/users/active.json?journal=true"})},o.fetchPaymentTypes=function(){return u({name:"paymentTypes",method:"getJSON",url:"/api/hotel_payment_types",resKey:"results"})},o.fetchTaxExemptTypes=function(){return u({name:"taxExempts",method:"getJSON",url:"api/tax_exempt_types",resKey:"results"})},o.fetchLanguages=function(){return u({name:"languages",method:"getJSON",url:"api/guest_languages",resKey:"languages"})},o.getChargeCodes=function(e){return u({method:"getJSON",url:"api/reports/"+e.report_id+"/revenue_by_charge_codes",params:_.omit(e,"report_id")})},o.getPaymentValues=function(e){return u({method:"getJSON",url:"api/reports/"+e.report_id+"/payment_by_charge_codes",params:_.omit(e,"report_id")})},o.fetchAccounts=function(){return u({name:"accounts",method:"getJSON",url:"/api/accounts/list",resKey:"accounts"})},o.fetchTravelAgents=function(e){return e=e||{},u({name:"accounts",method:"getJSON",url:" /api/reports/list_travel_agents",resKey:"travel_agents",params:e})},o.fetchCountries=function(e){return e=e||{},u({name:"accounts",method:"getJSON",url:" /ui/country_list",resKey:"",params:e})},o.fetchExternalReferenceList=function(e){return e=e||{},u({name:"externalReferenceList",method:"getJSON",url:"api/reference_values/manual_external_reference_interfaces?workstation_id="+r.workstation_id,resKey:"external_interface_types",params:e})},o.fetchGroups=function(e){return u({method:"getJSON",url:"/api/groups/search",resKey:"groups",params:e})},o.fetchGroupById=function(e){return u({method:"getJSON",url:"/api/groups/"+e+"/group_name"})},o.fetchAccountsById=function(e){return u({method:"getJSON",url:"/api/accounts/"+e})},o.fetchRateTypes=function(){return u({method:"getJSON",url:"/api/rate_types.json?sort_field=is_active&sort_dir=false&per_page=1000&page=1"})},o.fetchEmployeeList=function(){return u({method:"getJSON",url:"/api/work_statistics/employees_list?per_page=9999"})},o.fetchRateDetailsByIds=function(a){var n=e.defer(),s="/api/rates/list";return t.postJSON(s,a).then(function(e){n.resolve(e.rates)},function(e){n.reject(e)}),n.promise},o.fetchAddonsByIds=function(a){var n=e.defer(),s="/api/addons/names_list";return t.postJSON(s,a).then(function(e){n.resolve(e.results)},function(e){n.reject(e)}),n.promise},o.fetchTravelAgentsByIds=function(a){var n=e.defer(),s="/api/reports/list_travel_agents";return t.getJSON(s,a).then(function(e){n.resolve(e.travel_agents)},function(e){n.reject(e)}),n.promise},o.fetchWorkTypes=function(){var a=e.defer(),n="api/work_types";return t.getJSON(n).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},o.fetchFrontOfficeStatus=function(){var a=e.defer(),n="api/reference_values?type=front_office_status";return t.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},o.fetchHouseKeepingStatus=function(){var a=e.defer(),n="api/reference_values?type=housekeeping_status";return t.getJSON(n).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},o}]),angular.module("reportsModule").factory("RVReportApplyFlags",["RVReportNamesConst",function(e){return{init:function(t){var a={BOOKING_SOURCE_MARKET_REPORT:["canRemoveDate"],LOGIN_AND_OUT_ACTIVITY:["hasUserFilter"],DEPOSIT_REPORT:["canRemoveDate"],IN_HOUSE_GUEST:["canRemoveDate","hasOneMonthLimit"],OCCUPANCY_REVENUE_SUMMARY:["hasPrevDateLimit"],RESERVATIONS_BY_USER:["hasUserFilter","canRemoveDate"],MARKET_SEGMENT_STAT_REPORT:["hasSysDateLimit"],ROOMS_QUEUED:["hasSysDateLimit"],RATE_ADJUSTMENTS_REPORT:["hasDateLimit","canRemoveDate"],ADDON_FORECAST:["canRemoveDate","hasOneYearLimit"],ALLOWANCE_FORECAST:["canRemoveDate","isForecast"],DAILY_PRODUCTION_ROOM_TYPE:["canRemoveDate","hasOneYearLimit"],DAILY_PRODUCTION_DEMO:["hasOneYearLimit"],DAILY_PRODUCTION_RATE:["hasOneYearLimit"],RATE_RESTRICTION_REPORT:["hasOneYearLimit"],FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:["hasUserFilter"],CANCELLATION_NO_SHOW:["canRemoveDate"],COMPARISION_BY_DATE:["hasSysDateLimit"],BUSINESS_ON_BOOKS:["hasOneYearLimit"],COMPANY_TA_TOP_PRODUCERS:["hasPrevDateLimit"],GROUP_ROOMS_REPORT:["hasOneYearLimit"],ADDON_UPSELLS:["hasOneYearLimit"],FORECAST_BY_DATE:["hasOneYearLimit"],FORECAST_GUEST_GROUPS:["hasOneYearLimit"],ARRIVAL:["hasOneMonthLimit"],DEPARTURE:["hasOneMonthLimit"],FINANCIAL_TRANSACTION_REVENUE_REPORT:["hasUserFilter","hasBDLimit"],FINANCIAL_TRANSACTION_PAYMENT_REPORT:["hasUserFilter","hasBDLimit"],FINANCIAL_TRANSACTION_SUMMARY_REPORT:["hasDateLimit"],TAX_OUTPUT_REPORT:["hasOneYearLimit"]},n=_.findKey(e,function(e,a){return e===t.title});n&&_.each(a[n],function(e){t[e]=!0})}}}]),angular.module("reportsModule").factory("RVReportApplyIconClass",["RVReportNamesConst",function(e){return{init:function(t){var a={CHECK_IN_CHECK_OUT:"icon-report icon-check-in-check-out",UPSELL:"icon-report icon-upsell",WEB_CHECK_OUT_CONVERSION:"icon-report icon-check-out",WEB_CHECK_IN_CONVERSION:"icon-report icon-check-in",LATE_CHECK_OUT:"guest-status late-check-out",IN_HOUSE_GUEST:"guest-status inhouse",ARRIVAL:"guest-status check-in",DEPARTURE:"guest-status check-out",CANCELLATION_NO_SHOW:"guest-status cancel",BOOKING_SOURCE_MARKET_REPORT:"icon-report icon-booking",LOGIN_AND_OUT_ACTIVITY:"icon-report icon-activity",DEPOSIT_REPORT:"icon-report icon-deposit",GROUP_DEPOSIT_REPORT:"icon-report icon-deposit",OCCUPANCY_REVENUE_SUMMARY:"icon-report icon-occupancy",RESERVATIONS_BY_USER:"icon-report icon-reservations",DAILY_TRANSACTIONS:"icon-report icon-transactions",DAILY_PAYMENTS:"icon-report icon-transactions",ROOMS_QUEUED:"icons guest-status icon-queued",FORECAST_BY_DATE:"icon-report icon-forecast",MARKET_SEGMENT_STAT_REPORT:"icon-report icon-market",FORECAST_GUEST_GROUPS:"icon-report icon-forecast",COMPARISION_BY_DATE:"icon-report icon-comparison",RATE_ADJUSTMENTS_REPORT:"icon-report icon-rate",GROUP_PICKUP_REPORT:"icon-report icon-group",DAILY_PRODUCTION_ROOM_TYPE:"icon-report icon-forecast",AR_SUMMARY_REPORT:"icon-report icon-forecast",GUEST_BALANCE_REPORT:"icon-report icon-balance",RATE_RESTRICTION_REPORT:"icon-report icon-rate",COMPANY_TA_TOP_PRODUCERS:"icon-report icon-cards",FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:"icon-report icon-forecast",CREDIT_CHECK_REPORT:"icon-report icon-deposit",DEPOSIT_SUMMARY:"icon-report icon-deposit",ROOMS_OOO_OOS:"icon-report icon-room",ACTIONS_MANAGER:"icon-report icon-action",VACANT_ROOMS_REPORT:"icon-report icon-room",BUSINESS_ON_BOOKS:"icon-report icon-forecast",GROUP_ROOMS_REPORT:"icon-report icon-room",YEARLY_TAX:"icon-report icon-forecast",TAX_EXEMPT:"icon-report icon-forecast",GUESTS_INHOUSE_BY_NATIONALITY:"icons icon-adult icon-20w",DEFAULT:"icon-report"},n=_.findKey(e,function(e){return e===t.title});t.reportIconCls=a[n]||a.DEFAULT}}}]),sntRover.factory("RVReportParserFac",["$rootScope","$filter","$timeout","RVReportNamesConst",function(e,t,a,n){function s(e,t,a){var n,s,r=[],o=[],i=[],l=function(e){if(""!==e&&null!==e&&""!==e&&null!==e){var t=e.split("<br />");return _.reject(t,function(e){return""===e||" "===e})}},u=function(e,t){var a,n,s,o,i=0;for(a=0,n=e.length;a<n;a++)s=angular.copy(e[a]),o=parseFloat(s.amount),o=isNaN(o)?0:o,i+=o,0===a?(angular.extend(s,{isReport:!0,rowspan:n+1,charge_type:t,amount_class:"Adjustments"===t?"purple":"red",posted_date:s.posted.substring(0,10),posted_time:s.posted.substring(11),modified_date:s.modified.substring(0,10),modified_time:s.modified.substring(11),remarkAry:l(s.remark)}),r.push(s)):(angular.extend(s,{isReport:!0,amount_class:"Adjustments"===t?"purple":"red",posted_date:s.posted.substring(0,10),posted_time:s.posted.substring(11),modified_date:s.modified.substring(0,10),modified_time:s.modified.substring(11),remarkAry:l(s.remark)}),r.push(s)),1===n-a&&r.push({isReportSubTotal:!0,break_class:"row-break",amount_class:"Adjustments"===t?"purple":"red",total_amount:i})};if(!t.length)return[];for(n=0,s=t.length;n<s;n++)o=t[n].adjustments,i=t[n].deleted_charges,u(o,"Adjustments"),u(i,"Deleted Charges");return r}function r(e,t,a,n){var s,r,o,i={},l=_.keys(t)[0],u=t[l];for(s=0,r=u.length;s<r;s++)o=u[s].room_type+"__"+u[s].room_type_id,i[o]={};var c,d,E;for(var A in t)if(t.hasOwnProperty(A)){var c=t[A];for(s=0,r=c.length;s<r;s++)d=angular.copy(c[s]),E=d.room_type+"__"+d.room_type_id,i[E][A]=angular.copy(d)}var T;for(i.Totals={},s=0,r=n.length;s<r;s++)T=_.keys(n[s])[0],i.Totals[T]=angular.copy(n[s][T]);return i}function o(a){var n=_.keys(a),s=n[0],r=_.pluck(a[s].markets,"name"),o=_.pluck(a[s].sources,"name"),i=_.pluck(a[s].origins,"name"),l=_.pluck(a[s].segments,"name"),u=[],c=null;return u.push(p(!0,"Market","market_totals")),r.map(function(e){u.push(p(!1,e,"markets"))}),u.push(p(!0,"Source","source_totals")),o.map(function(e){u.push(p(!1,e,"sources"))}),u.push(p(!0,"Origin","origin_totals")),i.map(function(e){u.push(p(!1,e,"origins"))}),u.push(p(!0,"Segment","segment_totals")),l.map(function(e){u.push(p(!1,e,"segments"))}),_.each(u,function(n){_.each(a,function(a){c=a[n["key-in-api"]],c instanceof Array&&(c=_.findWhere(c,{name:n.displayLabel})),n.valueList=n.valueList.concat([{key:"res_count",value:c.total_reservations_count},{key:"available",value:c.available_rooms_count},{key:"future_revenue",value:t("currency")(c.future_revenue,e.currencySymbol,2)},{key:"adr",value:t("currency")(c.adr,e.currencySymbol,2)},{key:"rate_revenue",value:t("currency")(c.rate_revenue,e.currencySymbol,2)},{key:"arrivals",value:c.arrivals},{key:"adults",value:c.adults},{key:"children",value:c.children},{key:"fnb_future_revenue",value:t("currency")(c.fnb_future_revenue,e.currencySymbol,2)},{key:"fnb_actual_revenue",value:t("currency")(c.fnb_actual_revenue,e.currencySymbol,2)},{key:"others_future_revenue",value:t("currency")(c.others_future_revenue,e.currencySymbol,2)},{key:"others_actual_revenue",value:t("currency")(c.others_actual_revenue,e.currencySymbol,2)},{key:"total_future_revenue",value:t("currency")(c.total_future_revenue,e.currencySymbol,2)},{key:"total_actual_revenue",value:t("currency")(c.total_actual_revenue,e.currencySymbol,2)}])})}),{listing:u,dates:n}}function i(e,t,a){var s,r,o,i,l=[],u={},c=[],d={},E={},A={},T=[],a=a,p={},S={},O=function(t){return!!_.find(t,function(t){return t===e})},f=function(e){var t=!!a.checkGuest&&!!e.accompanying_names&&!!e.accompanying_names.length;return t},R=function(e){var t=!!e.company_name||!!e.travel_agent_name||!!e.group_name;return t},h=function(e){var t=!!e.vehicle_registration_number;return t},D=function(e){var t=!!e.phone_number;return t},N=function(e){var t=!!e.add_ons&&!!e.add_ons.length||!!e.addon_details;return t},C=function(e){var t=!!a.checkGuestNote&&!!e.guest_notes&&!!e.guest_notes.length;return t},m=function(e){var t=!!a.checkReservationNote&&!!e.reservation_notes&&!!e.reservation_notes.length;return t},g=function(e){var t=!!a.checkAction&&!!e.actions&&!!e.actions.length;return t},L=function(e){var t=!!a.checkCancel&&O([n.ARRIVAL,n.IN_HOUSE_GUEST]);return!!t&&!!e.cancel_reason},I=function(e){var t=!!a.checkRateAdjust&&!!e.rate_adjustment_reasons&&!!e.rate_adjustment_reasons.length;return t},v=function(e){var t=["ARRIVAL","IN_HOUSE_GUEST","CANCELLATION_NO_SHOW","DEPARTURE","LOGIN_AND_OUT_ACTIVITY","RESERVATIONS_BY_USER"];return!!_.find(t,function(t){return e==n[t]})};if(v(e))for(s=0,r=t.length;s<r;s++)for(u=angular.copy(t[s]),c=[],d={},p={},S={},A={},T=[],f(u)&&angular.extend(d,{isGuestData:!0,guestNames:angular.copy(u.accompanying_names)}),R(u)&&angular.extend(d,{isGuestData:!0,company_name:u.company_name,travel_agent_name:u.travel_agent_name,group_name:u.group_name}),h(u)&&angular.extend(d,{isGuestData:!0,vehicle_registration_number:angular.copy(u.vehicle_registration_number)}),D(u)&&angular.extend(d,{isGuestData:!0,phone_number:angular.copy(u.phone_number)}),N(u)&&angular.extend(d,{isGuestData:!0,addOns:angular.copy(u.add_ons),addOnDetails:angular.copy(u.addon_details)}),_.size(d)&&c.push(d),L(u)&&(A={isCancelData:!0,reason:angular.copy(u.cancel_reason)},c.push(A)),C(u)&&(p={isGuestNoteData:!0,guestNotes:angular.copy(u.guest_notes)},c.push(p)),m(u)&&(S={isReservationNoteData:!0,reservationNotes:angular.copy(u.reservation_notes)},c.push(S)),g(u)&&(E={isActionData:!0,actions:angular.copy(u.actions)},c.push(E)),I(u)&&(T={isAdjustData:!0,reasons:angular.copy(u.rate_adjustment_reasons)},c.push(T)),c.length?(u.rowspan=c.length+1,c[c.length-1].className="row-break"):u.className="row-break",e===n.LOGIN_AND_OUT_ACTIVITY&&(u.hasOwnProperty("action_type")&&"INVALID_LOGIN"===u.action_type&&(u.action_type="INVALID LOGIN",u.className="row-break invalid"),u.hasOwnProperty("date")&&(u.uiDate=u.date.split(", ")[0],u.uiTime=u.date.split(", ")[1])),u.isReport=!0,l.push(u),o=0,i=c.length;o<i;o++)l.push(c[o]);else l=t;return l}function l(e,t,a){var n,s,r={},o=a.groupedByKey;for(n=0,s=t.length;n<s;n++)""===t[n][o]&&(t[n][o]="N/A");var r=_.groupBy(t,o);return _.each(r,function(t,n,s){r[n]=angular.copy(i(e,t,a))}),r}function u(e,t,a){var n,s,r,o,i,l=[],_={},u="",c={},d={};for(n=0,s=t.length;n<s;n++){_=angular.copy(t[n]),u=r;for(r in _)_.hasOwnProperty(r)&&"0"!==r&&0!==r&&(u=r,c=_[r]);if(c.details.length)for(o=0,i=c.details.length;o<i;o++)d=angular.copy(c.details[o]),0===o&&(d.chargeGroupName=u,d.rowspan=i+1),d.isReport=!0,l.push(d);else d={},d.chargeGroupName=u,d.rowspan=2,d.isReport=!0,l.push(d);c.sub_total.isReportSubTotal=!0,c.sub_total.chargeGroupName=u,c.sub_total.className="row-break",l.push(c.sub_total)}return l}function c(e,t,a){var n,s,r,o,i,l,_,u=[],c=[];for(o=0,i=t.length;o<i;o++){if(n=angular.copy(t[o]),n.hasOwnProperty("stay_dates")&&n.stay_dates.length)for(l=0,_=n.stay_dates.length;l<_;l++)s=n.stay_dates[l],0===l?(angular.extend(n,{isReport:!0,rowspan:_+1,stay_date:s.stay_date,original_amount:s.original_amount,adjusted_amount:s.adjusted_amount,variance:s.variance,reason:s.reason,adjusted_by:s.adjusted_by}),u.push(n)):(c={},angular.extend(c,{isSubReport:!0,stay_date:s.stay_date,original_amount:s.original_amount,adjusted_amount:s.adjusted_amount,variance:s.variance,reason:s.reason,adjusted_by:s.adjusted_by}),u.push(c));else u.push(n);n.hasOwnProperty("stay_dates_total")&&n.stay_dates_total.hasOwnProperty("original_amount")?(r=n.stay_dates_total,c={},angular.extend(c,{isSubTotal:!0,className:"row-break",original_amount:r.original_amount,adjusted_amount:r.adjusted_amount,variance:r.variance}),u.push(c)):u.push(n)}return u}function d(e,t,a){var n,s,r,o,i,l,_,u,c=[],d=[];for(i=0,l=t.length;i<l;i++){if(n=angular.copy(t[i]),o=!0,n.hasOwnProperty("group_data")&&n.group_data.length)for(_=0,u=n.group_data.length;_<u;_++)s=n.group_data[_],0===_?(angular.extend(n,{isReport:!0,rowspan:u+1,date:s.date,hold_status:s.hold_status,room_type:s.room_type,rooms_available:s.rooms_available,rooms_held_non_deduct:s.rooms_held_non_deduct,rooms_held_deduct:s.rooms_held_deduct,rooms_held_picked_up:s.rooms_held_picked_up,pickup_percentage:s.pickup_percentage}),c.push(n)):(d={},angular.extend(d,{isSubReport:!0,date:s.date,hold_status:s.hold_status,room_type:s.room_type,rooms_available:s.rooms_available,rooms_held_non_deduct:s.rooms_held_non_deduct,rooms_held_deduct:s.rooms_held_deduct,rooms_held_picked_up:s.rooms_held_picked_up,pickup_percentage:s.pickup_percentage}),c.push(d));else o=!1,angular.extend(n,{isReport:!0,rowspan:0,className:"row-break"}),c.push(n);o&&n.hasOwnProperty("group_total")&&(r=n.group_total,d={},angular.extend(d,{isSubTotal:!0,className:"row-break",rooms_available:r.rooms_available,rooms_held_non_deduct:r.rooms_held_non_deduct,rooms_held_deduct:r.rooms_held_deduct,rooms_held_picked_up:r.rooms_held_picked_up,pickup_percentage:r.pickup_percentage}),c.push(d))}return c}function E(e,t,a){var n,s,r,o,i,l,u,c=[],d=[];for(o=0,i=t.length;o<i;o++)if(n=angular.copy(t[o]),n.hasOwnProperty("deposit_data")&&n.deposit_data.length){for(l=0,u=n.deposit_data.length;l<u;l++)s=n.deposit_data[l],0===l?(angular.extend(n,{isReport:!0,rowspan:u+1,deposit_payment_status:s.deposit_payment_status,due_date:s.due_date,deposit_due_amount:s.deposit_due_amount,paid_date:s.paid_date,paid_amount:s.paid_amount}),c.push(n)):(d={},angular.extend(d,{isSubReport:!0,deposit_payment_status:s.deposit_payment_status,due_date:s.due_date,deposit_due_amount:s.deposit_due_amount,paid_date:s.paid_date,paid_amount:s.paid_amount}),c.push(d));n.hasOwnProperty("deposit_totals")&&!_.isEmpty(n.deposit_totals)&&(r=n.deposit_totals,d={},angular.extend(d,{isSubTotal:!0,className:"row-break",deposit_due_amount:r.deposit_due_amount,paid_amount:r.paid_amount}),c.push(d))}else angular.extend(n,{isReport:!0,className:"row-break"}),c.push(n);return c}function A(e,t,a){var n,s,r,o={},i=[];return a.chosenSortBy&&"ROOM_NO"===a.chosenSortBy?(o=_.groupBy(t,"room_no"),_.each(o,function(e){for(n=0,s=e.length,r=s-1;n<s;n++)0===n?i.push($.extend({},e[n],{rowspan:e.length,isMainRow:!0,className:r===n?"row-break":""})):r===n?i.push($.extend({},_.omit(e[n],["room_no","room_type"]),{className:"row-break"})):i.push(_.omit(e[n],["room_no","room_type"]))})):_.each(t,function(e){i.push($.extend({},e,{className:"row-break",isMainRow:!0}))}),i}var T={};T.parseAPI=function(e,t,a,T){return e===n.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT?_.isEmpty(t)?t:s(e,t,a):e===n.DAILY_PRODUCTION_ROOM_TYPE?_.isEmpty(t)?t:r(e,t,a,T):e===n.DAILY_PRODUCTION_DEMO?_.isEmpty(t)?t:o(t):e===n.DAILY_TRANSACTIONS||e===n.DAILY_PAYMENTS?_.isEmpty(t)?t:u(e,t,a):e==n.RATE_ADJUSTMENTS_REPORT?_.isEmpty(t)?t:c(e,t,a):e==n.GROUP_PICKUP_REPORT?_.isEmpty(t)?t:d(e,t,a):e===n.DEPOSIT_REPORT?_.isEmpty(t)?t:E(e,t,a):e===n.GROUP_DEPOSIT_REPORT?_.isEmpty(t)?t:E(e,t,a):e===n.RESERVATIONS_BY_USER&&a.groupedByKey?_.isEmpty(t)?t:l(e,t,a):e===n.ROOMS_OOO_OOS?_.isEmpty(t)?t:A(e,t,a):_.isEmpty(t)?t:i(e,t,a)};var p=function(e,t,a){return{showInBold:e,displayLabel:t,"key-in-api":a,valueList:[]}};return T}]),angular.module("reportsModule").factory("RVReportSetupOptions",["RVReportNamesConst",function(e){function t(e,t,a,n,s){n.hasOwnProperty(e)||(n[e]=$.extend({title:"Option(s)",isOpen:!1,selectAll:!1,value:"Select Options",allValue:"All Selected",defaultValue:"Select Options",valueKey:"description",data:[]},t)),data=$.extend({paramKey:s.value.toLowerCase(),description:s.description,selected:!1},a),n[e].data.push(data)}function a(e){var t=_.where(e.data,{selected:!0});1===t.length?e.value=t[0].description:t.length===e.data.length?(e.value=e.allValue,e.selectAll=!0):e.value=t.length+" Selected"}var n={},s={hasShowOptions:{SHOW_COMPANY:!0,SHOW_TRAVEL_AGENT:!0},hasChargeTypeOptions:{SHOW_ADJUSTMENTS:!0,SHOW_DELETED_CHARGES:!0},hasGeneralOptions:{INCLUDE_ACTIONS:!0,INCLUDE_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,INCLUDE_TAX_RATE:!0,INCLUDE_ADDON_RATE:!0,INCLUDE_ADDONS:!0,INCLUDE_ADDON_REVENUE:!0}},r={hasShowOptions:{title:"Show",allValue:"Both"},hasChargeTypeOptions:{title:"Charge Types",allValue:"Both"}},o={CANCELLATION_NO_SHOW:function(e){if("INCLUDE_CANCELLED"===e||"INCLUDE_CANCELED"===e)return{selected:!0}},FORECAST_GUEST_GROUPS:function(e){if("EXCLUDE_NON_GTD"==e)return{selected:!0}},DAILY_PRODUCTION_DEMO:function(e){if("EXCLUDE_TAX"===e)return{selected:!0}},DAILY_PRODUCTION_ROOM_TYPE:function(e){if("INCLUDE_ADDONS"===e)return{selected:!0}},DEFAULT:function(e){var t={};return"DUE_IN_ARRIVALS"!==e&&"DUE_OUT_DEPARTURES"!==e||(t.selected=!0),"DEPOSIT_PAID"!==e&&"DEPOSIT_DUE"!==e&&"DEPOSIT_PAST"!==e||(t.mustSend=!0),"SHOW_COMPANY"!==e&&"SHOW_TRAVEL_AGENT"!==e||(t.selected=!0),t}};return n.init=function(n){var i=_.findKey(e,function(e,t){return e===n.title}),l=o[i]||o.DEFAULT;n.allOptions=[],_.each(n.filters,function(e){_.each(s,function(a,s){a[e.value]&&(t(s,r[s],l(e.value),n,e),n.allOptions.push(s))})}),_.each(n.allOptions,function(e){a(n[e])})},n}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("reportsModule").factory("RVReportUtilsFac",["$rootScope","$filter","$timeout","$q","RVReportNamesConst","RVReportFiltersConst","RVreportsSubSrv","rvUtilSrv","RVReportParamsConst",function(e,t,a,n,s,r,o,i,l){var u={},c=["fromCancelDate","untilCancelDate","fromDepositDate","untilDepositDate","fromPaidDate","untilPaidDate","fromDate","untilDate","fromCreateDate","untilCreateDate","fromAdjustmentDate","untilAdjustmentDate","fromArrivalDate","untilArrivalDate","groupStartDate","groupEndDate","singleValueDate"],d=["year","with_vat_number","without_vat_number","fromTime","untilTime","chosenCico","chosenIncludeCompanyTa","chosenIncludeCompanyTaGroup","chosenIncludeGroup","hasMinRoomNights","hasMinRevenue","showActionables","show_vat_with_rates","show_upsell_only"],E=[{
status:"VACANT",description:"Show Vacant"},{status:"OCCUPIED",description:"Show Occupied"},{status:"QUEUED",description:"Show Queued"},{status:"LATE_CHECKOUT",description:"Late Checkout"},{status:"PRE_CHECKIN",description:"Pre Checkin"}],A=[{status:"STAY_OVER",description:"Show Stayover"},{status:"NOT_RESERVED",description:"Show Not Reserved"},{status:"ARRIVAL",description:"Show Arrival"},{status:"ARRIVED",description:"Show Arrived"},{status:"DAY_USE",description:"Show Day Use"},{status:"DUE_OUT",description:"Show Due Out"},{status:"DEPARTED",description:"Show Departed"}],T=[{id:-2,status:"DUE IN",selected:!0},{id:-1,status:"DUE OUT",selected:!0},{id:1,status:"RESERVED",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],p=[{id:-1,status:"DUE OUT",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],S=function(e){var t=_.pluck(e,"rate_type_id"),t=_.unique(t),a={},n=t.map(function(t){return a=_.findWhere(e,{rate_type_id:t}),a&&(a.name=a.rate_type_name,a=_.pick(a,"name","rate_type_id","selected")),a});return n},O=function(e){return e.map(function(e){return e.name=e.rate_name,_.omit(e,"rate_type_name")})},f=function(e,t,a,n){var s,r,o=[],i=[],l=null,u=!1,c={},n="boolean"!=typeof n||n;return s=angular.copy(e),r=angular.copy(t),"REMOVE_PAYMENTS"===a?(_.each(s,function(e){"Payments"!==e.name?(e.selected=n,o.push(e)):l=e.id}),_.each(r,function(e){u=_.find(e.associcated_charge_groups,function(e){return e.id===l}),u||(e.selected=n,i.push(e))})):"ONLY_PAYMENTS"===a?(c=_.find(s,function(e){return"Payments"===e.name}),c&&(l=c.id,c.selected=n,o.push(c),_.each(r,function(e){u=_.find(e.associcated_charge_groups,function(e){return e.id===l}),u&&(e.selected=n,i.push(e))}))):(_.each(s,function(e){e.selected=n,o.push(e)}),_.each(r,function(e){e.selected=n,i.push(e)})),{chargeGroups:o,chargeCodes:i}},R={INCLUDE_GUEST_NOTES:!0,INCLUDE_RESERVATION_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,INCLUDE_TAX_RATE:!0,INCLUDE_ADDON_RATE:!0,INCLUDE_ADDONS:!0,INCLUDE_ADDON_REVENUE:!0,INCLUDE_ACTIONS:!0,INCLUDE_LEDGER_DATA:!0,HAS_VEHICLE_REG_NO:!0,SHOW_PHONE_NUMBER:!0},h={EXCLUDE_TAX:!0},D={INCLUDE_MARKET:!0,INCLUDE_SOURCE:!0,INCLUDE_ORIGIN:!0,INCLUDE_SEGMENT:!0},N={GUEST:!0,ACCOUNT:!0},C={SHOW_COMPANY:!0,SHOW_TRAVEL_AGENT:!0,INCLUDE_DUE_OUT:!0,INCLUDE_INHOUSE:!0,RESTRICTED_POST_ONLY:!0,EXCEEDED_ONLY:!0,OOO:!0,OOS:!0},m={SHOW_DELETED_CHARGES:!0,SHOW_ADJUSTMENTS:!0},g=function(e,t,a){var a=("undefined"==typeof a?"undefined":_typeof(a))===_typeof(!0)&&a,n=!1,r=!1,o={INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0},i={DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0},l={DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0};e.title===s.CANCELLATION_NO_SHOW&&o[t.value]&&(a=!0),i[t.value]&&(a=!0),l[t.value]&&(n=!0),e.title===s.FORECAST_GUEST_GROUPS&&"EXCLUDE_NON_GTD"===t.value&&(a=!0),e.title===s.DAILY_PRODUCTION_DEMO&&"EXCLUDE_TAX"===t.value&&(a=!0),e.title===s.DAILY_PRODUCTION_ROOM_TYPE&&"INCLUDE_ADDONS"===t.value&&(a=!0),e.title===s.RESERVATIONS_BY_USER&&"INCLUDE_NEW"===t.value&&("INCLUDE_NEW"===t.value&&(a=!0),"SHOW_RATE_ADJUSTMENTS_ONLY"===t.value&&(e.hasGeneralOptions.options.selectiveSingleSelectKey=t.value.toLowerCase(),e.hasGeneralOptions.options.noSelectAll=!0)),e.title===s.IN_HOUSE_GUEST&&("VIP_ONLY"!==t.value&&"RESTRICTED_POST_ONLY"!==t.value||(r=!0)),e.hasGeneralOptions.data.push({id:t.value.toLowerCase(),paramKey:t.value.toLowerCase(),description:t.description,selected:a,mustSend:n,isRadioOption:r}),e.title!==s.ARRIVAL&&e.title!==s.DEPARTURE||(e.hasGeneralOptions.options.noSelectAll=!0)},L=function(e,t){var a=!1;e.title===s.DAILY_PRODUCTION_DEMO&&"INCLUDE_MARKET"===t.value&&(a=!0),e.hasDisplay.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:a})},I=function(e,t){e.hasGuestOrAccountFilter.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:!0})},v=function(e,t){e.hasShow.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:"EXCEEDED_ONLY"!==t.value})},y=function(e,t){e.hasChargeTypes.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:!0})};return u.addIncludeUserFilter=function(e){switch(e.title){case s.LOGIN_AND_OUT_ACTIVITY:case s.RATE_ADJUSTMENTS_REPORT:case s.RESERVATIONS_BY_USER:e.filters.push({value:"INCLUDE_USER_NAMES",description:"Include User Names"});break;case s.ACTIONS_MANAGER:e.filters.push({value:"INCLUDE_COMPLETION_STATUS",description:"Include Completion status"},{value:"INCLUDE_DEPARTMENTS",description:"Include Departments"});break;case s["A/R_AGING"]:e.filters.push({value:"INCLUDE_AGING_BALANCE",description:"Include Aging Balance"},{value:"ACCOUNT_SEARCH",description:"Include Account Search"});break;case s.FOLIO_TAX_REPORT:e.filters.push({value:"INCLUDE_LANGUAGE",description:"Include Language"});break;case s.TAX_EXEMPT:e.filters.push({value:"SHOW_VAT_WITH_RATES",description:"VAT"})}},u.addIncludeOtherFilter=function(e){switch(e.title){case s.TRAVEL_AGENT_COMMISSIONS:e.filters.push({value:"INCLUDE_TRAVEL_AGENT",description:"Include Travel Agent"});break;case s.YEARLY_TAX:e.filters.push({value:"VAT_YEAR",description:"Year"},{value:"CO_TA_WITH_OR_WITHOUT_VAT",description:"company_travelagent_with_without_vat"});break;case s.TAX_EXEMPT:e.filters.push({value:"INCLUDE_LONG_STAYS",description:"include_long_stays"})}},u.processFilters=function(t,a){t.hasUserFilter&&(t.filterTitle=t.title===s.RESERVATIONS_BY_USER?"Users":"Employees",t.empList={data:angular.copy(a.activeUserList),options:{selectAll:!0,hasSearch:!0,key:"full_name",altKey:"email"}}),t.hasGeneralOptions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description"}},t.chosenOptions={},t.hasDisplay={data:[],options:{selectAll:!0,hasSearch:!1,key:"description",defaultValue:"Select displays"}},t.hasExclusions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description",defaultValue:"Exclude",visible:!0}},t.hasGuestOrAccountFilter={data:[],options:{selectAll:!0,hasSearch:!1,key:"description"},affectsFilter:{name:"hasReservationStatus",process:function(e,a){if(t.title===s.GUEST_BALANCE_REPORT){var n=!!_.find(a,{paramKey:"guest"});e.updateData(!n)}}}},t.hasShow={data:[],options:{selectAll:!1,hasSearch:!1,key:"description",allValue:"Both",defaultValue:"Select options"}},t.hasChargeTypes={data:[],options:{selectAll:!0,hasSearch:!1,key:"description"}},_.each(t.filters,function(n){if("RATE_TYPE"===n.value&&(t.hasRateTypeFilter=n),"RATE"===n.value&&(t.hasRateFilter=n),"INCLUDE_DAY_USE"===n.value&&(t.hasDayUseFilter=n),"RATE_CODE"===n.value&&(t.hasRateCodeFilter=n),"ROOM_TYPE"===n.value&&(t.hasRoomTypeFilter=n),"RESTRICTION"===n.value&&(t.hasRestrictionListFilter=n),"ORIGIN"===n.value&&(t.hasOriginFilter=n),"URLS"===n.value&&(t.hasURLsList=n),"CAMPAIGN_TYPES"===n.value&&(t.hasCampaignTypes=n),"TIME_RANGE"===n.value&&(t.hasTimeFilter=n,t.timeFilterOptions=u.createTimeSlots()),"CICO"===n.value&&(t.hasCicoFilter=n,t.cicoOptions=[{value:"BOTH",label:"Show Check Ins and  Check Outs"},{value:"IN",label:"Show only Check Ins"},{value:"OUT",label:"Show only Check Outs"}]),"DAYS_0_30"===n.value&&(t.hasIncludeAgingBalance=n),"TAX_EXEMPT_TYPE"===n.value&&(t.hasIncludeTaxExempts=n),"ACCOUNT_SEARCH"===n.value&&(t.hasAccountSearch=n),"TRAVEL_AGENTS"===n.value&&(t.hasTravelAgentsSearch=n),"INCLUDE_COMPANYCARD_TA"!==n.value&&"TA_CC_CARD"!==n.value||(t.hasIncludeCompanyTa=n),"INCLUDE_GROUP"===n.value&&(t.hasIncludeGroup=n),"INCLUDE_COMPANYCARD_TA_GROUP"!==n.value&&"GROUP_COMPANY_TA_CARD"!==n.value||(t.hasIncludeCompanyTaGroup=n),"GROUP_CODE"===n.value&&(t.hasGroupCode=n),"MIN_REVENUE"===n.value&&(t.hasMinRevenue=n),"MIN_ROOM_NIGHTS"===n.value&&(t.hasMinRoomNights=n),"ACCOUNT_NAME"===n.value&&(t.hasIncludeAccountName=n),"COUNTRY"===n.value&&(t.hasIncludeCountry=n),"CO_TA_WITH_OR_WITHOUT_VAT"===n.value&&(t.hasCompanyTravelAgentWithOrWithoutVat=n),"SHOW_VAT_WITH_RATES"===n.value&&(t.hasShowVatWithRates=n),"INCLUDE_LONG_STAYS"===n.value&&(t.hasShowIncludeLongStays=n),"VAT_YEAR"===n.value&&(t.hasVatYear=n,t.yearFilter=Array.from({length:10},function(e,t){return{value:moment().add(-1*t,"y").format("YYYY")}}),t.year=moment().format("YYYY")),"MIN_NUMBER_OF_DAYS_NOT_OCCUPIED"===n.value&&(t.hasMinNoOfDaysNotOccupied=n),"ACTIONS_BY"===n.value){var r=[{value:"GUEST",name:"Guests"}];t.showActionables="GUEST",e.isHourlyRateOn||(r.push({value:"GROUP",name:"Groups"}),r.push({value:"BOTH",name:"Both"}),t.showActionables="BOTH"),t.hasShowActionables={data:r,options:{key:"name"}}}if("SHOW_UPSELL_ONLY"===n.value&&(t.hasShowUpsellOnly=n),R[n.value]&&g(t,n),t.title===s.IN_HOUSE_GUEST&&"INCLUDE_DUE_OUT"===n.value&&g(t,n,!0),t.title===s.IN_HOUSE_GUEST&&"RESTRICTED_POST_ONLY"===n.value&&e.isStandAlone&&g(t,n,!1),t.title===s.IN_HOUSE_GUEST&&"NO_NATIONALITY"===n.value&&g(t,n,!1),h[n.value]){var o=!1;(t.title===s.DAILY_PRODUCTION_DEMO||s.DAILY_PRODUCTION_RATE||s.DAILY_PRODUCTION_ROOM_TYPE)&&(t.hasExclusions.options.selectAll=!0,t.hasExclusions.options.visible=!1),t.hasExclusions.data.push({paramKey:n.value.toLowerCase(),description:n.description,selected:o})}D[n.value]&&(t.title===s.MARKET_SEGMENT_STAT_REPORT?"INCLUDE_MARKET"===n.value&&a.codeSettings.is_market_on?L(t,n):"INCLUDE_ORIGIN"===n.value&&a.codeSettings.is_origin_on?L(t,n):"INCLUDE_SEGMENT"===n.value&&a.codeSettings.is_segments_on?L(t,n):"INCLUDE_SOURCE"===n.value&&a.codeSettings.is_source_on&&L(t,n):L(t,n)),N[n.value]&&I(t,n),C[n.value]&&t.title!==s.IN_HOUSE_GUEST&&v(t,n),m[n.value]&&y(t,n)})},u.findFillFilters=function(e,t){function a(e){var a,n={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(e,{name:"UNDEFINED"});r||e.push(n),_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_GUARANTEE_TYPE"}),a&&(a.filled=!0,t.hasGuaranteeType={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!0,key:"name",defaultValue:"Select guarantees"}})}),W++,j()}function r(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TAX_PAYMENT_RECEIPT_TYPE"}),a&&(a.filled=!0,t.hasTaxPaymentReceiptTypes={data:angular.copy(e),options:{selectAll:t.title===s.TAX_OUTPUT_REPORT,hasSearch:!1,key:"name",defaultValue:"Select payment receipt"}})}),W++,j()}function i(){var e,a=[{id:1,value:"Expanded",description:"Expanded"},{id:2,value:"Collapsed",description:"Collapsed"}];_.each(t,function(t){e=_.find(t.filters,{value:"EXPANDED_OR_COLLAPSED"}),e&&(e.filled=!0,t.hasCollapsedOrExpanded={data:a,selected:a[0]})})}function u(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ACCOUNT_SEARCH"}),a&&(a.filled=!0,t.hasAccountSearch={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"account_name",defaultValue:"Select Accounts"}})}),W++,j()}function c(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TRAVEL_AGENTS"}),a&&(a.filled=!0,t.hasTravelAgentsSearch={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"account_name",defaultValue:"Select TA"}})}),W++,j()}function d(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"COUNTRY"}),a&&(a.filled=!0,t.hasIncludeCountry={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"value",defaultValue:"Select Country"}})}),W++,j()}function E(e){var a,n={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(e,{name:"UNDEFINED"});r||e.push(n),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_MARKET"}),a&&(a.filled=!0,t.hasMarketsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),W++,j()}function A(e){var a,n={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(e,{name:"UNDEFINED"});r||e.push(n),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_SEGMENT"}),a&&(a.filled=!0,t.hasSegmentsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),W++,j()}function R(e){var a,n={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(e,{name:"UNDEFINED"});r||e.push(n),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_SOURCE"}),a&&(a.filled=!0,t.hasSourcesList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}},t.filters.filled=!0)}),W++,j()}function h(e){var a,n={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(e,{name:"UNDEFINED"});r||e.push(n),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_BOOKING_ORIGIN"}),a&&(a.filled=!0,t.hasOriginsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),W++,j()}function D(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"HOLD_STATUS"}),a&&(a.filled=!0,t.hasHoldStatus={data:angular.copy(e),options:{hasSearch:!1,selectAll:!1,key:"name"}})}),W++,j()}function N(e){var a,n;_.each(t,function(t){a=_.find(t.filters,{value:"RESERVATION_STATUS"}),a&&(a.filled=!0,n=angular.copy(e),t.title===s.DEPOSIT_REPORT?n=angular.copy(T):t.title===s.GUEST_BALANCE_REPORT&&(n=angular.copy(p)),t.hasReservationStatus={data:n,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"},originalData:angular.copy(n),updateData:function(e){e&&this.data.length>0?this.data=[]:e||0!==this.data.length||(this.data=angular.copy(this.originalData),_.each(this.data,function(e){e.selected=!0}))}})}),W++,j()}function C(){var e,a=[{id:"UNASSIGNED",status:"UNASSIGNED",selected:!0},{id:"ASSIGNED",status:"ASSIGNED",selected:!0},{id:"COMPLETED",status:"COMPLETED",selected:!0}];_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_COMPLETION_STATUS"}),e&&(e.filled=!0,t.hasCompletionStatus={data:a,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"}})})}function m(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TAX_EXEMPT_TYPE"}),a&&(a.filled=!0,t.hasIncludeTaxExempts={data:e,options:{hasSearch:!0,selectAll:!0,key:"name"}})}),W++,j()}function g(){var e,a=[{id:"0to30",status:"0-30 DAYS",selected:!0},{id:"31to60",status:"31-60 DAYS",selected:!0},{id:"61to90",status:"61-90 DAYS",selected:!0},{id:"91to120",status:"91-120 DAYS",selected:!0},{id:"120plus",status:"120+ DAYS",selected:!0}];_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_AGING_BALANCE"}),e&&(e.filled=!0,t.hasIncludeAgingBalance={data:a,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Aging Balance"}})})}function L(){var e,a=[{id:1,value:"TOTAL",description:"Total"},{id:2,value:"PRE STAY",description:"Pre Stay"},{id:3,value:"IN HOUSE",description:"In House"},{id:4,value:"POST STAY",description:"Post Stay"}];_.each(t,function(t){e=_.find(t.filters,{value:"TRANSACTION_CATEGORY"}),e&&(e.filled=!0,t.hasTransactionCategory={data:a})})}function I(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"SHOW_EMPLOYEES_INCLUDING_EOD"}),a&&(a.filled=!0,t.filterTitle="Employees",t.empList={data:angular.copy(e),options:{hasSearch:!0,selectAll:!0,key:"full_name",defaultValue:"Selected Employee"}})}),W++,j()}function v(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"PAYMENT_TYPES"}),a&&(a.filled=!0,t.hasPaymentType={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,noSelectAll:!0,key:"description",defaultValue:"Show All"}})}),W++,j()}function y(e){var a;_.each(e,function(e){e.id=e.value}),_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_DEPARTMENTS"}),a&&(a.filled=!0,t.hasDepartments={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Department"}})}),W++,j()}function U(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_LANGUAGE"}),a&&(a.filled=!0,t.hasLanguages={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"language",defaultValue:"Select Language"}})}),W++,j()}function P(e){var a;e[0].selected=!0,_.each(t,function(t){if(a=_.find(t.filters,{value:"RATE_CODE"})){if(a.filled=!0,t.title===s.RESERVATIONS_BY_USER){var n=_.find(e,{id:-1});if(!n){var r={id:-1,description:"UNDEFINED"};e.push(r)}}t.hasRateCodeFilter={data:angular.copy(e),options:{hasSearch:!0,selectAll:t.title===s.RESERVATIONS_BY_USER,singleSelect:t.title!==s.RESERVATIONS_BY_USER,key:"description",defaultValue:"Select Rate"}}}}),W++,j()}function M(a){var n;_.each(t,function(t){if(n=_.find(t.filters,{value:"ROOM_TYPE"})){if(e.title!==s.RESERVATIONS_BY_USER){var r=_.filter(a,function(e){return!e.is_suite&&!e.is_pseudo});a=r}t.hasRoomTypeFilter={data:angular.copy(a),options:{hasSearch:!1,selectAll:!0,key:"name"}}}}),W++,j()}function Y(){var e;_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_DAY_USE"}),e&&(e.filled=!0,t[l.INCLUDE_DAYUSE]=!0)})}function G(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"RESTRICTION"}),a&&(a.filled=!0,t.hasRestrictionListFilter={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"description",defaultValue:"Select Restriction(s)"}})}),W++,j()}function k(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ORIGIN"}),a&&(a.filled=!0,t.hasOriginFilter={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"description",defaultValue:"Select Origin(s)"},affectsFilter:{name:"hasURLsList",process:function(e,a){var n=_.find(a,{value:"URL"}),s=_.find(t.filters,{value:"URLS"});s&&e.updateData(!n)}}})}),W++,j()}function b(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"URLS"}),a&&(a.filled=!0,t.hasURLsList={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select URL(s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),W++,j()}function H(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ALLOWANCE_CODE"}),a&&(a.filled=!0,t.hasAllowanceCodes={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Allowance(-s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),W++,j()}function V(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"CAMPAIGN_TYPES"}),a&&(a.filled=!0,t.hasCampaignTypes={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Campaign Type(s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),W++,j()}function F(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"FLOOR"}),a&&(a.filled=!0,t.hasFloorList={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"floor_number",defaultValue:"Select Floors(s)"}})}),W++,j()}function B(e){var a;_.each(e,function(e){e.selected=!0}),_.each(t,function(t){a=_.find(t.filters,{value:"RATE"}),a&&(a.filled=!0,t.hasRateTypeFilter={data:angular.copy(S(e)),options:{selectAll:!0,hasSearch:!0,key:"name"}},t.hasRateFilter={data:angular.copy(O(e)),options:{selectAll:!0,hasSearch:!0,key:"name"}})}),W++,j()}function w(e,a){var n,r,o,i;_.each(t,function(t){t.title===s.DAILY_TRANSACTIONS?(i=!0,o=f(e,a,"REMOVE_PAYMENTS",i)):t.title===s.DAILY_PAYMENTS?(i=!0,o=f(e,a,"ONLY_PAYMENTS",i)):t.title===s.DAILY_PRODUCTION_ROOM_TYPE?(i=!1,o=f(e,a,"NONE",i)):(i=!0,o=f(e,a,"NONE",i)),n=_.find(t.filters,{value:"INCLUDE_CHARGE_GROUP"}),n&&(n.filled=!0,t.hasByChargeGroup={data:angular.copy(o.chargeGroups),options:{selectAll:i,hasSearch:!1,key:"name"},affectsFilter:{name:"hasByChargeCode",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(e.associcated_charge_groups,function(a){_.each(t,function(t){a.id===t.id&&(e.disabled=!1)})})}),e.updateData()}}}),r=_.find(t.filters,{value:"INCLUDE_CHARGE_CODE"})||_.find(t.filters,{value:"SHOW_CHARGE_CODES"}),r&&(r.filled=!0,t.hasByChargeCode={data:angular.copy(o.chargeCodes),originalData:angular.copy(o.chargeCodes),options:{selectAll:i,hasSearch:!1,key:"name"},updateData:function(){var e=[];_.each(this.originalData,function(t){t.disabled||e.push(t)}),this.data=e}},t.title===s.FINANCIAL_TRANSACTION_REVENUE_REPORT&&(t.hasByChargeCode.options.key="description"))}),W+=2,j()}function x(e,a){var n,s,r=function(e){var t=[];return _.each(e,function(e){e.disabled||_.each(e.list_of_addons,function(e){t.push(e)})}),t};_.each(t,function(t){n=_.find(t.filters,{value:"ADDON_GROUPS"}),n&&(n.filled=!0,t.hasAddonGroups={data:angular.copy(e),options:{selectAll:!0,hasSearch:!0,key:"name"},affectsFilter:{name:"hasAddons",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(t,function(t){e.group_id===t.id&&(e.disabled=!1)})}),e.updateData()}}}),s=_.find(t.filters,{value:"ADDONS"}),s&&(s.filled=!0,t.hasAddons={data:r(a),originalData:angular.copy(a),options:{selectAll:!0,hasSearch:!0,key:"addon_name"},updateData:function(){this.data=r(this.originalData)}})}),W++,j()}var J=n.defer(),K=0,W=0,j=function(){W===K&&($=_.find(X,function(e){return!e.hasOwnProperty("filled")}),void 0===$&&(e.allFiltersProcessed=!0),J.resolve())},X=e.filters,$=void 0;return _.each(X,function(t){("INCLUDE_GUARANTEE_TYPE"!==t.value||t.filled)&&("INCLUDE_GUARANTEE_TYPE"!==t.value||t.filled)?"CHOOSE_MARKET"!==t.value||t.filled?"CHOOSE_SEGMENT"!==t.value||t.filled?"CHOOSE_SOURCE"!==t.value||t.filled?"CHOOSE_BOOKING_ORIGIN"!==t.value||t.filled?"HOLD_STATUS"!==t.value||t.filled?"RESERVATION_STATUS"!==t.value||t.filled?"RATE"!==t.value||t.filled?"RATE_CODE"!==t.value||t.filled?"ROOM_TYPE"!==t.value||t.filled?"RATE_TYPE"!==t.value||t.filled?"RESTRICTION"!==t.value||t.filled?"INCLUDE_CHARGE_GROUP"===t.value&&!t.filled||"INCLUDE_CHARGE_CODE"===t.value&&!t.filled||"ADDON_GROUPS"===t.value&&!t.filled||"SHOW_CHARGE_CODES"===t.value&&!t.filled?(K++,o.fetchChargeNAddonGroups({for_addon_forecast_report:"Add-On Forecast"===e.title,include_payment:"Financial Transaction - Revenue Report"===e.title}).then(function(e){K++,o.fetchChargeCodes().then(w.bind(null,e)),K++,o.fetchAddons({addon_group_ids:_.pluck(e,"id")}).then(x.bind(null,e))})):"ALLOWANCE_CODE"!==t.value||t.filled?"URLS"!==t.value||t.filled?"ORIGIN"!==t.value||t.filled?"CAMPAIGN_TYPES"!==t.value||t.filled?"FLOOR"!==t.value||t.filled?"INCLUDE_DEPARTMENTS"!==t.value||t.filled?"TRANSACTION_CATEGORY"!==t.value||t.filled?"SHOW_EMPLOYEES_INCLUDING_EOD"!==t.value||t.filled?"INCLUDE_COMPLETION_STATUS"!==t.value||t.filled?"INCLUDE_AGING_BALANCE"!==t.value||t.filled?"PAYMENT_TYPES"!==t.value||t.filled?"INCLUDE_LANGUAGE"!==t.value||t.filled?"TAX_EXEMPT_TYPE"!==t.value||t.filled?"ACCOUNT_SEARCH"!==t.value||t.filled?"INCLUDE_TRAVEL_AGENT"!==t.value||t.filled?"COUNTRY"!==t.value||t.filled?"INCLUDE_DAY_USE"!==t.value||t.filled?"SHOW_UPSELL_ONLY"===t.value?e[l.SHOW_UPSELL_ONLY]=!0:"TAX_PAYMENT_RECEIPT_TYPE"!==t.value||t.filled?"EXPANDED_OR_COLLAPSED"!==t.value||t.filled||i():(K++,o.fetchTaxPaymentReceiptTypes().then(r)):Y():(K++,o.fetchCountries().then(d)):(K++,o.fetchTravelAgents().then(c)):(K++,o.fetchAccounts().then(u)):(K++,o.fetchTaxExemptTypes().then(m)):(K++,o.fetchLanguages().then(U)):(K++,o.fetchPaymentTypes().then(v)):g():C():(K++,o.fetchEmployees().then(I)):L():(K++,o.fetchDepartments().then(y)):(K++,o.fetchFloors().then(F)):(K++,o.fetchCampaignTypes().then(V)):(K++,o.fetchOrigins().then(k)):(K++,o.fetchURLs().then(b)):(K++,o.fetchAllowances().then(H)):(K++,o.fetchRestrictionList().then(G)):(K++,o.fetchRateTypesAndRateList().then(B)):(K++,o.fetchRoomTypeList().then(M)):(K++,o.fetchRateCode().then(P)):(K++,o.fetchRateTypesAndRateList().then(B)):(K++,o.fetchReservationStatus().then(N)):(K++,o.fetchHoldStatus().then(D)):(K++,o.fetchBookingOrigins().then(h)):(K++,o.fetchSources().then(R)):(K++,o.fetchSegments().then(A)):(K++,o.fetchMarkets().then(E)):(K++,o.fetchGuaranteeTypes().then(a))}),0===K&&j(),J.promise},u.processGroupBy=function(e){e.group_fields&&e.group_fields.length&&(e.groupByOptions=_.reject(e.group_fields,{value:"BLANK"})),e.title===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT&&(e.groupByOptions=void 0)},u.reOrderSortBy=function(e){var t;if(e.title===s.ARRIVAL||e.title===s.DEPARTURE){var a=angular.copy(e.sort_fields[1]),n=angular.copy(e.sort_fields[4]),r=angular.copy(e.sort_fields[2]),o=angular.copy(e.sort_fields[0]),i=angular.copy(e.sort_fields[3]),l=angular.copy(e.sort_fields[5]);o.disableSort=!0,l.disableSort=!0,a.colspan=2,n.colspan=0,e.sort_fields[0]=n,e.sort_fields[1]=r,e.sort_fields[2]=a,e.sort_fields[3]=o,e.sort_fields[4]=i,e.sort_fields[5]=l}if(e.title===s.AR_SUMMARY_REPORT){var r=angular.copy(_.find(e.sort_fields,{value:"ACCOUNT_NAME"})),u=angular.copy(_.find(e.sort_fields,{value:"ACCOUNT_NO"})),c=angular.copy(_.find(e.sort_fields,{value:"OPEN_BALANCE"})),d=angular.copy(_.find(e.sort_fields,{value:"CREDIT"}));e.sort_fields[0]=r,e.sort_fields[1]=u,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=c,e.sort_fields[5]=d}if(e.title===s.IN_HOUSE_GUEST){var r=angular.copy(e.sort_fields[1]),n=angular.copy(e.sort_fields[3]),i=angular.copy(e.sort_fields[2]),a=angular.copy(e.sort_fields[0]),o=angular.copy(e.sort_fields[4]);a.disableSort=!0,o.disableSort=!0,l={disableSort:!0},r.colspan=2,n.colspan=0,e.sort_fields[0]=n,e.sort_fields[1]=r,e.sort_fields[2]=a,e.sort_fields[3]=o,e.sort_fields[4]=i,e.sort_fields[5]=l}if(e.title===s.LOGIN_AND_OUT_ACTIVITY&&(e.sort_fields[0].description="Date & Time",e.sort_fields[0].colspan=2,e.sort_fields[1].colspan=2),e.title===s.DEPOSIT_REPORT){var E=angular.copy(e.sort_fields[4]),A=angular.copy(e.sort_fields[1]),T=angular.copy(e.sort_fields[2]);e.sort_fields[0]=E,e.sort_fields[1]=null,e.sort_fields[2]=A,e.sort_fields[3]=null,e.sort_fields[4]=T,e.sort_fields[5]=null}if(e.title===s.GROUP_DEPOSIT_REPORT){var E=angular.copy(e.sort_fields[4]),A=angular.copy(e.sort_fields[1]),T=angular.copy(e.sort_fields[2]);e.sort_fields[0]=E,e.sort_fields[1]=null,e.sort_fields[2]=A,e.sort_fields[3]=null,e.sort_fields[4]=T,e.sort_fields[5]=null}if(e.title===s.RESERVATIONS_BY_USER){var p=angular.copy(e.sort_fields[6]),S=angular.copy(e.sort_fields[3]),O=angular.copy(e.sort_fields[1]),f=angular.copy(e.sort_fields[5]),R=angular.copy(e.sort_fields[0]),h=angular.copy(e.sort_fields[2]),D=angular.copy(e.sort_fields[4]);e.sort_fields[0]=p,e.sort_fields[1]=S,e.sort_fields[2]=O,e.sort_fields[3]=f,e.sort_fields[4]=R,e.sort_fields[5]=h,e.sort_fields[6]=D,e.sort_fields[7]=null}if(e.title===s.DAILY_TRANSACTIONS||e.title===s.DAILY_PAYMENTS){var N=angular.copy(e.sort_fields[1]),C=angular.copy(e.sort_fields[0]),m=angular.copy(e.sort_fields[3]),g=angular.copy(e.sort_fields[2]),L=angular.copy(e.sort_fields[4]);e.sort_fields[0]=N,e.sort_fields[1]=C,e.sort_fields[2]=null,e.sort_fields[3]=m,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=g,e.sort_fields[7]=null,e.sort_fields[8]=null,e.sort_fields[9]=L}if(e.title===s.RATE_ADJUSTMENTS_REPORT){var I=angular.copy(e.sort_fields[1]),v=angular.copy(e.sort_fields[0]);t=angular.copy(e.sort_fields[2]),e.sort_fields[0]=v,e.sort_fields[1]=I,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=t}if(e.title===s.GROUP_PICKUP_REPORT){var y=angular.copy(e.sort_fields[1]),I=angular.copy(e.sort_fields[0]),U=angular.copy(e.sort_fields[2]);e.sort_fields[0]=y,e.sort_fields[1]=I,e.sort_fields[2]=U,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=null,e.sort_fields[7]=null,e.sort_fields[8]=null}if(e.title===s.GUEST_BALANCE_REPORT){var P=angular.copy(_.find(e.sort_fields,{value:"BALANCE"})),M=angular.copy(_.find(e.sort_fields,{value:"NAME"})),Y=angular.copy(_.find(e.sort_fields,{value:"ROOM_NO"})),G=angular.copy(_.find(e.sort_fields,{value:"RESERVATION_STATUS"}));e.sort_fields[0]=M,e.sort_fields[1]=Y,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=P,e.sort_fields[5]=G}if(e.title===s.COMPANY_TA_TOP_PRODUCERS){var k=angular.copy(_.find(e.sort_fields,{value:"COMPANY_TA_NAME"})),b=angular.copy(_.find(e.sort_fields,{value:"ROOM_NIGHTS"})),m=angular.copy(_.find(e.sort_fields,{value:"REVENUE"}));e.sort_fields[0]=k,e.sort_fields[1]=null,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=b,e.sort_fields[5]=null,e.sort_fields[6]=null,e.sort_fields[7]=m,e.sort_fields[8]=null,e.sort_fields[9]=null}if(e.title===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT){var C=angular.copy(_.find(e.sort_fields,{value:"CHARGE_CODE"})),I=angular.copy(_.find(e.sort_fields,{value:"DATE"}));t=angular.copy(_.find(e.sort_fields,{value:"USER"})),e.sort_fields[0]=null,e.sort_fields[1]=C,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=t,e.sort_fields[6]=null,e.sort_fields[7]=I,e.sort_fields[8]=null,e.sort_fields[9]=null}if(e.title===s.DEPOSIT_SUMMARY){var H=angular.copy(_.find(e.sort_fields,{value:"CREDIT"})),V=angular.copy(_.find(e.sort_fields,{value:"DEBIT"})),M=angular.copy(_.find(e.sort_fields,{value:"NAME"}));e.sort_fields[0]=M,e.sort_fields[1]=null,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=V,e.sort_fields[5]=H}if(e.title===s.ROOMS_OOO_OOS){var F,B,w,x;_.each(e.sort_fields,function(e){e&&("ROOM_NO"===e.value&&(F=angular.copy(e)),"ROOM_TYPE"===e.value&&(B=angular.copy(e)),"START_DATE"===e.value&&(w=angular.copy(e)),"END_DATE"===e.value&&(x=angular.copy(e)))}),e.sort_fields=[F,B,null,w,x,null,null]}if(e.title===s.VACANT_ROOMS_REPORT){var F=angular.copy(_.find(e.sort_fields,{value:"ROOM_NUMBER"})),B=angular.copy(_.find(e.sort_fields,{value:"ROOM_TYPE"})),J=angular.copy(_.find(e.sort_fields,{value:"NO_OF_DAYS_VACANT"})),K=angular.copy(_.find(e.sort_fields,{value:"LAST_CHECK_OUT_DATE"}));e.sort_fields[0]=F,e.sort_fields[1]=B,e.sort_fields[2]=J,e.sort_fields[3]=K}},u.processSortBy=function(e){if(e.sortByOptions=angular.copy(e.sort_fields),e.showSort=!0,e.sortByOptions&&e.sortByOptions.length){if(_.each(e.sortByOptions,function(e,t,a){e&&(e.sortDir=void 0)}),e.title===s.DAILY_PRODUCTION_ROOM_TYPE){var t=_.find(e.sortByOptions,{value:"ROOM_TYPE"});t&&(t.sortDir=!0,e.chosenSortBy=t.value)}if(e.title===s.COMPANY_TA_TOP_PRODUCERS){var a=_.find(e.sortByOptions,{value:"REVENUE"});a&&(a.sortDir=!1,e.chosenSortBy=a.value)}if(e.title===s.CREDIT_CHECK_REPORT){var n=_.find(e.sortByOptions,{value:"ROOM_NO"});n&&(n.sortDir=!0,e.chosenSortBy=n.value)}if(e.title===s.COMPLIMENTARY_ROOM_REPORT&&(e.showSort=!1),e.title===s.GROUP_ROOMS_REPORT){var r=_.find(e.sortByOptions,{value:"GROUP_ARRIVAL_DATE"});r&&(r.sortDir=!0,e.chosenSortBy=r.value)}}},u.initDateValues=function(e){var t=u.processDate();switch(e.title){case s.ARRIVAL:case s.DEPARTURE:e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.DEPOSIT_REPORT:e.fromArrivalDate=t.businessDate,e.untilArrivalDate=t.aWeekAfter,e.fromDepositDate=t.businessDate,e.untilDepositDate=t.businessDate,e.fromPaidDate=t.businessDate,e.untilPaidDate=t.businessDate;break;case s.GROUP_DEPOSIT_REPORT:e.groupStartDate=t.businessDate,e.groupEndDate=t.twentyEightDaysAfter,e.fromPaidDate=t.twentyEightDaysBefore,e.untilPaidDate=t.businessDate;break;case s.OCCUPANCY_REVENUE_SUMMARY:e.fromDate=t.yesterday,e.untilDate=t.yesterday;break;case s.DAILY_TRANSACTIONS:case s.DAILY_PAYMENTS:case s.MARKET_SEGMENT_STAT_REPORT:case s.COMPARISION_BY_DATE:e.singleValueDate=t.yesterday;break;case s.FORECAST_BY_DATE:case s.FORECAST_GUEST_GROUPS:e.fromDate=t.businessDate,e.untilDate=t.aMonthAfter;break;case s.ADDON_FORECAST:case s.ALLOWANCE_FORECAST:e.showSort=!0,e.isForecast=!0,e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_ROOM_TYPE:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_DEMO:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_RATE:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.RATE_RESTRICTION_REPORT:e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.IN_HOUSE_GUEST:e.singleValueDate=t.businessDate;break;default:e.fromDate=t.aWeekAgo,e.fromCancelDate=t.aWeekAgo,e.fromArrivalDate=t.aWeekAgo,e.fromCreateDate=t.aWeekAgo,e.fromAdjustmentDate=t.aWeekAgo,
e.untilDate=t.businessDate,e.untilCancelDate=t.businessDate,e.untilArrivalDate=t.businessDate,e.untilCreateDate=t.businessDate,e.untilAdjustmentDate=t.businessDate}},u.processDate=function(a,n){var s=a?tzIndependentDate(a):e.businessDate,r=t("date")(s,"yyyy-MM-dd"),o=r.match(/(\d+)/g),i=parseInt(o[0]),l=parseInt(o[1])-1,_=parseInt(o[2]),u={businessDate:new Date(i,l,_),today:new Date(i,l,_),yesterday:new Date(i,l,_-1),tomorrow:new Date(i,l,_+1),aWeekAgo:new Date(i,l,_-7),aWeekAfter:new Date(i,l,_+7),aMonthAfter:new Date(i,l,_+30),monthStart:new Date(i,l,1),twentyEightDaysBefore:new Date(i,l,_-28),twentyEightDaysAfter:new Date(i,l,_+28),aYearAfter:new Date(i+1,l,_-1),sixMonthsAfter:new Date(i,l+6,_),thirtyOneDaysAfter:new Date(i,l,_+30)};return NaN!==parseInt(n)&&(u.xDaysBefore=new Date(i,l,_-n),u.xDaysAfter=new Date(i,l,_+n)),u},u.createTimeSlots=function(e){var t,a,n,s=[],r="",o="";30===e?(t=e,a=2):(t=15,a=4),n=24*a;var i=0,l=0,_=-1;for(i=0;i<n;i++)i%a===0?(_++,l=0):l+=t,r=_<10?"0"+_:_,o=l<10?"0"+l:l,s.push({value:r+":"+o,name:r+":"+o});return s},u.reduceObject=function(e,t){return t=t||c.concat(d),_.pick(e,t)},u.parseDatesInObject=function(e){for(var t in e)c.indexOf(t)!==-1&&(e[t]=tzIndependentDate(e[t]))},u.markAsSelected=function(e,t,a){_.each(e,function(e){t.indeOf(e[a])>-1&&(e.selected=!0)})},u.markSelectedEntriesForFilter=function(e){e.filters[l.RESTRICTION_IDS]&&e.filters[l.RESTRICTION_IDS].length>0&&u.markAsSelected(e.hasRestrictionListFilter.data,e.filters[l.RESTRICTION_IDS],"id"),e.filters[l.ROOM_TYPE_IDS]&&e.filters[l.ROOM_TYPE_IDS].length>0&&u.markAsSelected(e.hasRestrictionListFilter.data,e.filters[l.ROOM_TYPE_IDS],"id")},u.fillRateTypesAndRatesForScheduledReports=function(e,t,a){var n=function(e){var n=!1;return t&&t.rate_type_ids?n=t.rate_type_ids.length===e.length:t&&!t.rate_type_ids?n=!1:t||a!==s.DAILY_PRODUCTION_RATE||(n=!0),n},r=function(e){var n=!1;return t&&t.rate_ids?n=t.rate_ids.length===e.length:t&&!t.rate_ids?n=!1:t||a!==s.DAILY_PRODUCTION_RATE||(n=!0),n},i=function(o){var i,l,u=S(o),c=O(o);t&&t.rate_type_ids?_.each(t.rate_type_ids,function(e){i=_.findWhere(u,{rate_type_id:e}),i.selected=!0}):t||a!==s.DAILY_PRODUCTION_RATE||_.each(u,function(e){e.selected=!0}),t&&t.rate_ids?_.each(t.rate_ids,function(e){l=_.findWhere(c,{id:e}),l.selected=!0}):t||a!==s.DAILY_PRODUCTION_RATE||_.each(c,function(e){e.selected=!0}),e.hasRateTypeFilter={data:u,options:{selectAll:n(u),hasSearch:!0,key:"name"}},e.hasRateFilter={data:c,options:{selectAll:r(c),hasSearch:!0,key:"name"}}};o.fetchRateTypesAndRateList().then(i)},u.fillChargeGroupsAndChargeCodes=function(e,t,a){var n=function(e){var a=!0;return t&&t.charge_group_ids?a=t.charge_group_ids.length===e.length:t&&!t.charge_group_ids&&(a=!1),a},r=function(e){var a=!0;return t&&t.charge_code_ids?a=t.charge_code_ids.length===e.length:t&&!t.charge_code_ids&&(a=!1),a},i=function(o,i,l,u,c){var d,E,A=f(o,c,i,!0),T=angular.copy(A.chargeGroups),p=angular.copy(A.chargeCodes);delete e.hasByChargeGroup,delete e.hasByChargeCode,l&&(t&&t.charge_group_ids?T=_.map(T,function(e){return d=_.indexOf(t.charge_group_ids,e.id),e.selected=!1,d>-1&&(e.selected=!0),e}):t&&!t.charge_group_ids&&(T=_.map(T,function(e){return e.selected=!1,e})),e.hasByChargeGroup={data:T,options:{selectAll:n(T),hasSearch:!1,key:"name"},affectsFilter:{name:"hasByChargeCode",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(e.associcated_charge_groups,function(a){_.each(t,function(t){a.id===t.id&&(e.disabled=!1)})})}),e.updateData()}}}),u&&(t&&t.charge_code_ids?p=_.map(p,function(e){return E=_.indexOf(t.charge_code_ids,e.id),e.selected=!1,E>-1&&(e.selected=!0),e}):t&&!t.charge_code_ids&&(p=_.map(p,function(e){return e.selected=!1,e})),e.hasByChargeCode={data:p,originalData:p,options:{selectAll:r(p),hasSearch:!1,key:"name"},updateData:function(){var e=[];_.each(this.originalData,function(t){t.disabled||e.push(t)}),this.data=e}},a===s.FINANCIAL_TRANSACTION_REVENUE_REPORT&&(e.hasByChargeCode.options.key="description"))},l="NONE",u=!0,c=!0;a===s.DAILY_TRANSACTIONS&&(l="REMOVE_PAYMENTS"),a===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT&&(u=!1,c=!0),o.fetchChargeNAddonGroups().then(function(e){o.fetchChargeCodes().then(i.bind(null,e,l,u,c))})},u.fillCompletionStatus=function(e){var t=[{id:"UNASSIGNED",status:"UNASSIGNED",selected:!0},{id:"ASSIGNED",status:"ASSIGNED",selected:!0},{id:"COMPLETED",status:"COMPLETED",selected:!0}];e.hasCompletionStatus={data:t,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"}}},u.fillEmployees=function(e,t){var a=function(e){var a=!0;return t&&t.all_users_selected?a:(t&&t.user_ids&&(a=e.length===t.user_ids.length),a)};o.fetchEmployees().then(function(n){var s=angular.copy(n);t&&t.user_ids&&(s=s.map(function(e){return e.selected=!1,t.user_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.filterTitle="Employees",e.empList={title:"Employees",data:s,options:{selectAll:a(s),hasSearch:!0,key:"full_name",altKey:"email"}}})},u.fillTransactionCategory=function(e,t){var a,n=[{id:"TOTAL",description:"Show Totals"},{id:"PRE STAY",description:"Pre Stay"},{id:"IN HOUSE",description:"In House"},{id:"POST STAY",description:"Post Stay"}];a=t&&t.transaction_category?_.find(n,{id:t.transaction_category}):n[0],e.hasTransactionCategory={data:n,selected:a,options:{key:"description",defaultValue:"Select Transaction Category"}}},u.fillPaymentTypes=function(e,t){var a=function(e){var a=!0;return t&&t.payment_types&&(a=e.length===t.payment_types.length),a};o.fetchPaymentTypes().then(function(n){var s=angular.copy(n);t&&t.payment_types&&(s=s.map(function(e){return e.selected=!1,t.payment_types.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasPaymentType={data:s,options:{hasSearch:!1,selectAll:a(s),noSelectAll:!0,key:"description",defaultValue:"Show All"}}})},u.fillCollapsedOrExpanded=function(e,t){var a,n=[{id:1,value:"EXPANDED",description:"Expanded"},{id:2,value:"COLLAPSED",description:"Collapsed"}];a=t&&t.summary_type?_.find(n,{value:t.summary_type}):n[0],e.hasCollapsedOrExpanded={data:n,selected:a,options:{key:"description"}}},u.fillDepartments=function(e,t){var a=function(e){var a=!0;return t&&t.assigned_departments&&(a=e.length===t.assigned_departments.length),a};o.fetchDepartments().then(function(n){_.each(n,function(e){e.id=e.value});var s=angular.copy(n);t&&t.assigned_departments&&(s=s.map(function(e){return e.selected=!1,t.assigned_departments.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasDepartments={data:s,options:{hasSearch:!1,selectAll:a(s),key:"name",defaultValue:"Select Department"}}})},u.fillMarkets=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER||a===s.OCCUPANCY_REVENUE_SUMMARY;return t&&t.market_ids&&(n=e.length===t.market_ids.length),n};o.fetchMarkets().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(a,{name:"UNDEFINED"});r||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.market_ids&&(o=o.map(function(e){return e.selected=!1,t.market_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasMarketsList={data:o,options:{selectAll:n(o),hasSearch:!1,key:"name"}}})},u.fillBookingOrigins=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER;return t&&t.booking_origin_ids&&(n=e.length===t.booking_origin_ids.length),n};o.fetchBookingOrigins().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(a,{name:"UNDEFINED"});r||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.booking_origin_ids&&(o=o.map(function(e){return e.selected=!1,t.booking_origin_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasOriginsList={data:o,options:{selectAll:n(o),hasSearch:!1,key:"name"}}})},u.fillSources=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER;return t&&t.source_ids&&(n=e.length===t.source_ids.length),n};o.fetchSources().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(a,{name:"UNDEFINED"});r||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.source_ids&&(o=o.map(function(e){return e.selected=!1,t.source_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasSourcesList={data:o,options:{selectAll:n(o),hasSearch:!1,key:"name"}}})},u.fillCountries=function(e,t){o.fetchCountries().then(function(a){var n=angular.copy(a);t&&t.country_ids&&(n=n.map(function(e){return e.selected=!1,t.country_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeCountry={data:n,options:{selectAll:!1,hasSearch:!0,key:"value",defaultValue:"Select Country"}}})},u.fillWorkTypes=function(e,t){var a=function(e){var a=!0;return t&&t.work_type_ids&&(a=e.length===t.work_type_ids.length),a};o.fetchWorkTypes().then(function(n){_.each(n,function(e){e.value=e.name.toUpperCase()});var s=angular.copy(n);t&&t.work_type_ids&&(s=s.map(function(e){return e.selected=!1,t.work_type_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeWorkTypes={data:s,options:{selectAll:a(s),hasSearch:!0,key:"value",defaultValue:"Select Work Type"}}})},u.fillFrontOfficeStatus=function(e,t){var a=function(e){var a=!0;return t&&t.hk_fo_statuses&&(a=e.length===t.hk_fo_statuses.length),a},n=angular.copy(A);t&&t.hk_fo_statuses&&(n=n.map(function(e){return e.selected=!1,t.hk_fo_statuses.indexOf(e.status)>-1&&(e.selected=!0),e})),e.hasFrontOfficeStatus={data:n,options:{selectAll:a(n),hasSearch:!1,key:"description",defaultValue:"Select Front Office Status"}}},u.fillFloors=function(e,t){var a=function(e){var a=!0;return t&&t.floor&&(a=e.length===t.floor.length),a};o.fetchFloors().then(function(n){var s=angular.copy(n);t&&t.floor&&(s=s.map(function(e){return e.selected=!1,t.floor.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasFloorList={data:s,options:{selectAll:a(s),hasSearch:!0,key:"floor_number",defaultValue:"Select Floor"}}})},u.fillHouseKeepingStatus=function(e,t,a){var n=function(e){var a=!0;return t&&t.hk_status_ids&&(a=e.length===t.hk_status_ids.length),a},r=function(e){var t=angular.copy(e);return a===s.ROOM_STATUS_REPORT&&(t=t.map(function(e){return"OO"===e.value?e.value="Show Out of Order":"OS"===e.value?e.value="Show Out of Service":e.value="Show "+e.value,e})),t};o.fetchHouseKeepingStatus().then(function(a){var s=r(a);t&&t.hk_status_ids&&(s=s.map(function(e){return e.selected=!1,t.hk_status_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasHouseKeepingStatus={data:s,options:{selectAll:n(s),hasSearch:!1,key:"value",defaultValue:"Select Status"}}})},u.fillReservationStatus=function(e,t){var a=function(e){var a=!0;return t&&t.hk_reservation_statuses&&(a=e.length===t.hk_reservation_statuses.length),a},n=angular.copy(E);t&&t.hk_reservation_statuses&&(n=n.map(function(e){return e.selected=!1,t.hk_reservation_statuses.indexOf(e.status)>-1&&(e.selected=!0),e})),e.hasHkReservationStatus={data:n,options:{selectAll:a(n),hasSearch:!1,key:"description",defaultValue:"Select Status"}}},u.fillActionsBy=function(t){var a=[{value:"GUEST",name:"Guests"}];e.isHourlyRateOn||(a.push({value:"GROUP",name:"Groups"}),a.push({value:"BOTH",name:"Both"})),t.hasShowActionables={data:a,options:{key:"name"}}},u.fillRateCodesList=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER;return t&&t.rate_ids&&(n=e.length===t.rate_ids.length),n};o.fetchRateCode().then(function(r){if(a===s.RESERVATIONS_BY_USER){var o=_.find(r,{id:-1});if(!o){var i={id:-1,description:"UNDEFINED"};r.push(i)}}var l=angular.copy(r);t&&t.rate_ids&&(l=l.map(function(e){return e.selected=!1,t.rate_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasRateCodeList={data:l,options:{hasSearch:!0,selectAll:n(l),singleSelect:a!==s.RESERVATIONS_BY_USER,key:"description",defaultValue:"Select Rate"}}})},u.fillRoomTypes=function(e,t,a){var n=function(e){var a=!0;return t&&t.room_type_ids&&(a=e.length===t.room_type_ids.length),a};o.fetchRoomTypeList().then(function(r){if(a!==s.RESERVATIONS_BY_USER){var o=_.filter(r,function(e){return!e.is_suite&&!e.is_pseudo});r=o}var i=angular.copy(r);t&&t.room_type_ids&&(i=i.map(function(e){return e.selected=!1,t.room_type_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasRoomTypeList={data:i,options:{hasSearch:!1,selectAll:n(i),key:"name"}}})},u.fillSegments=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER;return t&&t.segment_ids&&(n=e.length===t.segment_ids.length),n};o.fetchSegments().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(a,{name:"UNDEFINED"});r||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.segment_ids&&(o=o.map(function(e){return e.selected=!1,t.segment_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasSegmentList={data:o,options:{selectAll:n(o),hasSearch:!1,key:"name"}}})},u.fillGuaranteeTypes=function(e,t,a){var n=function(e){var n=a===s.RESERVATIONS_BY_USER;return t&&t.include_guarantee_type&&(n=e.length===t.include_guarantee_type.length),n};o.fetchGuaranteeTypes().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},r=_.find(a,{name:"UNDEFINED"});r||a.push(s),_.each(a,function(e){e.id=e.name});var o=angular.copy(a);t&&t.include_guarantee_type&&(o=o.map(function(e){return e.selected=!1,t.include_guarantee_type.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasGuaranteeTypeList={data:o,options:{selectAll:n(o),hasSearch:!0,key:"name",defaultValue:"Select guarantees"}}})},u.fillEmployeeList=function(e,t){var a=function(e){var a=!0;return t&&t.user_ids&&(a=e.length===t.user_ids.length),a};o.fetchEmployeeList().then(function(n){var s=angular.copy(n.results);t&&t.user_ids&&(s=s.map(function(e){return e.selected=!1,t.user_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasUsers={title:"Employees",data:s,options:{selectAll:a(s),hasSearch:!0,key:"maid_name",altKey:"email"}}})},u.fillAddonGroups=function(e,t,a){var n=function(e){var a=!0;return t&&t.addon_group_ids?a=e.length===t.addon_group_ids.length:t&&!t.addon_group_ids&&(a=!1),a},s=function(e){var a=!0;if(t&&t.addon_ids){var n=t.addon_ids,s=0;_.each(e,function(e){n.indexOf(e.group_id)>-1&&(s+=e.list_of_addons.length)}),a=t.addon_ids.length===s}return a},r=function(e){var a=[];return _.each(e,function(e){e.disabled||_.each(e.list_of_addons,function(e){e.selected=!1,(t&&t.addon_ids&&t.addon_ids.indexOf(e.addon_id)>-1||angular.isUndefined(t))&&(e.selected=!0),a.push(e)})}),a},i=function(a,o){var i=angular.copy(a),l=angular.copy(o);t&&t.addon_group_ids&&(i=i.map(function(e){return e.selected=!1,t.addon_group_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasAddonGroups={title:"Addon Groups",data:i,options:{selectAll:n(i),hasSearch:!0,key:"name"},affectsFilter:{name:"hasAddons",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(t,function(t){e.group_id===t.id&&(e.disabled=!1)})}),e.updateData()}}},e.hasAddons={data:r(o),originalData:l,options:{selectAll:s(l),hasSearch:!0,key:"addon_name"},updateData:function(){this.data=r(this.originalData),this.options.selectAll=s(l)}}};o.fetchChargeNAddonGroups({for_addon_forecast_report:"Add-On Forecast"===a,include_payment:"Financial Transaction - Revenue Report"===a}).then(function(e){o.fetchAddons({addon_group_ids:_.pluck(e,"id")}).then(i.bind(null,e))})},u.fillResStatus=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=function(a){var n=angular.copy(a),s=function(e){var a=!0;return t&&t.status_ids?a=e.length===t.status_ids.length:angular.isDefined(t)&&!t.status_ids&&(a=!1),a};t&&t.status_ids&&(n=n.map(function(e){return e.selected=!1,t.status_ids.indexOf(e.id.toString())>-1&&(e.selected=!0),e})),e.hasReservationStatus={data:n,options:{selectAll:s(n),hasSearch:!1,key:"status",defaultValue:"Select status"}}};a?s(T):n?s(p):o.fetchReservationStatus().then(s)},u.fillRateCodes=function(e,t,a){t&&t.rate_id&&(a.rate_code=t.rate_id),o.fetchRateCode().then(function(t){e.hasRateCode={title:"Rate Codes",data:t}})},u.fillAgingBalances=function(e,t){var a=[{id:"0to30",status:"0-30 DAYS"},{id:"31to60",status:"31-60 DAYS"},{id:"61to90",status:"61-90 DAYS"},{id:"91to120",status:"91-120 DAYS"},{id:"120plus",status:"120+ DAYS"}],n=function(e){var a=!0;return t&&t.age_buckets?a=e.length===t.age_buckets.length:angular.isDefined(t)&&!t.age_buckets&&(a=!1),a},s=angular.copy(a);t&&t.age_buckets&&(s=s.map(function(e){return e.selected=!1,t.age_buckets.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeAgingBalance={data:s,options:{hasSearch:!1,selectAll:n(s),key:"status",defaultValue:"Select Aging Balance"}}},u.fillAccountNames=function(e,t){var a=function(e){var a=!1;return t&&t.account_ids?a=e.length===t.account_ids.length:angular.isDefined(t)&&!t.account_ids&&(a=!1),a};o.fetchAccounts().then(function(n){var s=angular.copy(n);t&&t.account_ids&&(s=s.map(function(e){return s.selected=!1,t.account_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasAccountSearch={data:s,options:{selectAll:a(s),hasSearch:!0,key:"account_name",defaultValue:"Select Accounts"}}})},u}]),angular.module("reportsModule").factory("RVReportSetupDates",["RVReportNamesConst","RVReportUtilsFac",function(e,t){return{init:function(a){var n=t.processDate(),s={ARRIVAL:{fromDate:n.businessDate,untilDate:n.businessDate},DEPARTURE:{fromDate:n.businessDate,untilDate:n.businessDate},DEPOSIT_REPORT:{fromArrivalDate:n.businessDate,untilArrivalDate:n.aWeekAfter,fromDepositDate:n.businessDate,untilDepositDate:n.businessDate,fromPaidDate:n.businessDate,untilPaidDate:n.businessDate},GROUP_DEPOSIT_REPORT:{groupStartDate:n.businessDate,groupEndDate:n.twentyEightDaysAfter,fromPaidDate:n.twentyEightDaysBefore,untilPaidDate:n.businessDate},OCCUPANCY_REVENUE_SUMMARY:{fromDate:n.yesterday,untilDate:n.yesterday},DAILY_TRANSACTIONS:{singleValueDate:n.yesterday},DAILY_PAYMENTS:{singleValueDate:n.yesterday},MARKET_SEGMENT_STAT_REPORT:{singleValueDate:n.yesterday},COMPARISION_BY_DATE:{singleValueDate:n.yesterday},FORECAST_BY_DATE:{fromDate:n.businessDate,untilDate:n.aMonthAfter},FORECAST_GUEST_GROUPS:{fromDate:n.businessDate,untilDate:n.aMonthAfter},ADDON_FORECAST:{fromDate:n.businessDate,untilDate:n.businessDate},ALLOWANCE_FORECAST:{fromDate:n.tomorrow,untilDate:n.tomorrow},DAILY_PRODUCTION_ROOM_TYPE:{fromDate:n.monthStart,untilDate:n.businessDate},DAILY_PRODUCTION_DEMO:{fromDate:n.monthStart,untilDate:n.businessDate},DAILY_PRODUCTION_RATE:{fromDate:n.monthStart,untilDate:n.businessDate},RATE_RESTRICTION_REPORT:{fromDate:n.businessDate,untilDate:n.businessDate},IN_HOUSE_GUEST:{singleValueDate:n.businessDate},COMPANY_TA_TOP_PRODUCERS:{fromDate:n.aWeekAgo,untilDate:n.yesterday},FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:{fromDate:n.businessDate,untilDate:n.businessDate},"A/R_AGING":{untilDate:n.yesterday},COMPLIMENTARY_ROOM_REPORT:{fromDate:n.businessDate,untilDate:n.businessDate},GROUP_ROOMS_REPORT:{fromDate:n.businessDate,untilDate:n.thirtyOneDaysAfter},FINANCIAL_TRANSACTION_REVENUE_REPORT:{fromDate:n.yesterday,untilDate:n.yesterday},FINANCIAL_TRANSACTION_PAYMENT_REPORT:{fromDate:n.yesterday,untilDate:n.yesterday},FINANCIAL_TRANSACTION_SUMMARY_REPORT:{singleValueDate:n.yesterday},DEFAULT:{fromDate:n.aWeekAgo,untilDate:n.businessDate,fromCancelDate:n.aWeekAgo,untilCancelDate:n.businessDate,fromArrivalDate:n.aWeekAgo,untilArrivalDate:n.businessDate,fromCreateDate:n.aWeekAgo,untilCreateDate:n.businessDate,fromAdjustmentDate:n.aWeekAgo,untilAdjustmentDate:n.businessDate}},r=_.findKey(e,function(e,t){return e===a.title}),o=s[r]||s.DEFAULT;_.each(o,function(e,t){a[t]=e}),a.allDates=[]},execFilter:function(t,a){var n=function(e,n,s){t[e]=a,angular.extend(t[e],{showRemove:!0,fromModel:n}),s&&(t[e].untilModel=s),t.allDates.push(e)};"DATE_RANGE"===a.value&&(n("hasDateFilter","fromDate","untilDate"),t.title===e.CANCELLATION_NO_SHOW&&(t.hasDateFilter.description="Arrival Date Range"),t.title===e.BOOKING_SOURCE_MARKET_REPORT&&(t.hasDateFilter.description="Booked Date")),"CANCELATION_DATE_RANGE"!==a.value&&"CANCELLATION_DATE_RANGE"!==a.value||n("hasCancelDateFilter","fromCancelDate","untilCancelDate"),"ARRIVAL_DATE_RANGE"===a.value&&n("hasArrivalDateFilter","fromArrivalDate","untilArrivalDate"),"GROUP_START_DATE_RANGE"===a.value&&n("hasGroupStartDateRange","groupStartDate","groupEndDate"),"DEPOSIT_DATE_RANGE"===a.value&&n("hasDepositDateFilter","fromDepositDate","untilDepositDate"),"CREATE_DATE_RANGE"===a.value&&n("hasCreateDateFilter","fromCreateDate","untilCreateDate"),"PAID_DATE_RANGE"===a.value&&n("hasPaidDateRange","fromPaidDate","untilPaidDate"),"SINGLE_DATE"===a.value&&n("hasSingleDateFilter","singleValueDate"),"ADJUSTMENT_DATE_RANGE"===a.value&&n("hasAdjustmentDateRange","fromAdjustmentDate","untilAdjustmentDate")}}}]),sntRover.constant("RVCustomExportFilterParamsConst",{BOOKING_ORIGIN_CODE:"BOOKING_ORIGIN_CODE",MARKET_CODE:"MARKET_CODE",RESERVATION_STATUS:"RESERVATION_STATUS",ROOM_TYPE:"ROOM_TYPE",SEGMENT_CODE:"SEGMENT_CODE",SOURCE_CODE:"SOURCE_CODE",ACTIVE:"ACTIVE","DAYUSE INDICATOR":"DAYUSE INDICATOR",ROOM_NO:"ROOM_NO",ARRIVAL_ROOM_TYPE:"ARRIVAL_ROOM_TYPE",DEPARTURE_ROOM_TYPE:"DEPARTURE_ROOM_TYPE",LANGUAGE:"LANGUAGE",NATIONALITY:"NATIONALITY",ARRIVAL_RATE_CODE:"ARRIVAL_RATE_CODE",CI_AGENT:"CI_AGENT",CO_AGENT:"CO_AGENT",CI_APPLICATION:"CI_APPLICATION",CO_APPLICATION:"CO_APPLICATION",COUNTRY:"COUNTRY",VIP:"VIP",PRIMARY_PAYMENT_METHOD:"PRIMARY_PAYMENT_METHOD",MEMBERSHIP:"MEMBERSHIP",MEMBERSHIP_LEVEL:"MEMBERSHIP_LEVEL",STAY_TYPE:"STAY_TYPE",ORIGIN_CODE:"ORIGIN_CODE",CHARGE_GROUP:"CHARGE_GROUP",CHARGE_CODE_DESC:"CHARGE_CODE_DESC",CHARGE_CODE:"CHARGE_CODE",CHARGE_TYPE:"CHARGE_TYPE",PRE_STAY:"PRE_STAY",POST_STAY:"POST_STAY",RATE_CODE:"RATE_CODE",MARKET:"MARKET",ORIGIN:"ORIGIN",SEGMENT:"SEGMENT",SOURCE:"SOURCE",USER_NAME:"USER_NAME",HOLD_STATUS:"HOLD_STATUS",RESERVATION_TYPE:"RESERVATION_TYPE",TAX_EXEMPT:"TAX_EXEMPT",GLOBAL:"GLOBAL",GROUP_NAME:"GROUP_NAME",DO_NOT_MOVE:"DO_NOT_MOVE",IS_FLAGGED:"IS_FLAGGED",EXTERNAL_SYSTEM:"EXTERNAL_SYSTEM"}),sntRover.constant("RVReportDisplaysConst",{INCLUDE_MARKET:!0,INCLUDE_SOURCE:!0,INCLUDE_ORIGIN:!0,INCLUDE_SEGMENT:!0}),sntRover.constant("RVReportFiltersConst",{DATE_RANGE:!0,CANCELATION_DATE_RANGE:!0,CANCELLATION_DATE_RANGE:!0,ARRIVAL_DATE_RANGE:!0,GROUP_START_DATE_RANGE:!0,DEPOSIT_DATE_RANGE:!0,CREATE_DATE_RANGE:!0,PAID_DATE_RANGE:!0,SINGLE_DATE:!0,ADJUSTMENT_DATE_RANGE:!0,TIME_RANGE:!0,CICO:!0,INCLUDE_COMPANYCARD_TA_GROUP:!0,GROUP_COMPANY_TA_CARD:!0,INCLUDE_GUARANTEE_TYPE:!0,INCLUDE_CHARGE_GROUP:!0,INCLUDE_CHARGE_CODE:!0,CHOOSE_MARKET:!0,CHOOSE_SEGMENT:!0,CHOOSE_SOURCE:!0,CHOOSE_BOOKING_ORIGIN:!0,HOLD_STATUS:!0,DAYS_0_30:!0,ACCOUNT_SEARCH:!0,GROUP_CODE:!0}),sntRover.constant("RVReportFiltersKmConst",{DATE_RANGE:"DATE_RANGE",CANCELATION_DATE_RANGE:"CANCELATION_DATE_RANGE",CANCELLATION_DATE_RANGE:"CANCELLATION_DATE_RANGE",ARRIVAL_DATE_RANGE:"ARRIVAL_DATE_RANGE",GROUP_START_DATE_RANGE:"GROUP_START_DATE_RANGE",DEPOSIT_DATE_RANGE:"DEPOSIT_DATE_RANGE",CREATE_DATE_RANGE:"CREATE_DATE_RANGE",PAID_DATE_RANGE:"PAID_DATE_RANGE",SINGLE_DATE:"SINGLE_DATE",ADJUSTMENT_DATE_RANGE:"ADJUSTMENT_DATE_RANGE",TIME_RANGE:"TIME_RANGE",CICO:"CICO",INCLUDE_COMPANYCARD_TA_GROUP:"INCLUDE_COMPANYCARD_TA_GROUP",GROUP_COMPANY_TA_CARD:"GROUP_COMPANY_TA_CARD",INCLUDE_GUARANTEE_TYPE:"INCLUDE_GUARANTEE_TYPE",INCLUDE_CHARGE_GROUP:"INCLUDE_CHARGE_GROUP",INCLUDE_CHARGE_CODE:"INCLUDE_CHARGE_CODE",CHOOSE_MARKET:"CHOOSE_MARKET",CHOOSE_SOURCE:"CHOOSE_SOURCE",CHOOSE_BOOKING_ORIGIN:"CHOOSE_BOOKING_ORIGIN",HOLD_STATUS:"HOLD_STATUS",GROUP_CODE:"GROUP_CODE"}),angular.module("reportsModule").constant("RVReportInboxFilterLabelConst",{from_date:"Date Range (From)",to_date:"Date Range (To)",cancel_from_date:"Cancel From Date",cancel_to_date:"Cancel To Date",arrival_from_date:"Arrival From Date",arrival_to_date:"Arrival To Date",group_from_date:"Group Start Date",group_to_date:"Group End Date",deposit_from_date:"Deposit From Date",deposit_to_date:"Deposit To Date",paid_from_date:"Paid From Date",paid_to_date:"Paid To Date",create_from_date:"Create From Date",create_to_date:"Create To Date",date:"Date",from_time:"From Time",to_time:"To Time",rate_ids:"Rates",assigned_departments:"Departments",selected_language:"Language",include_guarantee_type:"Guarantee Types",market_ids:"Markets",segment_ids:"Segments",source_ids:"Sources",booking_origin_ids:"Origin(s)",hold_status_ids:"Hold Status",status_ids:"Reservation Status",room_type_ids:"Room Types",restriction_ids:"Restrictions",campaign_types:"Campaign Types",status:"Completion Status",age_buckets:"Aging Balance",tax_exempt_type_ids:"Tax Exempt Type",include_long_stays:"Include long stays",account_ids:"Account Name(s)",travel_agent_ids:"Travel Agents",floor:"Floors",sort_field:"Sort By",sort_dir:"Sort Order",OPTIONS:"Option(s)",deposit_due:"Deposit Due",deposit_paid:"Deposit Paid",deposit_past:"Deposit Past",include_canceled:"Include Canceled",include_market:"Include Market",include_no_show:"Include No Show",include_tax:"Include Tax",show_adjustments:"Show Adjustments",DISPLAY:"Display(s)",include_origin:"Include Origin",include_segment:"Include Segment",include_source:"Include Source","0to30":"0-30 DAYS","31to60":"31-60 DAYS","61to90":"61-90 DAYS","91to120":"91-120 DAYS","120plus":"120+ DAYS",actions_by:"Show",origin:"Origin(s)",urls:"URL(s)",addon_group_ids:"Add-on Group(s)",addon_ids:"Add-on(s)",group_field:"Group By",include_companycard_ta_group:"Company/TA/Group",due_in_arrivals:"DUE IN ARRIVALS",include_actions:"INCLUDE ACTIONS",checked_in:"Show only Check Ins",checked_out:"Show only Check Outs","CHECK IN/ CHECK OUT":"CHECK IN/ CHECK OUT",SHOW:"SHOW",show_company:"SHOW COMPANY",show_travel_agent:"SHOW TRAVEL AGENTS",min_revenue:"MIN REVENUE",min_room_nights:"MIN NIGHTS",include_ledger_data:"Include Ledger Data",exceeded_only:"Exceeded Only",include_due_out:"Include Due Out",include_inhouse:"Include Inhouse",rate_type_ids:"Rate Types",charge_code_ids:"Charge Code(s)",charge_group_ids:"Charge Group(s)",due_out_departures:"Due Out Departures",include_guest_notes:"Include Guest Notes",include_reservation_notes:"Include Reservation Notes",show_guests:"Show Guests",vip_only:"Vip Only","GUEST/ACCOUNT":"Guest/Account",user_ids:"Employees",exclude_non_gtd:" Exclude Non-Guaranteed",include_group:"Group",restricted_post_only:"Restricted Post Only",rover:"Rover",zest:"Zest",zest_web:"Zest Web",include_last_year:"Include Last Year",include_variance:"Include Variance",include_both:"Include Both",include_new:"Include New",show_rate_adjustments_only:"Show Rate Adjustments Only",ooo:"OOO",oos:"OOS",min_number_of_days_not_occupied:"Min No of Days Not Occupied",year:"Year","COMPANY/TRAVEL_AGENT":"Company/Travel Agent",exclude_tax:"Exclude Tax",show_deleted_charges:"Show Deleted Charges",account:"Account",guest:"Guest",include_cancelled:"Include Cancelled",show_room_revenue:"Show Room Revenue",with_vat_number:"Cards with tax id",without_vat_number:"Cards without tax id",include_companycard_ta:"Include CC/TA",BOOKED_DATE_FROM:"Booked Date (From)",BOOKED_DATE_TO:"Booked Date (To)",SHOW_CHECKINS_AND_CHECKOUTS:"Show Check Ins and Check Outs",no_nationality:"No Nationality",rate_id:"Rate","COMPANY/TA":"Company/TA",group_company_ta_card:"Company/TA/Group",GROUP_BY:"Group By",group_by_date:"Date",group_by_user:"User",group_by_group_name:"Group name",DEPOSIT_DUE_FROM_DATE:"Deposit Due From Date",DEPOSIT_DUE_TO_DATE:"Deposit Due To Date",group_code:"Group Code",country_ids:"Country",include_day_use:"Include Day Use",show_upsell_only:"Show Upsells Only"}),angular.module("reportsModule").constant("RVReportMsgsConst",{REPORT_FILTER_CHANGED:"report.filter.change",REPORT_SUBMITED:"report.submited",REPORT_UPDATED:"report.updated",REPORT_PAGE_CHANGED:"report.page.changed",REPORT_PRE_PRINT_DONE:"report.pre.print.done",REPORT_PRINTING:"report.printing",REPORT_API_FAILED:"report.API.failed",REPORT_LIST_SCROLL_REFRESH:"report.list.scroll.refresh",REPORT_DETAILS_FILTER_SCROLL_REFRESH:"report.details.filter.scroll.refresh",REPORT_LOAD_LAST_REPORT:"report.show.last"}),angular.module("reportsModule").constant("RVReportNamesConst",{CHECK_IN_CHECK_OUT:"Check In / Check Out",CHECKIN_NOW_OR_LATER:"Check In - Now or Later",UPSELL:"Upsell",ROOM_UPSELL:"Room Upsell",WEB_CHECK_OUT_CONVERSION:"Web Check Out Conversion",WEB_CHECK_IN_CONVERSION:"Web Check In Conversion",WEB_CHECK_IN_CONV_BY_DAY:"Web Check In Conversion By Day",LATE_CHECK_OUT:"Late Check Out",EARLY_CHECKIN:"Early Check In",IN_HOUSE_GUEST:"In-House Guests",ARRIVAL:"Arrival",DEPARTURE:"Departure",BOOKING_SOURCE_MARKET_REPORT:"Booking Source & Market Report",CANCELLATION_NO_SHOW:"Cancellation & No Show",DEPOSIT_REPORT:"Guest Deposit Report",GROUP_DEPOSIT_REPORT:"Group Deposit Report",LOGIN_AND_OUT_ACTIVITY:"Login and out Activity",OCCUPANCY_REVENUE_SUMMARY:"Occupancy & Revenue Summary",RESERVATIONS_BY_USER:"Reservations By User",DAILY_TRANSACTIONS:"Daily Transactions",DAILY_PAYMENTS:"Daily Payments",FORECAST_BY_DATE:"Forecast",ROOMS_QUEUED:"Rooms Queued",FORECAST_GUEST_GROUPS:"Forecast Guests & Groups",MARKET_SEGMENT_STAT_REPORT:"Market Segment Statistics Report",MOBILE_CHECKIN_NOW:"Mobile Check In - Now",MOBILE_CHECKIN:"Mobile Check In",COMPARISION_BY_DATE:"Comparison",RATE_ADJUSTMENTS_REPORT:"Rate Adjustment Report",GROUP_PICKUP_REPORT:"Group Pick Up Report",GUEST_BALANCE_REPORT:"Guest Balance Report",ADDON_FORECAST:"Add-On Forecast",ALLOWANCE_FORECAST:"Allowance Forecast Report",DAILY_PRODUCTION_ROOM_TYPE:"Daily Production",AR_SUMMARY_REPORT:"A/R Summary Report",DAILY_PRODUCTION_DEMO:"Daily Production by Demographics",DAILY_PRODUCTION_RATE:"Daily Production by Rate",RATE_RESTRICTION_REPORT:"Rate & Restrictions",COMPANY_TA_TOP_PRODUCERS:"Company/TA Top Producers",FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:"Financial Transactions - Adjustment Report",CREDIT_CHECK_REPORT:"Credit Check Report",DEPOSIT_SUMMARY:"Deposit Balance Summary",ZEST_CAMPAIGN_REPORT:"Zest App Campaign Report",ROOMS_OOO_OOS:"Rooms OOO/OOS",ACTIONS_MANAGER:"Action Manager",VACANT_ROOMS_REPORT:"Vacant Rooms Report","A/R_AGING":"A/R Aging",TRAVEL_AGENT_COMMISSIONS:"Travel Agent Commissions",BUSINESS_ON_BOOKS:"Business on the Books",COMPLIMENTARY_ROOM_REPORT:"Complimentary Room Report",GROUP_ROOMS_REPORT:"Group Rooms Report",ADDON_UPSELLS:"Add On Upsell",YEARLY_TAX:"Yearly Tax Report",TAX_EXEMPT:"Tax Exempt",FOLIO_TAX_REPORT:"Folio Tax Report",GUESTS_INHOUSE_BY_NATIONALITY:"Guests In House by Nationality",BUSINESS_ON_THE_BOOKS:"Business on the Books",ROOM_STATUS_REPORT:"Room Status Report",FINANCIAL_TRANSACTION_REVENUE_REPORT:"Financial Transaction - Revenue Report",FINANCIAL_TRANSACTION_PAYMENT_REPORT:"Financial Transaction - Payment Report",FINANCIAL_TRANSACTION_SUMMARY_REPORT:"Financial Transaction - Summary Report",TAX_OUTPUT_REPORT:"Tax Output Report - Tax Payment Receipts"}),sntRover.constant("RVReportOptionsConst",{INCLUDE_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,EXCLUDE_TAX:!0,INCLUDE_LEDGER_DATA:!0}),angular.module("reportsModule").constant("RVReportPaginationIdsConst",{"Action Manager":"ACTIONS_MANAGER",Arrival:"ARRIVAL","Cancellation & No Show":"CANCELLATION_NO_SHOW",Departure:"DEPARTURE","Guest Balance Report":"GUEST_BALANCE_REPORT","Guest Deposit Report":"DEPOSIT_REPORT","In-House Guests":"IN_HOUSE_GUEST","Late Check Out":"LATE_CHECK_OUT","Login and out Activity":"LOGIN_AND_OUT_ACTIVITY","Rate Adjustment Report":"RATE_ADJUSTMENTS_REPORT","Vacant Rooms Report":"VACANT_ROOMS_REPORT","A/R Summary Report":"AR_SUMMARY_REPORT",Forecast:"FORECAST_BY_DATE","Forecast Guests & Groups":"FORECAST_GUEST_GROUPS","Reservations By User":"RESERVATIONS_BY_USER",Upsell:"UPSELL","Room Upsell":"ROOM_UPSELL","Rooms OOO/OOS":"ROOMS_OOO_OOS","Company/TA Top Producers":"COMPANY_TA_TOP_PRODUCERS","Credit Check Report":"CREDIT_CHECK_REPORT","Deposit Balance Summary":"DEPOSIT_SUMMARY","Business on the Books":"BUSINESS_ON_BOOKS",
"Complimentary Room Report":"COMPLIMENTARY_ROOM_REPORT","Group Rooms Report":"GROUP_ROOMS_REPORT","Add On Upsell":"ADDON_UPSELLS","Tax Exempt":"TAX_EXEMPT","Folio Tax Report":"FOLIO_TAX_REPORT","Guests In House by Nationality":"GUESTS_INHOUSE_BY_NATIONALITY"}),angular.module("reportsModule").constant("RVReportParamsConst",{FROM_DATE:"from_date",TO_DATE:"to_date",CANCEL_FROM_DATE:"cancel_from_date",CANCEL_TO_DATE:"cancel_to_date",ARRIVAL_FROM_DATE:"arrival_from_date",ARRIVAL_TO_DATE:"arrival_to_date",GROUP_START_DATE:"group_from_date",GROUP_END_DATE:"group_to_date",DEPOSIT_FROM_DATE:"deposit_from_date",DEPOSIT_TO_DATE:"deposit_to_date",PAID_FROM_DATE:"paid_from_date",PAID_TO_DATE:"paid_to_date",CREATE_FROM_DATE:"create_from_date",CREATE_TO_DATE:"create_to_date",ADJUSTMENT_FROM_DATE:"adjustment_from_date",ADJUSTMENT_TO_DATE:"adjustment_to_date",SINGLE_DATE:"date",FROM_TIME:"from_time",TO_TIME:"to_time",SELECTED_LANGUAGE:"locale",SORT_FIELD:"sort_field",SORT_DIR:"sort_dir",GROUP_BY_DATE:"group_by_date",GROUP_BY_USER:"group_by_user",GROUP_BY_GROUP_NAME:"group_by_group_name",ADDON_GROUP_BY:"group_field",CHARGE_TYPE:"group_by_charge_type",USER_IDS:"user_ids",MARKET_IDS:"market_ids",SEGMENT_IDS:"segment_ids",SOURCE_IDS:"source_ids",BOOKING_ORIGIN_IDS:"booking_origin_ids",INCLUDE_GUARANTEE_TYPE:"include_guarantee_type",CHARGE_GROUP_IDS:"charge_group_ids",CHARGE_CODE_IDS:"charge_code_ids",HOLD_STATUS_IDS:"hold_status_ids",ADDONS_GROUPS_IDS:"addon_group_ids",ADDONS_IDS:"addon_ids",RESERVATION_STATUS:"status_ids",RESERVATION_ADDONS:"addon_ids",RATE_IDS:"rate_ids",RATE_TYPE_IDS:"rate_type_ids",RESTRICTION_IDS:"restriction_ids",ROOM_TYPE_IDS:"room_type_ids",RATE_ID:"rate_id",ORIGIN_VALUES:"origin",ORIGIN_URLS:"urls",CAMPAIGN_TYPES:"campaign_types",FLOOR:"floor",ASSIGNED_DEPARTMENTS:"assigned_departments",COMPLETION_STATUS:"status",AGING_BALANCE:"age_buckets",ACCOUNT_SEARCH:"account_ids",SHOW_ACTIONABLES:"actions_by",TRAVEL_AGENTS:"travel_agent_ids",TRAVEL_AGENTS_PER_PAGE_COUNT:25,RECEIPTS_PER_PAGE_COUNT:25,RESERVATION_STATUS_ARRAY:"status_ids[]",VAT_YEAR:"year",WITH_VAT_NUMBER:"with_vat_number",WITHOUT_VAT_NUMBER:"without_vat_number",DEPOSIT_DUE:"deposit_due",DEPOSIT_PAID:"deposit_paid",DEPOSIT_PAST:"deposit_past",INCLUDE_CANCELED:"include_canceled",INCLUDE_NO_SHOW:"include_no_show",INCLUDE_TAX:"include_tax",SHOW_DELETED_CHARGES:"show_deleted_charges",SHOW_ADJUSTMENTS:"show_adjustments",INCLUDE_MARKET:"include_market",INCLUDE_ORIGIN:"include_origin",INCLUDE_SEGMENT:"include_segment",INCLUDE_SOURCE:"include_source",SHOW_ROOM_REVENUE:"show_room_revenue",INCLUDE_ACTIONS:"include_actions",INCLUDE_GUEST_NOTES:"include_guest_notes",INCLUDE_RESERVATION_NOTES:"include_reservation_notes",INCLUDE_COMPANYCARD_TA_GROUP:"include_companycard_ta_group",DUE_IN_ARRIVALS:"due_in_arrivals",CHECKED_IN:"checked_in",CHECKED_OUT:"checked_out",SHOW_TRAVEL_AGENT:"show_travel_agent",SHOW_COMPANY:"show_company",MIN_REVENUE:"min_revenue",MIN_NIGHTS:"min_room_nights",INCLUDE_LEDGER_DATA:"include_ledger_data",EXCEEDED_ONLY:"exceeded_only",INCLUDE_DUE_OUT:"include_due_out",INCLUDE_INHOUSE:"include_inhouse",SHOW_GUESTS:"show_guests",VIP_ONLY:"vip_only",ACCOUNT:"account",GUEST:"guest",EXCLUDE_NON_GTD:"exclude_non_gtd",INCLUDE_GROUP:"include_group",RESTRICTED_POST_ONLY:"restricted_post_only",ROVER:"rover",ZEST:"zest",ZEST_WEB:"zest_web",INCLUDE_LAST_YEAR:"include_last_year",INCLUDE_VARIANCE:"include_variance",INCLUDE_BOTH:"include_both",INCLUDE_NEW:"include_new",SHOW_RATE_ADJUSTMENTS_ONLY:"show_rate_adjustments_only",OOO:"ooo",OOS:"oos",MIN_NO_OF_DAYS_NOT_OCCUPIED:"min_number_of_days_not_occupied",EXCLUDE_TAX:"exclude_tax",DUE_OUT_DEPARTURES:"due_out_departures",INCLUDE_CANCELLED:"include_cancelled",ENTITY_TYPE:"entity_type",INCLUDE_COMPANYCARD_TA:"include_companycard_ta",NO_NATIONALITY:"no_nationality",GROUP_COMPANY_TA_CARD:"group_company_ta_card",GROUP_CODE:"group_code",TAX_EXEMPT_TYPE:"tax_exempt_type_ids",TA_CC_CARD:"ta_cc_card",SHOW_VAT_WITH_RATES:"show_vat_with_rates",COUNTRY:"country_ids",INCLUDE_LONG_STAYS:"include_long_stays",INCLUDE_DAYUSE:"include_day_use",SHOW_UPSELL_ONLY:"show_upsell_only",ENTITY_NAME:"entity_name",WORK_TYPE:"work_type_ids",FRONT_OFFICE_STATUS:"fo_status_ids",HOUSEKEEPING_STATUS:"hk_status_ids",HK_RESERVATION_STATUSES:"hk_reservation_statuses",HK_FRONT_OFFICE_STATUSES:"hk_fo_statuses",PAYMENT_TYPES:"payment_types",TRANSACTION_CATEGORY:"transaction_category",SHOW_EMPLOYEES_INCLUDING_EOD:"show_employee_including_eod",TAX_RECEIPT_TYPE_VALUES:"tax_receipt_type_values",EXPANDED_OR_COLLAPSED:"summary_type"});