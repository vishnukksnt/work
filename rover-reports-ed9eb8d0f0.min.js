"use strict";function Model(e){var t=function(e){return{enumerable:!0,writable:!0,value:e}},a=Object.prototype.hasOwnProperty;if(!(this instanceof Model))return new Model(e);Object.defineProperties(this,{isUpdating:t(!1),isResolved:t(!1),isDirty:t(!1)});for(var r in e)a.call(e,r)&&(this[r]=e[r])}function Time(e){return this instanceof Time?(e=function(e){var t={};return e.toFixed?(t.milliseconds=e%1e3,t.seconds=Math.floor(e/1e3),t.minutes=Math.floor(e/6e4),t.hours=Math.floor(e/36e5),t):e}(e),void function(e){var t=function(e){return{enumerable:!0,writable:!0,value:e}};Object.defineProperties(this,{milliseconds:t(e.milliseconds||0),seconds:t(e.seconds||0),minutes:t(e.minutes||0),hours:t(e.hours||0)})}.call(this,e)):new Time(e)}function arrayMap(e,t){for(var a=-1,r=e?e.length:0,s=Array(r);++a<r;)s[a]=t(e[a],a,e);return s}function arraySome(e,t){for(var a=-1,r=e?e.length:0;++a<r;)if(t(e[a],a,e))return!0;return!1}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function baseSortBy(e,t){var a=e.length;for(e.sort(t);a--;)e[a]=e[a].value;return e}function baseTimes(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}function baseUnary(e){return function(t){return e(t)}}function getValue(e,t){return null==e?void 0:e[t]}function isHostObject(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function mapToArray(e){var t=-1,a=Array(e.size);return e.forEach(function(e,r){a[++t]=[r,e]}),a}function overArg(e,t){return function(a){return e(t(a))}}function setToArray(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=e}),a}function Hash(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(e){return this.has(e)&&delete this.__data__[e]}function hashGet(e){var t=this.__data__;if(nativeCreate){var a=t[e];return a===HASH_UNDEFINED?void 0:a}return hasOwnProperty.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty.call(t,e)}function hashSet(e,t){var a=this.__data__;return a[e]=nativeCreate&&void 0===t?HASH_UNDEFINED:t,this}function ListCache(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(e){var t=this.__data__,a=assocIndexOf(t,e);if(a<0)return!1;var r=t.length-1;return a==r?t.pop():splice.call(t,a,1),!0}function listCacheGet(e){var t=this.__data__,a=assocIndexOf(t,e);return a<0?void 0:t[a][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var a=this.__data__,r=assocIndexOf(a,e);return r<0?a.push([e,t]):a[r][1]=t,this}function MapCache(e){var t=-1,a=e?e.length:0;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(e){return getMapData(this,e).delete(e)}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){return getMapData(this,e).set(e,t),this}function SetCache(e){var t=-1,a=e?e.length:0;for(this.__data__=new MapCache;++t<a;)this.add(e[t])}function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function Stack(e){this.__data__=new ListCache(e)}function stackClear(){this.__data__=new ListCache}function stackDelete(e){return this.__data__.delete(e)}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}function stackSet(e,t){var a=this.__data__;if(a instanceof ListCache){var r=a.__data__;if(!Map||r.length<LARGE_ARRAY_SIZE-1)return r.push([e,t]),this;a=this.__data__=new MapCache(r)}return a.set(e,t),this}function arrayLikeKeys(e,t){var a=isArray(e)||isArguments(e)?baseTimes(e.length,String):[],r=a.length,s=!!r;for(var n in e)!t&&!hasOwnProperty.call(e,n)||s&&("length"==n||isIndex(n,r))||a.push(n);return a}function assocIndexOf(e,t){for(var a=e.length;a--;)if(eq(e[a][0],t))return a;return-1}function baseForOwn(e,t){return e&&baseFor(e,t,keys)}function baseGet(e,t){t=isKey(t,e)?[t]:castPath(t);for(var a=0,r=t.length;null!=e&&a<r;)e=e[toKey(t[a++])];return a&&a==r?e:void 0}function baseGetTag(e){return objectToString.call(e)}function baseHasIn(e,t){return null!=e&&t in Object(e)}function baseIsEqual(e,t,a,r,s){return e===t||(null==e||null==t||!isObject(e)&&!isObjectLike(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,baseIsEqual,a,r,s))}function baseIsEqualDeep(e,t,a,r,s,n){var o=isArray(e),i=isArray(t),l=arrayTag,c=arrayTag;o||(l=getTag(e),l=l==argsTag?objectTag:l),i||(c=getTag(t),c=c==argsTag?objectTag:c);var u=l==objectTag&&!isHostObject(e),d=c==objectTag&&!isHostObject(t),_=l==c;if(_&&!u)return n||(n=new Stack),o||isTypedArray(e)?equalArrays(e,t,a,r,s,n):equalByTag(e,t,l,a,r,s,n);if(!(s&PARTIAL_COMPARE_FLAG)){var p=u&&hasOwnProperty.call(e,"__wrapped__"),h=d&&hasOwnProperty.call(t,"__wrapped__");if(p||h){var E=p?e.value():e,R=h?t.value():t;return n||(n=new Stack),a(E,R,r,s,n)}}return!!_&&(n||(n=new Stack),equalObjects(e,t,a,r,s,n))}function baseIsMatch(e,t,a,r){var s=a.length,n=s,o=!r;if(null==e)return!n;for(e=Object(e);s--;){var i=a[s];if(o&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++s<n;){i=a[s];var l=i[0],c=e[l],u=i[1];if(o&&i[2]){if(void 0===c&&!(l in e))return!1}else{var d=new Stack;if(r)var _=r(c,u,l,e,t,d);if(!(void 0===_?baseIsEqual(u,c,r,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,d):_))return!1}}return!0}function baseIsNative(e){if(!isObject(e)||isMasked(e))return!1;var t=isFunction(e)||isHostObject(e)?reIsNative:reIsHostCtor;return t.test(toSource(e))}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[objectToString.call(e)]}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==("undefined"==typeof e?"undefined":_typeof(e))?isArray(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var a in Object(e))hasOwnProperty.call(e,a)&&"constructor"!=a&&t.push(a);return t}function baseMap(e,t){var a=-1,r=isArrayLike(e)?Array(e.length):[];return baseEach(e,function(e,s,n){r[++a]=t(e,s,n)}),r}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(a){return a===e||baseIsMatch(a,e,t)}}function baseMatchesProperty(e,t){return isKey(e)&&isStrictComparable(t)?matchesStrictComparable(toKey(e),t):function(a){var r=get(a,e);return void 0===r&&r===t?hasIn(a,e):baseIsEqual(t,r,void 0,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG)}}function baseOrderBy(e,t,a){var r=-1;t=arrayMap(t.length?t:[identity],baseUnary(baseIteratee));var s=baseMap(e,function(e,a,s){var n=arrayMap(t,function(t){return t(e)});return{criteria:n,index:++r,value:e}});return baseSortBy(s,function(e,t){return compareMultiple(e,t,a)})}function basePropertyDeep(e){return function(t){return baseGet(t,e)}}function baseToString(e){if("string"==typeof e)return e;if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function castPath(e){return isArray(e)?e:stringToPath(e)}function compareAscending(e,t){if(e!==t){var a=void 0!==e,r=null===e,s=e===e,n=isSymbol(e),o=void 0!==t,i=null===t,l=t===t,c=isSymbol(t);if(!i&&!c&&!n&&e>t||n&&o&&l&&!i&&!c||r&&o&&l||!a&&l||!s)return 1;if(!r&&!n&&!c&&e<t||c&&a&&s&&!r&&!n||i&&a&&s||!o&&s||!l)return-1}return 0}function compareMultiple(e,t,a){for(var r=-1,s=e.criteria,n=t.criteria,o=s.length,i=a.length;++r<o;){var l=compareAscending(s[r],n[r]);if(l){if(r>=i)return l;var c=a[r];return l*("desc"==c?-1:1)}}return e.index-t.index}function createBaseEach(e,t){return function(a,r){if(null==a)return a;if(!isArrayLike(a))return e(a,r);for(var s=a.length,n=t?s:-1,o=Object(a);(t?n--:++n<s)&&r(o[n],n,o)!==!1;);return a}}function createBaseFor(e){return function(t,a,r){for(var s=-1,n=Object(t),o=r(t),i=o.length;i--;){var l=o[e?i:++s];if(a(n[l],l,n)===!1)break}return t}}function equalArrays(e,t,a,r,s,n){var o=s&PARTIAL_COMPARE_FLAG,i=e.length,l=t.length;if(i!=l&&!(o&&l>i))return!1;var c=n.get(e);if(c&&n.get(t))return c==t;var u=-1,d=!0,_=s&UNORDERED_COMPARE_FLAG?new SetCache:void 0;for(n.set(e,t),n.set(t,e);++u<i;){var p=e[u],h=t[u];if(r)var E=o?r(h,p,u,t,e,n):r(p,h,u,e,t,n);if(void 0!==E){if(E)continue;d=!1;break}if(_){if(!arraySome(t,function(e,t){if(!_.has(t)&&(p===e||a(p,e,r,s,n)))return _.add(t)})){d=!1;break}}else if(p!==h&&!a(p,h,r,s,n)){d=!1;break}}return n.delete(e),n.delete(t),d}function equalByTag(e,t,a,r,s,n,o){switch(a){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!r(new Uint8Array(e),new Uint8Array(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var i=mapToArray;case setTag:var l=n&PARTIAL_COMPARE_FLAG;if(i||(i=setToArray),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;n|=UNORDERED_COMPARE_FLAG,o.set(e,t);var u=equalArrays(i(e),i(t),r,s,n,o);return o.delete(e),u;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}function equalObjects(e,t,a,r,s,n){var o=s&PARTIAL_COMPARE_FLAG,i=keys(e),l=i.length,c=keys(t),u=c.length;if(l!=u&&!o)return!1;for(var d=l;d--;){var _=i[d];if(!(o?_ in t:hasOwnProperty.call(t,_)))return!1}var p=n.get(e);if(p&&n.get(t))return p==t;var h=!0;n.set(e,t),n.set(t,e);for(var E=o;++d<l;){_=i[d];var R=e[_],f=t[_];if(r)var T=o?r(f,R,_,t,e,n):r(R,f,_,e,t,n);if(!(void 0===T?R===f||a(R,f,r,s,n):T)){h=!1;break}E||(E="constructor"==_)}if(h&&!E){var S=e.constructor,A=t.constructor;S!=A&&"constructor"in e&&"constructor"in t&&!("function"==typeof S&&S instanceof S&&"function"==typeof A&&A instanceof A)&&(h=!1)}return n.delete(e),n.delete(t),h}function getMapData(e,t){var a=e.__data__;return isKeyable(t)?a["string"==typeof t?"string":"hash"]:a.map}function getMatchData(e){for(var t=keys(e),a=t.length;a--;){var r=t[a],s=e[r];t[a]=[r,s,isStrictComparable(s)]}return t}function getNative(e,t){var a=getValue(e,t);return baseIsNative(a)?a:void 0}function hasPath(e,t,a){t=isKey(t,e)?[t]:castPath(t);for(var r,s=-1,n=t.length;++s<n;){var o=toKey(t[s]);if(!(r=null!=e&&a(e,o)))break;e=e[o]}if(r)return r;var n=e?e.length:0;return!!n&&isLength(n)&&isIndex(o,n)&&(isArray(e)||isArguments(e))}function isIndex(e,t){return t=null==t?MAX_SAFE_INTEGER:t,!!t&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function isKey(e,t){if(isArray(e))return!1;var a="undefined"==typeof e?"undefined":_typeof(e);return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!isSymbol(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}function isKeyable(e){var t="undefined"==typeof e?"undefined":_typeof(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}function isPrototype(e){var t=e&&e.constructor,a="function"==typeof t&&t.prototype||objectProto;return e===a}function isStrictComparable(e){return e===e&&!isObject(e)}function matchesStrictComparable(e,t){return function(a){return null!=a&&(a[e]===t&&(void 0!==t||e in Object(a)))}}function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function orderBy(e,t,a,r){return null==e?[]:(isArray(t)||(t=null==t?[]:[t]),a=r?void 0:a,isArray(a)||(a=null==a?[]:[a]),baseOrderBy(e,t,a))}function memoize(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);var a=function a(){var r=arguments,s=t?t.apply(this,r):r[0],n=a.cache;if(n.has(s))return n.get(s);var o=e.apply(this,r);return a.cache=n.set(s,o),o};return a.cache=new(memoize.Cache||MapCache),a}function eq(e,t){return e===t||e!==e&&t!==t}function isArguments(e){return isArrayLikeObject(e)&&hasOwnProperty.call(e,"callee")&&(!propertyIsEnumerable.call(e,"callee")||objectToString.call(e)==argsTag)}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function isFunction(e){var t=isObject(e)?objectToString.call(e):"";return t==funcTag||t==genTag}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isObject(e){var t="undefined"==typeof e?"undefined":_typeof(e);return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==("undefined"==typeof e?"undefined":_typeof(e))}function isSymbol(e){return"symbol"==("undefined"==typeof e?"undefined":_typeof(e))||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toString(e){return null==e?"":baseToString(e)}function get(e,t,a){var r=null==e?void 0:baseGet(e,t);return void 0===r?a:r}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function identity(e){return e}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}var DiaryLib=window.DiaryLib||Object.create(null);DiaryLib.Models=DiaryLib.Models||Object.create(null),DiaryLib.Util=DiaryLib.Util||Object.create(null),Model.prototype={constructor:Model,reset:function(){this.isUpdating=!1,this.isResolved=!1,this.isDirty=!1}},Time.prototype.convertToReferenceInterval=function(e){var t;return t=(this.minutes/e).toFixed()*e,this.minutes>45?(this.hours+=1,this.minutes=0):this.minutes=t,this.seconds=0,this.milliseconds=0,this},Time.prototype.getOffsetFromReference=function(e){var t;if(!(e instanceof Time))throw new Error("invalid parameter");return t=this.getTotalMilliseconds()-e.getTotalMilliseconds()},Time.prototype.getTotalMilliseconds=function(){return 1e4*(360*this.hours+6*this.minutes+this.seconds)+this.milliseconds},Time.prototype.convertMillisecondsToTime=function(e){return new Time(e)},Time.prototype.isAM=function(){return this.hours<12},Time.prototype.AMPM=function(){return this.isAM()?"AM":"PM"},Time.prototype.padZeroes=function(e){return e=+e,e<10?"0"+e:e},Time.prototype.toString=function(e){var t=this.padZeroes(this.hours),a=this.padZeroes(this.minutes),r="";return e&&(t%=12,0===t&&(t=12),r=this.AMPM()),t+":"+a+r},Time.prototype.toReservationFormat=function(e){var t;return t={hh:this.padZeroes(this.hours%12),mm:this.padZeroes(this.minutes),amPM:this.AMPM()},e?t:t.hh+":"+t.mm+" "+t.amPM},Time.prototype.toHourAndMinute=function(e,t){var a;return"undefined"==typeof t&&(t=12),"undefined"==typeof e&&(e=":"),a={hh:this.padZeroes(this.hours%t),mm:this.padZeroes(this.minutes)},a.hh+e+a.mm},Time.prototype.constructor=Time,String.prototype.toTimeComponent=function(e){var t,a,r=e.indexOf(":");if(r>-1&&(t=e.substr(0,r),r<e.length&&(a=e.substr(r+1))),t&&a)return Time({hours:t,minutes:a})},Date.prototype.toComponents=function(){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{date:{day:this.getDate(),weekday:e[this.getDay()],month:this.getMonth(),monthName:t[this.getMonth()],monthNameShort:a[this.getMonth()],year:this.getFullYear(),toDateString:function(){return this.year+"-"+(this.month+1)+"-"+(this.day.length<2?"0":"")+this.day},fromDate:function(){var e=this.toLocaleDateString().replace(/\//g,"-").split("-").reverse();return e.shift()+"-"+temp.reverse().join("-")},toShortDateString:function(){return this.monthNameShort+" "+(this.day<10?"0":"")+this.day}},time:new Time({milliseconds:this.getMilliseconds(),seconds:this.getSeconds(),minutes:this.getMinutes(),hours:this.getHours()})}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},LARGE_ARRAY_SIZE=200,FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2,INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",promiseTag="[object Promise]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var freeGlobal="object"==("undefined"==typeof global?"undefined":_typeof(global))&&global&&global.Object===Object&&global,freeSelf="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports="object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_Symbol=root.Symbol,Uint8Array=root.Uint8Array,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,nativeKeys=overArg(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=_Symbol?_Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var baseEach=createBaseEach(baseForOwn),baseFor=createBaseFor(),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(e){var t=objectToString.call(e),a=t==objectTag?e.constructor:void 0,r=a?toSource(a):void 0;if(r)switch(r){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return t});var stringToPath=memoize(function(e){e=toString(e);var t=[];return reLeadingDot.test(e)&&t.push(""),e.replace(rePropName,function(e,a,r,s){t.push(r?s.replace(reEscapeChar,"$1"):a||e)}),t});memoize.Cache=MapCache;var isArray=Array.isArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;angular.module("sntRover").service("RVCustomExportSrv",["$q","sntBaseWebSrv","RVreportsSubSrv",function(e,t,a){var r=this,s={BOOKING_ORIGIN_CODE:"booking_origin_code",MARKET_CODE:"market_code",RESERVATION_STATUS:"reservation_status",ROOM_NO:"room_no",ROOM_TYPE:"room_type",SEGMENT_CODE:"segment_code",SOURCE_CODE:"source_code",ARRIVAL_ROOM_TYPE:"arrival_room_type",DEPARTURE_ROOM_TYPE:"departure_room_type",ARRIVAL_RATE_CODE:"arrival_rate_code",CI_AGENT:"ci_agent",CO_AGENT:"co_agent",CI_APPLICATION:"ci_application",CO_APPLICATION:"co_application",NATIONALITY:"nationality",COUNTRY:"country",LANGUAGE:"language",VIP:"vip",PRIMARY_PAYMENT_METHOD:"primary_payment_method",MEMBERSHIP:"membership",MEMBERSHIP_LEVEL:"membership_level",ORIGIN_CODE:"origin_code"},n={timePeriods:[],dataSpaceColumns:{},deliveryTypes:[],exportFrequencies:[],DROP_BOX:[],GOOGLE_DRIVE:[]},o=["DATE","DATE_RANGE","CURRENT_YEAR","NEXT_365_DAYS"],i=this;this.getAvailableDataSpaces=function(){var a=e.defer(),r="api/reports?show_only_redshift_reports=true";return t.getJSON(r).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},this.getScheduledCustomExports=function(){var a=e.defer(),r="admin/export_schedules.json?show_only_redshift_reports=true",s={page:1,per_page:9999};return t.getJSON(r,s).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},this.getCustomExportsAndScheduleFrequencies=function(){var t=e.defer(),a={};return a.customExports=r.getScheduledCustomExports(),a.scheduleFrequencies=r.getExportFrequencies(),e.all(a).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.getRequestData=function(t){var s={},n=e.defer();return s.columns=r.getDataSpaceColumns(t),s.exportFormats=r.getExportFormats(t),s.deliveryTypes=r.getExportDeliveryTypes(t),s.durations=r.getExportDurations(t),s.dropBoxAccounts=r.getCloudDrives("DROP_BOX"),s.googleDriveAccounts=r.getCloudDrives("GOOGLE_DRIVE"),s.ftpServerList=a.fetchFtpServers(),e.all(s).then(function(e){n.resolve(e)},function(){n.resolve([])}),n.promise},this.getExportFormats=function(){var a=e.defer(),r="admin/export_formats.json";return t.getJSON(r).then(function(e){var t=_.filter(e.results,function(e){return"CSV"===e.value||"XML"===e.value||"JSON"===e.value});a.resolve(t)},function(e){a.reject(e)}),a.promise},this.getExportDeliveryTypes=function(){var a=e.defer(),r="admin/export_delivery_types.json";return n.deliveryTypes.length>0?a.resolve(n.deliveryTypes):t.getJSON(r).then(function(e){n.deliveryTypes=e.results,a.resolve(n.deliveryTypes)},function(e){a.reject(e)}),a.promise},this.getExportFrequencies=function(){var a=e.defer(),r="admin/export_frequencies.json";return n.exportFrequencies.length>0?a.resolve(n.exportFrequencies):t.getJSON(r).then(function(e){n.exportFrequencies=e.results,a.resolve(n.exportFrequencies)},function(e){a.reject(e)}),a.promise},this.getCloudDrives=function(a){var r=e.defer(),s="/api/cloud_drives?cloud_drive_type="+a;return n[a].length>0?r.resolve(n[a]):t.getJSON(s).then(function(e){n[a]=e.results,r.resolve(n[a])},function(e){r.reject(e)}),r.promise},this.getDataSpaceColumns=function(a){var r=e.defer(),s="api/reports/"+a.reportId+"/list_data_space_columns";return n.dataSpaceColumns[a.reportId]?r.resolve(n.dataSpaceColumns[a.reportId]):t.getJSON(s).then(function(e){e=e.map(function(e){return{name:e,selected:!1}}),n.dataSpaceColumns[a.reportId]=e,r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getExportDurations=function(){var a=e.defer(),r="admin/export_time_periods.json";return n.timePeriods.length>0?a.resolve(n.timePeriods):t.getJSON(r).then(function(e){var t=_.reject(e.results,function(e){return o.indexOf(e.value)>=0});n.timePeriods=t,a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getRoomNos=function(){var a=e.defer(),r="house/search.json",s={all_employees_selected:!0,page:1,per_page:9999};return t.postJSON(r,s).then(function(e){var t=_.map(e.data.rooms,function(e){return{id:e.id,name:e.room_no}});a.resolve(angular.copy(t))},function(e){a.resolve(e)}),a.promise},this.getGuestLanguages=function(){var a=e.defer(),r="api/guest_languages";return t.getJSON(r).then(function(e){var t=_.map(e.languages,function(e){return{id:e.id,value:e.language}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getPaymentMethods=function(){var a=e.defer(),r="staff/payments/addNewPayment.json";return t.getJSON(r).then(function(e){a.resolve(e.data)},function(e){a.resolve(e)}),a.promise},this.getCountries=function(){var a=e.defer(),r="ui/country_list";return t.getJSON(r).then(function(e){var t=_.map(e,function(e){return{id:e.id,value:e.value,code:e.code}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getCICOAgents=function(){var a=e.defer(),r="admin/users.json?isAdminSnt=false&sort_dir=true&sort_field=name";return t.getJSON(r).then(function(e){var t=_.map(e.users,function(e){return{id:e.id,full_name:e.full_name,email:e.email}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getRateList=function(){var a=e.defer(),r="api/rates/list";return t.postJSON(r).then(function(e){var t=_.map(e.rates,function(e){return{code:e.rate_code,name:e.rate_name}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getCICOApplications=function(){var a=e.defer(),r="api/reference_values?type=application";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.resolve(e)}),a.promise},this.getHLP=function(){var a=e.defer(),r="staff/user_memberships/get_available_hlps.json";return t.getJSON(r).then(function(e){var t=_.map(e.data,function(e){return{desc:e.hl_description,value:e.hl_value}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getFFP=function(){var a=e.defer(),r="staff/user_memberships/get_available_ffps.json";return t.getJSON(r).then(function(e){var t=_.map(e.data,function(e){return{desc:e.ff_description,value:e.ff_value}});a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getHLPLevels=function(){var a=e.defer(),r="staff/user_memberships/get_available_hlps.json";return t.getJSON(r).then(function(e){var t=[];_.each(e.data,function(e){_.each(e.levels,function(e){t.push({value:e.membership_level})})}),a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getFFPLevels=function(){var a=e.defer(),r="staff/user_memberships/get_available_ffps.json";return t.getJSON(r).then(function(e){var t=[];_.each(e.data,function(e){_.each(e.levels,function(e){t.push({value:e.membership_level})})}),a.resolve(t)},function(e){a.resolve(e)}),a.promise},this.getMemberShips=function(){var t=e.defer(),a=[];return a.push(r.getHLP()),a.push(r.getFFP()),e.all(a).then(function(e){t.resolve(e[0].concat(e[1]))}),t.promise},this.getMemberShipLevels=function(){var t=e.defer(),a=[];return a.push(r.getHLPLevels()),a.push(r.getFFPLevels()),e.all(a).then(function(e){var a=e[0].concat(e[1]);a=_.uniq(a,function(e){return e.value}),t.resolve(a)}),t.promise},this.getReferenceValuesByType=function(a){var r=e.defer(),s="api/reference_values?type="+a;return t.getJSON(s).then(function(e){r.resolve(e)},function(e){r.resolve(e)}),r.promise},this.getReservationTypes=function(){var a=e.defer(),r="api/reservation_types";return t.getJSON(r).then(function(e){a.resolve(e.reservation_types)},function(e){a.resolve(e)}),a.promise},this.processFilterSelections=function(t){var r=[],n=e.defer();return _.each(t,function(e,t){switch(t){case s.BOOKING_ORIGIN_CODE:case s.ORIGIN_CODE:r.push(a.fetchBookingOrigins());break;case s.MARKET_CODE:r.push(a.fetchMarkets());break;case s.RESERVATION_STATUS:r.push(i.getReferenceValuesByType("reservation_status"));break;case s.ROOM_NO:r.push(i.getRoomNos());break;case s.ROOM_TYPE:case s.ARRIVAL_ROOM_TYPE:case s.DEPARTURE_ROOM_TYPE:r.push(a.fetchRoomTypeList());break;case s.SEGMENT_CODE:r.push(a.fetchSegments());break;case s.SOURCE_CODE:r.push(a.fetchSources());break;case s.ARRIVAL_RATE_CODE:r.push(i.getRateList());break;case s.CI_AGENT:case s.CO_AGENT:r.push(i.getCICOAgents());break;case s.CI_APPLICATION:case s.CO_APPLICATION:r.push(i.getCICOApplications());break;case s.COUNTRY:case s.NATIONALITY:r.push(i.getCountries());break;case s.LANGUAGE:r.push(i.getGuestLanguages());break;case s.PRIMARY_PAYMENT_METHOD:r.push(i.getPaymentMethods());break;case s.MEMBERSHIP:r.push(i.getMemberShips());break;case s.MEMBERSHIP_LEVEL:r.push(i.getMemberShipLevels())}}),e.all(r).then(function(e){n.resolve(e)},function(){n.resolve([])}),n.promise},this.getGroupsList=function(){var a=e.defer(),r="api/groups/group_names_list";return t.getJSON(r).then(function(e){a.resolve(e.groups)},function(e){a.resolve(e)}),a.promise}}]),angular.module("reportsModule").factory("RVCustomExportsUtilFac",["$rootScope","RVCustomExportFilterParamsConst","RVreportsSubSrv","$q","RVCustomExportSrv",function(e,t,a,r,s){var n=[{label:"Yes",value:!0},{label:"No",value:!1}],o=[{label:"D",value:"D"},{label:"N",value:"N"}],i=[{label:"Greater than",value:"greater_than"},{label:"Equal to",value:"equal_to"},{label:"Less than",value:"less_than"}],l={"text-transform":"none"},c=[{label:"Has values",value:"is not null"}],u=function(e){var t={};return _.each(e,function(e){t[e.filter_type]||(t[e.filter_type]=[]),t[e.filter_type].push({label:e.description,value:e.value})}),t},d=function(e,t,a){return a=a||"value",t&&0!==t.length?(_.each(e,function(e){t.indexOf(e[a])!==-1&&(e.selected=!0)}),e):e},p=function(e,t,r,s,n){a.fetchBookingOrigins(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,n),e.options={selectAll:!t||a.length===t.length,hasSearch:!1,key:s,value_key:n},e.isMultiSelect=!0,r.resolve(e)})},h=function(e,t,r,s,n){a.fetchMarkets(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,n),e.options={selectAll:!t||a.length===t.length,hasSearch:!1,key:s,value_key:n},e.isMultiSelect=!0,r.resolve(e)})},E=function(e,t,a){s.getReferenceValuesByType("reservation_status").then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"value",defaultValue:"Select Status",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},R=function(e,t,r,s,n){a.fetchSources(!0).then(function(a){
e.secondLevelData=d(angular.copy(a),t,n),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:s,value_key:n},e.isMultiSelect=!0,r.resolve(e)})},f=function(e,t,r,s,n){a.fetchSegments(!0).then(function(a){e.secondLevelData=d(angular.copy(a),t,n),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:s,value_key:n},e.isMultiSelect=!0,r.resolve(e)})},T=function(e,t,r){a.fetchRoomTypeList().then(function(a){e.secondLevelData=d(angular.copy(a),t,"code"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"code"},e.isMultiSelect=!0,r.resolve(e)})},S=function(e,t,a,r){t.secondLevelData=angular.copy(e),t.hasDualState=!0,t.selectedSecondLevel=a||"",r.resolve(t)},A=function(e,t,a){s.getRoomNos().then(function(r){e.secondLevelData=d(angular.copy(r),t,"name"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,a.resolve(e)})},m=function(e,t,a){s.getRateList().then(function(r){e.secondLevelData=d(angular.copy(r),t,"code"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"name",value_key:"code"},e.isMultiSelect=!0,a.resolve(e)})},O=function(e,t,a){s.getCICOAgents().then(function(r){e.secondLevelData=d(angular.copy(r),t,"full_name"),e.options={hasSearch:!0,selectAll:!t||r.length===t.length,key:"full_name",value_key:"full_name",altKey:"email"},e.isMultiSelect=!0,a.resolve(e)})},D=function(e,t,a){s.getCICOApplications().then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"value",value_key:"value",altKey:"description"},e.isMultiSelect=!0,a.resolve(e)})},y=function(e,t,a,r,n){s.getCountries().then(function(s){e.secondLevelData=d(angular.copy(s),t,n),e.options={hasSearch:!0,selectAll:!t||s.length===t.length,key:r,value_key:n},e.isMultiSelect=!0,a.resolve(e)})},v=function(e,t,a){s.getGuestLanguages().then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!0,selectAll:!t||r.length===t.length,key:"value",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},g=function(e,t,a){s.getPaymentMethods().then(function(r){e.secondLevelData=d(angular.copy(r),t,"description"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"description",value_key:"description"},e.isMultiSelect=!0,a.resolve(e)})},C=function(e,t,a){s.getMemberShips().then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"desc",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},N=function(e,t,a){s.getMemberShipLevels().then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"value",value_key:"value"},e.isMultiSelect=!0,e.entryStyle=l,a.resolve(e)})},P=function(e,t,r){a.fetchChargeNAddonGroups().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,r.resolve(e)})},L=function(e,t,r){a.fetchChargeCodes().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,r.resolve(e)})},I=function(e,t,r){a.fetchChargeCodes().then(function(a){e.secondLevelData=d(angular.copy(a),t,"description"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"description",value_key:"description"},e.isMultiSelect=!0,r.resolve(e)})},U=function(e,t,a){s.getReferenceValuesByType("charge_code_type").then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"description",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},M=function(e,t,r){a.fetchHoldStatus().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,r.resolve(e)})},b=function(e,t,a){s.getReservationTypes().then(function(r){e.secondLevelData=d(angular.copy(r),t,"value"),e.options={hasSearch:!1,selectAll:!t||r.length===t.length,key:"name",value_key:"value"},e.isMultiSelect=!0,a.resolve(e)})},F=function(e,t,a){s.getGroupsList().then(function(r){e.secondLevelData=d(angular.copy(r),t,"id"),e.options={hasSearch:!0,selectAll:!t||r.length===t.length,key:"name",value_key:"id"},e.isMultiSelect=!0,a.resolve(e)})},w=function(e,t,a,r){t.secondLevelData=d(angular.copy(e),a,"value"),t.options={hasSearch:!1,selectAll:!a||n.length===a.length,key:"label",value_key:"value"},t.isMultiSelect=!0,r.resolve(t)},G=function(e,t,r){a.fetchExternalReferenceList().then(function(a){e.secondLevelData=d(angular.copy(a),t,"name"),e.options={hasSearch:!1,selectAll:!t||a.length===t.length,key:"name",value_key:"name"},e.isMultiSelect=!0,r.resolve(e)})},Y=function(e,a,s){var i=r.defer();switch(e){case t.BOOKING_ORIGIN_CODE:case t.ORIGIN_CODE:p(a,s,i,"name","value");break;case t.MARKET_CODE:h(a,s,i,"name","value");break;case t.RESERVATION_STATUS:E(a,s,i);break;case t.SOURCE_CODE:R(a,s,i,"name","value");break;case t.SEGMENT_CODE:f(a,s,i,"name","value");break;case t.ROOM_TYPE:case t.ARRIVAL_ROOM_TYPE:case t.DEPARTURE_ROOM_TYPE:T(a,s,i);break;case t.ACTIVE:case t.VIP:case t.POST_STAY:case t.PRE_STAY:case t.TAX_EXEMPT:case t.GLOBAL:case t.IS_FLAGGED:S(n,a,s,i);break;case t.ROOM_NO:A(a,s,i);break;case t.ARRIVAL_RATE_CODE:case t.RATE_CODE:m(a,s,i);break;case t.CI_AGENT:case t.CO_AGENT:case t.USER_NAME:O(a,s,i);break;case t.CI_APPLICATION:case t.CO_APPLICATION:D(a,s,i);break;case t.COUNTRY:y(a,s,i,"value","value");break;case t.LANGUAGE:v(a,s,i);break;case t.PRIMARY_PAYMENT_METHOD:g(a,s,i);break;case t.MEMBERSHIP:C(a,s,i);break;case t.MEMBERSHIP_LEVEL:N(a,s,i);break;case t.STAY_TYPE:S(o,a,s,i);break;case t.CHARGE_GROUP:P(a,s,i);break;case t.CHARGE_CODE:L(a,s,i);break;case t.CHARGE_CODE_DESC:I(a,s,i);break;case t.ORIGIN:p(a,s,i,"name","name");break;case t.MARKET:h(a,s,i,"name","name");break;case t.SOURCE:R(a,s,i,"name","name");break;case t.SEGMENT:f(a,s,i,"name","name");break;case t.NATIONALITY:y(a,s,i,"value","code");break;case t.CHARGE_TYPE:U(a,s,i);break;case t.HOLD_STATUS:M(a,s,i);break;case t.RESERVATION_TYPE:b(a,s,i);break;case t.GROUP_NAME:F(a,s,i);break;case t.DO_NOT_MOVE:w(n,a,s,i);break;case t.EXTERNAL_SYSTEM:G(a,s,i)}return i.promise},k=function(e,t,a,r,s){var n=_.filter(a,function(t){return t.selectedFirstLevel===e}),o=_.pluck(n,"selectedSecondLevel"),i=_.filter(H(),function(e){return o.indexOf(e.value)===-1});t.secondLevelData=i,t.selectedSecondLevel=r,t.rangeValue=s},V=function(e,t,a,r){var s=_.filter(a,function(t){return t.selectedFirstLevel===e}),n=_.pluck(s,"selectedSecondLevel"),o=_.filter(c,function(e){return n.indexOf(e.value)===-1});t.secondLevelData=o,t.selectedSecondLevel=r},H=function(){return i},x=function(){return c},B={processFilters:u,populateOptions:Y,getRangeOperators:H,populateRangeOperators:k,populateGeneralOperators:V,getGeneralOperators:x};return B}]),angular.module("sntRover").service("RVReportsInboxSrv",["$q","rvBaseWebSrvV2","RVReportApplyIconClass","RVReportApplyFlags","RVReportSetupDates","RVReportParamsConst","RVReportInboxFilterLabelConst","RVReservationBaseSearchSrv","RVreportsSubSrv","$filter","$rootScope","RVReportNamesConst","RVReportUtilsFac",function(e,t,a,r,s,n,o,i,l,c,u,d,p){var h=this;this.PER_PAGE=50;var E=[{id:-2,status:"DUE IN",selected:!0},{id:-1,status:"DUE OUT",selected:!0},{id:1,status:"RESERVED",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],R={is_active:!0,name:"UNDEFINED",value:-1};this.fetchReportInbox=function(a){var r=e.defer(),s="/api/generated_reports";return _.isEmpty(a.generated_date)&&(a.generated_date=c("date")(u.serverDate,"yyyy-MM-dd")),t.getJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.processReports=function(e){for(var t=0,r=e.length;t<r;t++)a.init(e[t])},this.fillReportDates=function(e){var t="N/A",a="N/A",r=e.filters;r[n.FROM_DATE]?t=r[n.FROM_DATE]:r[n.CANCEL_FROM_DATE]?t=r[n.CANCEL_FROM_DATE]:r[n.ARRIVAL_FROM_DATE]?t=r[n.ARRIVAL_FROM_DATE]:r[n.GROUP_START_DATE]?t=r[n.GROUP_START_DATE]:r[n.DEPOSIT_FROM_DATE]?t=r[n.DEPOSIT_FROM_DATE]:r[n.PAID_FROM_DATE]?t=r[n.PAID_FROM_DATE]:r[n.CREATE_FROM_DATE]?t=r[n.CREATE_FROM_DATE]:r[n.ADJUSTMENT_FROM_DATE]?t=r[n.ADJUSTMENT_FROM_DATE]:r[n.SINGLE_DATE]&&(t=r[n.SINGLE_DATE]),r[n.TO_DATE]?a=r[n.TO_DATE]:r[n.CANCEL_TO_DATE]?a=r[n.CANCEL_TO_DATE]:r[n.ARRIVAL_TO_DATE]?a=r[n.ARRIVAL_TO_DATE]:r[n.GROUP_END_DATE]?a=r[n.GROUP_END_DATE]:r[n.DEPOSIT_TO_DATE]?a=r[n.DEPOSIT_TO_DATE]:r[n.PAID_TO_DATE]?a=r[n.PAID_TO_DATE]:r[n.CREATE_TO_DATE]?a=r[n.CREATE_TO_DATE]:r[n.ADJUSTMENT_TO_DATE]?a=r[n.ADJUSTMENT_TO_DATE]:r[n.SINGLE_DATE]&&(a=r[n.SINGLE_DATE]),e.fromDate="N/A"!==t?c("date")(tzIndependentDate(t),u.dateFormat):t,e.toDate="N/A"!==a?c("date")(tzIndependentDate(a),u.dateFormat):a},this.filterArrayValues=function(e,t,a){var r=-1,s=_.filter(e,function(e){return r=_.findIndex(t,function(t){return t==e[a]}),r!==-1});return s},this.processRateIds=function(e,t,a,r){_.isArray(e)||(e=[e]);var s={ids:e};a.push(l.fetchRateDetailsByIds(s).then(function(e){r[o[t]]=_.pluck(e,"rate_name").join(", ")}))},this.fillDepartmentNames=function(e,t,a,r){a.push(l.fetchDepartments().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.processMarkets=function(e,t,a,r){a.push(l.fetchMarkets().then(function(e){r[o[t]]=_.pluck(e,"name").join(", ")}))},this.processOptions=function(e,t,a){a[o.OPTIONS]||(a[o.OPTIONS]=[]),e&&a[o.OPTIONS].push(o[t])},this.processDisplayFilter=function(e,t,a){a[o.DISPLAY]||(a[o.DISPLAY]=[]),e&&a[o.DISPLAY].push(o[t])},this.fillTaCCDetails=function(e,t,a,r){a.push(l.fetchAccountsById(e).then(function(e){r[o[t]]=e.account_details.account_name}))},this.processAgingBalance=function(e,t,a){var r=[];_.each(e,function(e){r.push(o[e])}),a[o[t]]=r.join(", ")},this.processArrayValuesWithNoFormating=function(e,t,a){a[o[t]]=e.join(", ")},this.fillOriginInfo=function(e,t,a,r){a.push(l.fetchOrigins().then(function(a){var s=_.filter(a,function(t){return _.contains(e,t.value)});r[o[t]]=_.pluck(s,"description").join(", ")}))},this.processOriginUrls=function(e,t,a,r){a.push(l.fetchURLs().then(function(a){var s=_.filter(a,function(t){return _.contains(e,t.id)});r[o[t]]=_.pluck(s,"name").join(", ")}))},this.fillAddonGroups=function(e,t,a,r){a.push(l.fetchChargeNAddonGroups().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillAddons=function(e,t,a,r){var s={addon_ids:e};a.push(l.fetchAddonsByIds(s).then(function(e){r[o[t]]=e.join(", ")}))},this.fillReservationStatus=function(e,t,a,r,s){s.name===d.DEPOSIT_REPORT||s.name===d.GUEST_BALANCE_REPORT?r[o[t]]=_.pluck(h.filterArrayValues(E,e,"id"),"status").join(", "):a.push(l.fetchReservationStatus().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"status").join(", ")}))},this.fillOptionsWithoutFormating=function(e,t,a){a[o[t]]=e},this.fillCompanyTaGroupDetails=function(e,t,a,r){var s=e.split("_");2===s.length&&"account"===s[0]?a.push(l.fetchAccountsById(s[1]).then(function(e){r[o[t]]=e.account_details.account_name})):2===s.length&&"group"===s[0]&&a.push(l.fetchGroupById(s[1]).then(function(e){r[o[t]]=e.group_name}))},this.fillGroupCodes=function(e,t,a,r){var s=[];_.each(e,function(e){a.push(l.fetchGroupById(parseInt(e)).then(function(e){s.push(e.group_name),r[o[t]]=s.join(", ")}))})},this.fillCompanyTaDetails=function(e,t,a,r){r[o["COMPANY/TA"]]||(r[o["COMPANY/TA"]]=[]),_.each(e,function(e,t){a.push(l.fetchAccountsById(e).then(function(e){r[o["COMPANY/TA"]].push(e.account_details.account_name)}))})},this.fillCheckedInCheckedOut=function(e,t,a){a[o["CHECK IN/ CHECK OUT"]]||(a[o["CHECK IN/ CHECK OUT"]]=[]),e&&a[o["CHECK IN/ CHECK OUT"]].push(o[t])},this.fillShowFields=function(e,t,a){a[o.SHOW]||(a[o.SHOW]=[]),e&&a[o.SHOW].push(o[t])},this.fillValueWithoutFormating=function(e,t,a){a[o[t]]=e},this.fillRateTypes=function(e,t,a,r){a.push(l.fetchRateTypes().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a.results,e,"id"),"name").join(", ")}))},this.fillChargeCodes=function(e,t,a,r){a.push(l.fetchChargeCodes().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillChargeGroups=function(e,t,a,r){a.push(l.fetchChargeNAddonGroups().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"description").join(", ")}))},this.fillGuestAccount=function(e,t,a){a[o["GUEST/ACCOUNT"]]||(a[o["GUEST/ACCOUNT"]]=[]),e&&a[o["GUEST/ACCOUNT"]].push(o[t])},this.fillUserInfo=function(e,t,a,r){a.push(l.fetchActiveUsers().then(function(a){var s=h.filterArrayValues(a,e,"id");s=_.map(s,function(e){return e.full_name||e.email}),r[o[t]]=s.join(", ")}))},this.fillBookingOrigins=function(e,t,a,r){a.push(l.fetchBookingOrigins().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(R),r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillMarkets=function(e,t,a,r){a.push(l.fetchMarkets().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(R),r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSources=function(e,t,a,r){a.push(l.fetchSources().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(R),r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSegments=function(e,t,a,r){a.push(l.fetchSegments().then(function(a){var s=_.find(a,{name:"UNDEFINED"});s||a.push(R),r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillHoldStatuses=function(e,t,a,r){a.push(l.fetchHoldStatus().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"name").join(", ")}))},this.fillGroupInfo=function(e,t,a,r){a.push(l.fetchGroupById(e).then(function(e){r[o[t]]=e.group_name}))},this.fillRoomTypes=function(e,t,a,r){var s={"ids[]":e};a.push(h.fetchRoomtypesByIds(s).then(function(e){r[o[t]]=_.pluck(e,"name").join(", ")}))},this.fillFloors=function(e,t,a,r){a.push(l.fetchFloors().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"floor_number").join(", ")}))},this.fillTravelAgentInfo=function(e,t,a,r){var s={"ids[]":e};a.push(l.fetchTravelAgentsByIds(s).then(function(e){r[o[t]]=_.pluck(e,"account_name").join(", ")}))},this.fillVatInfo=function(e,t,a){a[o["COMPANY/TRAVEL_AGENT"]]||(a[o["COMPANY/TRAVEL_AGENT"]]=[]),e&&a[o["COMPANY/TRAVEL_AGENT"]].push(o[t])},this.fillCampaignTypesInfo=function(e,t,a,r){a.push(l.fetchCampaignTypes().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"value"),"name").join(", ")}))},this.fillSortDir=function(e,t,a){var r="ASC";e||(r="DESC"),a[o[t]]=r},this.fillSortField=function(e,t,a,r){var s="";if(r.filters.rawData&&_.isArray(r.filters.rawData.sortOptions)){var n=_.find(r.filters.rawData.sortOptions,{value:e});s=n.description}else s=e.replace(/_/g," ");a[o[t]]=s},this.getDateRangeLabelName=function(e,t){var a=o[e];if(e===n.FROM_DATE)switch(t){case d.BOOKING_SOURCE_MARKET_REPORT:a=o.BOOKED_DATE_FROM;break;case d.CANCELLATION_NO_SHOW:a=o.arrival_from_date}else if(e===n.TO_DATE)switch(t){case d.BOOKING_SOURCE_MARKET_REPORT:a=o.BOOKED_DATE_TO;break;case d.CANCELLATION_NO_SHOW:a=o.arrival_to_date}else if(e===n.DEPOSIT_FROM_DATE)switch(t){case d.DEPOSIT_REPORT:a=o.DEPOSIT_DUE_FROM_DATE}else if(e===n.DEPOSIT_TO_DATE)switch(t){case d.DEPOSIT_REPORT:a=o.DEPOSIT_DUE_TO_DATE}return a},h.processDueOut=function(e,t,a,r){if(e){var s=o[t];r.name===d.CREDIT_CHECK_REPORT?a[o.SHOW]?a[o.SHOW].push(s):a[o.SHOW]=[s]:a[o.OPTIONS]?a[o.OPTIONS].push(s):a[o.OPTIONS]=[s]}},this.fillRestrictions=function(e,t,a,r){a.push(l.fetchRestrictionList().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"description").join(",")}))},this.fillGroupByInfo=function(e,t,a){e&&(a[o.GROUP_BY]=o[t])},this.fillAccountInfo=function(e,t,a,r){r[o[t]]||(r[o[t]]=[]),a.push(l.fetchAccounts().then(function(a){r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"account_name").join(",")}))},this.fillSelectedCountries=function(e,t,a,r){r[o[t]]||(r[o[t]]=[]),a.push(l.fetchCountries().then(function(a){e.length===a.length+1?r[o[t]]="All Countries":r[o[t]]=_.pluck(h.filterArrayValues(a,e,"id"),"value").join(",")}))},this.fillShowUpsellsOnly=function(e,t,a){e&&(a[o[t]]="Yes")},this.processFilters=function(t){var a={},r=[],s=e.defer();return _.each(t.filters,function(e,s){switch(s){case n.FROM_DATE:case n.TO_DATE:case n.DEPOSIT_FROM_DATE:case n.DEPOSIT_TO_DATE:a[h.getDateRangeLabelName(s,t.name)]=e?c("date")(tzIndependentDate(e),u.dateFormat):e;break;case n.CANCEL_FROM_DATE:case n.CANCEL_TO_DATE:case n.ARRIVAL_FROM_DATE:case n.ARRIVAL_TO_DATE:case n.GROUP_START_DATE:case n.GROUP_END_DATE:case n.PAID_FROM_DATE:case n.PAID_TO_DATE:case n.CREATE_FROM_DATE:case n.CREATE_TO_DATE:case n.ADJUSTMENT_FROM_DATE:case n.ADJUSTMENT_TO_DATE:case n.SINGLE_DATE:a[o[s]]=e?c("date")(tzIndependentDate(e),u.dateFormat):e;break;case n.FROM_TIME:case n.TO_TIME:case n.INCLUDE_DAYUSE:a[o[s]]=e;break;case n.RATE_IDS:case n.RATE_ID:h.processRateIds(e,s,r,a);break;case n.ASSIGNED_DEPARTMENTS:h.fillDepartmentNames(e,s,r,a);break;case n.CHOOSE_MARKET:h.processMarkets(e,s,r,a);break;case n.DEPOSIT_DUE:case n.DEPOSIT_PAID:case n.DEPOSIT_PAST:case n.INCLUDE_CANCELLED:case n.INCLUDE_CANCELED:case n.INCLUDE_NO_SHOW:case n.INCLUDE_TAX:case n.DUE_IN_ARRIVALS:case n.INCLUDE_ACTIONS:case n.INCLUDE_LEDGER_DATA:case n.INCLUDE_GUEST_NOTES:case n.INCLUDE_RESERVATION_NOTES:case n.SHOW_GUESTS:case n.VIP_ONLY:case n.EXCLUDE_NON_GTD:case n.RESTRICTED_POST_ONLY:case n.ROVER:case n.ZEST:case n.ZEST_WEB:case n.INCLUDE_LAST_YEAR:case n.INCLUDE_VARIANCE:case n.INCLUDE_BOTH:case n.INCLUDE_NEW:case n.SHOW_RATE_ADJUSTMENTS_ONLY:case n.NO_NATIONALITY:case n.DUE_OUT_DEPARTURES:case n.HAS_VEHICLE_REG_NO:case n.SHOW_PHONE_NUMBER:h.processOptions(e,s,a);break;case n.SHOW_DELETED_CHARGES:case n.SHOW_ADJUSTMENTS:case n.INCLUDE_MARKET:case n.INCLUDE_ORIGIN:case n.INCLUDE_SEGMENT:case n.INCLUDE_SOURCE:h.processDisplayFilter(e,s,a);break;case n.ACCOUNT_SEARCH:h.fillAccountInfo(e,s,r,a);break;case n.AGING_BALANCE:h.processAgingBalance(e,s,a);break;case n.COMPLETION_STATUS:case n.SHOW_ACTIONABLES:case n.INCLUDE_GUARANTEE_TYPE:h.processArrayValuesWithNoFormating(e,s,a);break;case n.ORIGIN_VALUES:h.fillOriginInfo(e,s,r,a);break;case n.ORIGIN_URLS:h.processOriginUrls(e,s,r,a);break;case n.ADDONS_GROUPS_IDS:h.fillAddonGroups(e,s,r,a);break;case n.ADDONS_IDS:h.fillAddons(e,s,r,a);break;case n.RESERVATION_STATUS:h.fillReservationStatus(e,s,r,a,t);break;case n.ADDON_GROUP_BY:h.fillOptionsWithoutFormating(e,s,a);break;case n.INCLUDE_COMPANYCARD_TA_GROUP:case n.GROUP_COMPANY_TA_CARD:h.fillCompanyTaGroupDetails(e,s,r,a);break;case n.INCLUDE_COMPANYCARD_TA:case n.TA_CC_CARD:h.fillCompanyTaDetails(e,s,r,a,t);break;case n.GROUP_CODE:h.fillGroupCodes(e,s,r,a,t);break;case n.CHECKED_IN:case n.CHECKED_OUT:h.fillCheckedInCheckedOut(e,s,a);break;case n.SHOW_TRAVEL_AGENT:case n.SHOW_COMPANY:case n.INCLUDE_INHOUSE:case n.OOO:case n.OOS:case n.EXCEEDED_ONLY:h.fillShowFields(e,s,a);break;case n.MIN_REVENUE:case n.MIN_NIGHTS:case n.MIN_NO_OF_DAYS_NOT_OCCUPIED:case n.VAT_YEAR:h.fillValueWithoutFormating(e,s,a);break;case n.RATE_TYPE_IDS:h.fillRateTypes(e,s,r,a);break;case n.CHARGE_CODE_IDS:h.fillChargeCodes(e,s,r,a);break;case n.CHARGE_GROUP_IDS:h.fillChargeGroups(e,s,r,a);break;case n.ACCOUNT:case n.GUEST:h.fillGuestAccount(e,s,a);break;case n.USER_IDS:h.fillUserInfo(e,s,r,a);break;case n.BOOKING_ORIGIN_IDS:h.fillBookingOrigins(e,s,r,a);break;case n.MARKET_IDS:h.fillMarkets(e,s,r,a);break;case n.SOURCE_IDS:h.fillSources(e,s,r,a);break;case n.HOLD_STATUS_IDS:h.fillHoldStatuses(e,s,r,a);break;case n.INCLUDE_GROUP:h.fillGroupInfo(e,s,r,a);break;case n.ROOM_TYPE_IDS:h.fillRoomTypes(e,s,r,a);break;case n.FLOOR:h.fillFloors(e,s,r,a);break;case n.TRAVEL_AGENTS:h.fillTravelAgentInfo(e,s,r,a);break;case n.WITH_VAT_NUMBER:case n.WITHOUT_VAT_NUMBER:h.fillVatInfo(e,s,a);break;case n.CAMPAIGN_TYPES:h.fillCampaignTypesInfo(e,s,r,a);break;case n.SORT_DIR:h.fillSortDir(e,s,a);break;case n.SORT_FIELD:h.fillSortField(e,s,a,t);break;case n.INCLUDE_DUE_OUT:h.processDueOut(e,s,a,t);break;case n.SEGMENT_IDS:h.fillSegments(e,s,r,a);break;case n.RESTRICTION_IDS:h.fillRestrictions(e,s,r,a);break;case n.GROUP_BY_DATE:case n.GROUP_BY_USER:case n.GROUP_BY_GROUP_NAME:h.fillGroupByInfo(e,s,a);break;case n.COUNTRY:h.fillSelectedCountries(e,s,r,a);break;case n.SHOW_UPSELL_ONLY:h.fillShowUpsellsOnly(e,s,a)}}),a[o.OPTIONS]&&a[o.OPTIONS].length>0?a[o.OPTIONS]=a[o.OPTIONS].join(","):delete a[o.OPTIONS],a[o.SHOW]&&(a[o.SHOW]=a[o.SHOW].join(",")),a[o["COMPANY/TRAVEL_AGENT"]]&&(a[o["COMPANY/TRAVEL_AGENT"]]=a[o["COMPANY/TRAVEL_AGENT"]].join(",")),a[o["GUEST/ACCOUNT"]]&&(a[o["GUEST/ACCOUNT"]]=a[o["GUEST/ACCOUNT"]].join(",")),a[o["CHECK IN/ CHECK OUT"]]&&(2===a[o["CHECK IN/ CHECK OUT"]].length?a[o["CHECK IN/ CHECK OUT"]]=o.SHOW_CHECKINS_AND_CHECKOUTS:a[o["CHECK IN/ CHECK OUT"]]=a[o["CHECK IN/ CHECK OUT"]].join(",")),a[o.DISPLAY]&&(a[o.DISPLAY]=a[o.DISPLAY].join(",")),e.all(r).then(function(){h.formatResponseOnPromiseResolve(a),s.resolve(a)},function(){s.reject(a)}),s.promise},h.formatResponseOnPromiseResolve=function(e){e[o["COMPANY/TA"]]&&(e[o["COMPANY/TA"]]=e[o["COMPANY/TA"]].join(", "))},this.formatReportList=function(e,t){var a=void 0;return _.each(e,function(r,s){a=_.find(t,{id:r.report_id}),a?(r.name=a.title,r.reportIconCls=a.reportIconCls,r.shouldShowExport=a.display_export_button,r.shouldDisplayView=a.display_show_button,r.isExpanded=!1,p.parseDatesInObject(r.filters.rawData),r.rawData=r.filters.rawData,r.appliedFilter=r.filters.appliedFilter,h.fillReportDates(r)):delete e[s]}),e},this.fetchRoomtypesByIds=function(a){var r=e.defer(),s="/api/room_types";return t.getJSON(s,a).then(function(e){r.resolve(e.results)},function(e){r.reject(e)}),r.promise}}]),angular.module("reportsModule").factory("dateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,r){var s,n,o={},i={};return a.hasDateFilter&&(a.fromDate&&(s=e.FROM_DATE,o[s]=t("date")(a.fromDate,"yyyy/MM/dd"),r&&(i.fromDate=angular.copy(a.fromDate))),a.untilDate&&(n=e.TO_DATE,o[n]=t("date")(a.untilDate,"yyyy/MM/dd"),r&&(i.toDate=angular.copy(a.untilDate)))),{params:o,filters:i}}}}]).factory("cancelDateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,r){var s,n,o={},i={};return a.hasCancelDateFilter&&(s=e.CANCEL_FROM_DATE,n=e.CANCEL_TO_DATE,o[s]=t("date")(a.fromCancelDate,"yyyy/MM/dd"),o[n]=t("date")(a.untilCancelDate,"yyyy/MM/dd"),r&&(i.cancelFromDate=angular.copy(a.fromCancelDate),i.cancelToDate=angular.copy(a.untilCancelDate))),{params:o,filters:i}}}}]).factory("arrivalDateFilterFac",["RVReportParamsConst","$filter",function(e,t){return{check:function(a,r){var s,n,o={},i={};return a.hasArrivalDateFilter&&a.fromArrivalDate&&a.untilArrivalDate&&(s=e.ARRIVAL_FROM_DATE,n=e.ARRIVAL_TO_DATE,o[s]=t("date")(a.fromArrivalDate,"yyyy/MM/dd"),o[n]=t("date")(a.untilArrivalDate,"yyyy/MM/dd"),r&&(i.arrivalFromDate=angular.copy(a.fromArrivalDate),i.arrivalToDate=angular.copy(a.untilArrivalDate))),{params:o,filters:i}}}}]).service("RVReportParamsAndFiltersSrv",["dateFilterFac",function(e){var t={},a={},r={options:[],display:[],show:[],markets:[],sources:[],origins:[],origin_urls:[],guarantees:[],chargeGroups:[],chargeCodes:[],holdStatuses:[],addonGroups:[],addons:[],reservationStatus:[],guestOrAccount:[],chargeTypes:[],users:[],campaign_types:[],floorList:[],rates:[],assigned_departments:[],completion_status:[]},s=function(e){return a=_.extend(a,e)},n=function(){return a=angular.copy(r)};return{getParams:function(){return t},getFilters:function(){return a},genParamsAndFilters:function(a,r,o,i){var i="boolean"!=typeof i||i;i&&n(),addParam({id:a.id,page:r,per_page:o});var l=e.check(a,i);addParam(l.params),s(l.filters);var c=cancelDateFilterFac.check(a,i);addParam(c.params),s(c.filters);var u=arrivalDateFilterFac.check(a,i);return addParam(u.params),s(u.filters),{params:t,filters:filters}}}}]),angular.module("reportsModule").factory("rvReportsCache",["$cacheFactory",function(e){return e("REPORTS")}]),angular.module("sntRover").service("RVreportsSrv",["$q","sntBaseWebSrv","RVreportsSubSrv","$vault","$http","RVReportApplyFlags","RVReportUtilsFac","RVReportSetupDates","RVCustomExportSrv",function(e,t,a,r,s,n,o,i,l){function c(t,s){var n={},o=[],i=function(e,t){n[e]=angular.copy(t)},l=function(e,t){n[e]=t};n.reportsResponse=angular.copy(s),o.push(a.fetchCodeSettings().then(i.bind(null,"codeSettings"),l.bind(null,"codeSettings",{}))),o.push(a.fetchActiveUsers().then(i.bind(null,"activeUserList"),l.bind(null,"activeUserList",[]))),e.all(o).then(function(){p.payloadCache=angular.copy(n),r.set(A,JSON.stringify(p.payloadCache)),t.resolve(n)},function(){t.resolve(n)})}function u(t){var r=e.defer(),s={},n=9,o=t===f.EXPORT_SCHEDULE,i=function(){var e=_.keys(s).length;e===n&&r.resolve(s)},c=function(e,t){s[e]=angular.copy(t),i()},u=function(e,t,a){s[e]=t,i()};return a.fetchSchedules(o).then(c.bind(null,"schedulesList"),u.bind(null,"schedulesList",[])),a.fetchScheduleFrequency(o).then(c.bind(null,"scheduleFrequency"),u.bind(null,"scheduleFrequency",[])),a.fetchScheduleFormat().then(c.bind(null,"scheduleFormat"),u.bind(null,"scheduleFormat",[])),a.fetchTimePeriods().then(c.bind(null,"scheduleTimePeriods"),u.bind(null,"scheduleTimePeriods",[])),a.fetchSchedulableReports(o).then(c.bind(null,"schedulableReports"),u.bind(null,"schedulableReports",[])),a.fetchDeliveryTypes().then(c.bind(null,"scheduleDeliveryTypes"),u.bind(null,"scheduleDeliveryTypes",[])),a.fetchFtpServers().then(c.bind(null,"ftpServerList"),u.bind(null,"ftpServerList",[])),l.getCloudDrives("DROP_BOX").then(c.bind(null,"dropBoxAccounts"),u.bind(null,"ftpServerList",[])),l.getCloudDrives("GOOGLE_DRIVE").then(c.bind(null,"googleDriveAccounts"),u.bind(null,"ftpServerList",[])),r.promise}var d=this,p={},h={},E={},R={},f={SCHEDULE_REPORT:"SCHEDULE_REPORT",EXPORT_SCHEDULE:"EXPORT_SCHEDULE"},T={"Nationality Statistics":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Financial Transactions":["YESTERDAY"],"Stash Rewards Membership Export":["YESTERDAY"],Reservations:["YESTERDAY"],"Synxis - Reservations":["YESTERDAY"],Rooms:["TODAY"],"Future Reservations":["TODAY"],"Synxis - Upcoming Reservation Export (Future Reservation Export)":["TODAY"],"Last Week Reservations":["LAST_SEVEN_DAYS"],"Past Reservations - Monthly":["ALL","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],Commissions:["ALL","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Journal Export":["YESTERDAY","TODAY","DATE"],"Invoice / Folio Export":["YESTERDAY","TODAY","DATE_RANGE"],"GOBD Export":["DATE_RANGE"],"GOBD Admin Charge Code Actions Export":["DATE_RANGE"],"Clairvoyix Stays Export":["YESTERDAY","ALL"],"Clairvoyix Reservations Export":["TODAY"],"Police Report Export":["TODAY"],"Switzerland Zurich Police Export":["TODAY"],"Spain Barcelona Police Export":["TODAY"],"Belgium Nationality Export":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Austria Residence Country Export":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Criterion Hospitality CC Export":["TODAY","YESTERDAY","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Nationality Export - France":["TODAY","YESTERDAY","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Guest Details by Arrival Date":["YESTERDAY","DATE"],"Cancellations by Arrival Date":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","DATE_RANGE"],"Cancellations by Cancel Date":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","DATE_RANGE"],"HESTA Switzerland":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Ad Notum - Rate of the Day Export":["TODAY"]},S={Arrival:["TODAY","TOMORROW"],Departure:["TODAY","TOMORROW"],"In-House Guests":["TODAY","TOMORROW"],Comparison:["YESTERDAY"],"Guest Balance Report":["ALL"],"Daily Production":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Daily Production by Demographics":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Daily Production by Rate":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Business on the Books":["LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_MONTH","LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","LAST_THIRTY_DAYS","NEXT_THIRTY_DAYS","CURRENT_YEAR","NEXT_365_DAYS"],"Daily Transactions":["YESTERDAY"],"Action Manager":["YESTERDAY","TODAY","TOMORROW","LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS"],"Financial Transactions - Adjustment Report":["YESTERDAY","TODAY","LAST_SEVEN_DAYS","LAST_MONTH","LAST_THIRTY_DAYS","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],Forecast:["LAST_SEVEN_DAYS","NEXT_SEVEN_DAYS","NEXT_MONTH","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","LAST_THIRTY_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","CURRENT_YEAR","NEXT_365_DAYS"],"Rooms OOO/OOS":["CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Reservations By User:CREATE_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],
"Reservations By User:ARRIVAL_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH"],"Rate Adjustment Report:ARRIVAL_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","TOMORROW","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","NEXT_MONTH","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Rate Adjustment Report:ADJUSTMENT_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Occupancy & Revenue Summary":["YESTERDAY","LAST_WEEK","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Add-On Forecast":["TODAY","TOMORROW","NEXT_SEVEN_DAYS","NEXT_TEN_DAYS","NEXT_THIRTY_DAYS"],"Forecast Guests & Groups":["CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE","NEXT_SEVEN_DAYS","NEXT_TEN_DAYS","NEXT_THIRTY_DAYS","LAST_MONTH","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_YEAR","NEXT_365_DAYS"],"Market Segment Statistics Report":["YESTERDAY"],"A/R Aging":["YESTERDAY"],"Complimentary Room Report":["TODAY","TOMORROW","YESTERDAY","LAST_WEEK","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","CURRENT_MONTH","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Cancellation & No Show:DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER","TOMORROW","NEXT_SEVEN_DAYS","NEXT_THIRTY_DAYS","CURRENT_MONTH","CURRENT_MONTH_PLUS_ONE","CURRENT_MONTH_PLUS_TWO","CURRENT_MONTH_PLUS_THREE"],"Cancellation & No Show:CANCELATION_DATE_RANGE":["YESTERDAY","LAST_SEVEN_DAYS","LAST_THIRTY_DAYS","LAST_MONTH","LAST_JANUARY","LAST_FEBRUARY","LAST_MARCH","LAST_APRIL","LAST_MAY","LAST_JUNE","LAST_JULY","LAST_AUGUST","LAST_SEPTEMBER","LAST_OCTOBER","LAST_NOVEMBER","LAST_DECEMBER"],"Financial Transaction - Revenue Report":["YESTERDAY","TODAY","DATE_RANGE"],"Financial Transaction - Payment Report":["YESTERDAY","TODAY","DATE_RANGE"],"Financial Transaction - Summary Report":["YESTERDAY","TODAY","DATE"]},A="REPORT_PAYLOAD_CACHE";return p.payloadCache=r.get(A),p.payloadCache?p.payloadCache=JSON.parse(p.payloadCache):p.payloadCache={},p.setChoosenReport=function(e){h=e},p.getChoosenReport=function(){return h},p.reportApiPayload=function(){var t=e.defer(),r=function(e){t.reject(e)};return a.fetchReportList().then(c.bind(null,t),r),t.promise},p.exportCSV=function(e){return t.download(e.url,e.payload)},p.reportSchedulesPayload=function(){return u(f.SCHEDULE_REPORT)},p.reportExportPayload=function(){return u(f.EXPORT_SCHEDULE)},p.fetchOneSchedule=function(a){var r=e.defer(),s="admin/export_schedules/"+a.id,n=function(e){r.resolve(e)},o=function(e){r.reject(e)};return t.getJSON(s).then(n,o),r.promise},p.updateSchedule=function(a){var r=e.defer(),s="admin/export_schedules/"+a.id,n=function(e){r.resolve(e)},o=function(e){r.reject(e)};return t.putJSON(s,a).then(n,o),r.promise},p.createSchedule=function(a){var r=e.defer(),s="admin/export_schedules",n=function(e){r.resolve(e)},o=function(e){r.reject(e)};return t.postJSON(s,a).then(n,o),r.promise},p.deleteSchedule=function(a){var r=e.defer(),s="admin/export_schedules/"+a.id,n=function(e){r.resolve(e)},o=function(e){r.reject(e)};return t.deleteJSON(s).then(n,o),r.promise},p.runScheduleNow=function(a){var r=e.defer(),s="/admin/export_schedules/"+a.id+"/run_now",n=function(e){r.resolve(e)},o=function(e){r.reject(e)};return t.getJSON(s).then(n,o),r.promise},p.setReportRequestParam=function(e,t){h[e]=t},p.getReportExportTimePeriods=function(e){return T[e]},p.getScheduleReportTimePeriods=function(e){return S[e]},p.setPrintClicked=function(e){d.printClicked=e},p.getPrintClickedState=function(){return d.printClicked},p.processSelectedReport=function(e,t){n.init(e),o.addIncludeUserFilter(e),o.addIncludeOtherFilter(e),i.init(e),_.each(e.filters,function(t){i.execFilter(e,t)}),o.processFilters(e,t),o.reOrderSortBy(e),o.processSortBy(e),o.processGroupBy(e)},p.setSelectedReport=function(e){E=e},p.getSelectedReport=function(){return E},p.saveCofigurationData=function(e){R=e},p.getCofigurationData=function(){return R},p}]),angular.module("sntRover").service("RVreportsSubSrv",["$q","rvBaseWebSrvV2","rvReportsCache","RVReportMsgsConst","RVReportNamesConst","$rootScope",function(e,t,a,r,s,n){var o={},i={};o.availInStore=function(e){return!!i.hasOwnProperty(e)},o.getfromStore=function(e){return!!i.hasOwnProperty(e)&&i[e]},o.setIntoStore=function(e,t){i[e]=t},o.cachedInboxReport={},o.weekendDays=[];var l=function(e){return e===s.DAILY_PRODUCTION_DEMO||e===s.DAILY_PRODUCTION_RATE||e===s.DAILY_PRODUCTION_ROOM_TYPE};o.processResults=function(e){var t,a,r,n=angular.copy(o.cachedInboxReport).results,i=(e.page-1)*e.per_page,c=i+e.per_page,u=!1;if(l(e.reportTitle)&&(u=!0),e.fiterFromDate&&e.filterToDate&&u){a=new Date(e.fiterFromDate),r=new Date(e.filterToDate);var d;n=Object.keys(n).reduce(function(e,t){return d=new Date(t),d>=a&&d<=r&&(e[t]=n[t]),e},{})}if(e.reportTitle===s.TRAVEL_AGENT_COMMISSIONS){if(n.length){var p=n[0].reservation_details.reservations;n[0].reservation_details.reservations=p.length?p.slice(i,c):[]}t=n}else t=_.isArray(n)?n.slice(i,c):n;return t},o.processTotalResultRow=function(e){var t=angular.copy(o.cachedInboxReport),a=t.results_total_row,r=t.total_count,s=!1,n=Math.ceil(r/e.per_page);if(l(e.reportTitle)&&(s=!0),e.fiterFromDate&&e.filterToDate&&s){var i,c=new Date(e.fiterFromDate),u=new Date(e.filterToDate);a=_.filter(a,function(e){return i=new Date(Object.keys(e)[0]),i>=c&&i<=u})}return r<e.per_page||e.page===n?a:null},o.getcachedInboxReportByParams=function(e){var t=angular.copy(o.cachedInboxReport);if(e.reportTitle===s.TRAVEL_AGENT_COMMISSIONS){var a=t.results.length?t.results[0].reservation_details.total_reservations:0;t.results_total_row=a,t.total_count=a}return t.results=o.processResults(e),t.results_total_row=o.processTotalResultRow(e),t.isPaginatedResponse=!0,t};var c=function(s){var n=e.defer(),i=0,l=function(){i++},c=setInterval(l,1e3),u=function e(a){if(i>=300){var r=["Request timed out. Unable to process report !!"];n.reject(r)}else t.getJSONWithSpecialStatusHandling(a).then(function(t){t.status&&"processing_not_completed"===t.status||"null"===t?setTimeout(function(){console.info("POLLING::-> for print response"),e(a)},5e3):(clearInterval(c),n.resolve(t))},function(t){"undefined"==typeof t?e(a):(clearInterval(c),n.reject(t))})},d=function(e){var t;e.status&&"processing_not_completed"===e.status?u(e.location_header):(t=s.resKey2&&s.resKey?e[s.resKey][s.resKey2]:s.resKey?e[s.resKey]:e,s.hasOwnProperty("name")&&o.setIntoStore(s.name,t),clearInterval(c),[r.REPORT_SUBMITED,r.REPORT_UPDATED,r.REPORT_PAGE_CHANGED,r.REPORT_FILTER_CHANGED].indexOf(s.action)>=0&&a.put("LAST_FETCHED_REPORT",t),n.resolve(t))},p=function(e){n.reject(e||{})};return s.url&&s.method&&t.hasOwnProperty(s.method)?o.availInStore(s.name)?n.resolve(o.getfromStore(s.name)):s.params?s.action===r.REPORT_LOAD_LAST_REPORT?n.resolve(a.get("LAST_FETCHED_REPORT")):"Credit Check Report"===s.params.reportTitle?(s.params=_.omit(s.params,"reportTitle"),t.postJSONWithSpecialStatusHandling(s.url,s.params).then(d,p)):(s.params=_.omit(s.params,"reportTitle"),t[s.method](s.url,s.params).then(d,p)):t[s.method](s.url).then(d,p):p(),n.promise};return o.fetchReportList=function(){return c({name:"reportList",method:"getJSON",url:"/api/reports"})},o.fetchReportDetails=function(e){return c({method:"postJSON",url:"/api/reports/"+e.id+"/submit",params:_.omit(e,["id","action"]),action:e.action})},o.fetchGeneratedReportDetails=function(a){var r=e.defer(),s="/api/generated_reports/"+a.id+"/view";return"Tax Output Report - Tax Payment Receipts"===a.reportTitle?t.getJSON(s).then(function(e){99999!==a.per_page&&_.each(e.results,function(e){e.receipt_details&&e.receipt_details.receipts&&e.receipt_details.receipts.length>a.per_page&&(e.receipt_details.receipts=e.receipt_details.receipts.slice(0,a.per_page))}),o.cachedInboxReport=e,o.weekendDays=e.weekend_days||["Saturday","Sunday"],r.resolve(o.getcachedInboxReportByParams(a))},function(e){r.reject(e)}):1===a.page?t.getJSON(s).then(function(e){o.cachedInboxReport=e,o.weekendDays=e.weekend_days||["Saturday","Sunday"],r.resolve(o.getcachedInboxReportByParams(a))},function(e){r.reject(e)}):r.resolve(o.getcachedInboxReportByParams(a)),r.promise},o.getReservationsOfTravelAgents=function(e){return c({method:"getJSON",url:"api/reports/list_travel_agent_reservations",params:e})},o.getReceiptsOfCategories=function(e){return c({method:"getJSON",url:"api/reports/list_tax_payment_receipts",params:e})},o.fetchActiveUsers=function(){return c({name:"activeUsers",method:"getJSON",url:"/api/users/active"})},o.fetchTaxPaymentReceiptTypes=function(){return c({name:"paymentReceiptTypes",method:"getJSON",url:"/api/payment_receipts/tax_payment_receipt_types",resKey:"results"})},o.fetchGuaranteeTypes=function(){return c({name:"guaranteeTypes",method:"getJSON",url:"/api/reservation_types.json?is_active=true",resKey:"reservation_types"})},o.fetchChargeNAddonGroups=function(e){return c({name:"chargeNAddonGroups",method:"getJSON",url:"api/charge_groups",resKey:"results",params:e})},o.fetchChargeCodes=function(){return c({name:"chargeCodes",method:"getJSON",url:"api/charge_codes",resKey:"results"})},o.fetchAllowances=function(){return c({name:"allowances",method:"getJSON",url:"api/addons",params:{allowance_only:!0,no_pagination:!0},resKey:"results"})},o.fetchAddons=function(e){return c({name:"addons",method:"postJSON",url:"api/addons/detail",params:e,resKey:"results"})},o.fetchMarkets=function(e){var t="/api/market_segments?is_active=true";return e&&(t="/api/market_segments"),c({name:"markets",method:"getJSON",url:t,resKey:"markets"})},o.fetchSegments=function(e){var t="/api/segments?is_active=true";return e&&(t="/api/segments"),c({name:"segments",method:"getJSON",url:t,resKey:"segments"})},o.fetchSources=function(e){var t="api/sources?is_active=true";return e&&(t="api/sources"),c({name:"sources",method:"getJSON",url:t,resKey:"sources"})},o.fetchBookingOrigins=function(e){var t="api/booking_origins?is_active=true";return e&&(t="api/booking_origins"),c({name:"bookingOrigins",method:"getJSON",url:t,resKey:"booking_origins"})},o.fetchCodeSettings=function(){return c({name:"codeSettings",method:"getJSON",url:"/api/reports/code_settings"})},o.fetchComTaGrp=function(e,t){var a="?query="+e;return t&&(a+="&exclude_groups=true"),c({method:"getJSON",url:"api/reports/search_by_company_agent_group"+a,resKey:"results"})},o.fetchGroupCode=function(e){var t="?query="+e;return c({method:"getJSON",url:"api/reports/search_group_by_code"+t,resKey:"results"})},o.fetchHoldStatus=function(){return c({name:"holdStatus",method:"getJSON",url:"api/group_hold_statuses",resKey:"data",resKey2:"hold_status"})},o.fetchReservationStatus=function(){return c({name:"reservationStatus",method:"getJSON",url:"api/reservations/status",resKey:"reservation_status"})},o.fetchAddonReservations=function(e){return c({method:"getJSON",url:"/api/reports/"+e.id+"/addon_reservations",params:_.omit(e,"id"),resKey:"results"})},o.fetchRateTypesAndRateList=function(){return c({name:"rateTypeAndRateList",method:"postJSON",url:"/api/rates/list",resKey:"rates"})},o.fetchRateCode=function(){return c({name:"rateCodeList",method:"getJSON",url:"/api/rates/codes",resKey:"rate_codes"})},o.fetchRoomTypeList=function(e){return e=e||{},c({name:"roomTypeList",method:"getJSON",url:"api/room_types",resKey:"results",params:e})},o.fetchRestrictionList=function(){return c({name:"restrictionList",method:"getJSON",url:"/api/restriction_types?is_activated=true",resKey:"results"})},o.fetchOrigins=function(){return c({name:"origins",method:"getJSON",url:"api/reports/origins",resKey:"origins"})},o.fetchURLs=function(){return c({name:"URLs",method:"getJSON",url:"api/guest_web_urls/?application=URL&guest_web_url_type=CHECKIN",resKey:"data"})},o.fetchScheduleFrequency=function(e){var t=e?"admin/export_frequencies.json?export_only=true":"admin/export_frequencies.json";return c({method:"getJSON",url:t,resKey:"results"})},o.fetchScheduleFormat=function(){var e="admin/export_formats.json";return c({method:"getJSON",url:e,resKey:"results"})},o.fetchTimePeriods=function(){return c({name:"scheduleTimePeriods",method:"getJSON",url:"admin/export_time_periods.json",resKey:"results"})},o.fetchSchedules=function(e){var t="admin/export_schedules.json",a={page:1,per_page:9999};return e&&(a.export_only=!0),c({method:"getJSON",url:t,resKey:"results",params:a})},o.fetchOneSchedule=function(e){return c({method:"getJSON",url:"admin/export_schedules/"+e.id})},o.fetchDeliveryTypes=function(e){return c({name:"scheduleDeliveryTypes",method:"getJSON",url:"admin/export_delivery_types.json",resKey:"results"})},o.fetchFtpServers=function(){return c({name:"ftpServerList",method:"getJSON",url:"/api/sftp_servers",resKey:"results"})},o.runNowExport=function(e){var t="admin/export_schedules/"+e.id+".json";return c({method:"putJSON",url:t,resKey:"results"})},o.createExport=function(){var e="admin/export_schedules.json";return c({method:"postJSON",url:e,resKey:"results"})},o.updateAnExport=function(e){var t="admin/export_schedules/"+e.id+".json";return c({method:"putJSON",url:t,resKey:"results"})},o.fetchAnExport=function(e){var t="admin/export_schedules/"+e.id+".json";return c({method:"getJSON",url:t,resKey:"results"})},o.fetchCampaignTypes=function(){return c({name:"campaign_types",method:"getJSON",url:"api/campaigns/campaign_types",resKey:"campaign_types"})},o.fetchSchedulableReports=function(e){var t=e?"admin/export_reports.json?export_only=true":"admin/export_reports.json";return c({method:"getJSON",url:t,resKey:"results"})},o.fetchFloors=function(){return c({name:"houseFloors",method:"getJSON",url:"api/floors.json",resKey:"floors"})},o.fetchDepartments=function(){return c({name:"departments",method:"getJSON",url:"admin/departments.json",resKey:"data",resKey2:"departments"})},o.fetchEmployees=function(){return c({name:"employees",method:"getJSON",url:"/api/users/active.json?journal=true"})},o.fetchPaymentTypes=function(){return c({name:"paymentTypes",method:"getJSON",url:"/api/hotel_payment_types",resKey:"results"})},o.fetchTaxExemptTypes=function(){return c({name:"taxExempts",method:"getJSON",url:"api/tax_exempt_types",resKey:"results"})},o.fetchLanguages=function(){return c({name:"languages",method:"getJSON",url:"api/guest_languages",resKey:"languages"})},o.getChargeCodes=function(e){return c({method:"getJSON",url:"api/reports/"+e.report_id+"/revenue_by_charge_codes",params:_.omit(e,"report_id")})},o.getPaymentValues=function(e){return c({method:"getJSON",url:"api/reports/"+e.report_id+"/payment_by_charge_codes",params:_.omit(e,"report_id")})},o.fetchAccounts=function(){return c({name:"accounts",method:"getJSON",url:"/api/accounts/list",resKey:"accounts"})},o.fetchTravelAgents=function(e){return e=e||{},c({name:"accounts",method:"getJSON",url:" /api/reports/list_travel_agents",resKey:"travel_agents",params:e})},o.fetchCountries=function(e){return e=e||{},c({name:"accounts",method:"getJSON",url:" /ui/country_list",resKey:"",params:e})},o.fetchExternalReferenceList=function(e){return e=e||{},c({name:"externalReferenceList",method:"getJSON",url:"api/reference_values/manual_external_reference_interfaces?workstation_id="+n.workstation_id,resKey:"external_interface_types",params:e})},o.fetchGroups=function(e){return c({method:"getJSON",url:"/api/groups/search",resKey:"groups",params:e})},o.fetchGroupById=function(e){return c({method:"getJSON",url:"/api/groups/"+e+"/group_name"})},o.fetchAccountsById=function(e){return c({method:"getJSON",url:"/api/accounts/"+e})},o.fetchRateTypes=function(){return c({method:"getJSON",url:"/api/rate_types.json?sort_field=is_active&sort_dir=false&per_page=1000&page=1"})},o.fetchEmployeeList=function(){return c({method:"getJSON",url:"/api/work_statistics/employees_list?per_page=9999"})},o.fetchRateDetailsByIds=function(a){var r=e.defer(),s="/api/rates/list";return t.postJSON(s,a).then(function(e){r.resolve(e.rates)},function(e){r.reject(e)}),r.promise},o.fetchAddonsByIds=function(a){var r=e.defer(),s="/api/addons/names_list";return t.postJSON(s,a).then(function(e){r.resolve(e.results)},function(e){r.reject(e)}),r.promise},o.fetchTravelAgentsByIds=function(a){var r=e.defer(),s="/api/reports/list_travel_agents";return t.getJSON(s,a).then(function(e){r.resolve(e.travel_agents)},function(e){r.reject(e)}),r.promise},o.fetchWorkTypes=function(){var a=e.defer(),r="api/work_types";return t.getJSON(r).then(function(e){a.resolve(e.results)},function(e){a.reject(e)}),a.promise},o.fetchFrontOfficeStatus=function(){var a=e.defer(),r="api/reference_values?type=front_office_status";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},o.fetchHouseKeepingStatus=function(){var a=e.defer(),r="api/reference_values?type=housekeeping_status";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},o}]),angular.module("reportsModule").factory("RVReportApplyFlags",["RVReportNamesConst",function(e){return{init:function(t){var a={BOOKING_SOURCE_MARKET_REPORT:["canRemoveDate"],LOGIN_AND_OUT_ACTIVITY:["hasUserFilter"],DEPOSIT_REPORT:["canRemoveDate"],IN_HOUSE_GUEST:["canRemoveDate","hasOneMonthLimit"],OCCUPANCY_REVENUE_SUMMARY:["hasPrevDateLimit"],RESERVATIONS_BY_USER:["hasUserFilter","canRemoveDate"],MARKET_SEGMENT_STAT_REPORT:["hasSysDateLimit"],ROOMS_QUEUED:["hasSysDateLimit"],RATE_ADJUSTMENTS_REPORT:["hasDateLimit","canRemoveDate"],ADDON_FORECAST:["canRemoveDate","hasOneYearLimit"],ALLOWANCE_FORECAST:["canRemoveDate","isForecast"],DAILY_PRODUCTION_ROOM_TYPE:["canRemoveDate","hasOneYearLimit"],DAILY_PRODUCTION_DEMO:["hasOneYearLimit"],DAILY_PRODUCTION_RATE:["hasOneYearLimit"],RATE_RESTRICTION_REPORT:["hasOneYearLimit"],FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:["hasUserFilter"],CANCELLATION_NO_SHOW:["canRemoveDate"],COMPARISION_BY_DATE:["hasSysDateLimit"],BUSINESS_ON_BOOKS:["hasOneYearLimit"],COMPANY_TA_TOP_PRODUCERS:["hasPrevDateLimit"],GROUP_ROOMS_REPORT:["hasOneYearLimit"],ADDON_UPSELLS:["hasOneYearLimit"],FORECAST_BY_DATE:["hasOneYearLimit"],FORECAST_GUEST_GROUPS:["hasOneYearLimit"],ARRIVAL:["hasOneMonthLimit"],DEPARTURE:["hasOneMonthLimit"],FINANCIAL_TRANSACTION_REVENUE_REPORT:["hasUserFilter","hasBDLimit"],FINANCIAL_TRANSACTION_PAYMENT_REPORT:["hasUserFilter","hasBDLimit"],FINANCIAL_TRANSACTION_SUMMARY_REPORT:["hasDateLimit"],TAX_OUTPUT_REPORT:["hasOneYearLimit"]},r=_.findKey(e,function(e,a){return e===t.title});r&&_.each(a[r],function(e){t[e]=!0})}}}]),angular.module("reportsModule").factory("RVReportApplyIconClass",["RVReportNamesConst",function(e){return{init:function(t){var a={CHECK_IN_CHECK_OUT:"icon-report icon-check-in-check-out",UPSELL:"icon-report icon-upsell",WEB_CHECK_OUT_CONVERSION:"icon-report icon-check-out",WEB_CHECK_IN_CONVERSION:"icon-report icon-check-in",LATE_CHECK_OUT:"guest-status late-check-out",IN_HOUSE_GUEST:"guest-status inhouse",ARRIVAL:"guest-status check-in",DEPARTURE:"guest-status check-out",CANCELLATION_NO_SHOW:"guest-status cancel",BOOKING_SOURCE_MARKET_REPORT:"icon-report icon-booking",LOGIN_AND_OUT_ACTIVITY:"icon-report icon-activity",DEPOSIT_REPORT:"icon-report icon-deposit",GROUP_DEPOSIT_REPORT:"icon-report icon-deposit",OCCUPANCY_REVENUE_SUMMARY:"icon-report icon-occupancy",RESERVATIONS_BY_USER:"icon-report icon-reservations",DAILY_TRANSACTIONS:"icon-report icon-transactions",DAILY_PAYMENTS:"icon-report icon-transactions",ROOMS_QUEUED:"icons guest-status icon-queued",FORECAST_BY_DATE:"icon-report icon-forecast",MARKET_SEGMENT_STAT_REPORT:"icon-report icon-market",FORECAST_GUEST_GROUPS:"icon-report icon-forecast",COMPARISION_BY_DATE:"icon-report icon-comparison",RATE_ADJUSTMENTS_REPORT:"icon-report icon-rate",GROUP_PICKUP_REPORT:"icon-report icon-group",DAILY_PRODUCTION_ROOM_TYPE:"icon-report icon-forecast",AR_SUMMARY_REPORT:"icon-report icon-forecast",GUEST_BALANCE_REPORT:"icon-report icon-balance",RATE_RESTRICTION_REPORT:"icon-report icon-rate",COMPANY_TA_TOP_PRODUCERS:"icon-report icon-cards",FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:"icon-report icon-forecast",CREDIT_CHECK_REPORT:"icon-report icon-deposit",DEPOSIT_SUMMARY:"icon-report icon-deposit",ROOMS_OOO_OOS:"icon-report icon-room",ACTIONS_MANAGER:"icon-report icon-action",VACANT_ROOMS_REPORT:"icon-report icon-room",BUSINESS_ON_BOOKS:"icon-report icon-forecast",GROUP_ROOMS_REPORT:"icon-report icon-room",YEARLY_TAX:"icon-report icon-forecast",TAX_EXEMPT:"icon-report icon-forecast",GUESTS_INHOUSE_BY_NATIONALITY:"icons icon-adult icon-20w",DEFAULT:"icon-report"},r=_.findKey(e,function(e){return e===t.title});t.reportIconCls=a[r]||a.DEFAULT}}}]),sntRover.factory("RVReportParserFac",["$rootScope","$filter","$timeout","RVReportNamesConst",function(e,t,a,r){function s(e,t,a){var r,s,n=[],o=[],i=[],l=function(e){if(""!==e&&null!==e&&""!==e&&null!==e){var t=e.split("<br />");return _.reject(t,function(e){return""===e||" "===e})}},c=function(e,t){var a,r,s,o,i=0;for(a=0,r=e.length;a<r;a++)s=angular.copy(e[a]),o=parseFloat(s.amount),o=isNaN(o)?0:o,i+=o,0===a?(angular.extend(s,{isReport:!0,rowspan:r+1,charge_type:t,amount_class:"Adjustments"===t?"purple":"red",posted_date:s.posted.substring(0,10),posted_time:s.posted.substring(11),modified_date:s.modified.substring(0,10),modified_time:s.modified.substring(11),remarkAry:l(s.remark)}),n.push(s)):(angular.extend(s,{isReport:!0,amount_class:"Adjustments"===t?"purple":"red",posted_date:s.posted.substring(0,10),posted_time:s.posted.substring(11),modified_date:s.modified.substring(0,10),modified_time:s.modified.substring(11),remarkAry:l(s.remark)}),n.push(s)),1===r-a&&n.push({isReportSubTotal:!0,break_class:"row-break",amount_class:"Adjustments"===t?"purple":"red",total_amount:i})};if(!t.length)return[];for(r=0,s=t.length;r<s;r++)o=t[r].adjustments,i=t[r].deleted_charges,c(o,"Adjustments"),c(i,"Deleted Charges");return n}function n(e,t,a,r){var s,n,o,i={},l=_.keys(t)[0],c=t[l];for(s=0,n=c.length;s<n;s++)o=c[s].room_type+"__"+c[s].room_type_id,i[o]={};var u,d,p;for(var h in t)if(t.hasOwnProperty(h)){var u=t[h];for(s=0,n=u.length;s<n;s++)d=angular.copy(u[s]),p=d.room_type+"__"+d.room_type_id,i[p][h]=angular.copy(d)}var E;for(i.Totals={},s=0,n=r.length;s<n;s++)E=_.keys(r[s])[0],i.Totals[E]=angular.copy(r[s][E]);return i}function o(a){var r=_.keys(a),s=r[0],n=_.pluck(a[s].markets,"name"),o=_.pluck(a[s].sources,"name"),i=_.pluck(a[s].origins,"name"),l=_.pluck(a[s].segments,"name"),c=[],u=null;return c.push(R(!0,"Market","market_totals")),n.map(function(e){c.push(R(!1,e,"markets"))}),c.push(R(!0,"Source","source_totals")),o.map(function(e){c.push(R(!1,e,"sources"))}),c.push(R(!0,"Origin","origin_totals")),i.map(function(e){c.push(R(!1,e,"origins"))}),c.push(R(!0,"Segment","segment_totals")),l.map(function(e){c.push(R(!1,e,"segments"))}),_.each(c,function(r){_.each(a,function(a){u=a[r["key-in-api"]],u instanceof Array&&(u=_.findWhere(u,{name:r.displayLabel})),r.valueList=r.valueList.concat([{key:"res_count",value:u.total_reservations_count},{key:"available",value:u.available_rooms_count},{key:"future_revenue",value:t("currency")(u.future_revenue,e.currencySymbol,2)},{key:"adr",value:t("currency")(u.adr,e.currencySymbol,2)},{key:"rate_revenue",value:t("currency")(u.rate_revenue,e.currencySymbol,2)},{key:"arrivals",value:u.arrivals},{key:"adults",value:u.adults},{key:"children",value:u.children},{key:"fnb_future_revenue",value:t("currency")(u.fnb_future_revenue,e.currencySymbol,2)},{key:"fnb_actual_revenue",value:t("currency")(u.fnb_actual_revenue,e.currencySymbol,2)},{key:"others_future_revenue",value:t("currency")(u.others_future_revenue,e.currencySymbol,2)},{key:"others_actual_revenue",value:t("currency")(u.others_actual_revenue,e.currencySymbol,2)},{key:"total_future_revenue",value:t("currency")(u.total_future_revenue,e.currencySymbol,2)},{key:"total_actual_revenue",value:t("currency")(u.total_actual_revenue,e.currencySymbol,2)}])})}),{listing:c,dates:r}}function i(e,t,a){var s,n,o,i,l=[],c={},u=[],d={},p={},h={},E=[],a=a,R={},f={},T=function(t){return!!_.find(t,function(t){return t===e})},S=function(e){var t=!!a.checkGuest&&!!e.accompanying_names&&!!e.accompanying_names.length;return t},A=function(e){var t=!!e.company_name||!!e.travel_agent_name||!!e.group_name;return t},m=function(e){var t=!!e.vehicle_registration_number;return t},O=function(e){var t=!!e.phone_number;return t},D=function(e){var t=!!e.add_ons&&!!e.add_ons.length||!!e.addon_details;return t},y=function(e){var t=!!a.checkGuestNote&&!!e.guest_notes&&!!e.guest_notes.length;return t},v=function(e){var t=!!a.checkReservationNote&&!!e.reservation_notes&&!!e.reservation_notes.length;return t},g=function(e){var t=!!a.checkAction&&!!e.actions&&!!e.actions.length;return t},C=function(e){var t=!!a.checkCancel&&T([r.ARRIVAL,r.IN_HOUSE_GUEST]);return!!t&&!!e.cancel_reason},N=function(e){var t=!!a.checkRateAdjust&&!!e.rate_adjustment_reasons&&!!e.rate_adjustment_reasons.length;return t},P=function(e){var t=["ARRIVAL","IN_HOUSE_GUEST","CANCELLATION_NO_SHOW","DEPARTURE","LOGIN_AND_OUT_ACTIVITY","RESERVATIONS_BY_USER"];return!!_.find(t,function(t){return e==r[t]})};if(P(e))for(s=0,n=t.length;s<n;s++)for(c=angular.copy(t[s]),u=[],d={},R={},f={},h={},E=[],S(c)&&angular.extend(d,{isGuestData:!0,guestNames:angular.copy(c.accompanying_names)}),A(c)&&angular.extend(d,{isGuestData:!0,company_name:c.company_name,travel_agent_name:c.travel_agent_name,group_name:c.group_name}),m(c)&&angular.extend(d,{isGuestData:!0,vehicle_registration_number:angular.copy(c.vehicle_registration_number)}),O(c)&&angular.extend(d,{isGuestData:!0,phone_number:angular.copy(c.phone_number)}),D(c)&&angular.extend(d,{isGuestData:!0,addOns:angular.copy(c.add_ons),addOnDetails:angular.copy(c.addon_details)}),_.size(d)&&u.push(d),C(c)&&(h={isCancelData:!0,reason:angular.copy(c.cancel_reason)},u.push(h)),y(c)&&(R={isGuestNoteData:!0,guestNotes:angular.copy(c.guest_notes)},u.push(R)),v(c)&&(f={isReservationNoteData:!0,reservationNotes:angular.copy(c.reservation_notes)},u.push(f)),g(c)&&(p={isActionData:!0,actions:angular.copy(c.actions)},u.push(p)),N(c)&&(E={isAdjustData:!0,reasons:angular.copy(c.rate_adjustment_reasons)},u.push(E)),u.length?(c.rowspan=u.length+1,u[u.length-1].className="row-break"):c.className="row-break",e===r.LOGIN_AND_OUT_ACTIVITY&&(c.hasOwnProperty("action_type")&&"INVALID_LOGIN"===c.action_type&&(c.action_type="INVALID LOGIN",c.className="row-break invalid"),c.hasOwnProperty("date")&&(c.uiDate=c.date.split(", ")[0],c.uiTime=c.date.split(", ")[1])),c.isReport=!0,l.push(c),o=0,i=u.length;o<i;o++)l.push(u[o]);else l=t;return l}function l(e,t,a){var r,s,n={},o=a.groupedByKey;for(r=0,s=t.length;r<s;r++)""===t[r][o]&&(t[r][o]="N/A");var n=_.groupBy(t,o);return _.each(n,function(t,r,s){n[r]=angular.copy(i(e,t,a))}),n}function c(e,t,a){var r,s,n,o,i,l=[],c={},u="",d={},_={};for(r=0,s=t.length;r<s;r++){c=angular.copy(t[r]),u=n;for(n in c)c.hasOwnProperty(n)&&"0"!==n&&0!==n&&(u=n,d=c[n]);if(d.details.length)for(o=0,i=d.details.length;o<i;o++)_=angular.copy(d.details[o]),0===o&&(_.chargeGroupName=u,_.rowspan=i+1),_.isReport=!0,l.push(_);else _={},_.chargeGroupName=u,_.rowspan=2,_.isReport=!0,l.push(_);d.sub_total.isReportSubTotal=!0,d.sub_total.chargeGroupName=u,d.sub_total.className="row-break",l.push(d.sub_total)}return l}function u(e,t,a){var r,s,n,o,i,l,c,u=[],d=[];for(o=0,i=t.length;o<i;o++){if(r=angular.copy(t[o]),r.hasOwnProperty("stay_dates")&&r.stay_dates.length)for(l=0,c=r.stay_dates.length;l<c;l++)s=r.stay_dates[l],0===l?(angular.extend(r,{isReport:!0,rowspan:c+1,stay_date:s.stay_date,original_amount:s.original_amount,adjusted_amount:s.adjusted_amount,variance:s.variance,reason:s.reason,adjusted_by:s.adjusted_by}),u.push(r)):(d={},angular.extend(d,{isSubReport:!0,stay_date:s.stay_date,original_amount:s.original_amount,adjusted_amount:s.adjusted_amount,variance:s.variance,reason:s.reason,adjusted_by:s.adjusted_by}),u.push(d));else u.push(r);r.hasOwnProperty("stay_dates_total")&&r.stay_dates_total.hasOwnProperty("original_amount")?(n=r.stay_dates_total,d={},angular.extend(d,{isSubTotal:!0,className:"row-break",original_amount:n.original_amount,adjusted_amount:n.adjusted_amount,variance:n.variance}),u.push(d)):u.push(r)}return u}function d(e,t,a){var r,s,n,o,i,l,c,u,d=[],_=[];for(i=0,l=t.length;i<l;i++){if(r=angular.copy(t[i]),o=!0,r.hasOwnProperty("group_data")&&r.group_data.length)for(c=0,u=r.group_data.length;c<u;c++)s=r.group_data[c],0===c?(angular.extend(r,{isReport:!0,rowspan:u+1,date:s.date,hold_status:s.hold_status,room_type:s.room_type,rooms_available:s.rooms_available,rooms_held_non_deduct:s.rooms_held_non_deduct,rooms_held_deduct:s.rooms_held_deduct,rooms_held_picked_up:s.rooms_held_picked_up,pickup_percentage:s.pickup_percentage}),d.push(r)):(_={},angular.extend(_,{isSubReport:!0,date:s.date,hold_status:s.hold_status,room_type:s.room_type,rooms_available:s.rooms_available,rooms_held_non_deduct:s.rooms_held_non_deduct,rooms_held_deduct:s.rooms_held_deduct,rooms_held_picked_up:s.rooms_held_picked_up,pickup_percentage:s.pickup_percentage}),d.push(_));else o=!1,angular.extend(r,{isReport:!0,rowspan:0,className:"row-break"}),d.push(r);o&&r.hasOwnProperty("group_total")&&(n=r.group_total,_={},angular.extend(_,{isSubTotal:!0,className:"row-break",rooms_available:n.rooms_available,rooms_held_non_deduct:n.rooms_held_non_deduct,rooms_held_deduct:n.rooms_held_deduct,rooms_held_picked_up:n.rooms_held_picked_up,pickup_percentage:n.pickup_percentage}),d.push(_))}return d}function p(e,t,a){var r,s,n,o,i,l,c,u=[],d=[];for(o=0,i=t.length;o<i;o++)if(r=angular.copy(t[o]),r.hasOwnProperty("deposit_data")&&r.deposit_data.length){for(l=0,c=r.deposit_data.length;l<c;l++)s=r.deposit_data[l],0===l?(angular.extend(r,{isReport:!0,rowspan:c+1,deposit_payment_status:s.deposit_payment_status,due_date:s.due_date,deposit_due_amount:s.deposit_due_amount,paid_date:s.paid_date,paid_amount:s.paid_amount}),u.push(r)):(d={},angular.extend(d,{isSubReport:!0,deposit_payment_status:s.deposit_payment_status,due_date:s.due_date,deposit_due_amount:s.deposit_due_amount,paid_date:s.paid_date,paid_amount:s.paid_amount}),u.push(d));r.hasOwnProperty("deposit_totals")&&!_.isEmpty(r.deposit_totals)&&(n=r.deposit_totals,d={},angular.extend(d,{isSubTotal:!0,className:"row-break",deposit_due_amount:n.deposit_due_amount,paid_amount:n.paid_amount}),u.push(d))}else angular.extend(r,{isReport:!0,className:"row-break"}),u.push(r);return u}function h(e,t,a){var r,s,n,o={},i=[];return a.chosenSortBy&&"ROOM_NO"===a.chosenSortBy?(o=_.groupBy(t,"room_no"),_.each(o,function(e){for(r=0,s=e.length,n=s-1;r<s;r++)0===r?i.push($.extend({},e[r],{rowspan:e.length,
isMainRow:!0,className:n===r?"row-break":""})):n===r?i.push($.extend({},_.omit(e[r],["room_no","room_type"]),{className:"row-break"})):i.push(_.omit(e[r],["room_no","room_type"]))})):_.each(t,function(e){i.push($.extend({},e,{className:"row-break",isMainRow:!0}))}),i}var E={};E.parseAPI=function(e,t,a,E){return e===r.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT?_.isEmpty(t)?t:s(e,t,a):e===r.DAILY_PRODUCTION_ROOM_TYPE?_.isEmpty(t)?t:n(e,t,a,E):e===r.DAILY_PRODUCTION_DEMO?_.isEmpty(t)?t:o(t):e===r.DAILY_TRANSACTIONS||e===r.DAILY_PAYMENTS?_.isEmpty(t)?t:c(e,t,a):e==r.RATE_ADJUSTMENTS_REPORT?_.isEmpty(t)?t:u(e,t,a):e==r.GROUP_PICKUP_REPORT?_.isEmpty(t)?t:d(e,t,a):e===r.DEPOSIT_REPORT?_.isEmpty(t)?t:p(e,t,a):e===r.GROUP_DEPOSIT_REPORT?_.isEmpty(t)?t:p(e,t,a):e===r.RESERVATIONS_BY_USER&&a.groupedByKey?_.isEmpty(t)?t:l(e,t,a):e===r.ROOMS_OOO_OOS?_.isEmpty(t)?t:h(e,t,a):_.isEmpty(t)?t:i(e,t,a)};var R=function(e,t,a){return{showInBold:e,displayLabel:t,"key-in-api":a,valueList:[]}};return E}]),angular.module("reportsModule").factory("RVReportSetupOptions",["RVReportNamesConst",function(e){function t(e,t,a,r,s){r.hasOwnProperty(e)||(r[e]=$.extend({title:"Option(s)",isOpen:!1,selectAll:!1,value:"Select Options",allValue:"All Selected",defaultValue:"Select Options",valueKey:"description",data:[]},t)),data=$.extend({paramKey:s.value.toLowerCase(),description:s.description,selected:!1},a),r[e].data.push(data)}function a(e){var t=_.where(e.data,{selected:!0});1===t.length?e.value=t[0].description:t.length===e.data.length?(e.value=e.allValue,e.selectAll=!0):e.value=t.length+" Selected"}var r={},s={hasShowOptions:{SHOW_COMPANY:!0,SHOW_TRAVEL_AGENT:!0},hasChargeTypeOptions:{SHOW_ADJUSTMENTS:!0,SHOW_DELETED_CHARGES:!0},hasGeneralOptions:{INCLUDE_ACTIONS:!0,INCLUDE_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,INCLUDE_TAX_RATE:!0,INCLUDE_ADDON_RATE:!0,INCLUDE_ADDONS:!0,INCLUDE_ADDON_REVENUE:!0}},n={hasShowOptions:{title:"Show",allValue:"Both"},hasChargeTypeOptions:{title:"Charge Types",allValue:"Both"}},o={CANCELLATION_NO_SHOW:function(e){if("INCLUDE_CANCELLED"===e||"INCLUDE_CANCELED"===e)return{selected:!0}},FORECAST_GUEST_GROUPS:function(e){if("EXCLUDE_NON_GTD"==e)return{selected:!0}},DAILY_PRODUCTION_DEMO:function(e){if("EXCLUDE_TAX"===e)return{selected:!0}},DAILY_PRODUCTION_ROOM_TYPE:function(e){if("INCLUDE_ADDONS"===e)return{selected:!0}},DEFAULT:function(e){var t={};return"DUE_IN_ARRIVALS"!==e&&"DUE_OUT_DEPARTURES"!==e||(t.selected=!0),"DEPOSIT_PAID"!==e&&"DEPOSIT_DUE"!==e&&"DEPOSIT_PAST"!==e||(t.mustSend=!0),"SHOW_COMPANY"!==e&&"SHOW_TRAVEL_AGENT"!==e||(t.selected=!0),t}};return r.init=function(r){var i=_.findKey(e,function(e,t){return e===r.title}),l=o[i]||o.DEFAULT;r.allOptions=[],_.each(r.filters,function(e){_.each(s,function(a,s){a[e.value]&&(t(s,n[s],l(e.value),r,e),r.allOptions.push(s))})}),_.each(r.allOptions,function(e){a(r[e])})},r}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("reportsModule").factory("RVReportUtilsFac",["$rootScope","$filter","$timeout","$q","RVReportNamesConst","RVReportFiltersConst","RVreportsSubSrv","rvUtilSrv","RVReportParamsConst",function(e,t,a,r,s,n,o,i,l){var c={},u=["fromCancelDate","untilCancelDate","fromDepositDate","untilDepositDate","fromPaidDate","untilPaidDate","fromDate","untilDate","fromCreateDate","untilCreateDate","fromAdjustmentDate","untilAdjustmentDate","fromArrivalDate","untilArrivalDate","groupStartDate","groupEndDate","singleValueDate"],d=["year","with_vat_number","without_vat_number","fromTime","untilTime","chosenCico","chosenIncludeCompanyTa","chosenIncludeCompanyTaGroup","chosenIncludeGroup","hasMinRoomNights","hasMinRevenue","showActionables","show_vat_with_rates","show_upsell_only"],p=[{status:"VACANT",description:"Show Vacant"},{status:"OCCUPIED",description:"Show Occupied"},{status:"QUEUED",description:"Show Queued"},{status:"LATE_CHECKOUT",description:"Late Checkout"},{status:"PRE_CHECKIN",description:"Pre Checkin"}],h=[{status:"STAY_OVER",description:"Show Stayover"},{status:"NOT_RESERVED",description:"Show Not Reserved"},{status:"ARRIVAL",description:"Show Arrival"},{status:"ARRIVED",description:"Show Arrived"},{status:"DAY_USE",description:"Show Day Use"},{status:"DUE_OUT",description:"Show Due Out"},{status:"DEPARTED",description:"Show Departed"}],E=[{id:-2,status:"DUE IN",selected:!0},{id:-1,status:"DUE OUT",selected:!0},{id:1,status:"RESERVED",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],R=[{id:-1,status:"DUE OUT",selected:!0},{id:2,status:"CHECKED IN",selected:!0},{id:3,status:"CHECKED OUT",selected:!0},{id:4,status:"NO SHOW",selected:!0},{id:5,status:"CANCEL",selected:!0}],f=function(e){var t=_.pluck(e,"rate_type_id"),t=_.unique(t),a={},r=t.map(function(t){return a=_.findWhere(e,{rate_type_id:t}),a&&(a.name=a.rate_type_name,a=_.pick(a,"name","rate_type_id","selected")),a});return r},T=function(e){return e.map(function(e){return e.name=e.rate_name,_.omit(e,"rate_type_name")})},S=function(e,t,a,r){var s,n,o=[],i=[],l=null,c=!1,u={},r="boolean"!=typeof r||r;return s=angular.copy(e),n=angular.copy(t),"REMOVE_PAYMENTS"===a?(_.each(s,function(e){"Payments"!==e.name?(e.selected=r,o.push(e)):l=e.id}),_.each(n,function(e){c=_.find(e.associcated_charge_groups,function(e){return e.id===l}),c||(e.selected=r,i.push(e))})):"ONLY_PAYMENTS"===a?(u=_.find(s,function(e){return"Payments"===e.name}),u&&(l=u.id,u.selected=r,o.push(u),_.each(n,function(e){c=_.find(e.associcated_charge_groups,function(e){return e.id===l}),c&&(e.selected=r,i.push(e))}))):(_.each(s,function(e){e.selected=r,o.push(e)}),_.each(n,function(e){e.selected=r,i.push(e)})),{chargeGroups:o,chargeCodes:i}},A={INCLUDE_GUEST_NOTES:!0,INCLUDE_RESERVATION_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,INCLUDE_TAX_RATE:!0,INCLUDE_ADDON_RATE:!0,INCLUDE_ADDONS:!0,INCLUDE_ADDON_REVENUE:!0,INCLUDE_ACTIONS:!0,INCLUDE_LEDGER_DATA:!0,HAS_VEHICLE_REG_NO:!0,SHOW_PHONE_NUMBER:!0},m={EXCLUDE_TAX:!0},O={INCLUDE_MARKET:!0,INCLUDE_SOURCE:!0,INCLUDE_ORIGIN:!0,INCLUDE_SEGMENT:!0},D={GUEST:!0,ACCOUNT:!0},y={SHOW_COMPANY:!0,SHOW_TRAVEL_AGENT:!0,INCLUDE_DUE_OUT:!0,INCLUDE_INHOUSE:!0,RESTRICTED_POST_ONLY:!0,EXCEEDED_ONLY:!0,OOO:!0,OOS:!0},v={SHOW_DELETED_CHARGES:!0,SHOW_ADJUSTMENTS:!0},g=function(e,t,a){var a=("undefined"==typeof a?"undefined":_typeof(a))===_typeof(!0)&&a,r=!1,n=!1,o={INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0},i={DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0},l={DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0};e.title===s.CANCELLATION_NO_SHOW&&o[t.value]&&(a=!0),i[t.value]&&(a=!0),l[t.value]&&(r=!0),e.title===s.FORECAST_GUEST_GROUPS&&"EXCLUDE_NON_GTD"===t.value&&(a=!0),e.title===s.DAILY_PRODUCTION_DEMO&&"EXCLUDE_TAX"===t.value&&(a=!0),e.title===s.DAILY_PRODUCTION_ROOM_TYPE&&"INCLUDE_ADDONS"===t.value&&(a=!0),e.title===s.RESERVATIONS_BY_USER&&"INCLUDE_NEW"===t.value&&("INCLUDE_NEW"===t.value&&(a=!0),"SHOW_RATE_ADJUSTMENTS_ONLY"===t.value&&(e.hasGeneralOptions.options.selectiveSingleSelectKey=t.value.toLowerCase(),e.hasGeneralOptions.options.noSelectAll=!0)),e.title===s.IN_HOUSE_GUEST&&("VIP_ONLY"!==t.value&&"RESTRICTED_POST_ONLY"!==t.value||(n=!0)),e.hasGeneralOptions.data.push({id:t.value.toLowerCase(),paramKey:t.value.toLowerCase(),description:t.description,selected:a,mustSend:r,isRadioOption:n}),e.title!==s.ARRIVAL&&e.title!==s.DEPARTURE||(e.hasGeneralOptions.options.noSelectAll=!0)},C=function(e,t){var a=!1;e.title===s.DAILY_PRODUCTION_DEMO&&"INCLUDE_MARKET"===t.value&&(a=!0),e.hasDisplay.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:a})},N=function(e,t){e.hasGuestOrAccountFilter.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:!0})},P=function(e,t){e.hasShow.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:"EXCEEDED_ONLY"!==t.value})},L=function(e,t){e.hasChargeTypes.data.push({paramKey:t.value.toLowerCase(),description:t.description,selected:!0})};return c.addIncludeUserFilter=function(e){switch(e.title){case s.LOGIN_AND_OUT_ACTIVITY:case s.RATE_ADJUSTMENTS_REPORT:case s.RESERVATIONS_BY_USER:e.filters.push({value:"INCLUDE_USER_NAMES",description:"Include User Names"});break;case s.ACTIONS_MANAGER:e.filters.push({value:"INCLUDE_COMPLETION_STATUS",description:"Include Completion status"},{value:"INCLUDE_DEPARTMENTS",description:"Include Departments"});break;case s["A/R_AGING"]:e.filters.push({value:"INCLUDE_AGING_BALANCE",description:"Include Aging Balance"},{value:"ACCOUNT_SEARCH",description:"Include Account Search"});break;case s.FOLIO_TAX_REPORT:e.filters.push({value:"INCLUDE_LANGUAGE",description:"Include Language"});break;case s.TAX_EXEMPT:e.filters.push({value:"SHOW_VAT_WITH_RATES",description:"VAT"})}},c.addIncludeOtherFilter=function(e){switch(e.title){case s.TRAVEL_AGENT_COMMISSIONS:e.filters.push({value:"INCLUDE_TRAVEL_AGENT",description:"Include Travel Agent"});break;case s.YEARLY_TAX:e.filters.push({value:"VAT_YEAR",description:"Year"},{value:"CO_TA_WITH_OR_WITHOUT_VAT",description:"company_travelagent_with_without_vat"});break;case s.TAX_EXEMPT:e.filters.push({value:"INCLUDE_LONG_STAYS",description:"include_long_stays"})}},c.processFilters=function(t,a){t.hasUserFilter&&(t.filterTitle=t.title===s.RESERVATIONS_BY_USER?"Users":"Employees",t.empList={data:angular.copy(a.activeUserList),options:{selectAll:!0,hasSearch:!0,key:"full_name",altKey:"email"}}),t.hasGeneralOptions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description"}},t.chosenOptions={},t.hasDisplay={data:[],options:{selectAll:!0,hasSearch:!1,key:"description",defaultValue:"Select displays"}},t.hasExclusions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description",defaultValue:"Exclude",visible:!0}},t.hasGuestOrAccountFilter={data:[],options:{selectAll:!0,hasSearch:!1,key:"description"},affectsFilter:{name:"hasReservationStatus",process:function(e,a){if(t.title===s.GUEST_BALANCE_REPORT){var r=!!_.find(a,{paramKey:"guest"});e.updateData(!r)}}}},t.hasShow={data:[],options:{selectAll:!1,hasSearch:!1,key:"description",allValue:"Both",defaultValue:"Select options"}},t.hasChargeTypes={data:[],options:{selectAll:!0,hasSearch:!1,key:"description"}},_.each(t.filters,function(r){if("RATE_TYPE"===r.value&&(t.hasRateTypeFilter=r),"RATE"===r.value&&(t.hasRateFilter=r),"INCLUDE_DAY_USE"===r.value&&(t.hasDayUseFilter=r),"RATE_CODE"===r.value&&(t.hasRateCodeFilter=r),"ROOM_TYPE"===r.value&&(t.hasRoomTypeFilter=r),"RESTRICTION"===r.value&&(t.hasRestrictionListFilter=r),"ORIGIN"===r.value&&(t.hasOriginFilter=r),"URLS"===r.value&&(t.hasURLsList=r),"CAMPAIGN_TYPES"===r.value&&(t.hasCampaignTypes=r),"TIME_RANGE"===r.value&&(t.hasTimeFilter=r,t.timeFilterOptions=c.createTimeSlots()),"CICO"===r.value&&(t.hasCicoFilter=r,t.cicoOptions=[{value:"BOTH",label:"Show Check Ins and  Check Outs"},{value:"IN",label:"Show only Check Ins"},{value:"OUT",label:"Show only Check Outs"}]),"DAYS_0_30"===r.value&&(t.hasIncludeAgingBalance=r),"TAX_EXEMPT_TYPE"===r.value&&(t.hasIncludeTaxExempts=r),"ACCOUNT_SEARCH"===r.value&&(t.hasAccountSearch=r),"TRAVEL_AGENTS"===r.value&&(t.hasTravelAgentsSearch=r),"INCLUDE_COMPANYCARD_TA"!==r.value&&"TA_CC_CARD"!==r.value||(t.hasIncludeCompanyTa=r),"INCLUDE_GROUP"===r.value&&(t.hasIncludeGroup=r),"INCLUDE_COMPANYCARD_TA_GROUP"!==r.value&&"GROUP_COMPANY_TA_CARD"!==r.value||(t.hasIncludeCompanyTaGroup=r),"GROUP_CODE"===r.value&&(t.hasGroupCode=r),"MIN_REVENUE"===r.value&&(t.hasMinRevenue=r),"MIN_ROOM_NIGHTS"===r.value&&(t.hasMinRoomNights=r),"ACCOUNT_NAME"===r.value&&(t.hasIncludeAccountName=r),"COUNTRY"===r.value&&(t.hasIncludeCountry=r),"CO_TA_WITH_OR_WITHOUT_VAT"===r.value&&(t.hasCompanyTravelAgentWithOrWithoutVat=r),"SHOW_VAT_WITH_RATES"===r.value&&(t.hasShowVatWithRates=r),"INCLUDE_LONG_STAYS"===r.value&&(t.hasShowIncludeLongStays=r),"VAT_YEAR"===r.value&&(t.hasVatYear=r,t.yearFilter=Array.from({length:10},function(e,t){return{value:moment().add(-1*t,"y").format("YYYY")}}),t.year=moment().format("YYYY")),"MIN_NUMBER_OF_DAYS_NOT_OCCUPIED"===r.value&&(t.hasMinNoOfDaysNotOccupied=r),"ACTIONS_BY"===r.value){var n=[{value:"GUEST",name:"Guests"}];t.showActionables="GUEST",e.isHourlyRateOn||(n.push({value:"GROUP",name:"Groups"}),n.push({value:"BOTH",name:"Both"}),t.showActionables="BOTH"),t.hasShowActionables={data:n,options:{key:"name"}}}if("SHOW_UPSELL_ONLY"===r.value&&(t.hasShowUpsellOnly=r),A[r.value]&&g(t,r),t.title===s.IN_HOUSE_GUEST&&"INCLUDE_DUE_OUT"===r.value&&g(t,r,!0),t.title===s.IN_HOUSE_GUEST&&"RESTRICTED_POST_ONLY"===r.value&&e.isStandAlone&&g(t,r,!1),t.title===s.IN_HOUSE_GUEST&&"NO_NATIONALITY"===r.value&&g(t,r,!1),m[r.value]){var o=!1;(t.title===s.DAILY_PRODUCTION_DEMO||s.DAILY_PRODUCTION_RATE||s.DAILY_PRODUCTION_ROOM_TYPE)&&(t.hasExclusions.options.selectAll=!0,t.hasExclusions.options.visible=!1),t.hasExclusions.data.push({paramKey:r.value.toLowerCase(),description:r.description,selected:o})}O[r.value]&&(t.title===s.MARKET_SEGMENT_STAT_REPORT?"INCLUDE_MARKET"===r.value&&a.codeSettings.is_market_on?C(t,r):"INCLUDE_ORIGIN"===r.value&&a.codeSettings.is_origin_on?C(t,r):"INCLUDE_SEGMENT"===r.value&&a.codeSettings.is_segments_on?C(t,r):"INCLUDE_SOURCE"===r.value&&a.codeSettings.is_source_on&&C(t,r):C(t,r)),D[r.value]&&N(t,r),y[r.value]&&t.title!==s.IN_HOUSE_GUEST&&P(t,r),v[r.value]&&L(t,r)})},c.findFillFilters=function(e,t){function a(e){var a,r={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(e,{name:"UNDEFINED"});n||e.push(r),_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_GUARANTEE_TYPE"}),a&&(a.filled=!0,t.hasGuaranteeType={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!0,key:"name",defaultValue:"Select guarantees"}})}),K++,j()}function n(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TAX_PAYMENT_RECEIPT_TYPE"}),a&&(a.filled=!0,t.hasTaxPaymentReceiptTypes={data:angular.copy(e),options:{selectAll:t.title===s.TAX_OUTPUT_REPORT,hasSearch:!1,key:"name",defaultValue:"Select payment receipt"}})}),K++,j()}function i(){var e,a=[{id:1,value:"Expanded",description:"Expanded"},{id:2,value:"Collapsed",description:"Collapsed"}];_.each(t,function(t){e=_.find(t.filters,{value:"EXPANDED_OR_COLLAPSED"}),e&&(e.filled=!0,t.hasCollapsedOrExpanded={data:a,selected:a[0]})})}function c(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ACCOUNT_SEARCH"}),a&&(a.filled=!0,t.hasAccountSearch={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"account_name",defaultValue:"Select Accounts"}})}),K++,j()}function u(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TRAVEL_AGENTS"}),a&&(a.filled=!0,t.hasTravelAgentsSearch={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"account_name",defaultValue:"Select TA"}})}),K++,j()}function d(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"COUNTRY"}),a&&(a.filled=!0,t.hasIncludeCountry={data:angular.copy(e),options:{selectAll:!1,hasSearch:!0,key:"value",defaultValue:"Select Country"}})}),K++,j()}function p(e){var a,r={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(e,{name:"UNDEFINED"});n||e.push(r),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_MARKET"}),a&&(a.filled=!0,t.hasMarketsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),K++,j()}function h(e){var a,r={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(e,{name:"UNDEFINED"});n||e.push(r),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_SEGMENT"}),a&&(a.filled=!0,t.hasSegmentsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),K++,j()}function A(e){var a,r={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(e,{name:"UNDEFINED"});n||e.push(r),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_SOURCE"}),a&&(a.filled=!0,t.hasSourcesList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}},t.filters.filled=!0)}),K++,j()}function m(e){var a,r={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(e,{name:"UNDEFINED"});n||e.push(r),_.each(t,function(t){a=_.find(t.filters,{value:"CHOOSE_BOOKING_ORIGIN"}),a&&(a.filled=!0,t.hasOriginsList={data:angular.copy(e),options:{selectAll:t.title===s.RESERVATIONS_BY_USER,hasSearch:!1,key:"name"}})}),K++,j()}function O(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"HOLD_STATUS"}),a&&(a.filled=!0,t.hasHoldStatus={data:angular.copy(e),options:{hasSearch:!1,selectAll:!1,key:"name"}})}),K++,j()}function D(e){var a,r;_.each(t,function(t){a=_.find(t.filters,{value:"RESERVATION_STATUS"}),a&&(a.filled=!0,r=angular.copy(e),t.title===s.DEPOSIT_REPORT?r=angular.copy(E):t.title===s.GUEST_BALANCE_REPORT&&(r=angular.copy(R)),t.hasReservationStatus={data:r,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"},originalData:angular.copy(r),updateData:function(e){e&&this.data.length>0?this.data=[]:e||0!==this.data.length||(this.data=angular.copy(this.originalData),_.each(this.data,function(e){e.selected=!0}))}})}),K++,j()}function y(){var e,a=[{id:"UNASSIGNED",status:"UNASSIGNED",selected:!0},{id:"ASSIGNED",status:"ASSIGNED",selected:!0},{id:"COMPLETED",status:"COMPLETED",selected:!0}];_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_COMPLETION_STATUS"}),e&&(e.filled=!0,t.hasCompletionStatus={data:a,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"}})})}function v(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"TAX_EXEMPT_TYPE"}),a&&(a.filled=!0,t.hasIncludeTaxExempts={data:e,options:{hasSearch:!0,selectAll:!0,key:"name"}})}),K++,j()}function g(){var e,a=[{id:"0to30",status:"0-30 DAYS",selected:!0},{id:"31to60",status:"31-60 DAYS",selected:!0},{id:"61to90",status:"61-90 DAYS",selected:!0},{id:"91to120",status:"91-120 DAYS",selected:!0},{id:"120plus",status:"120+ DAYS",selected:!0}];_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_AGING_BALANCE"}),e&&(e.filled=!0,t.hasIncludeAgingBalance={data:a,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Aging Balance"}})})}function C(){var e,a=[{id:1,value:"TOTAL",description:"Total"},{id:2,value:"PRE STAY",description:"Pre Stay"},{id:3,value:"IN HOUSE",description:"In House"},{id:4,value:"POST STAY",description:"Post Stay"}];_.each(t,function(t){e=_.find(t.filters,{value:"TRANSACTION_CATEGORY"}),e&&(e.filled=!0,t.hasTransactionCategory={data:a})})}function N(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"SHOW_EMPLOYEES_INCLUDING_EOD"}),a&&(a.filled=!0,t.filterTitle="Employees",t.empList={data:angular.copy(e),options:{hasSearch:!0,selectAll:!0,key:"full_name",defaultValue:"Selected Employee"}})}),K++,j()}function P(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"PAYMENT_TYPES"}),a&&(a.filled=!0,t.hasPaymentType={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,noSelectAll:!0,key:"description",defaultValue:"Show All"}})}),K++,j()}function L(e){var a;_.each(e,function(e){e.id=e.value}),_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_DEPARTMENTS"}),a&&(a.filled=!0,t.hasDepartments={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Department"}})}),K++,j()}function I(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"INCLUDE_LANGUAGE"}),a&&(a.filled=!0,t.hasLanguages={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"language",defaultValue:"Select Language"}})}),K++,j()}function U(e){var a;e[0].selected=!0,_.each(t,function(t){if(a=_.find(t.filters,{value:"RATE_CODE"})){if(a.filled=!0,t.title===s.RESERVATIONS_BY_USER){var r=_.find(e,{id:-1});if(!r){var n={id:-1,description:"UNDEFINED"};e.push(n)}}t.hasRateCodeFilter={data:angular.copy(e),options:{hasSearch:!0,selectAll:t.title===s.RESERVATIONS_BY_USER,singleSelect:t.title!==s.RESERVATIONS_BY_USER,key:"description",defaultValue:"Select Rate"}}}}),K++,j()}function M(a){var r;_.each(t,function(t){if(r=_.find(t.filters,{value:"ROOM_TYPE"})){if(e.title!==s.RESERVATIONS_BY_USER){var n=_.filter(a,function(e){return!e.is_suite&&!e.is_pseudo});a=n}t.hasRoomTypeFilter={data:angular.copy(a),options:{hasSearch:!1,selectAll:!0,key:"name"}}}}),K++,j()}function b(){var e;_.each(t,function(t){e=_.find(t.filters,{value:"INCLUDE_DAY_USE"}),e&&(e.filled=!0,t[l.INCLUDE_DAYUSE]=!0)})}function F(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"RESTRICTION"}),a&&(a.filled=!0,t.hasRestrictionListFilter={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"description",defaultValue:"Select Restriction(s)"}})}),K++,j()}function w(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ORIGIN"}),a&&(a.filled=!0,t.hasOriginFilter={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"description",defaultValue:"Select Origin(s)"},affectsFilter:{name:"hasURLsList",process:function(e,a){var r=_.find(a,{value:"URL"}),s=_.find(t.filters,{value:"URLS"});s&&e.updateData(!r)}}})}),K++,j()}function G(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"URLS"}),a&&(a.filled=!0,t.hasURLsList={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select URL(s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),K++,j()}function Y(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"ALLOWANCE_CODE"}),a&&(a.filled=!0,t.hasAllowanceCodes={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Allowance(-s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),K++,j()}function k(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"CAMPAIGN_TYPES"}),a&&(a.filled=!0,t.hasCampaignTypes={data:angular.copy(e),originalData:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"name",defaultValue:"Select Campaign Type(s)"},updateData:function(e){this.data=e?[]:this.originalData}})}),K++,j()}function V(e){var a;_.each(t,function(t){a=_.find(t.filters,{value:"FLOOR"}),a&&(a.filled=!0,t.hasFloorList={data:angular.copy(e),options:{hasSearch:!1,selectAll:!0,key:"floor_number",defaultValue:"Select Floors(s)"}})}),K++,j()}function H(e){var a;_.each(e,function(e){e.selected=!0}),_.each(t,function(t){a=_.find(t.filters,{value:"RATE"}),a&&(a.filled=!0,t.hasRateTypeFilter={data:angular.copy(f(e)),options:{selectAll:!0,hasSearch:!0,key:"name"}},t.hasRateFilter={data:angular.copy(T(e)),options:{selectAll:!0,hasSearch:!0,key:"name"}})}),K++,j()}function x(e,a){var r,n,o,i;_.each(t,function(t){t.title===s.DAILY_TRANSACTIONS?(i=!0,o=S(e,a,"REMOVE_PAYMENTS",i)):t.title===s.DAILY_PAYMENTS?(i=!0,o=S(e,a,"ONLY_PAYMENTS",i)):t.title===s.DAILY_PRODUCTION_ROOM_TYPE?(i=!1,o=S(e,a,"NONE",i)):(i=!0,o=S(e,a,"NONE",i)),r=_.find(t.filters,{value:"INCLUDE_CHARGE_GROUP"}),r&&(r.filled=!0,t.hasByChargeGroup={data:angular.copy(o.chargeGroups),options:{selectAll:i,hasSearch:!1,key:"name"},affectsFilter:{name:"hasByChargeCode",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(e.associcated_charge_groups,function(a){_.each(t,function(t){a.id===t.id&&(e.disabled=!1)})})}),e.updateData()}}}),n=_.find(t.filters,{value:"INCLUDE_CHARGE_CODE"})||_.find(t.filters,{value:"SHOW_CHARGE_CODES"}),n&&(n.filled=!0,t.hasByChargeCode={data:angular.copy(o.chargeCodes),originalData:angular.copy(o.chargeCodes),options:{selectAll:i,hasSearch:!1,key:"name"},updateData:function(){var e=[];_.each(this.originalData,function(t){t.disabled||e.push(t)}),this.data=e}},t.title===s.FINANCIAL_TRANSACTION_REVENUE_REPORT&&(t.hasByChargeCode.options.key="description"))}),K+=2,j()}function B(e,a){var r,s,n=function(e){var t=[];return _.each(e,function(e){e.disabled||_.each(e.list_of_addons,function(e){t.push(e)})}),t};_.each(t,function(t){r=_.find(t.filters,{value:"ADDON_GROUPS"}),r&&(r.filled=!0,t.hasAddonGroups={data:angular.copy(e),options:{selectAll:!0,hasSearch:!0,key:"name"},affectsFilter:{name:"hasAddons",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(t,function(t){e.group_id===t.id&&(e.disabled=!1)})}),e.updateData()}}}),s=_.find(t.filters,{value:"ADDONS"}),s&&(s.filled=!0,t.hasAddons={data:n(a),originalData:angular.copy(a),options:{selectAll:!0,hasSearch:!0,key:"addon_name"},updateData:function(){this.data=n(this.originalData)}})}),K++,j()}var $=r.defer(),W=0,K=0,j=function(){K===W&&(X=_.find(J,function(e){return!e.hasOwnProperty("filled")}),void 0===X&&(e.allFiltersProcessed=!0),$.resolve())},J=e.filters,X=void 0;return _.each(J,function(t){("INCLUDE_GUARANTEE_TYPE"!==t.value||t.filled)&&("INCLUDE_GUARANTEE_TYPE"!==t.value||t.filled)?"CHOOSE_MARKET"!==t.value||t.filled?"CHOOSE_SEGMENT"!==t.value||t.filled?"CHOOSE_SOURCE"!==t.value||t.filled?"CHOOSE_BOOKING_ORIGIN"!==t.value||t.filled?"HOLD_STATUS"!==t.value||t.filled?"RESERVATION_STATUS"!==t.value||t.filled?"RATE"!==t.value||t.filled?"RATE_CODE"!==t.value||t.filled?"ROOM_TYPE"!==t.value||t.filled?"RATE_TYPE"!==t.value||t.filled?"RESTRICTION"!==t.value||t.filled?"INCLUDE_CHARGE_GROUP"===t.value&&!t.filled||"INCLUDE_CHARGE_CODE"===t.value&&!t.filled||"ADDON_GROUPS"===t.value&&!t.filled||"SHOW_CHARGE_CODES"===t.value&&!t.filled?(W++,o.fetchChargeNAddonGroups({for_addon_forecast_report:"Add-On Forecast"===e.title,include_payment:"Financial Transaction - Revenue Report"===e.title}).then(function(e){W++,o.fetchChargeCodes().then(x.bind(null,e)),W++,o.fetchAddons({addon_group_ids:_.pluck(e,"id")}).then(B.bind(null,e))})):"ALLOWANCE_CODE"!==t.value||t.filled?"URLS"!==t.value||t.filled?"ORIGIN"!==t.value||t.filled?"CAMPAIGN_TYPES"!==t.value||t.filled?"FLOOR"!==t.value||t.filled?"INCLUDE_DEPARTMENTS"!==t.value||t.filled?"TRANSACTION_CATEGORY"!==t.value||t.filled?"SHOW_EMPLOYEES_INCLUDING_EOD"!==t.value||t.filled?"INCLUDE_COMPLETION_STATUS"!==t.value||t.filled?"INCLUDE_AGING_BALANCE"!==t.value||t.filled?"PAYMENT_TYPES"!==t.value||t.filled?"INCLUDE_LANGUAGE"!==t.value||t.filled?"TAX_EXEMPT_TYPE"!==t.value||t.filled?"ACCOUNT_SEARCH"!==t.value||t.filled?"INCLUDE_TRAVEL_AGENT"!==t.value||t.filled?"COUNTRY"!==t.value||t.filled?"INCLUDE_DAY_USE"!==t.value||t.filled?"SHOW_UPSELL_ONLY"===t.value?e[l.SHOW_UPSELL_ONLY]=!0:"TAX_PAYMENT_RECEIPT_TYPE"!==t.value||t.filled?"EXPANDED_OR_COLLAPSED"!==t.value||t.filled||i():(W++,o.fetchTaxPaymentReceiptTypes().then(n)):b():(W++,o.fetchCountries().then(d)):(W++,o.fetchTravelAgents().then(u)):(W++,o.fetchAccounts().then(c)):(W++,o.fetchTaxExemptTypes().then(v)):(W++,o.fetchLanguages().then(I)):(W++,o.fetchPaymentTypes().then(P)):g():y():(W++,o.fetchEmployees().then(N)):C():(W++,o.fetchDepartments().then(L)):(W++,o.fetchFloors().then(V)):(W++,o.fetchCampaignTypes().then(k)):(W++,o.fetchOrigins().then(w)):(W++,o.fetchURLs().then(G)):(W++,o.fetchAllowances().then(Y)):(W++,o.fetchRestrictionList().then(F)):(W++,o.fetchRateTypesAndRateList().then(H)):(W++,o.fetchRoomTypeList().then(M)):(W++,o.fetchRateCode().then(U)):(W++,o.fetchRateTypesAndRateList().then(H)):(W++,o.fetchReservationStatus().then(D)):(W++,o.fetchHoldStatus().then(O)):(W++,o.fetchBookingOrigins().then(m)):(W++,o.fetchSources().then(A)):(W++,o.fetchSegments().then(h)):(W++,o.fetchMarkets().then(p)):(W++,o.fetchGuaranteeTypes().then(a))}),0===W&&j(),$.promise},c.processGroupBy=function(e){e.group_fields&&e.group_fields.length&&(e.groupByOptions=_.reject(e.group_fields,{value:"BLANK"})),e.title===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT&&(e.groupByOptions=void 0)},c.reOrderSortBy=function(e){var t;if(e.title===s.ARRIVAL||e.title===s.DEPARTURE){var a=angular.copy(e.sort_fields[1]),r=angular.copy(e.sort_fields[4]),n=angular.copy(e.sort_fields[2]),o=angular.copy(e.sort_fields[0]),i=angular.copy(e.sort_fields[3]),l=angular.copy(e.sort_fields[5]);o.disableSort=!0,l.disableSort=!0,a.colspan=2,r.colspan=0,e.sort_fields[0]=r,e.sort_fields[1]=n,e.sort_fields[2]=a,e.sort_fields[3]=o,e.sort_fields[4]=i,e.sort_fields[5]=l}if(e.title===s.AR_SUMMARY_REPORT){var n=angular.copy(_.find(e.sort_fields,{value:"ACCOUNT_NAME"})),c=angular.copy(_.find(e.sort_fields,{value:"ACCOUNT_NO"})),u=angular.copy(_.find(e.sort_fields,{value:"OPEN_BALANCE"})),d=angular.copy(_.find(e.sort_fields,{value:"CREDIT"}));e.sort_fields[0]=n,e.sort_fields[1]=c,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=u,e.sort_fields[5]=d}if(e.title===s.IN_HOUSE_GUEST){var n=angular.copy(e.sort_fields[1]),r=angular.copy(e.sort_fields[3]),i=angular.copy(e.sort_fields[2]),a=angular.copy(e.sort_fields[0]),o=angular.copy(e.sort_fields[4]);a.disableSort=!0,o.disableSort=!0,l={disableSort:!0},n.colspan=2,r.colspan=0,e.sort_fields[0]=r,e.sort_fields[1]=n,e.sort_fields[2]=a,e.sort_fields[3]=o,e.sort_fields[4]=i,e.sort_fields[5]=l}if(e.title===s.LOGIN_AND_OUT_ACTIVITY&&(e.sort_fields[0].description="Date & Time",e.sort_fields[0].colspan=2,e.sort_fields[1].colspan=2),e.title===s.DEPOSIT_REPORT){var p=angular.copy(e.sort_fields[4]),h=angular.copy(e.sort_fields[1]),E=angular.copy(e.sort_fields[2]);e.sort_fields[0]=p,e.sort_fields[1]=null,e.sort_fields[2]=h,e.sort_fields[3]=null,e.sort_fields[4]=E,e.sort_fields[5]=null}if(e.title===s.GROUP_DEPOSIT_REPORT){var p=angular.copy(e.sort_fields[4]),h=angular.copy(e.sort_fields[1]),E=angular.copy(e.sort_fields[2]);e.sort_fields[0]=p,e.sort_fields[1]=null,e.sort_fields[2]=h,e.sort_fields[3]=null,e.sort_fields[4]=E,e.sort_fields[5]=null}if(e.title===s.RESERVATIONS_BY_USER){var R=angular.copy(e.sort_fields[6]),f=angular.copy(e.sort_fields[3]),T=angular.copy(e.sort_fields[1]),S=angular.copy(e.sort_fields[5]),A=angular.copy(e.sort_fields[0]),m=angular.copy(e.sort_fields[2]),O=angular.copy(e.sort_fields[4]);e.sort_fields[0]=R,e.sort_fields[1]=f,e.sort_fields[2]=T,e.sort_fields[3]=S,e.sort_fields[4]=A,e.sort_fields[5]=m,e.sort_fields[6]=O,e.sort_fields[7]=null}if(e.title===s.DAILY_TRANSACTIONS||e.title===s.DAILY_PAYMENTS){var D=angular.copy(e.sort_fields[1]),y=angular.copy(e.sort_fields[0]),v=angular.copy(e.sort_fields[3]),g=angular.copy(e.sort_fields[2]),C=angular.copy(e.sort_fields[4]);e.sort_fields[0]=D,e.sort_fields[1]=y,e.sort_fields[2]=null,e.sort_fields[3]=v,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=g,e.sort_fields[7]=null,e.sort_fields[8]=null,e.sort_fields[9]=C}if(e.title===s.RATE_ADJUSTMENTS_REPORT){var N=angular.copy(e.sort_fields[1]),P=angular.copy(e.sort_fields[0]);t=angular.copy(e.sort_fields[2]),e.sort_fields[0]=P,e.sort_fields[1]=N,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=t}if(e.title===s.GROUP_PICKUP_REPORT){var L=angular.copy(e.sort_fields[1]),N=angular.copy(e.sort_fields[0]),I=angular.copy(e.sort_fields[2]);e.sort_fields[0]=L,e.sort_fields[1]=N,e.sort_fields[2]=I,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=null,e.sort_fields[6]=null,e.sort_fields[7]=null,e.sort_fields[8]=null}if(e.title===s.GUEST_BALANCE_REPORT){var U=angular.copy(_.find(e.sort_fields,{value:"BALANCE"})),M=angular.copy(_.find(e.sort_fields,{value:"NAME"})),b=angular.copy(_.find(e.sort_fields,{value:"ROOM_NO"})),F=angular.copy(_.find(e.sort_fields,{value:"RESERVATION_STATUS"}));e.sort_fields[0]=M,e.sort_fields[1]=b,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=U,e.sort_fields[5]=F}if(e.title===s.COMPANY_TA_TOP_PRODUCERS){
var w=angular.copy(_.find(e.sort_fields,{value:"COMPANY_TA_NAME"})),G=angular.copy(_.find(e.sort_fields,{value:"ROOM_NIGHTS"})),v=angular.copy(_.find(e.sort_fields,{value:"REVENUE"}));e.sort_fields[0]=w,e.sort_fields[1]=null,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=G,e.sort_fields[5]=null,e.sort_fields[6]=null,e.sort_fields[7]=v,e.sort_fields[8]=null,e.sort_fields[9]=null}if(e.title===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT){var y=angular.copy(_.find(e.sort_fields,{value:"CHARGE_CODE"})),N=angular.copy(_.find(e.sort_fields,{value:"DATE"}));t=angular.copy(_.find(e.sort_fields,{value:"USER"})),e.sort_fields[0]=null,e.sort_fields[1]=y,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=null,e.sort_fields[5]=t,e.sort_fields[6]=null,e.sort_fields[7]=N,e.sort_fields[8]=null,e.sort_fields[9]=null}if(e.title===s.DEPOSIT_SUMMARY){var Y=angular.copy(_.find(e.sort_fields,{value:"CREDIT"})),k=angular.copy(_.find(e.sort_fields,{value:"DEBIT"})),M=angular.copy(_.find(e.sort_fields,{value:"NAME"}));e.sort_fields[0]=M,e.sort_fields[1]=null,e.sort_fields[2]=null,e.sort_fields[3]=null,e.sort_fields[4]=k,e.sort_fields[5]=Y}if(e.title===s.ROOMS_OOO_OOS){var V,H,x,B;_.each(e.sort_fields,function(e){e&&("ROOM_NO"===e.value&&(V=angular.copy(e)),"ROOM_TYPE"===e.value&&(H=angular.copy(e)),"START_DATE"===e.value&&(x=angular.copy(e)),"END_DATE"===e.value&&(B=angular.copy(e)))}),e.sort_fields=[V,H,null,x,B,null,null]}if(e.title===s.VACANT_ROOMS_REPORT){var V=angular.copy(_.find(e.sort_fields,{value:"ROOM_NUMBER"})),H=angular.copy(_.find(e.sort_fields,{value:"ROOM_TYPE"})),$=angular.copy(_.find(e.sort_fields,{value:"NO_OF_DAYS_VACANT"})),W=angular.copy(_.find(e.sort_fields,{value:"LAST_CHECK_OUT_DATE"}));e.sort_fields[0]=V,e.sort_fields[1]=H,e.sort_fields[2]=$,e.sort_fields[3]=W}},c.processSortBy=function(e){if(e.sortByOptions=angular.copy(e.sort_fields),e.showSort=!0,e.sortByOptions&&e.sortByOptions.length){if(_.each(e.sortByOptions,function(e,t,a){e&&(e.sortDir=void 0)}),e.title===s.DAILY_PRODUCTION_ROOM_TYPE){var t=_.find(e.sortByOptions,{value:"ROOM_TYPE"});t&&(t.sortDir=!0,e.chosenSortBy=t.value)}if(e.title===s.COMPANY_TA_TOP_PRODUCERS){var a=_.find(e.sortByOptions,{value:"REVENUE"});a&&(a.sortDir=!1,e.chosenSortBy=a.value)}if(e.title===s.CREDIT_CHECK_REPORT){var r=_.find(e.sortByOptions,{value:"ROOM_NO"});r&&(r.sortDir=!0,e.chosenSortBy=r.value)}if(e.title===s.COMPLIMENTARY_ROOM_REPORT&&(e.showSort=!1),e.title===s.GROUP_ROOMS_REPORT){var n=_.find(e.sortByOptions,{value:"GROUP_ARRIVAL_DATE"});n&&(n.sortDir=!0,e.chosenSortBy=n.value)}}},c.initDateValues=function(e){var t=c.processDate();switch(e.title){case s.ARRIVAL:case s.DEPARTURE:e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.DEPOSIT_REPORT:e.fromArrivalDate=t.businessDate,e.untilArrivalDate=t.aWeekAfter,e.fromDepositDate=t.businessDate,e.untilDepositDate=t.businessDate,e.fromPaidDate=t.businessDate,e.untilPaidDate=t.businessDate;break;case s.GROUP_DEPOSIT_REPORT:e.groupStartDate=t.businessDate,e.groupEndDate=t.twentyEightDaysAfter,e.fromPaidDate=t.twentyEightDaysBefore,e.untilPaidDate=t.businessDate;break;case s.OCCUPANCY_REVENUE_SUMMARY:e.fromDate=t.yesterday,e.untilDate=t.yesterday;break;case s.DAILY_TRANSACTIONS:case s.DAILY_PAYMENTS:case s.MARKET_SEGMENT_STAT_REPORT:case s.COMPARISION_BY_DATE:e.singleValueDate=t.yesterday;break;case s.FORECAST_BY_DATE:case s.FORECAST_GUEST_GROUPS:e.fromDate=t.businessDate,e.untilDate=t.aMonthAfter;break;case s.ADDON_FORECAST:case s.ALLOWANCE_FORECAST:e.showSort=!0,e.isForecast=!0,e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_ROOM_TYPE:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_DEMO:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.DAILY_PRODUCTION_RATE:e.fromDate=t.monthStart,e.untilDate=t.businessDate;break;case s.RATE_RESTRICTION_REPORT:e.fromDate=t.businessDate,e.untilDate=t.businessDate;break;case s.IN_HOUSE_GUEST:e.singleValueDate=t.businessDate;break;default:e.fromDate=t.aWeekAgo,e.fromCancelDate=t.aWeekAgo,e.fromArrivalDate=t.aWeekAgo,e.fromCreateDate=t.aWeekAgo,e.fromAdjustmentDate=t.aWeekAgo,e.untilDate=t.businessDate,e.untilCancelDate=t.businessDate,e.untilArrivalDate=t.businessDate,e.untilCreateDate=t.businessDate,e.untilAdjustmentDate=t.businessDate}},c.processDate=function(a,r){var s=a?tzIndependentDate(a):e.businessDate,n=t("date")(s,"yyyy-MM-dd"),o=n.match(/(\d+)/g),i=parseInt(o[0]),l=parseInt(o[1])-1,c=parseInt(o[2]),u={businessDate:new Date(i,l,c),today:new Date(i,l,c),yesterday:new Date(i,l,c-1),tomorrow:new Date(i,l,c+1),aWeekAgo:new Date(i,l,c-7),aWeekAfter:new Date(i,l,c+7),aMonthAfter:new Date(i,l,c+30),monthStart:new Date(i,l,1),twentyEightDaysBefore:new Date(i,l,c-28),twentyEightDaysAfter:new Date(i,l,c+28),aYearAfter:new Date(i+1,l,c-1),sixMonthsAfter:new Date(i,l+6,c),thirtyOneDaysAfter:new Date(i,l,c+30)};return NaN!==parseInt(r)&&(u.xDaysBefore=new Date(i,l,c-r),u.xDaysAfter=new Date(i,l,c+r)),u},c.createTimeSlots=function(e){var t,a,r,s=[],n="",o="";30===e?(t=e,a=2):(t=15,a=4),r=24*a;var i=0,l=0,c=-1;for(i=0;i<r;i++)i%a===0?(c++,l=0):l+=t,n=c<10?"0"+c:c,o=l<10?"0"+l:l,s.push({value:n+":"+o,name:n+":"+o});return s},c.reduceObject=function(e,t){return t=t||u.concat(d),_.pick(e,t)},c.parseDatesInObject=function(e){for(var t in e)u.indexOf(t)!==-1&&(e[t]=tzIndependentDate(e[t]))},c.markAsSelected=function(e,t,a){_.each(e,function(e){t.indeOf(e[a])>-1&&(e.selected=!0)})},c.markSelectedEntriesForFilter=function(e){e.filters[l.RESTRICTION_IDS]&&e.filters[l.RESTRICTION_IDS].length>0&&c.markAsSelected(e.hasRestrictionListFilter.data,e.filters[l.RESTRICTION_IDS],"id"),e.filters[l.ROOM_TYPE_IDS]&&e.filters[l.ROOM_TYPE_IDS].length>0&&c.markAsSelected(e.hasRestrictionListFilter.data,e.filters[l.ROOM_TYPE_IDS],"id")},c.fillRateTypesAndRatesForScheduledReports=function(e,t,a){var r=function(e){var r=!1;return t&&t.rate_type_ids?r=t.rate_type_ids.length===e.length:t&&!t.rate_type_ids?r=!1:t||a!==s.DAILY_PRODUCTION_RATE||(r=!0),r},n=function(e){var r=!1;return t&&t.rate_ids?r=t.rate_ids.length===e.length:t&&!t.rate_ids?r=!1:t||a!==s.DAILY_PRODUCTION_RATE||(r=!0),r},i=function(o){var i,l,c=f(o),u=T(o);t&&t.rate_type_ids?_.each(t.rate_type_ids,function(e){i=_.findWhere(c,{rate_type_id:e}),i.selected=!0}):t||a!==s.DAILY_PRODUCTION_RATE||_.each(c,function(e){e.selected=!0}),t&&t.rate_ids?_.each(t.rate_ids,function(e){l=_.findWhere(u,{id:e}),l.selected=!0}):t||a!==s.DAILY_PRODUCTION_RATE||_.each(u,function(e){e.selected=!0}),e.hasRateTypeFilter={data:c,options:{selectAll:r(c),hasSearch:!0,key:"name"}},e.hasRateFilter={data:u,options:{selectAll:n(u),hasSearch:!0,key:"name"}}};o.fetchRateTypesAndRateList().then(i)},c.fillChargeGroupsAndChargeCodes=function(e,t,a){var r=function(e){var a=!0;return t&&t.charge_group_ids?a=t.charge_group_ids.length===e.length:t&&!t.charge_group_ids&&(a=!1),a},n=function(e){var a=!0;return t&&t.charge_code_ids?a=t.charge_code_ids.length===e.length:t&&!t.charge_code_ids&&(a=!1),a},i=function(o,i,l,c,u){var d,p,h=S(o,u,i,!0),E=angular.copy(h.chargeGroups),R=angular.copy(h.chargeCodes);delete e.hasByChargeGroup,delete e.hasByChargeCode,l&&(t&&t.charge_group_ids?E=_.map(E,function(e){return d=_.indexOf(t.charge_group_ids,e.id),e.selected=!1,d>-1&&(e.selected=!0),e}):t&&!t.charge_group_ids&&(E=_.map(E,function(e){return e.selected=!1,e})),e.hasByChargeGroup={data:E,options:{selectAll:r(E),hasSearch:!1,key:"name"},affectsFilter:{name:"hasByChargeCode",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(e.associcated_charge_groups,function(a){_.each(t,function(t){a.id===t.id&&(e.disabled=!1)})})}),e.updateData()}}}),c&&(t&&t.charge_code_ids?R=_.map(R,function(e){return p=_.indexOf(t.charge_code_ids,e.id),e.selected=!1,p>-1&&(e.selected=!0),e}):t&&!t.charge_code_ids&&(R=_.map(R,function(e){return e.selected=!1,e})),e.hasByChargeCode={data:R,originalData:R,options:{selectAll:n(R),hasSearch:!1,key:"name"},updateData:function(){var e=[];_.each(this.originalData,function(t){t.disabled||e.push(t)}),this.data=e}},a===s.FINANCIAL_TRANSACTION_REVENUE_REPORT&&(e.hasByChargeCode.options.key="description"))},l="NONE",c=!0,u=!0;a===s.DAILY_TRANSACTIONS&&(l="REMOVE_PAYMENTS"),a===s.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT&&(c=!1,u=!0),o.fetchChargeNAddonGroups().then(function(e){o.fetchChargeCodes().then(i.bind(null,e,l,c,u))})},c.fillCompletionStatus=function(e){var t=[{id:"UNASSIGNED",status:"UNASSIGNED",selected:!0},{id:"ASSIGNED",status:"ASSIGNED",selected:!0},{id:"COMPLETED",status:"COMPLETED",selected:!0}];e.hasCompletionStatus={data:t,options:{hasSearch:!1,selectAll:!0,key:"status",defaultValue:"Select Status"}}},c.fillEmployees=function(e,t){var a=function(e){var a=!0;return t&&t.all_users_selected?a:(t&&t.user_ids&&(a=e.length===t.user_ids.length),a)};o.fetchEmployees().then(function(r){var s=angular.copy(r);t&&t.user_ids&&(s=s.map(function(e){return e.selected=!1,t.user_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.filterTitle="Employees",e.empList={title:"Employees",data:s,options:{selectAll:a(s),hasSearch:!0,key:"full_name",altKey:"email"}}})},c.fillTransactionCategory=function(e,t){var a,r=[{id:"TOTAL",description:"Show Totals"},{id:"PRE STAY",description:"Pre Stay"},{id:"IN HOUSE",description:"In House"},{id:"POST STAY",description:"Post Stay"}];a=t&&t.transaction_category?_.find(r,{id:t.transaction_category}):r[0],e.hasTransactionCategory={data:r,selected:a,options:{key:"description",defaultValue:"Select Transaction Category"}}},c.fillPaymentTypes=function(e,t){var a=function(e){var a=!0;return t&&t.payment_types&&(a=e.length===t.payment_types.length),a};o.fetchPaymentTypes().then(function(r){var s=angular.copy(r);t&&t.payment_types&&(s=s.map(function(e){return e.selected=!1,t.payment_types.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasPaymentType={data:s,options:{hasSearch:!1,selectAll:a(s),noSelectAll:!0,key:"description",defaultValue:"Show All"}}})},c.fillCollapsedOrExpanded=function(e,t){var a,r=[{id:1,value:"EXPANDED",description:"Expanded"},{id:2,value:"COLLAPSED",description:"Collapsed"}];a=t&&t.summary_type?_.find(r,{value:t.summary_type}):r[0],e.hasCollapsedOrExpanded={data:r,selected:a,options:{key:"description"}}},c.fillDepartments=function(e,t){var a=function(e){var a=!0;return t&&t.assigned_departments&&(a=e.length===t.assigned_departments.length),a};o.fetchDepartments().then(function(r){_.each(r,function(e){e.id=e.value});var s=angular.copy(r);t&&t.assigned_departments&&(s=s.map(function(e){return e.selected=!1,t.assigned_departments.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasDepartments={data:s,options:{hasSearch:!1,selectAll:a(s),key:"name",defaultValue:"Select Department"}}})},c.fillMarkets=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER||a===s.OCCUPANCY_REVENUE_SUMMARY;return t&&t.market_ids&&(r=e.length===t.market_ids.length),r};o.fetchMarkets().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(a,{name:"UNDEFINED"});n||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.market_ids&&(o=o.map(function(e){return e.selected=!1,t.market_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasMarketsList={data:o,options:{selectAll:r(o),hasSearch:!1,key:"name"}}})},c.fillBookingOrigins=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER;return t&&t.booking_origin_ids&&(r=e.length===t.booking_origin_ids.length),r};o.fetchBookingOrigins().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(a,{name:"UNDEFINED"});n||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.booking_origin_ids&&(o=o.map(function(e){return e.selected=!1,t.booking_origin_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasOriginsList={data:o,options:{selectAll:r(o),hasSearch:!1,key:"name"}}})},c.fillSources=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER;return t&&t.source_ids&&(r=e.length===t.source_ids.length),r};o.fetchSources().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(a,{name:"UNDEFINED"});n||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.source_ids&&(o=o.map(function(e){return e.selected=!1,t.source_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasSourcesList={data:o,options:{selectAll:r(o),hasSearch:!1,key:"name"}}})},c.fillCountries=function(e,t){o.fetchCountries().then(function(a){var r=angular.copy(a);t&&t.country_ids&&(r=r.map(function(e){return e.selected=!1,t.country_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeCountry={data:r,options:{selectAll:!1,hasSearch:!0,key:"value",defaultValue:"Select Country"}}})},c.fillWorkTypes=function(e,t){var a=function(e){var a=!0;return t&&t.work_type_ids&&(a=e.length===t.work_type_ids.length),a};o.fetchWorkTypes().then(function(r){_.each(r,function(e){e.value=e.name.toUpperCase()});var s=angular.copy(r);t&&t.work_type_ids&&(s=s.map(function(e){return e.selected=!1,t.work_type_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeWorkTypes={data:s,options:{selectAll:a(s),hasSearch:!0,key:"value",defaultValue:"Select Work Type"}}})},c.fillFrontOfficeStatus=function(e,t){var a=function(e){var a=!0;return t&&t.hk_fo_statuses&&(a=e.length===t.hk_fo_statuses.length),a},r=angular.copy(h);t&&t.hk_fo_statuses&&(r=r.map(function(e){return e.selected=!1,t.hk_fo_statuses.indexOf(e.status)>-1&&(e.selected=!0),e})),e.hasFrontOfficeStatus={data:r,options:{selectAll:a(r),hasSearch:!1,key:"description",defaultValue:"Select Front Office Status"}}},c.fillFloors=function(e,t){var a=function(e){var a=!0;return t&&t.floor&&(a=e.length===t.floor.length),a};o.fetchFloors().then(function(r){var s=angular.copy(r);t&&t.floor&&(s=s.map(function(e){return e.selected=!1,t.floor.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasFloorList={data:s,options:{selectAll:a(s),hasSearch:!0,key:"floor_number",defaultValue:"Select Floor"}}})},c.fillHouseKeepingStatus=function(e,t,a){var r=function(e){var a=!0;return t&&t.hk_status_ids&&(a=e.length===t.hk_status_ids.length),a},n=function(e){var t=angular.copy(e);return a===s.ROOM_STATUS_REPORT&&(t=t.map(function(e){return"OO"===e.value?e.value="Show Out of Order":"OS"===e.value?e.value="Show Out of Service":e.value="Show "+e.value,e})),t};o.fetchHouseKeepingStatus().then(function(a){var s=n(a);t&&t.hk_status_ids&&(s=s.map(function(e){return e.selected=!1,t.hk_status_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasHouseKeepingStatus={data:s,options:{selectAll:r(s),hasSearch:!1,key:"value",defaultValue:"Select Status"}}})},c.fillReservationStatus=function(e,t){var a=function(e){var a=!0;return t&&t.hk_reservation_statuses&&(a=e.length===t.hk_reservation_statuses.length),a},r=angular.copy(p);t&&t.hk_reservation_statuses&&(r=r.map(function(e){return e.selected=!1,t.hk_reservation_statuses.indexOf(e.status)>-1&&(e.selected=!0),e})),e.hasHkReservationStatus={data:r,options:{selectAll:a(r),hasSearch:!1,key:"description",defaultValue:"Select Status"}}},c.fillActionsBy=function(t){var a=[{value:"GUEST",name:"Guests"}];e.isHourlyRateOn||(a.push({value:"GROUP",name:"Groups"}),a.push({value:"BOTH",name:"Both"})),t.hasShowActionables={data:a,options:{key:"name"}}},c.fillRateCodesList=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER;return t&&t.rate_ids&&(r=e.length===t.rate_ids.length),r};o.fetchRateCode().then(function(n){if(a===s.RESERVATIONS_BY_USER){var o=_.find(n,{id:-1});if(!o){var i={id:-1,description:"UNDEFINED"};n.push(i)}}var l=angular.copy(n);t&&t.rate_ids&&(l=l.map(function(e){return e.selected=!1,t.rate_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasRateCodeList={data:l,options:{hasSearch:!0,selectAll:r(l),singleSelect:a!==s.RESERVATIONS_BY_USER,key:"description",defaultValue:"Select Rate"}}})},c.fillRoomTypes=function(e,t,a){var r=function(e){var a=!0;return t&&t.room_type_ids&&(a=e.length===t.room_type_ids.length),a};o.fetchRoomTypeList().then(function(n){if(a!==s.RESERVATIONS_BY_USER){var o=_.filter(n,function(e){return!e.is_suite&&!e.is_pseudo});n=o}var i=angular.copy(n);t&&t.room_type_ids&&(i=i.map(function(e){return e.selected=!1,t.room_type_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasRoomTypeList={data:i,options:{hasSearch:!1,selectAll:r(i),key:"name"}}})},c.fillSegments=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER;return t&&t.segment_ids&&(r=e.length===t.segment_ids.length),r};o.fetchSegments().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(a,{name:"UNDEFINED"});n||a.push(s),_.each(a,function(e){e.id=e.value});var o=angular.copy(a);t&&t.segment_ids&&(o=o.map(function(e){return e.selected=!1,t.segment_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasSegmentList={data:o,options:{selectAll:r(o),hasSearch:!1,key:"name"}}})},c.fillGuaranteeTypes=function(e,t,a){var r=function(e){var r=a===s.RESERVATIONS_BY_USER;return t&&t.include_guarantee_type&&(r=e.length===t.include_guarantee_type.length),r};o.fetchGuaranteeTypes().then(function(a){var s={is_active:!0,name:"UNDEFINED",value:-1},n=_.find(a,{name:"UNDEFINED"});n||a.push(s),_.each(a,function(e){e.id=e.name});var o=angular.copy(a);t&&t.include_guarantee_type&&(o=o.map(function(e){return e.selected=!1,t.include_guarantee_type.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasGuaranteeTypeList={data:o,options:{selectAll:r(o),hasSearch:!0,key:"name",defaultValue:"Select guarantees"}}})},c.fillEmployeeList=function(e,t){var a=function(e){var a=!0;return t&&t.user_ids&&(a=e.length===t.user_ids.length),a};o.fetchEmployeeList().then(function(r){var s=angular.copy(r.results);t&&t.user_ids&&(s=s.map(function(e){return e.selected=!1,t.user_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasUsers={title:"Employees",data:s,options:{selectAll:a(s),hasSearch:!0,key:"maid_name",altKey:"email"}}})},c.fillAddonGroups=function(e,t,a){var r=function(e){var a=!0;return t&&t.addon_group_ids?a=e.length===t.addon_group_ids.length:t&&!t.addon_group_ids&&(a=!1),a},s=function(e){var a=!0;if(t&&t.addon_ids){var r=t.addon_ids,s=0;_.each(e,function(e){r.indexOf(e.group_id)>-1&&(s+=e.list_of_addons.length)}),a=t.addon_ids.length===s}return a},n=function(e){var a=[];return _.each(e,function(e){e.disabled||_.each(e.list_of_addons,function(e){e.selected=!1,(t&&t.addon_ids&&t.addon_ids.indexOf(e.addon_id)>-1||angular.isUndefined(t))&&(e.selected=!0),a.push(e)})}),a},i=function(a,o){var i=angular.copy(a),l=angular.copy(o);t&&t.addon_group_ids&&(i=i.map(function(e){return e.selected=!1,t.addon_group_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasAddonGroups={title:"Addon Groups",data:i,options:{selectAll:r(i),hasSearch:!0,key:"name"},affectsFilter:{name:"hasAddons",process:function(e,t){_.each(e.originalData,function(e){e.disabled=!0}),_.each(e.originalData,function(e){_.each(t,function(t){e.group_id===t.id&&(e.disabled=!1)})}),e.updateData()}}},e.hasAddons={data:n(o),originalData:l,options:{selectAll:s(l),hasSearch:!0,key:"addon_name"},updateData:function(){this.data=n(this.originalData),this.options.selectAll=s(l)}}};o.fetchChargeNAddonGroups({for_addon_forecast_report:"Add-On Forecast"===a,include_payment:"Financial Transaction - Revenue Report"===a}).then(function(e){o.fetchAddons({addon_group_ids:_.pluck(e,"id")}).then(i.bind(null,e))})},c.fillResStatus=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=function(a){var r=angular.copy(a),s=function(e){var a=!0;return t&&t.status_ids?a=e.length===t.status_ids.length:angular.isDefined(t)&&!t.status_ids&&(a=!1),a};t&&t.status_ids&&(r=r.map(function(e){return e.selected=!1,t.status_ids.indexOf(e.id.toString())>-1&&(e.selected=!0),e})),e.hasReservationStatus={data:r,options:{selectAll:s(r),hasSearch:!1,key:"status",defaultValue:"Select status"}}};a?s(E):r?s(R):o.fetchReservationStatus().then(s)},c.fillRateCodes=function(e,t,a){t&&t.rate_id&&(a.rate_code=t.rate_id),o.fetchRateCode().then(function(t){e.hasRateCode={title:"Rate Codes",data:t}})},c.fillAgingBalances=function(e,t){var a=[{id:"0to30",status:"0-30 DAYS"},{id:"31to60",status:"31-60 DAYS"},{id:"61to90",status:"61-90 DAYS"},{id:"91to120",status:"91-120 DAYS"},{id:"120plus",status:"120+ DAYS"}],r=function(e){var a=!0;return t&&t.age_buckets?a=e.length===t.age_buckets.length:angular.isDefined(t)&&!t.age_buckets&&(a=!1),a},s=angular.copy(a);t&&t.age_buckets&&(s=s.map(function(e){return e.selected=!1,t.age_buckets.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasIncludeAgingBalance={data:s,options:{hasSearch:!1,selectAll:r(s),key:"status",defaultValue:"Select Aging Balance"}}},c.fillAccountNames=function(e,t){var a=function(e){var a=!1;return t&&t.account_ids?a=e.length===t.account_ids.length:angular.isDefined(t)&&!t.account_ids&&(a=!1),a};o.fetchAccounts().then(function(r){var s=angular.copy(r);t&&t.account_ids&&(s=s.map(function(e){return s.selected=!1,t.account_ids.indexOf(e.id)>-1&&(e.selected=!0),e})),e.hasAccountSearch={data:s,options:{selectAll:a(s),hasSearch:!0,key:"account_name",defaultValue:"Select Accounts"}}})},c}]),angular.module("reportsModule").factory("RVReportSetupDates",["RVReportNamesConst","RVReportUtilsFac",function(e,t){return{init:function(a){var r=t.processDate(),s={ARRIVAL:{fromDate:r.businessDate,untilDate:r.businessDate},DEPARTURE:{fromDate:r.businessDate,untilDate:r.businessDate},DEPOSIT_REPORT:{fromArrivalDate:r.businessDate,untilArrivalDate:r.aWeekAfter,fromDepositDate:r.businessDate,untilDepositDate:r.businessDate,fromPaidDate:r.businessDate,untilPaidDate:r.businessDate},GROUP_DEPOSIT_REPORT:{groupStartDate:r.businessDate,groupEndDate:r.twentyEightDaysAfter,fromPaidDate:r.twentyEightDaysBefore,untilPaidDate:r.businessDate},OCCUPANCY_REVENUE_SUMMARY:{fromDate:r.yesterday,untilDate:r.yesterday},DAILY_TRANSACTIONS:{singleValueDate:r.yesterday},DAILY_PAYMENTS:{singleValueDate:r.yesterday},MARKET_SEGMENT_STAT_REPORT:{singleValueDate:r.yesterday},COMPARISION_BY_DATE:{singleValueDate:r.yesterday},FORECAST_BY_DATE:{fromDate:r.businessDate,untilDate:r.aMonthAfter},FORECAST_GUEST_GROUPS:{fromDate:r.businessDate,untilDate:r.aMonthAfter},ADDON_FORECAST:{fromDate:r.businessDate,untilDate:r.businessDate},ALLOWANCE_FORECAST:{fromDate:r.tomorrow,untilDate:r.tomorrow},DAILY_PRODUCTION_ROOM_TYPE:{fromDate:r.monthStart,untilDate:r.businessDate},DAILY_PRODUCTION_DEMO:{fromDate:r.monthStart,untilDate:r.businessDate},DAILY_PRODUCTION_RATE:{fromDate:r.monthStart,untilDate:r.businessDate},RATE_RESTRICTION_REPORT:{fromDate:r.businessDate,untilDate:r.businessDate},IN_HOUSE_GUEST:{singleValueDate:r.businessDate},COMPANY_TA_TOP_PRODUCERS:{fromDate:r.aWeekAgo,untilDate:r.yesterday},FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:{fromDate:r.businessDate,untilDate:r.businessDate},"A/R_AGING":{untilDate:r.yesterday},COMPLIMENTARY_ROOM_REPORT:{fromDate:r.businessDate,untilDate:r.businessDate},GROUP_ROOMS_REPORT:{fromDate:r.businessDate,untilDate:r.thirtyOneDaysAfter},FINANCIAL_TRANSACTION_REVENUE_REPORT:{fromDate:r.yesterday,untilDate:r.yesterday},FINANCIAL_TRANSACTION_PAYMENT_REPORT:{fromDate:r.yesterday,untilDate:r.yesterday},FINANCIAL_TRANSACTION_SUMMARY_REPORT:{singleValueDate:r.yesterday},DEFAULT:{fromDate:r.aWeekAgo,untilDate:r.businessDate,fromCancelDate:r.aWeekAgo,untilCancelDate:r.businessDate,fromArrivalDate:r.aWeekAgo,untilArrivalDate:r.businessDate,fromCreateDate:r.aWeekAgo,untilCreateDate:r.businessDate,fromAdjustmentDate:r.aWeekAgo,untilAdjustmentDate:r.businessDate}},n=_.findKey(e,function(e,t){return e===a.title}),o=s[n]||s.DEFAULT;_.each(o,function(e,t){a[t]=e}),a.allDates=[]},execFilter:function(t,a){var r=function(e,r,s){t[e]=a,angular.extend(t[e],{showRemove:!0,fromModel:r}),s&&(t[e].untilModel=s),t.allDates.push(e)};"DATE_RANGE"===a.value&&(r("hasDateFilter","fromDate","untilDate"),t.title===e.CANCELLATION_NO_SHOW&&(t.hasDateFilter.description="Arrival Date Range"),t.title===e.BOOKING_SOURCE_MARKET_REPORT&&(t.hasDateFilter.description="Booked Date")),"CANCELATION_DATE_RANGE"!==a.value&&"CANCELLATION_DATE_RANGE"!==a.value||r("hasCancelDateFilter","fromCancelDate","untilCancelDate"),"ARRIVAL_DATE_RANGE"===a.value&&r("hasArrivalDateFilter","fromArrivalDate","untilArrivalDate"),"GROUP_START_DATE_RANGE"===a.value&&r("hasGroupStartDateRange","groupStartDate","groupEndDate"),"DEPOSIT_DATE_RANGE"===a.value&&r("hasDepositDateFilter","fromDepositDate","untilDepositDate"),"CREATE_DATE_RANGE"===a.value&&r("hasCreateDateFilter","fromCreateDate","untilCreateDate"),"PAID_DATE_RANGE"===a.value&&r("hasPaidDateRange","fromPaidDate","untilPaidDate"),"SINGLE_DATE"===a.value&&r("hasSingleDateFilter","singleValueDate"),"ADJUSTMENT_DATE_RANGE"===a.value&&r("hasAdjustmentDateRange","fromAdjustmentDate","untilAdjustmentDate")}}}]),sntRover.constant("RVCustomExportFilterParamsConst",{BOOKING_ORIGIN_CODE:"BOOKING_ORIGIN_CODE",MARKET_CODE:"MARKET_CODE",RESERVATION_STATUS:"RESERVATION_STATUS",ROOM_TYPE:"ROOM_TYPE",SEGMENT_CODE:"SEGMENT_CODE",SOURCE_CODE:"SOURCE_CODE",ACTIVE:"ACTIVE","DAYUSE INDICATOR":"DAYUSE INDICATOR",ROOM_NO:"ROOM_NO",ARRIVAL_ROOM_TYPE:"ARRIVAL_ROOM_TYPE",DEPARTURE_ROOM_TYPE:"DEPARTURE_ROOM_TYPE",LANGUAGE:"LANGUAGE",NATIONALITY:"NATIONALITY",ARRIVAL_RATE_CODE:"ARRIVAL_RATE_CODE",CI_AGENT:"CI_AGENT",CO_AGENT:"CO_AGENT",CI_APPLICATION:"CI_APPLICATION",CO_APPLICATION:"CO_APPLICATION",COUNTRY:"COUNTRY",VIP:"VIP",PRIMARY_PAYMENT_METHOD:"PRIMARY_PAYMENT_METHOD",MEMBERSHIP:"MEMBERSHIP",MEMBERSHIP_LEVEL:"MEMBERSHIP_LEVEL",STAY_TYPE:"STAY_TYPE",ORIGIN_CODE:"ORIGIN_CODE",CHARGE_GROUP:"CHARGE_GROUP",CHARGE_CODE_DESC:"CHARGE_CODE_DESC",CHARGE_CODE:"CHARGE_CODE",CHARGE_TYPE:"CHARGE_TYPE",PRE_STAY:"PRE_STAY",POST_STAY:"POST_STAY",RATE_CODE:"RATE_CODE",MARKET:"MARKET",ORIGIN:"ORIGIN",SEGMENT:"SEGMENT",SOURCE:"SOURCE",USER_NAME:"USER_NAME",HOLD_STATUS:"HOLD_STATUS",RESERVATION_TYPE:"RESERVATION_TYPE",TAX_EXEMPT:"TAX_EXEMPT",GLOBAL:"GLOBAL",GROUP_NAME:"GROUP_NAME",DO_NOT_MOVE:"DO_NOT_MOVE",IS_FLAGGED:"IS_FLAGGED",EXTERNAL_SYSTEM:"EXTERNAL_SYSTEM"}),sntRover.constant("RVReportDisplaysConst",{INCLUDE_MARKET:!0,INCLUDE_SOURCE:!0,INCLUDE_ORIGIN:!0,INCLUDE_SEGMENT:!0}),sntRover.constant("RVReportFiltersConst",{DATE_RANGE:!0,CANCELATION_DATE_RANGE:!0,CANCELLATION_DATE_RANGE:!0,ARRIVAL_DATE_RANGE:!0,GROUP_START_DATE_RANGE:!0,DEPOSIT_DATE_RANGE:!0,CREATE_DATE_RANGE:!0,PAID_DATE_RANGE:!0,SINGLE_DATE:!0,ADJUSTMENT_DATE_RANGE:!0,TIME_RANGE:!0,CICO:!0,INCLUDE_COMPANYCARD_TA_GROUP:!0,GROUP_COMPANY_TA_CARD:!0,INCLUDE_GUARANTEE_TYPE:!0,INCLUDE_CHARGE_GROUP:!0,INCLUDE_CHARGE_CODE:!0,CHOOSE_MARKET:!0,CHOOSE_SEGMENT:!0,CHOOSE_SOURCE:!0,CHOOSE_BOOKING_ORIGIN:!0,HOLD_STATUS:!0,DAYS_0_30:!0,ACCOUNT_SEARCH:!0,GROUP_CODE:!0}),sntRover.constant("RVReportFiltersKmConst",{DATE_RANGE:"DATE_RANGE",CANCELATION_DATE_RANGE:"CANCELATION_DATE_RANGE",CANCELLATION_DATE_RANGE:"CANCELLATION_DATE_RANGE",ARRIVAL_DATE_RANGE:"ARRIVAL_DATE_RANGE",GROUP_START_DATE_RANGE:"GROUP_START_DATE_RANGE",DEPOSIT_DATE_RANGE:"DEPOSIT_DATE_RANGE",CREATE_DATE_RANGE:"CREATE_DATE_RANGE",PAID_DATE_RANGE:"PAID_DATE_RANGE",SINGLE_DATE:"SINGLE_DATE",ADJUSTMENT_DATE_RANGE:"ADJUSTMENT_DATE_RANGE",TIME_RANGE:"TIME_RANGE",CICO:"CICO",INCLUDE_COMPANYCARD_TA_GROUP:"INCLUDE_COMPANYCARD_TA_GROUP",GROUP_COMPANY_TA_CARD:"GROUP_COMPANY_TA_CARD",INCLUDE_GUARANTEE_TYPE:"INCLUDE_GUARANTEE_TYPE",INCLUDE_CHARGE_GROUP:"INCLUDE_CHARGE_GROUP",INCLUDE_CHARGE_CODE:"INCLUDE_CHARGE_CODE",CHOOSE_MARKET:"CHOOSE_MARKET",CHOOSE_SOURCE:"CHOOSE_SOURCE",CHOOSE_BOOKING_ORIGIN:"CHOOSE_BOOKING_ORIGIN",HOLD_STATUS:"HOLD_STATUS",GROUP_CODE:"GROUP_CODE"}),angular.module("reportsModule").constant("RVReportInboxFilterLabelConst",{from_date:"Date Range (From)",to_date:"Date Range (To)",cancel_from_date:"Cancel From Date",cancel_to_date:"Cancel To Date",arrival_from_date:"Arrival From Date",arrival_to_date:"Arrival To Date",group_from_date:"Group Start Date",group_to_date:"Group End Date",deposit_from_date:"Deposit From Date",deposit_to_date:"Deposit To Date",paid_from_date:"Paid From Date",paid_to_date:"Paid To Date",create_from_date:"Create From Date",create_to_date:"Create To Date",date:"Date",from_time:"From Time",to_time:"To Time",rate_ids:"Rates",assigned_departments:"Departments",selected_language:"Language",include_guarantee_type:"Guarantee Types",market_ids:"Markets",segment_ids:"Segments",source_ids:"Sources",booking_origin_ids:"Origin(s)",hold_status_ids:"Hold Status",status_ids:"Reservation Status",room_type_ids:"Room Types",restriction_ids:"Restrictions",campaign_types:"Campaign Types",status:"Completion Status",age_buckets:"Aging Balance",tax_exempt_type_ids:"Tax Exempt Type",include_long_stays:"Include long stays",account_ids:"Account Name(s)",travel_agent_ids:"Travel Agents",floor:"Floors",sort_field:"Sort By",sort_dir:"Sort Order",OPTIONS:"Option(s)",deposit_due:"Deposit Due",deposit_paid:"Deposit Paid",deposit_past:"Deposit Past",include_canceled:"Include Canceled",include_market:"Include Market",include_no_show:"Include No Show",include_tax:"Include Tax",show_adjustments:"Show Adjustments",DISPLAY:"Display(s)",include_origin:"Include Origin",include_segment:"Include Segment",include_source:"Include Source","0to30":"0-30 DAYS","31to60":"31-60 DAYS","61to90":"61-90 DAYS","91to120":"91-120 DAYS","120plus":"120+ DAYS",actions_by:"Show",origin:"Origin(s)",urls:"URL(s)",addon_group_ids:"Add-on Group(s)",addon_ids:"Add-on(s)",group_field:"Group By",include_companycard_ta_group:"Company/TA/Group",due_in_arrivals:"DUE IN ARRIVALS",include_actions:"INCLUDE ACTIONS",checked_in:"Show only Check Ins",checked_out:"Show only Check Outs","CHECK IN/ CHECK OUT":"CHECK IN/ CHECK OUT",SHOW:"SHOW",show_company:"SHOW COMPANY",show_travel_agent:"SHOW TRAVEL AGENTS",min_revenue:"MIN REVENUE",min_room_nights:"MIN NIGHTS",include_ledger_data:"Include Ledger Data",exceeded_only:"Exceeded Only",include_due_out:"Include Due Out",include_inhouse:"Include Inhouse",rate_type_ids:"Rate Types",charge_code_ids:"Charge Code(s)",charge_group_ids:"Charge Group(s)",due_out_departures:"Due Out Departures",include_guest_notes:"Include Guest Notes",include_reservation_notes:"Include Reservation Notes",show_guests:"Show Guests",vip_only:"Vip Only","GUEST/ACCOUNT":"Guest/Account",user_ids:"Employees",exclude_non_gtd:" Exclude Non-Guaranteed",include_group:"Group",restricted_post_only:"Restricted Post Only",rover:"Rover",zest:"Zest",zest_web:"Zest Web",include_last_year:"Include Last Year",include_variance:"Include Variance",include_both:"Include Both",include_new:"Include New",show_rate_adjustments_only:"Show Rate Adjustments Only",ooo:"OOO",oos:"OOS",min_number_of_days_not_occupied:"Min No of Days Not Occupied",year:"Year","COMPANY/TRAVEL_AGENT":"Company/Travel Agent",exclude_tax:"Exclude Tax",show_deleted_charges:"Show Deleted Charges",account:"Account",guest:"Guest",include_cancelled:"Include Cancelled",show_room_revenue:"Show Room Revenue",with_vat_number:"Cards with tax id",without_vat_number:"Cards without tax id",include_companycard_ta:"Include CC/TA",BOOKED_DATE_FROM:"Booked Date (From)",BOOKED_DATE_TO:"Booked Date (To)",SHOW_CHECKINS_AND_CHECKOUTS:"Show Check Ins and Check Outs",no_nationality:"No Nationality",rate_id:"Rate","COMPANY/TA":"Company/TA",group_company_ta_card:"Company/TA/Group",GROUP_BY:"Group By",group_by_date:"Date",group_by_user:"User",group_by_group_name:"Group name",DEPOSIT_DUE_FROM_DATE:"Deposit Due From Date",DEPOSIT_DUE_TO_DATE:"Deposit Due To Date",group_code:"Group Code",country_ids:"Country",include_day_use:"Include Day Use",show_upsell_only:"Show Upsells Only"}),angular.module("reportsModule").constant("RVReportMsgsConst",{REPORT_FILTER_CHANGED:"report.filter.change",REPORT_SUBMITED:"report.submited",REPORT_UPDATED:"report.updated",REPORT_PAGE_CHANGED:"report.page.changed",REPORT_PRE_PRINT_DONE:"report.pre.print.done",REPORT_PRINTING:"report.printing",REPORT_API_FAILED:"report.API.failed",REPORT_LIST_SCROLL_REFRESH:"report.list.scroll.refresh",REPORT_DETAILS_FILTER_SCROLL_REFRESH:"report.details.filter.scroll.refresh",
REPORT_LOAD_LAST_REPORT:"report.show.last"}),angular.module("reportsModule").constant("RVReportNamesConst",{CHECK_IN_CHECK_OUT:"Check In / Check Out",CHECKIN_NOW_OR_LATER:"Check In - Now or Later",UPSELL:"Upsell",ROOM_UPSELL:"Room Upsell",WEB_CHECK_OUT_CONVERSION:"Web Check Out Conversion",WEB_CHECK_IN_CONVERSION:"Web Check In Conversion",WEB_CHECK_IN_CONV_BY_DAY:"Web Check In Conversion By Day",LATE_CHECK_OUT:"Late Check Out",EARLY_CHECKIN:"Early Check In",IN_HOUSE_GUEST:"In-House Guests",ARRIVAL:"Arrival",DEPARTURE:"Departure",BOOKING_SOURCE_MARKET_REPORT:"Booking Source & Market Report",CANCELLATION_NO_SHOW:"Cancellation & No Show",DEPOSIT_REPORT:"Guest Deposit Report",GROUP_DEPOSIT_REPORT:"Group Deposit Report",LOGIN_AND_OUT_ACTIVITY:"Login and out Activity",OCCUPANCY_REVENUE_SUMMARY:"Occupancy & Revenue Summary",RESERVATIONS_BY_USER:"Reservations By User",DAILY_TRANSACTIONS:"Daily Transactions",DAILY_PAYMENTS:"Daily Payments",FORECAST_BY_DATE:"Forecast",ROOMS_QUEUED:"Rooms Queued",FORECAST_GUEST_GROUPS:"Forecast Guests & Groups",MARKET_SEGMENT_STAT_REPORT:"Market Segment Statistics Report",MOBILE_CHECKIN_NOW:"Mobile Check In - Now",MOBILE_CHECKIN:"Mobile Check In",COMPARISION_BY_DATE:"Comparison",RATE_ADJUSTMENTS_REPORT:"Rate Adjustment Report",GROUP_PICKUP_REPORT:"Group Pick Up Report",GUEST_BALANCE_REPORT:"Guest Balance Report",ADDON_FORECAST:"Add-On Forecast",ALLOWANCE_FORECAST:"Allowance Forecast Report",DAILY_PRODUCTION_ROOM_TYPE:"Daily Production",AR_SUMMARY_REPORT:"A/R Summary Report",DAILY_PRODUCTION_DEMO:"Daily Production by Demographics",DAILY_PRODUCTION_RATE:"Daily Production by Rate",RATE_RESTRICTION_REPORT:"Rate & Restrictions",COMPANY_TA_TOP_PRODUCERS:"Company/TA Top Producers",FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:"Financial Transactions - Adjustment Report",CREDIT_CHECK_REPORT:"Credit Check Report",DEPOSIT_SUMMARY:"Deposit Balance Summary",ZEST_CAMPAIGN_REPORT:"Zest App Campaign Report",ROOMS_OOO_OOS:"Rooms OOO/OOS",ACTIONS_MANAGER:"Action Manager",VACANT_ROOMS_REPORT:"Vacant Rooms Report","A/R_AGING":"A/R Aging",TRAVEL_AGENT_COMMISSIONS:"Travel Agent Commissions",BUSINESS_ON_BOOKS:"Business on the Books",COMPLIMENTARY_ROOM_REPORT:"Complimentary Room Report",GROUP_ROOMS_REPORT:"Group Rooms Report",ADDON_UPSELLS:"Add On Upsell",YEARLY_TAX:"Yearly Tax Report",TAX_EXEMPT:"Tax Exempt",FOLIO_TAX_REPORT:"Folio Tax Report",GUESTS_INHOUSE_BY_NATIONALITY:"Guests In House by Nationality",BUSINESS_ON_THE_BOOKS:"Business on the Books",ROOM_STATUS_REPORT:"Room Status Report",FINANCIAL_TRANSACTION_REVENUE_REPORT:"Financial Transaction - Revenue Report",FINANCIAL_TRANSACTION_PAYMENT_REPORT:"Financial Transaction - Payment Report",FINANCIAL_TRANSACTION_SUMMARY_REPORT:"Financial Transaction - Summary Report",TAX_OUTPUT_REPORT:"Tax Output Report - Tax Payment Receipts"}),sntRover.constant("RVReportOptionsConst",{INCLUDE_NOTES:!0,VIP_ONLY:!0,INCLUDE_VARIANCE:!0,INCLUDE_LAST_YEAR:!0,INCLUDE_CANCELLED:!0,INCLUDE_CANCELED:!0,INCLUDE_NO_SHOW:!0,SHOW_GUESTS:!0,ROVER:!0,ZEST:!0,ZEST_WEB:!0,DEPOSIT_PAID:!0,DEPOSIT_DUE:!0,DEPOSIT_PAST:!0,DUE_IN_ARRIVALS:!0,DUE_OUT_DEPARTURES:!0,INCLUDE_NEW:!0,INCLUDE_BOTH:!0,EXCLUDE_NON_GTD:!0,SHOW_RATE_ADJUSTMENTS_ONLY:!0,INCLUDE_TAX:!0,EXCLUDE_TAX:!0,INCLUDE_LEDGER_DATA:!0}),angular.module("reportsModule").constant("RVReportPaginationIdsConst",{"Action Manager":"ACTIONS_MANAGER",Arrival:"ARRIVAL","Cancellation & No Show":"CANCELLATION_NO_SHOW",Departure:"DEPARTURE","Guest Balance Report":"GUEST_BALANCE_REPORT","Guest Deposit Report":"DEPOSIT_REPORT","In-House Guests":"IN_HOUSE_GUEST","Late Check Out":"LATE_CHECK_OUT","Login and out Activity":"LOGIN_AND_OUT_ACTIVITY","Rate Adjustment Report":"RATE_ADJUSTMENTS_REPORT","Vacant Rooms Report":"VACANT_ROOMS_REPORT","A/R Summary Report":"AR_SUMMARY_REPORT",Forecast:"FORECAST_BY_DATE","Forecast Guests & Groups":"FORECAST_GUEST_GROUPS","Reservations By User":"RESERVATIONS_BY_USER",Upsell:"UPSELL","Room Upsell":"ROOM_UPSELL","Rooms OOO/OOS":"ROOMS_OOO_OOS","Company/TA Top Producers":"COMPANY_TA_TOP_PRODUCERS","Credit Check Report":"CREDIT_CHECK_REPORT","Deposit Balance Summary":"DEPOSIT_SUMMARY","Business on the Books":"BUSINESS_ON_BOOKS","Complimentary Room Report":"COMPLIMENTARY_ROOM_REPORT","Group Rooms Report":"GROUP_ROOMS_REPORT","Add On Upsell":"ADDON_UPSELLS","Tax Exempt":"TAX_EXEMPT","Folio Tax Report":"FOLIO_TAX_REPORT","Guests In House by Nationality":"GUESTS_INHOUSE_BY_NATIONALITY"}),angular.module("reportsModule").constant("RVReportParamsConst",{FROM_DATE:"from_date",TO_DATE:"to_date",CANCEL_FROM_DATE:"cancel_from_date",CANCEL_TO_DATE:"cancel_to_date",ARRIVAL_FROM_DATE:"arrival_from_date",ARRIVAL_TO_DATE:"arrival_to_date",GROUP_START_DATE:"group_from_date",GROUP_END_DATE:"group_to_date",DEPOSIT_FROM_DATE:"deposit_from_date",DEPOSIT_TO_DATE:"deposit_to_date",PAID_FROM_DATE:"paid_from_date",PAID_TO_DATE:"paid_to_date",CREATE_FROM_DATE:"create_from_date",CREATE_TO_DATE:"create_to_date",ADJUSTMENT_FROM_DATE:"adjustment_from_date",ADJUSTMENT_TO_DATE:"adjustment_to_date",SINGLE_DATE:"date",FROM_TIME:"from_time",TO_TIME:"to_time",SELECTED_LANGUAGE:"locale",SORT_FIELD:"sort_field",SORT_DIR:"sort_dir",GROUP_BY_DATE:"group_by_date",GROUP_BY_USER:"group_by_user",GROUP_BY_GROUP_NAME:"group_by_group_name",ADDON_GROUP_BY:"group_field",CHARGE_TYPE:"group_by_charge_type",USER_IDS:"user_ids",MARKET_IDS:"market_ids",SEGMENT_IDS:"segment_ids",SOURCE_IDS:"source_ids",BOOKING_ORIGIN_IDS:"booking_origin_ids",INCLUDE_GUARANTEE_TYPE:"include_guarantee_type",CHARGE_GROUP_IDS:"charge_group_ids",CHARGE_CODE_IDS:"charge_code_ids",HOLD_STATUS_IDS:"hold_status_ids",ADDONS_GROUPS_IDS:"addon_group_ids",ADDONS_IDS:"addon_ids",RESERVATION_STATUS:"status_ids",RESERVATION_ADDONS:"addon_ids",RATE_IDS:"rate_ids",RATE_TYPE_IDS:"rate_type_ids",RESTRICTION_IDS:"restriction_ids",ROOM_TYPE_IDS:"room_type_ids",RATE_ID:"rate_id",ORIGIN_VALUES:"origin",ORIGIN_URLS:"urls",CAMPAIGN_TYPES:"campaign_types",FLOOR:"floor",ASSIGNED_DEPARTMENTS:"assigned_departments",COMPLETION_STATUS:"status",AGING_BALANCE:"age_buckets",ACCOUNT_SEARCH:"account_ids",SHOW_ACTIONABLES:"actions_by",TRAVEL_AGENTS:"travel_agent_ids",TRAVEL_AGENTS_PER_PAGE_COUNT:25,RECEIPTS_PER_PAGE_COUNT:25,RESERVATION_STATUS_ARRAY:"status_ids[]",VAT_YEAR:"year",WITH_VAT_NUMBER:"with_vat_number",WITHOUT_VAT_NUMBER:"without_vat_number",DEPOSIT_DUE:"deposit_due",DEPOSIT_PAID:"deposit_paid",DEPOSIT_PAST:"deposit_past",INCLUDE_CANCELED:"include_canceled",INCLUDE_NO_SHOW:"include_no_show",INCLUDE_TAX:"include_tax",SHOW_DELETED_CHARGES:"show_deleted_charges",SHOW_ADJUSTMENTS:"show_adjustments",INCLUDE_MARKET:"include_market",INCLUDE_ORIGIN:"include_origin",INCLUDE_SEGMENT:"include_segment",INCLUDE_SOURCE:"include_source",SHOW_ROOM_REVENUE:"show_room_revenue",INCLUDE_ACTIONS:"include_actions",INCLUDE_GUEST_NOTES:"include_guest_notes",INCLUDE_RESERVATION_NOTES:"include_reservation_notes",INCLUDE_COMPANYCARD_TA_GROUP:"include_companycard_ta_group",DUE_IN_ARRIVALS:"due_in_arrivals",CHECKED_IN:"checked_in",CHECKED_OUT:"checked_out",SHOW_TRAVEL_AGENT:"show_travel_agent",SHOW_COMPANY:"show_company",MIN_REVENUE:"min_revenue",MIN_NIGHTS:"min_room_nights",INCLUDE_LEDGER_DATA:"include_ledger_data",EXCEEDED_ONLY:"exceeded_only",INCLUDE_DUE_OUT:"include_due_out",INCLUDE_INHOUSE:"include_inhouse",SHOW_GUESTS:"show_guests",VIP_ONLY:"vip_only",ACCOUNT:"account",GUEST:"guest",EXCLUDE_NON_GTD:"exclude_non_gtd",INCLUDE_GROUP:"include_group",RESTRICTED_POST_ONLY:"restricted_post_only",ROVER:"rover",ZEST:"zest",ZEST_WEB:"zest_web",INCLUDE_LAST_YEAR:"include_last_year",INCLUDE_VARIANCE:"include_variance",INCLUDE_BOTH:"include_both",INCLUDE_NEW:"include_new",SHOW_RATE_ADJUSTMENTS_ONLY:"show_rate_adjustments_only",OOO:"ooo",OOS:"oos",MIN_NO_OF_DAYS_NOT_OCCUPIED:"min_number_of_days_not_occupied",EXCLUDE_TAX:"exclude_tax",DUE_OUT_DEPARTURES:"due_out_departures",INCLUDE_CANCELLED:"include_cancelled",ENTITY_TYPE:"entity_type",INCLUDE_COMPANYCARD_TA:"include_companycard_ta",NO_NATIONALITY:"no_nationality",GROUP_COMPANY_TA_CARD:"group_company_ta_card",GROUP_CODE:"group_code",TAX_EXEMPT_TYPE:"tax_exempt_type_ids",TA_CC_CARD:"ta_cc_card",SHOW_VAT_WITH_RATES:"show_vat_with_rates",COUNTRY:"country_ids",INCLUDE_LONG_STAYS:"include_long_stays",INCLUDE_DAYUSE:"include_day_use",SHOW_UPSELL_ONLY:"show_upsell_only",ENTITY_NAME:"entity_name",WORK_TYPE:"work_type_ids",FRONT_OFFICE_STATUS:"fo_status_ids",HOUSEKEEPING_STATUS:"hk_status_ids",HK_RESERVATION_STATUSES:"hk_reservation_statuses",HK_FRONT_OFFICE_STATUSES:"hk_fo_statuses",PAYMENT_TYPES:"payment_types",TRANSACTION_CATEGORY:"transaction_category",SHOW_EMPLOYEES_INCLUDING_EOD:"show_employee_including_eod",TAX_RECEIPT_TYPE_VALUES:"tax_receipt_type_values",EXPANDED_OR_COLLAPSED:"summary_type"}),angular.module("sntRover").controller("RVReportsInboxCtrl",["$rootScope","$scope","RVReportsInboxSrv","generatedReportsList","$state","$filter","sntActivity","$timeout","RVreportsSrv","RVReportNamesConst","RVreportsSubSrv","RVReportUtilsFac","$q","RVReportMsgsConst",function(e,t,a,r,s,n,o,i,l,c,u,d,p,h){var E=this;BaseCtrl.call(this,t),t.viewStatus.showDetails=!1,t.maxDateRange=1;var R="report-inbox-scroller",f="report_filters_proc_activity",T="report_inbox_pagination";t.createNewReport=function(){t.$parent.reportList=JSON.parse(JSON.stringify(t.reportListCopy)),s.go("rover.reports.dashboard")},t.shouldDisableInboxItem=function(e){return e.message||"IN_PROGRESS"===e.status.value||"REQUESTED"===e.status.value},t.getColorCodeForReportStatus=function(e){var t="";return e.message?t="red":"IN_PROGRESS"===e.status.value&&(t="blue"),t},t.getRequestedReportStatus=function(e){var t=e.message;return"IN_PROGRESS"!==e.status.value&&"REQUESTED"!==e.status.value||(t=e.status.description),t},E.refreshScroll=function(){i(function(){t.refreshScroller(R)},800)},t.showReportDetails=function(e){e.isExpanded?(e.isExpanded=!e.isExpanded,E.refreshScroll()):e.filterDetails?(e.isExpanded=!e.isExpanded,E.refreshScroll()):(o.start(f),a.processFilters(e).then(function(t){e.filterDetails=t,e.isExpanded=!e.isExpanded,o.stop(f),E.refreshScroll()}).catch(function(t){e.filterDetails=t,e.isExpanded=!e.isExpanded,o.stop(f),E.refreshScroll()}))},E.setScroller=function(){var e={tap:!0,preventDefault:!1};t.setScroller(R,e)},E.refreshAndAdjustScroll=function(){i(function(){t.refreshScroller(R),i(function(){t.getScroller(R).scrollTo(0,0)},200)},800)},E.createDateDropdownData=function(){var t=new tzIndependentDate(e.serverDate),a=new tzIndependentDate(t),r=new tzIndependentDate(t),s=new tzIndependentDate(t);a.setDate(a.getDate()-1),r.setDate(r.getDate()-2),s.setDate(s.getDate()-3);var o=[{name:"Today("+n("date")(t,e.dateFormat)+")",value:n("date")(t,"yyyy-MM-dd")},{name:"Yesterday("+n("date")(a,e.dateFormat)+")",value:n("date")(a,"yyyy-MM-dd")},{name:n("date")(r,e.dateFormat),value:n("date")(r,"yyyy-MM-dd")},{name:n("date")(s,e.dateFormat),value:n("date")(s,"yyyy-MM-dd")}];return o},E.generateRequestParams=function(r){var s={user_id:e.userId,generated_date:t.reportInboxData.filter.selectedDate,per_page:a.PER_PAGE,page:r,query:t.reportInboxData.filter.searchTerm};return s},E.fetchGeneratedReports=function(r,s){t.reportInboxPageState.returnPage=s;var o=function(a){t.reportInboxData.generatedReports=E.getFormatedGeneratedReports(a.results,t.reportList),t.totalResultCount=a.total_count,r&&e.serverDate!==a.background_report_default_date&&(e.serverDate=a.background_report_default_date,t.dateDropDown=E.createDateDropdownData(),t.reportInboxData.filter.selectedDate=n("date")(e.serverDate,"yyyy-MM-dd"),E.fetchGeneratedReports(!1,1)),E.refreshPagination(),E.refreshAndAdjustScroll()},i={onSuccess:o,params:E.generateRequestParams(s)};t.callAPI(a.fetchReportInbox,i)},E.setPageOptions=function(){t.pageOptions={id:T,api:[E.fetchGeneratedReports,!1],perPage:a.PER_PAGE}},E.refreshPagination=function(){t.refreshPagination(T)},E.getFormatedGeneratedReports=function(e,t){return a.formatReportList(e,t)},t.shouldShowReportList=function(){return t.totalResultCount>0},t.refreshReportInbox=function(){t.reportInboxPageState.returnDate=t.reportInboxData.filter.selectedDate,E.fetchGeneratedReports(!0,1)},t.shouldShowPagination=function(){return t.totalResultCount>a.PER_PAGE},t.filterByQuery=_.debounce(function(){t.$apply(function(){E.fetchGeneratedReports(!1,1)})},800),t.clearQuery=function(){t.reportInboxData.filter.searchTerm="",E.fetchGeneratedReports(!1,1)};var S=function(){var e={guaranteeTypes:t.$parent.guaranteeTypes,markets:t.$parent.markets,sources:t.$parent.sources,origins:t.$parent.origins,codeSettings:t.$parent.codeSettings,holdStatus:t.$parent.holdStatus,chargeNAddonGroups:t.$parent.chargeNAddonGroups,chargeCodes:t.$parent.chargeCodes,addons:t.$parent.addons,reservationStatus:t.$parent.reservationStatus,assigned_departments:t.$parent.assigned_departments,activeUserList:t.$parent.activeUserList,travel_agent_ids:t.$parent.travel_agents};return l.saveCofigurationData(e),e},A=function(e){var a=l.getChoosenReport()?l.getChoosenReport().id:null,r=t.$parent,s=_.find(t.reportList,function(t){return e.report_id===t.id}),o=p.defer(),i=e.name;return s.usedFilters=e.filters,i!==c.DAILY_PRODUCTION_ROOM_TYPE&&i!==c.DAILY_PRODUCTION_DEMO&&i!==c.DAILY_PRODUCTION_RATE||(s.usedFilters.to_date=n("date")(e.filterToDate,"yyyy-MM-dd"),s.usedFilters.from_date=n("date")(e.filterFromDate,"yyyy-MM-dd")),s.generatedReportId=e.id,a!==e.id&&r.printOptions.resetSelf(),l.processSelectedReport(s,S()),d.findFillFilters(s,t.$parent.reportList).then(function(){s=_.extend(JSON.parse(JSON.stringify(s)),e.rawData),s.appliedFilter=e.appliedFilter,l.setChoosenReport(s),o.resolve()}),o.promise};t.showGeneratedReportFromInbox=function(e){delete e.filterFromDate,delete e.filterToDate,e.name!==c.TRAVEL_AGENT_COMMISSIONS&&(delete e.filters.from_date,delete e.filters.to_date);var a=t.$parent;e.shouldShowExport&&!e.shouldDisplayView||t.shouldDisableInboxItem(e)||(l.setSelectedReport(e),t.$emit("showLoader"),i(function(){A(e).then(function(){a.genReport(null,null,null,!1)})},2e3))},t.exportCSV=function(e){var a=t.$parent;A(e).then(function(){a.exportCSV()})},E.setTitleAndHeading=function(){var e=n("translate")("MENU_REPORTS_INBOX");t.setTitle(e),t.$parent.heading=e},E.resetPreviousReportSelection=function(){_.map(t.$parent.reportList,function(e){e.uiChosen=!1,_.map(e.filters,function(e){e.filled&&(e.filled=!1)})})},t.printReportFromInbox=function(a){t.viewStatus.showDetails=!0,l.setSelectedReport(a),i(function(){e.$broadcast("PRINT_INBOX_REPORT")},100)},t.addListener(h.REPORT_API_FAILED,function(e,a){t.errorMessage=a}),t.clearErrorMsg=function(){t.errorMessage=""},t.addListener("CLEAR_ERROR_MSG",function(){t.errorMessage=[]}),E.init=function(){var o=s.params.date?s.params.date:e.serverDate;t.reportInboxData={selectedReportAppliedFilters:{},generatedReports:[],filter:{selectedDate:n("date")(o,"yyyy-MM-dd"),searchTerm:""},isReportInboxOpen:!1},t.dateDropDown=E.createDateDropdownData(),E.setPageOptions(),E.setScroller(),E.setTitleAndHeading(),a.processReports(t.reportList),t.reportInboxData.generatedReports=E.getFormatedGeneratedReports(r.results,t.reportList),t.totalResultCount=r.total_count,t.reportInboxPageState.returnDate=t.reportInboxData.filter.selectedDate,i(function(){t.$broadcast("updatePagination",T),t.$broadcast("updatePageNo",s.params.page)},50),E.refreshAndAdjustScroll(),E.resetPreviousReportSelection(),l.getChoosenReport()&&(l.getChoosenReport().generatedReportId=null)},E.init()}]),angular.module("sntRover").controller("RVScheduleReportsAndExportsCtrl",["$scope","$timeout","$state","$filter","$stateParams","$rootScope","Toggles","ngDialog",function(e,t,a,r,s,n,o,i){BaseCtrl.call(this,e);var l={showingAllReport:!1,showingScheduledReports:!1,showingScheduleAReport:!1,showingExportReports:!1,showingExportAReport:!1,showingCustomExports:!1,showingCustomNewExport:!1},c=function(){var t=e.reportList;return e.reportViewStore.showingScheduledReports||e.reportViewStore.showingExportReports?t=e.schedulesList:e.reportViewStore.showingScheduleAReport||e.reportViewStore.showingExportAReport?t=e.schedulableReports:e.reportViewStore.showingCustomExports?t=e.customExportsData.scheduledCustomExports:e.reportViewStore.showingCustomNewExport&&(t=e.customExportsData.customExportDataSpaces),t},u=function(){e.setScroller("FULL_REPORT_SCROLL",{tap:!0,preventDefault:!1,scrollX:!0,scrollY:!1})},d=function(t){e.refreshScroller("FULL_REPORT_SCROLL"),!t&&e.$parent.myScroll&&e.$parent.myScroll.hasOwnProperty("FULL_REPORT_SCROLL")&&e.$parent.myScroll.FULL_REPORT_SCROLL.scrollTo(0,0,100)},p=function(){t(function(){e.refreshScroller("report-list-scroll"),e.myScroll&&e.myScroll["report-list-scroll"]&&e.myScroll["report-list-scroll"].refresh(),e.myScroll&&e.myScroll["report-filter-sidebar-scroll"]&&e.myScroll["report-filter-sidebar-scroll"].refresh()},200)},h=function(t){var a=[];return a.push(angular.isDefined(t)?"cols-"+t:"cols-"+e.reportViewActions.ONE),e.reportViewStore&&(e.reportViewStore.showingCustomNewExport||e.reportViewStore.showingCustomExports)&&t===e.viewColsActions.SIX&&a.push("with-bottom-form"),a};e.viewColsActions={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6},e.reportViewActions={SHOW_ALL_REPORTS:"SHOW_ALL_REPORTS",SHOW_SCHEDULED_REPORTS:"SHOW_SCHEDULED_REPORTS",SHOW_SCHEDULE_A_REPORT:"SHOW_SCHEDULE_A_REPORT",SHOW_EXPORT_REPORTS:"SHOW_EXPORT_REPORTS",SHOW_EXPORT_A_REPORT:"SHOW_EXPORT_A_REPORT",SHOW_CUSTOM_EXPORTS:"SHOW_CUSTOM_EXPORTS",SHOW_CUSTOM_NEW_EXPORT:"SHOW_CUSTOM_NEW_EXPORT"};var E=function(t){switch(t){case e.reportViewActions.SHOW_ALL_REPORT:return angular.extend({},l,{showingAllReport:!0});case e.reportViewActions.SHOW_SCHEDULED_REPORTS:return angular.extend({},l,{showingScheduledReports:!0});case e.reportViewActions.SHOW_SCHEDULE_A_REPORT:return angular.extend({},l,{showingScheduleAReport:!0});case e.reportViewActions.SHOW_EXPORT_REPORTS:return angular.extend({},l,{showingExportReports:!0});case e.reportViewActions.SHOW_EXPORT_A_REPORT:return angular.extend({},l,{showingExportAReport:!0});case e.reportViewActions.SHOW_CUSTOM_EXPORTS:return angular.extend({},l,{showingCustomExports:!0});case e.reportViewActions.SHOW_CUSTOM_NEW_EXPORT:return angular.extend({},l,{showingCustomNewExport:!0});default:return angular.extend({},l,{showingAllReport:!0})}};e.updateView=function(t){e.reportViewStore=E(t)},e.filterByQuery=function(){var t,a,r,s=e.query.toLowerCase().trim(),n=c();if(e.updateViewCol(e.viewColsActions.ONE),s.length<3){for(a=0,r=n.length;a<r;a++)n[a].filteredOut=!1;return void p()}for(e.uiChosenReport&&(e.uiChosenReport.uiChosen=!1),a=0,r=n.length;a<r;a++)t=n[a].title||n[a].name||n[a].report&&n[a].report.title,t=t.toLowerCase(),n[a].filteredOut=t.indexOf(s)===-1;p()},e.clearQuery=function(){e.query="",c().map(function(e){e.filteredOut=!1}),p()},e.reportMainMenuChange=function(t){e.updateViewCol(e.viewColsActions.ONE),e.updateView(t),e.$broadcast("RESET_CURRENT_STAGE")},e.updateViewCol=function(t,a){e.viewColClassName=h(t),d(a)},e.$on("REPORT_LIST_FILTER_SCROLL_REFRESH",p);var R=function(){var t="";e.reportViewStore.showingScheduledReports||e.reportViewStore.showingExportReports?t=r("translate")("SCHEDULED_REPORTS_AND_EXPORTS"):e.reportViewStore.showingScheduleAReport?t=r("translate")("SCHEDULE_REPORT"):e.reportViewStore.showingExportAReport&&(t=r("translate")("SCHEDULE_EXPORT")),e.setTitle(t),e.$parent.heading=t};e.reloadState=function(){a.reload()};var f=function(t,a,o){var i=r("translate")("SCHEDULED_REPORTS");a?i=r("translate")("SCHEDULED_EXPORTS"):o&&(i=r("translate")("CUSTOM_EXPORTS")),s&&s.showScheduledReports===t&&s.showScheduledExports===a&&s.showCustomExports===o?n.setPrevState={title:i,callback:"reloadState",scope:e}:n.setPrevState={title:i,name:"rover.reports.scheduleReportsAndExports",param:{showScheduledReports:t,showScheduledExports:a,showCustomExports:o}}};e.createNewReportSchedule=function(){e.$broadcast("CREATE_NEW_REPORT_SCHEDULE"),f(!0,!1,!1)},e.createNewExportSchedule=function(){e.$broadcast("CREATE_NEW_EXPORT_SCHEDULE"),f(!1,!0,!1)},e.$on("UPDATE_TITLE_AND_HEADING",function(){R()}),e.createNewCustomExport=function(){e.$broadcast("CREATE_NEW_CUSTOM_EXPORT"),f(!1,!1,!0)},e.shouldShowReportFooterForm=function(){return e.reportViewStore&&(e.reportViewStore.showingCustomNewExport||e.reportViewStore.showingCustomExports)&&e.viewColClassName&&e.viewColClassName.indexOf("with-bottom-form")>-1},e.createCustomExport=function(){e.$broadcast("CREATE_NEW_CUSTOM_EXPORT_SCHEDULE")},e.saveCustomExport=function(){e.$broadcast("UPDATE_CUSTOM_EXPORT_SCHEDULE")},e.navigateToExportListing=function(){e.$broadcast("SHOW_EXPORT_LISTING")},e.addListener("SHOW_ERROR_MSG_EVENT",function(t,a){e.errorMessage=a||[]}),e.clearErrorMsg=function(){e.errorMessage=""},e.onOutputFormatChange=function(){var t=_.find(e.customExportsData.exportFormats,{id:e.customExportsScheduleParams.format});!t||"XML"!==t.value&&"JSON"!==t.value||i.open({template:"/assets/partials/common/rvWarningPopup.html",scope:e})},e.addListener("CLEAR_ERROR_MSG",function(){e.errorMessage=[]}),e.deleteCustomExportSchedule=function(){e.$broadcast("DELETE_CUSTOM_EXPORT_SCHEDULE")},e.shouldShowCustomExports=function(){return e.isCustomExportsEnabled&&e.hasPermissionToViewScheduleReport()},function(){e.updateViewCol(e.viewColsActions.ONE),s.showScheduledReports?e.updateView(e.reportViewActions.SHOW_SCHEDULED_REPORTS):s.showScheduledExports?e.updateView(e.reportViewActions.SHOW_EXPORT_REPORTS):s.showCustomExports?e.updateView(e.reportViewActions.SHOW_CUSTOM_EXPORTS):e.updateView(e.reportViewActions.SHOW_SCHEDULED_REPORTS),u(),R(),e.isCustomExportsEnabled=o.isEnabled("custom_exports"),e.customExportsScheduleParams={},e.isToastEnabled=o.isEnabled("show_toast_notifications"),e.customExportsData={isNewExport:!1,scheduledCustomExports:[],customExportDataSpaces:[],exportFormats:[],deliveryTypes:[]},e.showingErrMsg=!1,e.errorMessage=""}()}]),angular.module("sntRover").controller("RVReportsDashboardCtrl",["$scope","$timeout","$state","$filter","$rootScope",function(e,t,a,r,s){var n={showingAllReport:!1,showingScheduledReports:!1,showingScheduleAReport:!1,showingExportReports:!1,showingExportAReport:!1},o=function(){var t=e.reportList;return e.reportViewStore.showingScheduledReports||e.reportViewStore.showingExportReports?t=e.schedulesList:(e.reportViewStore.showingScheduleAReport||e.reportViewStore.showingExportAReport)&&(t=e.schedulableReports),t},i=function(){e.setScroller("FULL_REPORT_SCROLL",{tap:!0,preventDefault:!1,scrollX:!0,scrollY:!1})},l=function(t){e.refreshScroller("FULL_REPORT_SCROLL"),!t&&e.$parent.myScroll&&e.$parent.myScroll.hasOwnProperty("FULL_REPORT_SCROLL")&&e.$parent.myScroll.FULL_REPORT_SCROLL.scrollTo(0,0,100)},c=function(){t(function(){e.refreshScroller("report-list-scroll"),e.myScroll["report-list-scroll"].refresh(),e.myScroll&&e.myScroll["report-filter-sidebar-scroll"]&&e.myScroll["report-filter-sidebar-scroll"].refresh()},200)},u=function(t){return angular.isDefined(t)?"cols-"+t:"cols-"+e.reportViewActions.ONE};e.viewColsActions={ONE:1,TWO:2,THREE:3,FOUR:4},e.reportViewActions={SHOW_ALL_REPORTS:"SHOW_ALL_REPORTS",SHOW_SCHEDULED_REPORTS:"SHOW_SCHEDULED_REPORTS",SHOW_SCHEDULE_A_REPORT:"SHOW_SCHEDULE_A_REPORT",SHOW_EXPORT_REPORTS:"SHOW_EXPORT_REPORTS",SHOW_EXPORT_A_REPORT:"SHOW_EXPORT_A_REPORT"};var d=function(t){switch(t){case e.reportViewActions.SHOW_ALL_REPORT:return angular.extend({},n,{showingAllReport:!0});case e.reportViewActions.SHOW_SCHEDULED_REPORTS:return angular.extend({},n,{showingScheduledReports:!0});case e.reportViewActions.SHOW_SCHEDULE_A_REPORT:return angular.extend({},n,{showingScheduleAReport:!0});case e.reportViewActions.SHOW_EXPORT_REPORTS:return angular.extend({},n,{showingExportReports:!0});case e.reportViewActions.SHOW_EXPORT_A_REPORT:return angular.extend({},n,{showingExportAReport:!0});default:return angular.extend({},n,{showingAllReport:!0})}};e.updateView=function(t){e.reportViewStore=d(t)},e.filterByQuery=function(){var t,a,r,n=e.query.toLowerCase().trim(),i=o();if(e.updateViewCol(e.viewColsActions.ONE),n.length<3){for(a=0,r=i.length;a<r;a++)i[a].filteredOut=!1,s.isFolioTaxEnabled||"folio_tax_report"!==i[a].method||(i[a].filteredOut=!0);return void c()}for(e.uiChosenReport&&(e.uiChosenReport.uiChosen=!1),a=0,r=i.length;a<r;a++)t=e.reportViewStore.showingAllReport?i[a].title.toLowerCase():i[a].report.description.toLowerCase(),i[a].filteredOut=t.indexOf(n)===-1,(!s.isFolioTaxEnabled&&"folio_tax_report"===i[a].method||"room_status"===i[a].method)&&(i[a].filteredOut=!0);c()},e.clearQuery=function(){e.query="",o().map(function(e){e.filteredOut=!1}),c()},e.reportMainMenuChange=function(t){e.updateViewCol(e.viewColsActions.ONE),e.updateView(t)},e.updateViewCol=function(t,a){e.viewColClassName=u(t),l(a)},e.$on("REPORT_LIST_FILTER_SCROLL_REFRESH",c);var _=function(){var t=r("translate")("MENU_NEW_REPORT");e.setTitle(t),e.$parent.heading=t};e.createNewReportSchedule=function(){e.fromReportInbox=!0,e.$broadcast("CREATE_NEW_SCHEDULE")};var p=function(){s.isBackgroundReportsEnabled&&(s.setPrevState={title:r("translate")("MENU_REPORTS_INBOX"),name:"rover.reports.inbox"})};!function(){e.updateViewCol(e.viewColsActions.ONE),e.updateView(e.reportViewActions.SHOW_ALL_REPORT),i(),_(),p()}()}]),sntRover.controller("RVAddonForecastReportByAddonCtrl",["$rootScope","$scope","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout","ngDialog","$interval",function(e,t,a,r,s,n,o,i,l,c,u,d){function p(e){var t,a,r=25,s=e.pageNo||1,n=e.total_count||0,o=e.reservations?e.reservations.length:0,i=!1,l=!1;return 0===n&&0===o?(i=!0,l=!0):1===s?(t=1,a=n<r?n:r,i=!0,l=!(n>r)):(t=r*(s-1)+1,a=t+r-1<n?t+r-1:n,i=!1,l=a===n),{perPage:r,pageNo:s,netTotalCount:n,uiTotalCount:o,disablePrevBtn:i,disableNextBtn:l,resultFrom:t,resultUpto:a}}function h(e,a){var s,o,a=a||{},i=function(a){t.$emit("hideLoader"),e.reservations=a,g()},l=function(e){t.$emit("hideLoader"),g()};_.extend(a,{id:m.id,date:e.date,addon_group_id:e.addonGroupId,addon_id:e.addonId,page:e.pageNo,per_page:e.perPage}),s=_.where(m.hasReservationStatus.data,{selected:!0}),s.length>0&&(o=n.RESERVATION_STATUS_ARRAY,a[o]=[],_.each(s,function(e){a[o].push(e.id)})),t.invokeApi(r.fetchAddonReservations,a,i,l)}function E(){try{R=t.chosenReport.hasAddonGroups.data}catch(e){R=[]}try{f=t.chosenReport.hasAddons.data}catch(e){f=[]}O=A.results,D={},y={},_.each(R,function(e){D[e.id]=e.description}),_.each(f,function(e){y[e.addon_id]=e.addon_name}),t.modifiedResults={};for(var e in O)if(O.hasOwnProperty(e)){var a=e,r=O[e].addons;O[e].guests>0?O[e].hasData=!0:O[e].hasData=!1;var s,n;for(s=0,n=r.length;s<n;s++){var o=r[s];for(var i in o)if("$$hashKey"!=i&&o.hasOwnProperty(i)){var l=i,c=o[i].dates;o[i].guests>0?o[i].hasData=!0:o[i].hasData=!1;var u,d;for(u=0,d=c.length;u<d;u++){var h=c[u];for(var E in h)if("$$hashKey"!=E&&h.hasOwnProperty(E)){var T=E,S=h[E];o[i].guests>0&&(_.extend(S,{sortField:void 0,roomSortDir:void 0,nameSortDir:void 0,date:T,addonGroupId:a,addonId:l}),_.extend(S,p(S)))}}}}}t.modifiedResults=angular.copy(O),t.hasResults=!!_.find(t.modifiedResults,function(e){return e.hasData})}BaseCtrl.call(this,t);var R,f,T,S=t.$parent,A=S.$parent,m=S.chosenReport,O=[],D={},y={},v="addon-forecast-report-scroll",g=function(e){t.refreshScroller(v),e&&t.$parent.myScroll.hasOwnProperty(v)&&t.$parent.myScroll[v].scrollTo(0,0,100)},C=function(){t.setScroller(v,{probeType:3,tap:!0,preventDefault:!1,scrollX:!1,scrollY:!0})},N=function(){T&&(d.cancel(T),T=void 0)},P=function e(){t.$parent.myScroll.hasOwnProperty(v)?(g(),T||(T=d(g,1e3)),t.$parent.myScroll[v].on("scroll",function(){N()})):c(e,1e3)};t.getKey=function(e){return _.keys(e)[0]},t.getKeyValues=function(e){return e[t.getKey(e)]},t.getKeyName=function(e){return allAddonHash[t.getKey(e)]||e},t.getAddonGrpName=function(e){return D[e]||e},t.getAddonName=function(e){return y[t.getKey(e)]||e},t.toggleSub=function(e){e.hasOwnProperty("hidden")?e.hidden=!e.hidden:e.hidden=!0,g()};var L={"DUE IN":"check-in",INHOUSE:"inhouse","DUE OUT":"check-out",CHECKEDOUT:"check-out",CANCELLED:"cancel",NOSHOW:"no-show"};t.getStatusClass=function(e){return L[e]||""},t.sortRes=function(e,t){var a={};t.sortField=e,a.sort_field=e,"ROOM"==e?(t.roomSortDir=void 0==t.roomSortDir||0==t.roomSortDir,t.nameSortDir=void 0,a.sort_dir=t.roomSortDir):"NAME"==e&&(t.nameSortDir=void 0==t.nameSortDir||0==t.nameSortDir,t.roomSortDir=void 0,a.sort_dir=t.nameSortDir),h(t,a)},t.loadRes=function(e,t){"next"!=e||t.disableNextBtn?"prev"!=e||t.disablePrevBtn||(t.pageNo--,_.extend(t,p(t)),h(t)):(t.pageNo++,_.extend(t,p(t)),h(t))};var I=function(){E(),C(),c(function(){g("scrollUp")})};I();var U=function(){E(),c(function(){g("scrollUp")})},M=t.$on(o.REPORT_SUBMITED,U),b=t.$on(o.REPORT_PRINTING,U),F=t.$on(o.REPORT_UPDATED,U),w=t.$on(o.REPORT_PAGE_CHANGED,U),G=t.$on("ALL_RENDERED",P);t.$on("$destroy",M),t.$on("$destroy",F),t.$on("$destroy",b),t.$on("$destroy",w),t.$on("$destroy",G),t.$on("$destroy",N),A.printOptions.showModal=function(){t.printLevel={},t.levelValues={date:"DATE",group:"GROUP",addon:"ADDON",all:"ALL"},t.printLevel.value="GROUP",u.open({template:"/assets/partials/reports/addonForecastReport/rvGrpByGroupPrintPopup.html",className:"ngdialog-theme-default",closeByDocument:!0,scope:t,data:[]})},A.printOptions.afterPrint=function(){t.openAddon=!1,t.openDate=!1,t.openResrv=!1},t.closeDialog=function(){A.printOptions.afterPrint(),u.close()},t.continueWithPrint=function(){switch(t.printLevel.value){case"ADDON":t.openAddon=!0;break;case"DATE":t.openAddon=!0,t.openDate=!0;break;case"ALL":t.openAddon=!0,t.openDate=!0,t.openResrv=!0}u.close(),t.$emit(o.REPORT_PRE_PRINT_DONE)}}]),sntRover.controller("RVAddonForecastReportByDateCtrl",["$rootScope","$scope","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout","ngDialog","$interval",function(e,t,a,r,s,n,o,i,l,c,u,d){function p(e){var t,a,r=25,s=e.pageNo||1,n=e.total_count||0,o=e.reservations?e.reservations.length:0,i=!1,l=!1;return 0===n&&0===o?(i=!0,l=!0):1===s?(t=1,a=n<r?n:r,i=!0,l=!(n>r)):(t=r*(s-1)+1,a=t+r-1<n?t+r-1:n,i=!1,l=a===n),{perPage:r,pageNo:s,netTotalCount:n,uiTotalCount:o,disablePrevBtn:i,disableNextBtn:l,resultFrom:t,resultUpto:a}}function h(e,a){var s,o,a=a||{},i=function(a){t.$emit("hideLoader"),e.reservations=a,y()},l=function(e){t.$emit("hideLoader"),y()};_.extend(a,{id:S.id,date:e.date,addon_group_id:e.addonGroupId,addon_id:e.addonId,page:e.pageNo,per_page:e.perPage}),s=_.where(S.hasReservationStatus.data,{selected:!0}),s.length>0&&(o=n.RESERVATION_STATUS_ARRAY,a[o]=[],_.each(s,function(e){a[o].push(e.id)})),t.invokeApi(r.fetchAddonReservations,a,i,l)}function E(){try{r=t.chosenReport.hasAddonGroups.data}catch(e){r=[]}try{c=t.chosenReport.hasAddons.data}catch(e){c=[]}A=T.results,m={},O={},_.each(r,function(e){m[e.id]=e.description}),_.each(c,function(e){O[e.addon_id]=e.addon_name}),t.modifiedResults={};for(var e in A)if(A.hasOwnProperty(e)){var a=e,r=A[e].addon_groups;A[e].guests>0?A[e].hasData=!0:A[e].hasData=!1;var s,n;for(s=0,n=r.length;s<n;s++){var o=r[s];for(var i in o)if("$$hashKey"!=i&&o.hasOwnProperty(i)){var l=i,c=o[i].addons;o[i].guests>0?o[i].hasData=!0:o[i].hasData=!1;var u,d;for(u=0,d=c.length;u<d;u++){var h=c[u];for(var E in h)if("$$hashKey"!=E&&h.hasOwnProperty(E)){var R=E,f=h[E];0<h[E].guests?(h[E].hasData=!0,_.extend(f,{sortField:void 0,roomSortDir:void 0,nameSortDir:void 0,date:a,addonGroupId:l,addonId:R}),_.extend(f,p(f))):h[E].hasData=!1}}}}}t.modifiedResults=angular.copy(A),t.hasResults=!!_.find(t.modifiedResults,function(e){return e.hasData})}BaseCtrl.call(this,t);var R,f=t.$parent,T=f.$parent,S=f.chosenReport,A={},m={},O={},D="addon-forecast-report-scroll",y=function(e){t.refreshScroller(D),e&&t.$parent.myScroll.hasOwnProperty(D)&&t.$parent.myScroll[D].scrollTo(0,0,100)},v=function(){t.setScroller(D,{probeType:3,tap:!0,preventDefault:!1,scrollX:!1,scrollY:!0
})},g=function(){R&&(d.cancel(R),R=void 0)},C=function e(){t.$parent.myScroll.hasOwnProperty(D)?(y(),R||(R=d(y,1e3)),t.$parent.myScroll[D].on("scroll",function(){g()})):c(e,1e3)};t.getKey=function(e){return _.keys(e)[0]},t.getKeyValues=function(e){return e[t.getKey(e)]},t.getAddonGrpName=function(e){return m[t.getKey(e)]||e},t.getAddonName=function(e){return O[t.getKey(e)]||e},t.toggleSub=function(e){e.hasOwnProperty("hidden")?e.hidden=!e.hidden:e.hidden=!0,y()};var N={"DUE IN":"check-in",INHOUSE:"inhouse","DUE OUT":"check-out",CHECKEDOUT:"check-out",CANCELLED:"cancel",NOSHOW:"no-show"};t.getStatusClass=function(e){return N[e]||""},t.sortRes=function(e,t){var a={};t.sortField=e,a.sort_field=e,"ROOM"==e?(t.roomSortDir=void 0==t.roomSortDir||0==t.roomSortDir,t.nameSortDir=void 0,a.sort_dir=t.roomSortDir):"NAME"==e&&(t.nameSortDir=void 0==t.nameSortDir||0==t.nameSortDir,t.roomSortDir=void 0,a.sort_dir=t.nameSortDir),h(t,a)},t.loadRes=function(e,t){"next"!=e||t.disableNextBtn?"prev"!=e||t.disablePrevBtn||(t.pageNo--,_.extend(t,p(t)),h(t)):(t.pageNo++,_.extend(t,p(t)),h(t))};var P=function(){E(),v(),c(function(){y("scrollUp")})};P();var L=function(){E(),c(function(){y("scrollUp")})},I=t.$on(o.REPORT_SUBMITED,L),U=t.$on(o.REPORT_PRINTING,L),M=t.$on(o.REPORT_UPDATED,L),b=t.$on(o.REPORT_PAGE_CHANGED,L),F=t.$on("ALL_RENDERED",C);t.$on("$destroy",I),t.$on("$destroy",M),t.$on("$destroy",U),t.$on("$destroy",b),t.$on("$destroy",F),t.$on("$destroy",g),T.printOptions.showModal=function(){t.printLevel={},t.levelValues={date:"DATE",group:"GROUP",addon:"ADDON",all:"ALL"},t.printLevel.value="DATE",u.open({template:"/assets/partials/reports/addonForecastReport/rvGrpByDatePrintPopup.html",className:"ngdialog-theme-default",closeByDocument:!0,scope:t,data:[]})},T.printOptions.afterPrint=function(){t.openGroup=!1,t.openAddon=!1,t.openResrv=!1},t.closeDialog=function(){T.printOptions.afterPrint(),u.close()},t.continueWithPrint=function(){switch(t.printLevel.value){case"GROUP":t.openGroup=!0;break;case"ADDON":t.openGroup=!0,t.openAddon=!0;break;case"ALL":t.openGroup=!0,t.openAddon=!0,t.openResrv=!0}u.close(),t.$emit(o.REPORT_PRE_PRINT_DONE)}}]),sntRover.controller("RVAllowanceForecastReportByAllowanceCtrl",["$scope","RVReportMsgsConst","$timeout","$interval","$stateParams","RVreportsSrv",function(e,t,a,r,s,n){BaseCtrl.call(this,e);var o,i=e.$parent,l=i.$parent,c={},u="allowance-forecast-report-scroll",d=function(t){e.refreshScroller(u),t&&e.$parent.myScroll.hasOwnProperty(u)&&e.$parent.myScroll[u].scrollTo(0,0,100)},p=function(){e.setScroller(u,{probeType:3,tap:!0,preventDefault:!1,scrollX:!1,scrollY:!0})},h=function(){o&&(r.cancel(o),o=void 0)},E=function t(){e.$parent.myScroll.hasOwnProperty(u)?(d(),o||(o=r(d,1e3)),e.$parent.myScroll[u].on("scroll",function(){h()})):a(t,1e3)};e.sortedResults={},e.sortedTotals={},e.totalsPerDay={},e.isSortByAllowance=function(){var e=n.getSelectedReport();if(e&&e.filters&&e.filters.appliedFilter.sortBy)return"Allowance"===e.filters.appliedFilter.sortBy;if(s.report&&s.report.report&&s.report.report.sortByOptions){var t=s.report.report.sortByOptions;return t.findIndex(function(e){return"ALLOWANCE"===e.value&&e.sortDir===!0})!==-1}return!1},e.currentSort=e.isSortByAllowance()?"Allowance":"Arrival",e.fieldSetup={Arrival:{sort:"asc",mapping:"arrival_date"},Departure:{sort:!1,mapping:"dep_date"},"Room Type":{sort:!1,mapping:"room_type"},Room:{sort:!1,mapping:"room_no"},"Rate Code":{sort:!1,mapping:"rate_code"},Allowance:{sort:"asc",mapping:"allowance"},Guest:{sort:!1,mapping:"guest_name"}},e.toggleSort=function(t){e.fieldSetup[t].sort&&(e.currentSort!==t?(e.currentSort=t,e.fieldSetup[t].sort="asc"):e.fieldSetup[t].sort="asc"===e.fieldSetup[t].sort?"desc":"asc"),e.reSort()},e.reSort=function(){_.each(e.sortedResults,function(t,a){e.sortedResults[a]=baseOrderBy(t,[e.fieldSetup[e.currentSort].mapping,"guest_name"],[e.fieldSetup[e.currentSort].sort,"asc"])})};var R=function(){c=l.results,e.sortedResults=angular.copy(c),e.sortedTotals={},_.each(angular.copy(c.total_allowance),function(t,a){delete t.total,e.sortedTotals[a]=t}),delete e.sortedResults.total_allowance,_.each(e.sortedTotals,function(t,a){e.totalsPerDay[a]=Object.values(t).reduce(function(e,t){return e+t})}),e.hasResults=Object.keys(e.sortedResults).length},f=function(){R(),p(),a(function(){d("scrollUp")})};f();var T=function(){R(),a(function(){d("scrollUp")})},S=e.$on(t.REPORT_SUBMITED,T),A=e.$on(t.REPORT_PRINTING,T),m=e.$on(t.REPORT_UPDATED,T),O=e.$on(t.REPORT_PAGE_CHANGED,T),D=e.$on("ALL_RENDERED",E);e.$on("$destroy",S),e.$on("$destroy",m),e.$on("$destroy",A),e.$on("$destroy",O),e.$on("$destroy",D),e.$on("$destroy",h),l.printOptions.showModal=function(){e.continueWithPrint()},e.continueWithPrint=function(){e.$emit(t.REPORT_PRE_PRINT_DONE)}}]),sntRover.controller("RVAllowanceForecastReportByDateCtrl",["$scope","RVReportMsgsConst","$timeout","$interval","$stateParams","RVreportsSrv",function(e,t,a,r,s,n){BaseCtrl.call(this,e);var o,i=e.$parent,l=i.$parent,c={},u="allowance-forecast-report-scroll",d=function(t){e.refreshScroller(u),t&&e.$parent.myScroll.hasOwnProperty(u)&&e.$parent.myScroll[u].scrollTo(0,0,100)},p=function(){e.setScroller(u,{probeType:3,tap:!0,preventDefault:!1,scrollX:!1,scrollY:!0})},h=function(){o&&(r.cancel(o),o=void 0)},E=function t(){e.$parent.myScroll.hasOwnProperty(u)?(d(),o||(o=r(d,1e3)),e.$parent.myScroll[u].on("scroll",function(){h()})):a(t,1e3)};e.sortedResults={},e.sortedTotals={},e.totalsPerDay={},e.fieldSetup={Arrival:{sort:"asc",mapping:"arrival_date"},Departure:{sort:!1,mapping:"dep_date"},"Room Type":{sort:!1,mapping:"room_type"},Room:{sort:!1,mapping:"room_no"},"Rate Code":{sort:!1,mapping:"rate_code"},Allowance:{sort:"asc",mapping:"allowance"},Guest:{sort:!1,mapping:"guest_name"}},e.isSortByAllowance=function(){var e=n.getSelectedReport();if(e&&e.filters&&e.filters.appliedFilter.sortBy)return"Allowance"!==e.filters.appliedFilter.sortBy;if(s.report&&s.report.report&&s.report.report.sortByOptions){var t=s.report.report.sortByOptions;return t.findIndex(function(e){return"ALLOWANCE"===e.value&&e.sortDir===!0})!==-1}return!1},e.currentSort=e.isSortByAllowance()?"Allowance":"Arrival",e.toggleSort=function(t){e.fieldSetup[t].sort&&(e.currentSort!==t?(e.currentSort=t,e.fieldSetup[t].sort="asc"):e.fieldSetup[t].sort="asc"===e.fieldSetup[t].sort?"desc":"asc"),e.reSort()},e.reSort=function(){_.each(e.sortedResults,function(t,a){e.sortedResults[a]=baseOrderBy(t,[e.fieldSetup[e.currentSort].mapping,"guest_name"],[e.fieldSetup[e.currentSort].sort,"asc"])})};var R=function(){c=l.results,e.sortedResults=angular.copy(c),e.sortedTotals={},_.each(angular.copy(c.total_allowance),function(t,a){delete t.total,e.sortedTotals[a]=t}),delete e.sortedResults.total_allowance,_.each(e.sortedTotals,function(t,a){e.totalsPerDay[a]=Object.values(t).reduce(function(e,t){return e+t})}),e.hasResults=Object.keys(e.sortedResults).length},f=function(){R(),p(),a(function(){d("scrollUp")})};f();var T=function(){R(),a(function(){d("scrollUp")})},S=e.$on(t.REPORT_SUBMITED,T),A=e.$on(t.REPORT_PRINTING,T),m=e.$on(t.REPORT_UPDATED,T),O=e.$on(t.REPORT_PAGE_CHANGED,T),D=e.$on("ALL_RENDERED",E);e.$on("$destroy",S),e.$on("$destroy",m),e.$on("$destroy",A),e.$on("$destroy",O),e.$on("$destroy",D),e.$on("$destroy",h),l.printOptions.showModal=function(){e.continueWithPrint()},e.continueWithPrint=function(){e.$emit(t.REPORT_PRE_PRINT_DONE)}}]),angular.module("sntRover").controller("RVBusinessOnBooksController",["$scope","RVReportMsgsConst","$timeout",function(e,t,a){BaseCtrl.call(this,e);var r="left-pane-scroll",s="right-pane-scroll",n=1e3,o=function(){e.setScroller(r,{preventDefault:!1,probeType:3}),e.setScroller(s,{preventDefault:!1,probeType:3,scrollX:!0})},i=function(){e.myScroll[r].on("scroll",function(){e.myScroll[s].scrollTo(0,this.y)}),e.myScroll[s].on("scroll",function(){e.myScroll[r].scrollTo(0,this.y)})},l=function t(){e.myScroll.hasOwnProperty(r)&&e.myScroll.hasOwnProperty(s)?i():a(t,n)},c=function(){e.myScroll.hasOwnProperty(r)&&e.refreshScroller(r),e.myScroll.hasOwnProperty(s)&&e.refreshScroller(s)},u=function(){e.dates=[],e.roomDetails=[];var t=e.results;_.each(t,function(t){e.dates.push(t.date),e.roomDetails.push(t)}),a(function(){c(),e.$emit("hideLoader")},n)},d=function(){o(),l(),u();var a=e.$on(t.REPORT_SUBMITED,u),r=e.$on(t.REPORT_PRINTING,u),s=e.$on(t.REPORT_UPDATED,u),n=e.$on(t.REPORT_PAGE_CHANGED,u);e.$on("$destroy",a),e.$on("$destroy",s),e.$on("$destroy",r),e.$on("$destroy",n)};d()}]),angular.module("sntRover").controller("RVComparisonReport.Controller",["$rootScope","$scope","$filter","RVReportUtilsFac","RVReportMsgsConst","$timeout","RVreportsSubSrv","$q",function(e,t,a,r,s,n,o,i){function l(e){var a,r,s,n=[],o=51,i=_.where(e,{is_charge_group:!0});for(a=0,r=i.length;a<r;a++)if(i[a].is_charge_group){n.push(angular.extend({},i[a],{isChargeGroup:!0,isChargeGroupActive:!1,pageNo:0}));var l=n.length-1;for(s=0;s<o;s++)n.push({isChargeCode:!0,isChargeCodeActive:!1,isEmpty:!0});n.push({isChargeCode:!0,isChargeCodeActive:!1,isChargeCodePagination:!0,isEmpty:!0,pageOptions:{id:i[a].charge_group_id.toString(),api:[t.fetchChargeCodes,l],perPage:50}})}return n}function c(e,a,r){var s=function e(a,s,n){var o=s+1,i=n+1,l=a[s]||{},c=!a[s];angular.extend(t.cgEntries[n],l,{isEmpty:c}),t.cgEntries[n].isChargeCodePagination&&(t.cgEntries[n].pageOptions.totalCount=r),t.cgEntries[i]&&t.cgEntries[i].isChargeCode&&e(a,o,i)};s(e,0,a)}function u(e){var t,a,r,s,n;for(t=0,a=e.length;t<a;t++)r=e[t].charge_group_id,s=F.get(r),n=t+1,angular.isDefined(s)&&c(s,n)}function d(e,t,a){var r=i.defer(),s=function e(t,a,s){var n=a+1;t[a].isChargeCodeActive=s,t[a].isChargeCodePagination&&(t[a].isEmpty=!1),t[n]&&t[n].isChargeCode?e(t,n,s):r.resolve()};return s(e,t,a),r.promise}function p(e,t){var a,r;for(a=0,r=e.length;a<r;a++)e[a].isChargeCode&&!e[a].isEmpty&&(e[a].isChargeCodeActive=t)}function h(e){var a,r;for(t.ledgerEntries=[],a=0,r=e.length;a<r;a++)e[a].is_ledger&&t.ledgerEntries.push(e[a])}function E(e){var a,r;for(t.totalEntries=[],a=0,r=e.length;a<r;a++)e[a].is_total_revenue&&t.totalEntries.push(e[a])}function R(e){var r,s,n=function(e){var t=2;switch(e.section){case"Total Occupancy %":case"Total Occupancy % (Excl Comp)":e.today+="%",e.mtd+="%",e.last_year_mtd+="%",e.ytd+="%",e.last_year_ytd+="%";break;case"ADR":case"ADR (Excl Comp)":case"Revpar":e.today=a("currency")(e.today,L,t),e.mtd=a("currency")(e.mtd,L,t),e.last_year_mtd=a("currency")(e.last_year_mtd,L,t),e.ytd=a("currency")(e.ytd,L,t),e.last_year_ytd=a("currency")(e.last_year_ytd,L,t)}return e};for(t.staticEntries=[],r=0,s=e.length;r<s;r++)e[r].is_static&&t.staticEntries.push(n(e[r]))}function f(e){t.cgEntries=l(e),u(t.cgEntries)}function T(e){t.pgEntries=[],t.pgEntries=_.where(e,{is_payment_group:!0}),_.each(t.pgEntries,function(e){e.isPaymentGroupActive=!1,e.paymentGroupEntries=F.get(e.charge_group_id)})}function S(e){t.balanceEntries=[],t.balanceEntries=_.where(e,{is_balance_brought_forward:!0})}function A(e){t.ledgerDepositEntries=[],t.ledgerDepositEntries=_.where(e,{is_deposit_ledger:!0})}function m(e){t.ledgerGuestEntries=[],t.ledgerGuestEntries=_.where(e,{is_guest_ledger:!0})}function O(e){t.ledgerAREntries=[],t.ledgerAREntries=_.where(e,{is_ar_ledger:!0})}function D(e){t.ledgerTotalVariance=[],t.ledgerTotalVariance=_.where(e,{is_total_variance:!0})}function y(e){t.ledgerTotalClosingBalance=[],t.ledgerTotalClosingBalance=_.where(e,{is_total_closing_balance:!0})}function v(){var e=t.$parent.results;h(e),E(e),R(e),f(e),T(e),S(e),A(e),m(e),O(e),D(e),y(e)}var g,C,N,P,L=e.currencySymbol,I=50,U=function(e){return{get:function(t){return e[t]||void 0}}},M=function(e){return{set:function(t,a){return e[t]=a,e[t]}}},b=function(){var e={};return angular.extend({},U(e),M(e))},F=b();g=t.$on(s.REPORT_SUBMITED,function(){n(function(){v()},I)}),C=t.$on(s.REPORT_PRINTING,function(){v(),p(t.cgEntries,!0)}),N=t.$on(s.REPORT_UPDATED,v),P=t.$on(s.REPORT_PAGE_CHANGED,v),t.$on("$destroy",g),t.$on("$destroy",N),t.$on("$destroy",C),t.$on("$destroy",P),t.toggleChargeGroup=function(e){var a,r=t.cgEntries[e],s=(F.get(r.charge_group_id),e+1),o=500;r.isChargeGroupActive?(a=!1,d(t.cgEntries,s,!1).then(function(){r.isChargeGroupActive=!1,n(function(){t.refreshScroll(!0)},o)})):(a=!0,t.fetchChargeCodes(e,1))};var w=t.$on("PRINT_COMPARISON_REPORT",function(){t.$emit("PRINT_SELECTED_REPORT")});t.$on("$destroy",w),t.fetchChargeCodes=function(e,r){var s=t.cgEntries[e],r=r||1,i=100,l=500,u=function(a){var o=e+1;s.pageNo=r,F.set(s.charge_group_id,a.charge_codes),c(F.get(s.charge_group_id),o,a.total_count),n(function(){d(t.cgEntries,o,!0).then(function(){s.isChargeGroupActive=!0,t.$emit("hideLoader"),n(function(){var e=s.charge_group_id.toString();t.$broadcast("updatePagination",e),t.refreshScroll(!0)},l)})},i)},_=function(){t.$emit("hideLoader")},p={date:a("date")(t.chosenReport.singleValueDate,"yyyy-MM-dd"),report_id:t.chosenReport.id,charge_group_id:s.charge_group_id,page:r,per_page:50};t.invokeApi(o.getChargeCodes,p,u,_)},t.togglePaymentGroup=function(e,r){if(t.pgEntries[e].isPaymentGroupActive=!t.pgEntries[e].isPaymentGroupActive,t.pgEntries[e].isPaymentGroupActive){var s=1e3,i=function(a){F.set(t.pgEntries[e].charge_group_id,a),t.$emit("hideLoader"),t.pgEntries[e].paymentGroupEntries=a,t.pgEntries[e].insidePaginationData={id:t.pgEntries[e].charge_group_id,api:[t.togglePaymentGroup,e],perPage:50},t.pgEntries[e].totalInsidePagination=a.total_count,n(function(){var a=t.pgEntries[e].charge_group_id;t.$broadcast("updatePagination",a),t.refreshScroll(!0)},s)},l=function(){t.$emit("hideLoader")},c=t.pgEntries[e];r=r||1;var u={date:a("date")(t.chosenReport.singleValueDate,"yyyy-MM-dd"),report_id:t.chosenReport.id,charge_group_id:c.charge_group_id,page:r,per_page:50};t.invokeApi(o.getPaymentValues,u,i,l)}else t.pgEntries[e].paymentGroupEntries={},F.set(t.pgEntries[e].charge_group_id,{})},t.isHidden=function(e){var t=!1;return e.isChargeCode&&e.isEmpty?t=!0:e.isChargeCode&&!e.isChargeCodeActive&&(t=!0),t},v()}]),angular.module("sntRover").controller("RVCustomExportFilterCtrl",["$scope","RVCustomExportSrv","$timeout","RVCustomExportsUtilFac","sntActivity",function(e,t,a,r,s){BaseCtrl.call(this,e);var n={OPTIONS:"OPTION",DURATION:"DURATION",RANGE:"RANGE",GENERAL:"GENERAL"},o="custom-export-filters-scroller",i=100;e.setScroller(o,{tap:!0,preventDefault:!1}),e.refreshFilterScroller=function(t){a(function(){e.refreshScroller(o)},1e3),t&&e.myScroll.hasOwnProperty(o)&&e.myScroll[o].scrollTo(0,0,i)};var l=function(t,a,r){var s=angular.copy(e.selectedEntityDetails.processedFilters[t]),n=h(s),o={firstLevelData:n,secondLevelData:e.customExportsData.durations,selectedFirstLevel:a||"",selectedSecondLevel:r||"",isDuration:!0};return o},c=function(t,a,s,n){var o=angular.copy(e.selectedEntityDetails.processedFilters[t]),i=p(o),l={firstLevelData:i,secondLevelData:r.getRangeOperators(),selectedFirstLevel:a||"",selectedSecondLevel:s||"",isRange:!0,rangeValue:n||""};return l},u=function(t,a,r){var s=angular.copy(e.selectedEntityDetails.processedFilters[t]),n=d(s),o={firstLevelData:n,secondLevelData:[],selectedFirstLevel:a||"",selectedSecondLevel:r||"",options:[],isOption:!0};return o},d=function(t){var a=_.filter(e.filterData.appliedFilters,{isOption:!0}),r=_.pluck(a,"selectedFirstLevel"),s=[];return s=_.filter(t,function(e){return r.indexOf(e.value)===-1})},p=function(t){var a=[];return _.each(t,function(t){var s=_.filter(e.filterData.appliedFilters,{isRange:!0,selectedFirstLevel:t.value});s.length!==r.getRangeOperators().length&&a.push(t)}),a},h=function(t){var a=[];return _.each(t,function(t){var r=_.find(e.filterData.appliedFilters,{selectedFirstLevel:t.value});r||a.push(t)}),a},E=function(t,a,r){var s=angular.copy(e.selectedEntityDetails.processedFilters[t]),n=R(s),o={firstLevelData:n,secondLevelData:[],selectedFirstLevel:a||"",selectedSecondLevel:r||"",options:[],isGeneral:!0};return o},R=function(t){var a=[];return _.each(t,function(t){var s=_.filter(e.filterData.appliedFilters,{isGeneral:!0,selectedFirstLevel:t.value});s.length!==r.getGeneralOperators().length&&a.push(t)}),a},f=function(e){var t;return n.DURATION===e?t=l(e):n.RANGE===e?t=c(e):n.OPTIONS===e?t=u(e):n.GENERAL===e&&(t=E(e)),t};e.changePrimaryFilter=function(){e.filterData.appliedFilters.push(f(e.filterData.primaryFilter)),e.filterData.primaryFilter="",e.refreshFilterScroller()},e.removeFilter=function(t){e.filterData.appliedFilters.splice(t,1)},e.onFirstLevelFieldChange=function(t,a,n,o){var i=e.filterData.appliedFilters[a];return!t&&i?(i.options={},i.secondLevelData=[],i.selectedFirstLevel=t,i.isMultiSelect=!1,void(i.hasDualState=!1)):void(i.isOption?(s.start("LOAD_FILTERS"),removeKeysFromObj(i,["isRange","isDuration","secondLevelData","selectedSecondLevel","options","rangeValue","isMultiSelect","hasDualState","isGeneral"]),r.populateOptions(t,i,n).then(function(e){i=e,s.stop("LOAD_FILTERS")})):i.isRange?(removeKeysFromObj(i,["isOption","isDuration","secondLevelData","selectedSecondLevel","options","rangeValue","isMultiSelect","hasDualState","isGeneral"]),r.populateRangeOperators(t,i,e.filterData.appliedFilters,n,o)):i.isGeneral&&(removeKeysFromObj(i,["isOption","isDuration","secondLevelData","selectedSecondLevel","options","rangeValue","isMultiSelect","hasDualState","isRange"]),r.populateGeneralOperators(t,i,e.filterData.appliedFilters,n)))},e.removeAllFilters=function(){e.filterData.appliedFilters=[],e.refreshFilterScroller()};var T=function(){var a,r,s=e.selectedEntityDetails.filter_values,o=e.selectedEntityDetails.filters;t.processFilterSelections(s).then(function(){_.each(s,function(t,s){s=s.toUpperCase(),a=_.find(o,{value:s}).filter_type,a===n.DURATION?(r=l(a,s,t),e.filterData.appliedFilters.push(r)):a===n.RANGE?_.each(t,function(t){r=c(a,s,t.operator,t.value),e.filterData.appliedFilters.push(r),e.onFirstLevelFieldChange(s,e.filterData.appliedFilters.length-1,t.operator,t.value)}):a===n.OPTIONS?(r=u(a,s),e.filterData.appliedFilters.push(r),e.onFirstLevelFieldChange(s,e.filterData.appliedFilters.length-1,t)):a===n.GENERAL&&(r=E(a,s),e.filterData.appliedFilters.push(r),e.onFirstLevelFieldChange(s,e.filterData.appliedFilters.length-1,t))})})};e.addListener("UPDATE_FILTER_SELECTIONS",function(){T()}),e.shouldHideOptionFilter=function(){var t=_.filter(e.filterData.appliedFilters,function(e){return e.isOption}),a=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.OPTION;return!a||a&&a.length===t.length},e.shouldHideRangeFilter=function(){var t=_.filter(e.filterData.appliedFilters,function(e){return e.isRange}),a=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.RANGE;return!a||a&&a.length*r.getRangeOperators().length===t.length},e.shouldHideDurationFilter=function(){var t=_.filter(e.filterData.appliedFilters,function(e){return e.isDuration}),a=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.DURATION;return!a||a&&a.length===t.length},e.shouldHideAddFilter=function(){var t=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.OPTION&&e.selectedEntityDetails.processedFilters.OPTION.length||0,a=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.DURATION&&e.selectedEntityDetails.processedFilters.DURATION.length||0,s=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.RANGE&&e.selectedEntityDetails.processedFilters.RANGE.length*r.getRangeOperators().length||0,n=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.GENERAL&&e.selectedEntityDetails.processedFilters.GENERAL.length*r.getGeneralOperators().length||0;return e.filterData.appliedFilters.length===t+a+s+n},e.onFilterProcessComplete=function(){e.refreshFilterScroller(!0)},e.shouldHideGeneralFilter=function(){var t=_.filter(e.filterData.appliedFilters,function(e){return e.isGeneral}),a=e.selectedEntityDetails&&e.selectedEntityDetails.processedFilters&&e.selectedEntityDetails.processedFilters.GENERAL;return!a||a&&a.length*r.getGeneralOperators().length===t.length}}]),angular.module("sntRover").controller("RVCustomExportCtrl",["$scope","RVCustomExportSrv","$timeout","$rootScope","RVreportsSrv","RVCustomExportsUtilFac","RVReportUtilsFac","$filter","ngDialog",function(e,t,a,r,s,n,o,i,l){BaseCtrl.call(this,e);var c,u={SHOW_CUSTOM_EXPORT_LIST:"SHOW_CUSTOM_EXPORT_LIST",SHOW_PARAMETERS:"SHOW_PARAMETERS"},d="report-cols-scroller",p="report-selected-cols-scroller",h="exports-list-scroller",E="schedule-details-scroller",R="delivery-options-scroller",f=100,T="SHOW_ERROR_MSG_EVENT",S=function(){var t={tap:!0,preventDefault:!1};e.setScroller(d,t),e.setScroller(p,t),e.setScroller(h,t),e.setScroller(E,t),e.setScroller(R,t)};e.sortableOptions={start:function(){e.getScroller(p).disable(),e.$parent.myScroll.FULL_REPORT_SCROLL.disable()},stop:function(){e.getScroller(p).enable(),e.$parent.myScroll.FULL_REPORT_SCROLL.enable()}};var A=function(t,a){a&&e.myScroll.hasOwnProperty(t)&&e.myScroll[t].scrollTo(0,0,f),e.refreshScroller(t)},m=function(t){var a="Runs ",s=_.find(e.customExportsData.scheduleFrequencies,{id:t.frequency_id}),n="",o="",l={DAILY:"DAILY",HOURLY:"HOURLY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",RUN_ONCE:"RUN_ONCE",EVERY_MINUTE:"MINUTES"};return s&&(n=s.description,o=s.value),o===l.RUN_ONCE?a+="once":0!==t.repeats_every&&t.repeats_every?(a+="after every "+t.repeats_every+" ",o===l.DAILY?a+=1===t.repeats_every?"day":"days":o===l.HOURLY?a+=1===t.repeats_every?"hour":"hours":o===l.WEEKLY?a+=1===t.repeats_every?"week":"weeks":o===l.MONTHLY?a+=1===t.repeats_every?"month":"months":o===l.MONTHLY?a+=1===t.repeats_every?"month":"months":o===l.EVERY_MINUTE&&(a+=1===t.repeats_every?"minute":"minutes")):a+=n.toLowerCase(),a+=t.time?" at "+t.time+". ":". ",t.starts_on&&(a+="Started on "+i("date")(t.starts_on,r.dateFormat)+". "),o!==l.RUN_ONCE&&(a+=t.ends_on_after?"Ends after "+t.ends_on_after+" times.":t.ends_on_date?"Ends on "+i("date")(t.ends_on_date,r.dateFormat)+".":"Runs forever."),a},O=function(){if("Financial Transaction"===e.selectedEntityDetails.report.title){var t=_.find(e.filterData.appliedFilters,function(e){return e.isDuration});return t&&t.selectedFirstLevel&&t.selectedSecondLevel}return!0},D=function(){var t=function(){return!!e.scheduleParams.frequency_id},a=function(){var t=e.checkDeliveryType("EMAIL")&&e.emailList.length,a=e.checkDeliveryType("SFTP")&&!!e.scheduleParams.selectedFtpRecipient,r=e.checkDeliveryType("DROPBOX")&&!!e.scheduleParams.selectedCloudAccount,s=e.checkDeliveryType("GOOGLE DRIVE")&&!!e.scheduleParams.selectedCloudAccount;return t||a||r||s},r=function(){return!!e.customExportsScheduleParams.exportName},s=function(){return!!e.customExportsScheduleParams.format},n=function(){return e.selectedColumns.length};return t()&&a()&&r()&&s()&&n()&&O()},y=function(){e.createErrors=[],0===e.selectedColumns.length&&e.createErrors.push("No columns selected for the export"),e.scheduleParams.frequency_id||e.createErrors.push("Repeat frequency in details"),e.emailList.length||e.scheduleParams.selectedFtpRecipient||e.scheduleParams.selectedCloudAccount||e.createErrors.push("Emails/SFTP/Dropbox/Google Drive in distribution list"),e.customExportsScheduleParams.exportName||e.createErrors.push("No export name entered"),e.customExportsScheduleParams.format||e.createErrors.push("No format selected"),O()||e.createErrors.push("No Duration Filter Selected")};e.shouldShowExportListOnly=function(){return e.viewState.currentStage===u.SHOW_CUSTOM_EXPORT_LIST};var v=function(){C(),e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST},g=function(){var t=30,a={dateFormat:r.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(){angular.element("#ui-datepicker-div"),angular.element('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(){angular.element("#ui-datepicker-div"),angular.element("#ui-datepicker-overlay").remove()}},s=e.selectedEntityDetails.starts_on||r.businessDate,n=e.selectedEntityDetails.ends_on_date||r.businessDate,i=e.selectedEntityDetails.from_date||r.businessDate,l=e.selectedEntityDetails.to_date||r.businessDate;if(e.scheduleParams={},angular.isDefined(e.selectedEntityDetails.from_date))e.scheduleParams.from_date=e.selectedEntityDetails.from_date;else{e.scheduleParams.from_date=moment(tzIndependentDate(r.businessDate)).subtract(1,"days");var c=moment().startOf("day"),u=moment.duration(c.diff(e.scheduleParams.from_date)).asDays();u<7?e.scheduleParams.from_date=e.scheduleParams.from_date.format("L"):e.scheduleParams.from_date=e.scheduleParams.from_date.calendar()}if(angular.isDefined(e.selectedEntityDetails.to_date))e.scheduleParams.to_date=e.selectedEntityDetails.to_date;else{e.scheduleParams.to_date=moment(tzIndependentDate(r.businessDate)).subtract(1,"days");var c=moment().startOf("day"),u=moment.duration(c.diff(e.scheduleParams.to_date)).asDays();u<7?e.scheduleParams.to_date=e.scheduleParams.to_date.format("L"):e.scheduleParams.to_date=e.scheduleParams.to_date.calendar()}angular.isDefined(e.selectedEntityDetails.time)?e.scheduleParams.time=e.selectedEntityDetails.time:e.scheduleParams.time=void 0,angular.isDefined(e.selectedEntityDetails.frequency_id)?e.scheduleParams.frequency_id=e.selectedEntityDetails.frequency_id:e.scheduleParams.frequency_id=void 0,angular.isDefined(e.selectedEntityDetails.repeats_every)?e.scheduleParams.repeats_every=e.selectedEntityDetails.repeats_every:e.scheduleParams.repeats_every=void 0,null!==e.selectedEntityDetails.ends_on_date&&null===e.selectedEntityDetails.ends_on_after?e.scheduleParams.scheduleEndsOn="DATE":null===e.selectedEntityDetails.ends_on_date&&null!==e.selectedEntityDetails.ends_on_after?(e.scheduleParams.ends_on_after=e.selectedEntityDetails.ends_on_after,e.scheduleParams.scheduleEndsOn="NUMBER"):e.scheduleParams.scheduleEndsOn="NEVER",e.exportFromCalenderOptions=angular.extend({maxDate:tzIndependentDate(r.businessDate),onSelect:function(t){e.exportCalenderToOptions.minDate=t}},a),e.scheduleParams.from_date=o.processDate(i).today,e.exportCalenderToOptions=angular.extend({maxDate:tzIndependentDate(r.businessDate)},a),e.scheduleParams.to_date=o.processDate(l).today,e.startsOnOptions=angular.extend({minDate:tzIndependentDate(r.businessDate),onSelect:function(t){e.endsOnOptions.minDate=t,e.scheduleParams.ends_on_date<e.scheduleParams.starts_on&&(e.scheduleParams.ends_on_date=e.scheduleParams.starts_on)}},a),e.scheduleParams.starts_on=o.processDate(s).today,e.endsOnOptions=angular.extend({onSelect:function(t){e.startsOnOptions.maxDate=t}},a),e.scheduleParams.ends_on_date=o.processDate(n).today,e.scheduleParams.delivery_id=e.selectedEntityDetails.delivery_type?e.selectedEntityDetails.delivery_type.value:null,"CLOUD_DRIVE"===e.scheduleParams.delivery_id&&(e.scheduleParams.delivery_id=e.selectedEntityDetails.cloud_drive_type),"EMAIL"===e.scheduleParams.delivery_id?e.emailList=e.selectedEntityDetails.emails.split(", "):"SFTP"===e.scheduleParams.delivery_id?e.scheduleParams.selectedFtpRecipient=e.selectedEntityDetails.sftp_server_id:"GOOGLE DRIVE"!==e.scheduleParams.delivery_id&&"DROPBOX"!==e.scheduleParams.delivery_id||(e.scheduleParams.selectedCloudAccount=e.selectedEntityDetails.cloud_drive_id),e.timeSlots=o.createTimeSlots(t),e.customExportsScheduleParams.includeTitleHeader=e.selectedEntityDetails.include_title_header},C=function(){var r=function(t){_.each(t,function(t){e.customExportsData.customExportDataSpaces.push({id:t.id,report:{id:t.id,title:t.title,description:t.description},active:!1,filteredOut:!1,filters:t.filters})}),a(function(){A(h,!0)},500)},s=function(){e.customExportsData.customExportDataSpaces=[]};e.callAPI(t.getAvailableDataSpaces,{onSuccess:r,onFailure:s})},N=function(){var s=function(t){e.customExportsData.scheduledCustomExports=t.customExports,t.scheduleFrequencies=_.sortBy(t.scheduleFrequencies,function(e){return e.id}),e.customExportsData.scheduleFrequencies=angular.copy(t.scheduleFrequencies),e.customExportsData.scheduleFrequencies=_.filter(e.customExportsData.scheduleFrequencies,function(e){return"RUN_DURING_EOD"!==e.value||r.isStandAlone}),c=_.find(e.customExportsData.scheduleFrequencies,{value:"RUN_DURING_EOD"}).id,_.each(e.customExportsData.scheduledCustomExports,function(e){e.filteredOut=!1,e.report.description=e.name,e.occurance=m(e)}),e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST,a(function(){A(h,!0)},800)},n=function(){e.customExportsData.scheduledCustomExports=[]};e.callAPI(t.getCustomExportsAndScheduleFrequencies,{onSuccess:s,onFailure:n})},P=function(){e.customExportsScheduleParams.format=e.selectedEntityDetails.format&&e.selectedEntityDetails.format.id,e.customExportsScheduleParams.deliveryType=e.selectedEntityDetails.delivery_type&&e.selectedEntityDetails.delivery_type.id},L=function(){_.each(e.selectedEntityDetails.mapped_name,function(t){var a=_.find(e.selectedEntityDetails.columns,{name:t.field_name}),r=parseInt(t.sequence_order)-1;a&&(a.selected=!0,a.customColLabel=t.mapped_name,e.selectedColumns[r]=a)})},I=function(e){switch(e){case"DAILY":return"Day";case"HOURLY":return"Hour";case"WEEKLY":return"Week";case"MONTHLY":return"Month";case"RUN_ONCE":return"Once";case"MINUTES":return"Minute";default:return"Per"}},U=function(){e.customExportsData.scheduleFreqTypes=_.map(e.customExportsData.scheduleFrequencies,function(e){return{id:e.id,value:I(e.value),originalValue:e.value}})},M=function(r,s){var o=function(t){e.selectedEntityDetails.columns=angular.copy(t.columns),e.selectedEntityDetails.active=!0,e.viewState.currentStage=u.SHOW_PARAMETERS,e.customExportsData.exportFormats=angular.copy(t.exportFormats),e.customExportsData.deliveryTypes=angular.copy(t.deliveryTypes),e.customExportsData.durations=angular.copy(t.durations),e.ftpServerList=t.ftpServerList,e.dropBoxAccountList=t.dropBoxAccounts,e.googleDriveAccountList=t.googleDriveAccounts,e.customExportsData.CSV_FORMAT_ID=_.find(e.customExportsData.exportFormats,{value:"CSV"}).id,e.customExportsData.isNewExport||(P(),L()),U(),g(e.selectedEntityDetails),e.updateViewCol(e.viewColsActions.SIX);var r=angular.copy(e.selectedEntityDetails.filters);e.selectedEntityDetails.processedFilters=n.processFilters(r),s&&e.$broadcast("UPDATE_FILTER_SELECTIONS"),a(function(){A(h),A(d,!0),A(p,!0),A(E,!0),A(R,!0)},1e3)},i=function(t){e.errorMessage=t};e.callAPI(t.getRequestData,{onSuccess:o,onFailure:i,params:{reportId:r}})};e.clickDataSpace=function(t){e.selectedEntityDetails&&(e.selectedEntityDetails.active=!1),e.selectedEntityDetails=t,H(),M(t.id)},e.selectColumn=function(t){t.selected?e.selectedColumns.push(t):e.selectedColumns=_.reject(e.selectedColumns,function(e){return e.name===t.name}),a(function(){A(p),A(E,!0),A(R,!0)},1e3)};var b=function(e){var t=e.options.value_key||"value",a=_.where(e.secondLevelData,{selected:!0}),r=_.pluck(a,t);return r||[]},F=function(t){var a,s={report_id:t,hotel_id:r.hotelDetails.userHotelsData.current_hotel_id,format_id:e.customExportsScheduleParams.format,delivery_type_id:"",name:e.customExportsScheduleParams.exportName},n=[];_.each(e.selectedColumns,function(e,t){a={field_name:e.name,mapped_name:e.customColLabel||e.name,sequence_order:t+1},n.push(a)}),s.mapped_names=n;var o,l={};_.each(e.filterData.appliedFilters,function(e){o=e.selectedFirstLevel.toLowerCase(),e.isDuration||e.isGeneral?e.selectedSecondLevel&&(l[o]=e.selectedSecondLevel):e.isOption?e.hasDualState?e.selectedSecondLevel&&(l[o]=e.selectedSecondLevel):e.isMultiSelect&&(_.isEmpty(b(e))||(l[o]=b(e))):e.isRange&&(l[o]||(l[o]=[]),e.selectedSecondLevel&&e.rangeValue&&l[o].push({operator:e.selectedSecondLevel,value:e.rangeValue}))}),s.filter_values=l;var u=_.find(e.customExportsData.scheduleFrequencies,{value:"RUN_ONCE"}).id;e.scheduleParams.time&&(s.time=e.scheduleParams.time),e.scheduleParams.from_date&&(s.from_date=i("date")(e.scheduleParams.from_date,"yyyy/MM/dd")),
s.frequency_id=e.scheduleParams.frequency_id,e.scheduleParams.starts_on&&(s.starts_on=i("date")(e.scheduleParams.starts_on,"yyyy/MM/dd")),e.scheduleParams.frequency_id===u||e.scheduleParams.frequency_id===c?s.repeats_every=null:e.scheduleParams.repeats_every?s.repeats_every=e.scheduleParams.repeats_every:s.repeats_every=0,e.scheduleParams.frequency_id===u?(s.ends_on_after=null,s.ends_on_date=null):"NUMBER"===e.scheduleParams.scheduleEndsOn?(s.ends_on_after=e.scheduleParams.ends_on_after,s.ends_on_date=null):"DATE"===e.scheduleParams.scheduleEndsOn?(s.ends_on_date=i("date")(e.scheduleParams.ends_on_date,"yyyy/MM/dd"),s.ends_on_after=null):(s.ends_on_after=null,s.ends_on_date=null);var d=_.find(e.customExportsData.deliveryTypes,{value:e.scheduleParams.delivery_id});return d&&(s.delivery_type_id=parseInt(d.id)),e.checkDeliveryType("EMAIL")&&e.emailList.length?s.emails=e.emailList.join(", "):e.checkDeliveryType("SFTP")&&e.scheduleParams.selectedFtpRecipient?s.sftp_server_id=e.scheduleParams.selectedFtpRecipient:(e.checkDeliveryType("GOOGLE DRIVE")||e.checkDeliveryType("DROPBOX"))&&e.scheduleParams.selectedCloudAccount?s.cloud_drive_id=e.scheduleParams.selectedCloudAccount:(s.emails="",s.sftp_server_id=""),e.customExportsScheduleParams.includeTitleHeader&&e.customExportsScheduleParams.format===e.customExportsData.CSV_FORMAT_ID&&(s.include_title_header=e.customExportsScheduleParams.includeTitleHeader),s},w=function(){var t=F(e.selectedEntityDetails.id),a=function(){e.errorMessage="",Y()},r=function(t){e.errorMessage=t,e.$emit(T,t)};e.callAPI(s.createSchedule,{params:t,onSuccess:a,onFailure:r})};e.pickSchedule=function(t){e.selectedEntityDetails&&(e.selectedEntityDetails.active=!1),e.selectedEntityDetails=t,e.customExportsData.isNewExport=!1,H(),e.customExportsScheduleParams.exportName=t.name,t.active=!0,M(t.report.id,!0)};var G=function(){var t=F(e.selectedEntityDetails.report.id),a=function(){e.errorMessage="",e.updateViewCol(e.viewColsActions.ONE),e.customExportsData.isNewExport=!1,e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST,N()},r=function(t){e.errorMessage=t,e.$emit(T,t)};t.id=e.selectedEntityDetails.id,e.callAPI(s.updateSchedule,{params:t,onSuccess:a,onFailure:r})},Y=function(){B(),v(),e.customExportsData.isNewExport=!0,e.updateView(e.reportViewActions.SHOW_CUSTOM_NEW_EXPORT),e.updateViewCol(e.viewColsActions.ONE)},k=function(){e.addListener("UPDATE_CUSTOM_EXPORT_SCHEDULE",function(){D()?G():(y(),l.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:e}))}),e.addListener("SHOW_EXPORT_LISTING",function(){e.updateViewCol(e.viewColsActions.ONE),e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST,e.selectedEntityDetails.active=!1,H(),a(function(){A(h,!0)},300)}),e.addListener("CREATE_NEW_CUSTOM_EXPORT_SCHEDULE",function(){D()?w():(y(),l.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:e}))}),e.addListener("CREATE_NEW_CUSTOM_EXPORT",function(){Y()}),e.addListener("RESET_CURRENT_STAGE",function(){e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST}),e.addListener("DELETE_CUSTOM_EXPORT_SCHEDULE",function(){x()})};e.notRunOnce=function(){var t=_.find(e.customExportsData.scheduleFrequencies,{id:e.scheduleParams.frequency_id})||{};return"RUN_ONCE"!==t.value},e.getRepeatPer=function(){var t=_.find(e.customExportsData.scheduleFreqTypes,{id:e.scheduleParams.frequency_id});return t?t.value:"Per"},e.checkDeliveryType=function(t){return t===e.scheduleParams.delivery_id};var V=function(){e.$$phase||e.$digest()};e.userAutoCompleteSimple={minLength:3,source:function(t,a){var r,s;r=_.map(e.activeUserList,function(e){return{label:e.full_name||e.email,value:e.email}}),s=$.ui.autocomplete.filter(r,t.term),a(s)},select:function(t,a){var r=_.find(e.emailList,function(e){return e===a.item.value});return r||e.emailList.push(a.item.value),this.value="",V(),A(R,!0),!1},focus:function(){return!1}},e.removeEmail=function(t){e.emailList=[].concat(e.emailList.slice(0,t),e.emailList.slice(t+1)),A(R,!0)},e.onDeliveryOptionChange=function(){e.scheduleParams.selectedCloudAccount=null},e.hasMinutesRepeat=function(){var t=_.find(e.customExportsData.scheduleFreqTypes,{id:e.scheduleParams.frequency_id});return t&&"Minute"===t.value};var H=function(){e.customExportsScheduleParams.format="",e.customExportsScheduleParams.exportName="",e.selectedColumns=[],e.filterData={appliedFilters:[],primaryFilter:""},e.scheduleParams={},e.emailList=[]},x=function(){l.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDeleteSchedule.html",scope:e})};e.deleteSchedule=function(){var t=function(){e.errorMessage="",e.updateViewCol(e.viewColsActions.ONE),e.customExportsData.isNewExport=!1,e.viewState.currentStage=u.SHOW_CUSTOM_EXPORT_LIST,N()},a=function(t){e.errorMessage=t};e.closeDialog(),e.callAPI(s.deleteSchedule,{params:{id:e.selectedEntityDetails.id},onSuccess:t,onFailure:a})},e.runScheduleNow=function(){var t={id:e.selectedEntityDetails.id},a=function(t){var a,r={description:"",url:""};return e.ftpServerList.length&&(a=_.find(e.ftpServerList,{id:t})||r,r={description:a.description,url:a.url}),r},r=function(t){var a,r={description:""};return"GOOGLE DRIVE"===e.scheduleParams.delivery_id&&e.googleDriveAccountList.length&&(a=_.find(e.googleDriveAccountList,{id:t})||r,r={description:a.description}),"DROPBOX"===e.scheduleParams.delivery_id&&e.dropBoxAccountList.length&&(a=_.find(e.dropBoxAccountList,{id:t})||r,r={description:a.description}),r},n=function(){e.runNowData={isEmail:e.checkDeliveryType("EMAIL"),isFtp:e.checkDeliveryType("SFTP"),isGoogleDrive:e.checkDeliveryType("GOOGLE DRIVE"),isDropbox:e.checkDeliveryType("DROPBOX"),isSingleEmail:1===e.emailList.length,ftpAddress:a(e.scheduleParams.selectedFtpRecipient),cloudDetails:r(e.scheduleParams.selectedCloudAccount)},l.open({template:"/assets/partials/reports/scheduleReport/rvRunScheduleNowUpdate.html",scope:e})},o=function(){e.errorMessage="",e.runScheduleNowSuccess=!0,n()},i=function(t){e.errorMessage=t,e.runScheduleNowSuccess=!1,n()};e.callAPI(s.runScheduleNow,{params:t,onSuccess:o,onFailure:i})},e.changeRepeats=function(){A(E,!0)};var B=function(){H(),e.customExportsData.scheduledCustomExports=[],e.customExportsData.customExportDataSpaces=[],e.customExportsData.exportFormats=[],e.customExportsData.deliveryTypes=[],e.customExportsData.durations=[],e.viewState={currentStage:u.SHOW_CUSTOM_EXPORT_LIST},e.repeatMinutesMinVal=0};e.shallDisableRepeatsEvery=function(){return e.customExportsData.scheduleFrequencies&&e.scheduleParams.frequency_id===_.find(e.customExportsData.scheduleFrequencies,{value:"RUN_DURING_EOD"}).id};var W=function(){e.customExportsData.isNewExport=!1,B(),N(),S(),k()};W()}]),angular.module("sntRover").controller("rvDailyProdByDemographics.Controller",["$scope","RVReportParserFac","$timeout","RVReportMsgsConst","$rootScope",function(e,t,a,r,s){var n=50,o=10,i=100,l=2,c=function(){a(function(){e.$emit("showLoader")},0)},u=function(){a(function(){e.$emit("hideLoader")},0)},d=function(){a(function(){e.$emit("hideLoader")},l*e.results.dates.length)},_=function(){var t={data:e.results,businessDate:s.businessDate,startedRendering:c,completedRendering:u,completedUpdating:d};c(),ReactDOM.render(React.createElement(DailyProductionByDemographics,t),document.getElementById("daily-prod-demographics"))},p=function(){a(_,i)},h=function(){a(_,o)},E=e.$on(r.REPORT_SUBMITED,function(){a(_,n)}),R=e.$on(r.REPORT_PRINTING,_),f=e.$on(r.REPORT_UPDATED,p),T=e.$on(r.REPORT_PAGE_CHANGED,p),S=s.$on("RELOAD_RESULTS",p);e.$on("$destroy",E),e.$on("$destroy",f),e.$on("$destroy",R),e.$on("$destroy",T),e.$on("$destroy",S),BaseCtrl.call(this,e),h()}]),angular.module("sntRover").controller("RVDailyProdRateReport.Controller",["$rootScope","$scope","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout","$state",function(e,t,a,r,s,n,o,i,l,c,u){function d(e){var a=e||{},r=_.extend(a,{rightPaneWidth:t.rightPaneWidth,colspan:t.colSpan,headerTop:t.headerTop,headerBot:t.headerBot,reportData:t.reportData,colspanArray:t.colspanArray,isLastRowSum:!1,reactRenderDone:t.reactRenderDone});ReactDOM.render(React.createElement(DPContent,r),document.getElementById("daily-production-render"))}function p(t,a,r,s){var n,o,i,c={ROOMS:"Rooms #",AVAILABLE_ROOMS:"Avl. Rooms",FORECAST:"Forecast.",ADR:"ADR",ACTUAL:"Room Rev.",ADDON:"Add-on",ARRIVALS:"Arrivals",ADULTS:"Adults",CHILDREN:"Children",FORECAST_FNB_REV:"Forecast F&B Rev.",ACTUAL_FNB_REV:"Actual F&B Rev.",FORECAST_OTHER_REV:"Forecast Other Rev.",ACTUAL_OTHER_REV:"Actual Other Rev.",FORECAST_TOTAL_REV:"Forecast Total Rev.",ACTUAL_TOTAL_REV:"Actual Total Rev."},u=0,d=100,p=[],h=[],E=[],R=0,f=0,T=1*new tzIndependentDate(r.fromDate),S=1*new tzIndependentDate(r.untilDate),A=864e5;for(t.showAvailability&&t.showRevenue?n=["ROOMS","AVAILABLE_ROOMS","FORECAST","ADR"]:!t.showAvailability&&t.showRevenue?n=["FORECAST","ADR"]:t.showAvailability&&!t.showRevenue&&(n=["ROOMS","AVAILABLE_ROOMS"]),f=n.length;T<=S;T+=A)o=new tzIndependentDate(T)<new tzIndependentDate(e.businessDate),p.push({ms:T,name:l("date")(T,s)}),i=angular.copy(n),o&&t.showRevenue&&(i=_.without(i,"FORECAST").concat(["ACTUAL"]),a.chosenOptions.include_addon_revenue&&i.push("ADDON")),i.push("ARRIVALS","ADULTS","CHILDREN"),t.showRevenue&&i.push("FORECAST_FNB_REV","ACTUAL_FNB_REV","FORECAST_OTHER_REV","ACTUAL_OTHER_REV","FORECAST_TOTAL_REV","ACTUAL_TOTAL_REV"),f=i.length,E.push(i.length),_.each(i,function(e){h.push({name:c[e],cls:e===n.length-1?"day-end":""})}),u+=1;return R=u*d*_.max(E),{headerTop:p,headerBot:h,colSpan:f,colspanArray:E,rightPaneWidth:R}}function h(e,t){var a,r,s,n,o=[],i={},l={};return _.each(e,function(e,o){_.each(e,function(e){n=e.rate_id,a=t.allMappedRates[n],_.isUndefined(a)?(e.rate_name=F.name,r=F):(e.rate_name=a.rate_name||a.name,r=t.allMappedRateTypes[a.rate_type_id]),s=r.rate_type_id,e.rate_type_id=r.rate_type_id,e.rate_type_name=r.name,l.hasOwnProperty(s)||(l[s]={id:s,name:e.rate_type_name,rates_data:{}}),l[s].rates_data[n]={id:n,name:e.rate_name}}),i[o]=_.indexBy(e,"rate_id")}),_.each(l,function(e){o.push({rate_type_id:e.id,name:e.name,is_rate_type:!0}),e.name!==F.name&&_.each(e.rates_data,function(e){o.push({rate_id:e.id,name:e.name,is_rate_type:!1})})}),{yAxis:o,modifiedResults:i}}function E(a,r){var s,n,o,i=[];return _.each(a,function(a){o=[],_.each(r,function(r,i){n={date:i,businessDate:e.businessDate,currencySymbol:e.currencySymbol,showAvailability:t.uiFilter.showAvailability,showRevenue:t.uiFilter.showRevenue},a.is_rate_type?(n.isRateType=!0,n.data=D(O(r,"rate_type_id",a.rate_type_id))):(s=_.find(r,{rate_id:a.rate_id}),n.isRateType=!1,n.data=s),o.push(R(n))}),i.push(_.flatten(o))}),i}function R(e){var t=2,a=[],r=new tzIndependentDate(e.date)<new tzIndependentDate(e.businessDate),s=_.extend({adr:0,available_rooms_count:0,occupied_rooms_count:0,rate_id:0,room_revenue:0},e.data);return e.showAvailability&&!e.showRevenue?(a.push({value:s.occupied_rooms_count,isAvail:!0,isRateType:e.isRateType}),a.push({value:s.available_rooms_count,isAvail:!0,isRateType:e.isRateType})):!e.showAvailability&&e.showRevenue?(r||a.push({value:l("currency")(s.room_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.adr,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),r&&a.push({value:l("currency")(s.room_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType})):e.showAvailability&&e.showRevenue&&(a.push({value:s.occupied_rooms_count,isAvail:!0,isRateType:e.isRateType}),a.push({value:s.available_rooms_count,isAvail:!0,isRateType:e.isRateType}),r||a.push({value:l("currency")(s.room_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.adr,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),r&&a.push({value:l("currency")(s.room_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType})),a.push({value:s.arrivals,isAvail:!0,isRateType:e.isRateType}),a.push({value:s.adults,isAvail:!0,isRateType:e.isRateType}),a.push({value:s.children,isAvail:!0,isRateType:e.isRateType}),e.showRevenue&&(a.push({value:l("currency")(s.fnb_future_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.fnb_actual_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.others_future_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.others_actual_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.total_future_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType}),a.push({value:l("currency")(s.total_actual_revenue,e.currencySymbol,t),isRev:!0,isRateType:e.isRateType})),a}function f(a){var r,s,n;_.has(t.chosenReport,"hasRateFilter")&&(r=p(t.uiFilter,t.chosenReport,y(a),e.shortMonthAndDate),t.headerTop=r.headerTop,t.headerBot=r.headerBot,t.colSpan=r.colSpan,t.colspanArray=r.colspanArray,t.rightPaneWidth=r.rightPaneWidth,s=h(a,g),t.yAxisLabels=s.yAxis,n=s.modifiedResults,t.reportData=E(t.yAxisLabels,n),d())}function T(){t.$emit("showLoader"),c(function(){var e;f(C.getCurChunk()),t.reportMonths=[],t.reportMonths=C.getChunkNames(),t.reportMonthTrack={},e=_.findIndex(t.reportMonths,{isActive:!0}),t.reportMonthTrack.curr=t.reportMonths[e],e>0?t.reportMonthTrack.prev=t.reportMonths[e-1]:t.reportMonthTrack.prev=!1,e<t.reportMonths.length?t.reportMonthTrack.next=t.reportMonths[e+1]:t.reportMonthTrack.next=!1},V)}function S(){var e=G.results;"rover.reports.inbox"===u.current.name&&(t.isPrintClicked=!0),C=v(e),T()}function A(){S()}function m(e,t){return{allMappedRates:_.indexBy(e,"id"),allMappedRateTypes:_.indexBy(t,"rate_type_id")}}function O(e,t,a){var r=[];return _.each(e,function(e){e[t]===a&&r.push(e)}),r}function D(e){var t,a={adr:0,available_rooms_count:0,occupied_rooms_count:0,room_revenue:0,arrivals:0,adults:0,children:0,fnb_future_revenue:0,fnb_actual_revenue:0,others_future_revenue:0,others_actual_revenue:0,total_future_revenue:0,total_actual_revenue:0},r=function(e){var t=parseFloat(e);return isNaN(t)?0:t};return _.each(e,function(e){a.available_rooms_count=e.available_rooms_count,a.occupied_rooms_count+=r(e.occupied_rooms_count),a.room_revenue+=r(e.room_revenue),a.arrivals+=e.arrivals,a.adults+=e.adults,a.children+=e.children,a.fnb_future_revenue+=r(e.fnb_future_revenue),a.fnb_actual_revenue+=r(e.fnb_actual_revenue),a.others_future_revenue+=r(e.others_future_revenue),a.others_actual_revenue+=r(e.others_actual_revenue),a.total_future_revenue+=r(e.total_future_revenue),a.total_actual_revenue+=r(e.total_actual_revenue)}),t=a.room_revenue/a.occupied_rooms_count,a.adr=_.isFinite(t)?t:0,a}function y(e){var t,a,r,s,n=_.keys(e),o=[],i=[],l=[];_.map(n,function(e){return t=e,s={dayNum:parseInt(e.split("-")[2],10),monNum:parseInt(e.split("-")[1],10)},o.push(s),isNaN(a)?1:a});var c=_.map(n,function(e){return r=parseInt(e.split("-")[1],10),isNaN(r)?1:r}),u=_.min(c),d=_.max(c);_.each(o,function(e){e.monNum===u&&l.push(e),e.monNum===d&&i.push(e)});var p=_.map(l,function(e){return isNaN(e.dayNum)?1:e.dayNum}),h=_.map(i,function(e){return isNaN(e.dayNum)?1:e.dayNum}),E=_.min(p),R=_.max(h),f=t.split("-");return{fromDate:f[0]+"-"+u+"-"+E,untilDate:f[0]+"-"+d+"-"+R}}function v(e){var a,r=e||{},s={},n={keys:[],length:0,index:0},o=function(e){var t=e.split("-"),a=t[0],r=t[1],s="Default";switch(r){case"01":s="Jan";break;case"02":s="Feb";break;case"03":s="Mar";break;case"04":s="Apr";break;case"05":s="May";break;case"06":s="Jun";break;case"07":s="Jul";break;case"08":s="Aug";break;case"09":s="Sep";break;case"10":s="Oct";break;case"11":s="Nov";break;case"12":s="Dec"}return s+" "+a},i=function(e){return function(){var t=[];return t=_.map(e.keys,function(t,a){return{isActive:a===e.index,index:a,name:o(t)}})}},l=function(e,t){return function(){return e[t.keys[t.index]]||{}}},c=function(e,t){return function(a){var r;return a>=0&&a<t.length?(t.index=a,r=e[t.keys[a]]):r={},r}},u=7;if(_.each(r,function(e,t){a=t.slice(0,u),s.hasOwnProperty(a)||(s[a]={}),s[a][t]=e}),n.keys=_.keys(s),n.length=n.keys.length,t.isPrintClicked){var d={};n.length>1&&(_.each(s,function(e){_.each(e,function(e,t){d[t]||(d[t]=e)})}),s[n.keys[0]]=d)}return n.index=0,{getChunkNames:i(n),getCurChunk:l(s,n),jumpToChunk:c(s,n)}}var g,C,N,P,L,I,U,M,b,F={id:"UNDEFINED",rate_type_id:"UNDEFINED",name:"Undefined"},w=t.$parent,G=w.$parent,Y="left-pane-scroll",k="right-pane-scroll",V=300,H=1e3,x=function(){G.myScroll.hasOwnProperty(Y)&&t.refreshScroller(Y),G.myScroll.hasOwnProperty(k)&&t.refreshScroller(k)},B=function(){G.myScroll[Y].on("scroll",function(){G.myScroll[k].scrollTo(0,this.y)}),G.myScroll[k].on("scroll",function(){G.myScroll[Y].scrollTo(0,this.y)})},$=function e(){G.myScroll.hasOwnProperty(Y)&&G.myScroll.hasOwnProperty(k)?B():c(e,H)},W=function(){G.myScroll[Y].destroy(),delete G.myScroll[Y],G.myScroll[k].destroy(),delete G.myScroll[k]};BaseCtrl.call(this,t),t.setScroller(Y,{preventDefault:!1,probeType:3}),t.setScroller(k,{preventDefault:!1,probeType:3,scrollX:!0}),t.$on("$destroy",W),$(),t.colSpan=5,t.uiFilter={showAvailability:!0,showRevenue:!0},N=t.$watch("uiFilter.showAvailability",function(e,a){e!==a&&(!1!==e||t.uiFilter.showRevenue||(t.uiFilter.showRevenue=!0),t.$emit("showLoader"),c(A.bind(this,"uiFilter.showAvailability"),V))}),P=t.$watch("uiFilter.showRevenue",function(e,a){e!==a&&(!1!==e||t.uiFilter.showAvailability||(t.uiFilter.showAvailability=!0),t.$emit("showLoader"),c(A.bind(this,"uiFilter.showRevenue"),V))}),t.$on("$destroy",N),t.$on("$destroy",P),t.reactRenderDone=function(){x(),t.$emit("hideLoader")},t.jumpToMonth=function(e){C.jumpToChunk(e),T()},g=m(t.chosenReport.hasRateFilter.data,t.chosenReport.hasRateTypeFilter.data),S(),L=t.$on(o.REPORT_SUBMITED,function(){t.isPrintClicked=!1,A()}),I=t.$on(o.REPORT_PRINTING,A),U=t.$on(o.REPORT_UPDATED,A),M=t.$on(o.REPORT_PAGE_CHANGED,A),b=e.$on("RELOAD_RESULTS",function(){t.isPrintClicked=!0,A()}),t.$on("$destroy",L),t.$on("$destroy",U),t.$on("$destroy",I),t.$on("$destroy",M),t.$on("$destroy",b)}]),angular.module("sntRover").controller("RVDailyProdRoomTypeReport.Controller",["$rootScope","$scope","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout",function(e,t,a,r,s,n,o,i,l,c){function u(){var a,r,s,n,o,i,u,d,_=["Rooms#","Avl. Rooms","Rate Rev.","ADR","Actual Rev.","Arrivals","Adults","Children","Forecast F&B Rev.","Actual F&B Rev.","Forecast Other Rev.","Actual Other Rev.","Forecast Total Rev.","Actual Total Rev."],p=0,h=[],E=[],R=0,f=145,T=t.results;t.uiFilter.showAvailability&&t.uiFilter.showRevenue?t.colSpan=g:!t.uiFilter.showAvailability&&t.uiFilter.showRevenue?t.colSpan=C:t.uiFilter.showAvailability&&!t.uiFilter.showRevenue&&(t.colSpan=N),t.headerTop=[],t.headerBot=[],t.reportData=[],t.roomNames=[],t.rightPaneWidth=0;for(u in T)if(T.hasOwnProperty(u)){i=u.split("__")[0],t.roomNames.push(i||"NA"),n=T[u],h=[];for(d in n)if(n.hasOwnProperty(d)){if(0===p){for(t.headerTop.push({name:l("date")(d,e.shortMonthAndDate)}),g===t.colSpan?(a=0,r=_.length,s=_.length-1):C===t.colSpan?(a=N,r=_.length,s=_.length-1):N===t.colSpan&&(a=0,r=2,s=1);a<r;a++)t.headerBot.push({name:_[a],cls:a===s?"day-end":""});R+=1}o=n[d],E=[],N===t.colSpan?(E.push({value:o.total_reservations_count,isAvail:!0}),E.push({value:o.available_rooms_count,isAvail:!0,cls:"last-day"})):C===t.colSpan?(E.push({value:l("currency")(o.rate_revenue,e.currencySymbol,v),isRev:!0}),E.push({value:l("currency")(o.adr,e.currencySymbol,v),isRev:!0}),E.push({value:l("currency")(o.actual_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"})):g===t.colSpan&&(E.push({value:o.total_reservations_count,isAvail:!0}),E.push({value:o.available_rooms_count,isAvail:!0}),E.push({value:l("currency")(o.rate_revenue,e.currencySymbol,v),isRev:!0}),E.push({value:l("currency")(o.adr,e.currencySymbol,v),isRev:!0}),E.push({value:l("currency")(o.actual_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"})),E.push({value:o.arrivals,isAvail:!0}),E.push({value:o.adults,isAvail:!0}),E.push({value:o.children,isAvail:!0}),t.uiFilter.showRevenue&&(E.push({value:l("currency")(o.fnb_future_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"}),E.push({value:l("currency")(o.fnb_actual_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"}),E.push({value:l("currency")(o.others_future_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"}),E.push({value:l("currency")(o.others_actual_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"}),E.push({value:l("currency")(o.total_future_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"}),E.push({value:l("currency")(o.total_actual_revenue,e.currencySymbol,v),isRev:!0,cls:"last-day"})),h=h.concat(E)}p+=1,t.reportData.push(h)}t.rightPaneWidth=R*f*t.colSpan,c(function(){M(),t.$emit("hideLoader")},D)}function d(e){var a=e||{},r=_.extend(a,{rightPaneWidth:t.rightPaneWidth,colspan:t.colSpan,headerTop:t.headerTop,headerBot:t.headerBot,reportData:t.reportData,isLastRowSum:!0,roomNames:t.roomNames,reportType:i.DAILY_PRODUCTION_ROOM_TYPE});ReactDOM.render(React.createElement(DPContent,r),document.getElementById("daily-production-render"))}function p(){u(),d()}function h(){u(),d()}var E,R,f,T,S,A,m,O=100,D=300,y=1e3,v=2,g=14,C=12,N=5,P=t.$parent,L=P.$parent,I="left-pane-scroll",U="right-pane-scroll",M=function(){L.myScroll.hasOwnProperty(I)&&t.refreshScroller(I),L.myScroll.hasOwnProperty(U)&&t.refreshScroller(U)},b=function(){L.myScroll[I].on("scroll",function(){L.myScroll[U].scrollTo(0,this.y)}),L.myScroll[U].on("scroll",function(){L.myScroll[I].scrollTo(0,this.y)})},F=function e(){L.myScroll.hasOwnProperty(I)&&L.myScroll.hasOwnProperty(U)?b():c(e,y)},w=function(){L.myScroll[I].destroy(),delete L.myScroll[I],L.myScroll[U].destroy(),delete L.myScroll[U]};BaseCtrl.call(this,t),t.setScroller(I,{preventDefault:!1,probeType:3}),t.setScroller(U,{preventDefault:!1,probeType:3,scrollX:!0}),F(),t.$on("$destroy",w),t.colSpan=14,t.uiFilter={showAvailability:!0,showRevenue:!0},E=t.$watch("uiFilter.showAvailability",function(e){!1!==e||t.uiFilter.showRevenue||(t.uiFilter.showRevenue=!0),t.$emit("showLoader"),c(h,O)}),R=t.$watch("uiFilter.showRevenue",function(e){!1!==e||t.uiFilter.showAvailability||(t.uiFilter.showAvailability=!0),t.$emit("showLoader"),c(h,D)}),f=t.$on(o.REPORT_SUBMITED,h),T=t.$on(o.REPORT_PRINTING,h),S=t.$on(o.REPORT_UPDATED,h),A=t.$on(o.REPORT_PAGE_CHANGED,h),m=e.$on("RELOAD_RESULTS",h),t.$on("$destroy",E),t.$on("$destroy",R),t.$on("$destroy",f),t.$on("$destroy",S),t.$on("$destroy",T),t.$on("$destroy",A),t.$on("$destroy",m),p()}]),angular.module("sntRover").controller("RVExportReportsCtrl",["$rootScope","$scope","RVreportsSrv","RVReportUtilsFac","RVReportParamsConst","$filter","$timeout","ngDialog",function(e,t,a,r,s,n,o,i){function l(){t.isAddingNew=!1,t.addingStage=F.SHOW_SCHEDULE_LIST,t.selectedSchedule={},t.selectedReport={},t.selectedEntityDetails={},t.$parent.$parent.schedulesList=[],t.$parent.$parent.scheduleReport=[],t.scheduleTimePeriods=[],t.scheduleFrequency=[],t.scheduleFreqType=[],t.emailList=[],t.scheduleParams={},f(),M()}var c,u=[],d="REPORT_SCHEDULES_SCROLL",p="SECOND_COLUMN_SCROLL",h="THIRD_COLUMN_SCROLL",E="FOURTH_COLUMN_SCROLL",R="SHOW_ERROR_MSG_EVENT",f=function(){var e={tap:!0,preventDefault:!1};t.setScroller(d,e),t.setScroller(p,e),t.setScroller(h,e),t.setScroller(E,e)},T=function(e,a){var r=100;t.refreshScroller(e),a&&t.myScroll.hasOwnProperty(e)&&t.myScroll[e].scrollTo(0,0,r)},S=function(a){var r="Runs ",s=_.find(t.originalScheduleFrequency,{id:a.frequency_id}),o="",i="",l={DAILY:"DAILY",HOURLY:"HOURLY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",RUN_ONCE:"RUN_ONCE"};return s&&(o=s.description,i=s.value),i===l.RUN_ONCE?r+="once":0!==a.repeats_every&&a.repeats_every?(r+="after every "+a.repeats_every+" ",i===l.DAILY?r+=1===a.repeats_every?"day":"days":i===l.HOURLY?r+=1===a.repeats_every?"hour":"hours":i===l.WEEKLY?r+=1===a.repeats_every?"week":"weeks":i===l.MONTHLY?r+=1===a.repeats_every?"month":"months":i===l.MONTHLY&&(r+=1===a.repeats_every?"month":"months")):r+=o.toLowerCase(),r+=a.time?" at "+a.time+". ":". ",a.starts_on&&(r+="Started on "+n("date")(a.starts_on,e.dateFormat)+". "),i!==l.RUN_ONCE&&(r+=a.ends_on_after?"Ends after "+a.ends_on_after+" times.":a.ends_on_date?"Ends on "+n("date")(a.ends_on_date,e.dateFormat)+".":"Runs forever."),r},A=function(){var e=function(){return angular.isDefined(t.scheduleParams.time_period_id)&&!_.isNull(t.scheduleParams.time_period_id)},a=function(){return!!t.scheduleParams.frequency_id},r=function(){var e=t.checkDeliveryType("EMAIL")&&t.emailList.length,a=t.checkDeliveryType("SFTP")&&!!t.scheduleParams.selectedFtpRecipient,r=t.checkDeliveryType("DROPBOX")&&!!t.scheduleParams.selectedCloudAccount,s=t.checkDeliveryType("GOOGLE DRIVE")&&!!t.scheduleParams.selectedCloudAccount;return e||a||r||s},s=function(){var e=!0;return e=!t.isAdNotumExport||!!t.scheduleParams.rate_code};return e()&&a()&&r()&&s()},m=function(){t.createErrors=[],t.isGuestBalanceReport||t.scheduleParams.time_period_id||t.createErrors.push("Time period in parameters"),t.scheduleParams.frequency_id||t.createErrors.push("Repeat frequency in details"),t.emailList.length||t.scheduleParams.selectedFtpRecipient||t.scheduleParams.selectedCloudAccount||t.createErrors.push("Emails/SFTP/Dropbox/Google Drive in distribution list"),t.isAdNotumExport&&!t.scheduleParams.rate_code&&t.createErrors.push("No Rate Code Selected")};t.navigateToSchedulableReportList=function(){i.close(),t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.updateViewCol(t.viewColsActions.ONE),t.addingStage=F.SHOW_SCHEDULE_LIST,M()};var O=function(){var e=1;return"Police Report Export"===t.selectedEntityDetails.report.title||"HESTA Switzerland"===t.selectedEntityDetails.report.title?e=3:"Spain Barcelona Police Export"===t.selectedEntityDetails.report.title&&(e=4),e},D=function(){var r={report_id:t.selectedEntityDetails.id,hotel_id:e.hotelDetails.userHotelsData.current_hotel_id,format_id:O(),delivery_type_id:""},o=function(e){t.errorMessage="",t.$emit("hideLoader"),e.is_export_already_exist?i.open({template:"/assets/partials/reports/rvDuplicateScheduleWarningPopup.html",scope:t,closeByEscape:!1,data:{isUpdate:!1}}):t.navigateToSchedulableReportList()},l=function(e){t.errorMessage=e,t.$emit(R,e),t.$emit("hideLoader")},u={},d=_.find(t.originalScheduleFrequency,{value:"RUN_ONCE"}).id;t.scheduleParams.time&&(r.time=t.scheduleParams.time),t.scheduleParams.time_period_id&&(r.time_period_id=t.scheduleParams.time_period_id),t.scheduleParams.from_date&&(r.from_date=n("date")(t.scheduleParams.from_date,e.dateFormatForAPI)),t.scheduleParams.to_date&&(r.to_date=n("date")(t.scheduleParams.to_date,e.dateFormatForAPI)),r.frequency_id=t.scheduleParams.frequency_id,t.scheduleParams.starts_on&&(r.starts_on=n("date")(t.scheduleParams.starts_on,"yyyy/MM/dd")),t.scheduleParams.frequency_id===d||t.scheduleParams.frequency_id===c?r.repeats_every=null:t.scheduleParams.repeats_every?r.repeats_every=t.scheduleParams.repeats_every:r.repeats_every=0,t.scheduleParams.frequency_id===d?(r.ends_on_after=null,r.ends_on_date=null):"NUMBER"===t.scheduleParams.scheduleEndsOn?(r.ends_on_after=t.scheduleParams.ends_on_after,r.ends_on_date=null):"DATE"===t.scheduleParams.scheduleEndsOn?(r.ends_on_date=n("date")(t.scheduleParams.ends_on_date,"yyyy/MM/dd"),r.ends_on_after=null):(r.ends_on_after=null,r.ends_on_date=null);var p=_.find(t.scheduleDeliveryTypes,{value:t.scheduleParams.delivery_id});p&&(r.delivery_type_id=parseInt(p.id)),t.scheduleParams.format_id&&(r.format_id=t.scheduleParams.format_id),t.checkDeliveryType("EMAIL")&&t.emailList.length?r.emails=t.emailList.join(", "):t.checkDeliveryType("SFTP")&&t.scheduleParams.selectedFtpRecipient?r.sftp_server_id=t.scheduleParams.selectedFtpRecipient:(t.checkDeliveryType("GOOGLE DRIVE")||t.checkDeliveryType("DROPBOX"))&&t.scheduleParams.selectedCloudAccount?r.cloud_drive_id=t.scheduleParams.selectedCloudAccount:(r.emails="",r.sftp_server_id=""),t.scheduleParams.sort_field&&(u.sort_field=t.scheduleParams.sort_field),_.each(t.filters,function(e,a){"hasRateCode"===a&&(u[s.RATE_ID]=t.scheduleParams.rate_code)}),r.filter_values=u,t.scheduleParams.includeTitleHeader&&(r.include_title_header=t.scheduleParams.includeTitleHeader),t.invokeApi(a.createSchedule,r,o,l)};t.navigateToSchedulesList=function(e){i.close();var a=_.findIndex(t.$parent.$parent.schedulesList,{id:e.id});t.selectedSchedule&&t.selectedSchedule.active&&(t.selectedSchedule.active=!1),t.updateViewCol(t.viewColsActions.ONE),a>=0&&(t.$parent.$parent.schedulesList[a].frequency_id=e.frequency_id,t.$parent.$parent.schedulesList[a].repeats_every=e.repeats_every,t.$parent.$parent.schedulesList[a].time=e.time,t.$parent.$parent.schedulesList[a].starts_on=e.starts_on,t.$parent.$parent.schedulesList[a].ends_on_after=e.ends_on_after,t.$parent.$parent.schedulesList[a].ends_on_date=e.ends_on_date,t.$parent.$parent.schedulesList[a].occurance=S(t.$parent.$parent.schedulesList[a])),t.addingStage=F.SHOW_SCHEDULE_LIST};var y=function(){var r={id:t.selectedEntityDetails.id,report_id:t.selectedEntityDetails.report.id,hotel_id:e.hotelDetails.userHotelsData.current_hotel_id,format_id:O(),delivery_type_id:""},o=function(e){t.errorMessage="",t.$emit("hideLoader"),e.is_export_already_exist?i.open({template:"/assets/partials/reports/rvDuplicateScheduleWarningPopup.html",scope:t,closeByEscape:!1,data:{isUpdate:!0,params:r}}):t.navigateToSchedulesList(r)},l=function(e){t.errorMessage=e,t.$emit(R,e),t.$emit("hideLoader")},u={},d=_.find(t.originalScheduleFrequency,{value:"RUN_ONCE"}).id;t.scheduleParams.time&&(r.time=t.scheduleParams.time),t.scheduleParams.time_period_id&&(r.time_period_id=t.scheduleParams.time_period_id),t.scheduleParams.from_date&&(r.from_date=n("date")(t.scheduleParams.from_date,"yyyy/MM/dd")),t.scheduleParams.to_date&&(r.to_date=n("date")(t.scheduleParams.to_date,"yyyy/MM/dd")),r.frequency_id=t.scheduleParams.frequency_id,t.scheduleParams.starts_on&&(r.starts_on=n("date")(t.scheduleParams.starts_on,"yyyy/MM/dd")),t.scheduleParams.frequency_id===d||t.scheduleParams.frequency_id===c?r.repeats_every=null:t.scheduleParams.repeats_every?r.repeats_every=t.scheduleParams.repeats_every:r.repeats_every=0,t.scheduleParams.frequency_id===d?(r.ends_on_after=null,r.ends_on_date=null):"NUMBER"===t.scheduleParams.scheduleEndsOn?(r.ends_on_after=t.scheduleParams.ends_on_after,r.ends_on_date=null):"DATE"===t.scheduleParams.scheduleEndsOn?(r.ends_on_date=n("date")(t.scheduleParams.ends_on_date,"yyyy/MM/dd"),r.ends_on_after=null):(r.ends_on_after=null,r.ends_on_date=null);var p=_.find(t.scheduleDeliveryTypes,{value:t.scheduleParams.delivery_id});p&&(r.delivery_type_id=parseInt(p.id)),t.scheduleParams.format_id&&(r.format_id=t.scheduleParams.format_id),t.checkDeliveryType("EMAIL")&&t.emailList.length?r.emails=t.emailList.join(", "):t.checkDeliveryType("SFTP")&&t.scheduleParams.selectedFtpRecipient?r.sftp_server_id=t.scheduleParams.selectedFtpRecipient:(t.checkDeliveryType("GOOGLE DRIVE")||t.checkDeliveryType("DROPBOX"))&&t.scheduleParams.selectedCloudAccount?r.cloud_drive_id=t.scheduleParams.selectedCloudAccount:(r.emails="",r.sftp_server_id=""),t.scheduleParams.sort_field&&(u.sort_field=t.scheduleParams.sort_field),_.each(t.filters,function(e,a){"hasRateCode"===a&&(u[s.RATE_ID]=t.scheduleParams.rate_code)}),r.filter_values=u,t.scheduleParams.includeTitleHeader&&(r.include_title_header=t.scheduleParams.includeTitleHeader),t.invokeApi(a.updateSchedule,r,o,l)},v={DUE_IN_ARRIVALS:"DUE_IN_ARRIVALS",DUE_OUT_DEPARTURES:"DUE_OUT_DEPARTURES",INCLUDE_CANCELED:"INCLUDE_CANCELED",INCLUDE_NO_SHOW:"INCLUDE_NO_SHOW",INCLUDE_GUEST_NOTES:"INCLUDE_GUEST_NOTES",INCLUDE_RESERVATION_NOTES:"INCLUDE_RESERVATION_NOTES",INCLUDE_ACTIONS:"INCLUDE_ACTIONS",SHOW_GUESTS:"SHOW_GUESTS",VIP_ONLY:"VIP_ONLY",HAS_VEHICLE_REG_NO:"HAS_VEHICLE_REG_NO",SHOW_PHONE_NUMBER:"SHOW_PHONE_NUMBER",INCLUDE_DUE_OUT:"INCLUDE_DUE_OUT",
RESTRICTED_POST_ONLY:"RESTRICTED_POST_ONLY",INCLUDE_TAX:"INCLUDE_TAX"},g={DATE:"DATE",NAME:"NAME",ROOM:"ROOM",BALANCE:"BALANCE",ROOM_NO:"ROOM_NO",CONFIRMATION_NUMBER:"CONFIRMATION_NUMBER",CHECKOUT_DATE:"CHECKOUT_DATE",TRAVEL_AGENT:"TRAVEL_AGENT",LAST_NAME:"LAST_NAME",RESERVATION_STATUS:"RESERVATION_STATUS"},C={"Arriving Guests":"guest-status check-in","Departing Guests":"guest-status check-out","All In-House Guests":"guest-status inhouse","Balance for all Outstanding Accounts":"icon-report icon-balance","Statistics Report by Comparison":"icon-report icon-comparison"},N=function(){if(t.filters={},t.filters.hasGeneralOptions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description"}},(angular.isUndefined(t.selectedEntityDetails.filters)||null===t.selectedEntityDetails.filters)&&(t.selectedEntityDetails.filters=[]),t.isAdNotumExport){var e={description:"RATE_CODE",value:"RATE_CODE"};_.find(t.selectedEntityDetails.filters,e)||t.selectedEntityDetails.filters.push(e)}_.each(t.selectedEntityDetails.filters,function(e){var a,s=!1,n=!1;"ACCOUNT"!==e.value&&"GUEST"!==e.value||(s=!0,t.filters.hasGeneralOptions.data.push({paramKey:e.value.toLowerCase(),description:e.description,selected:s,mustSend:n})),s=!1,v[e.value]?("Arriving Guests"===t.selectedEntityDetails.report.description&&"DUE_IN_ARRIVALS"===e.value&&(s=!0),"Departing Guests"===t.selectedEntityDetails.report.description&&"DUE_OUT_DEPARTURES"===e.value&&(s=!0),"All In-House Guests"===t.selectedEntityDetails.report.description&&"INCLUDE_DUE_OUT"===e.value&&(s=!0),"Restricted Post only"===t.selectedEntityDetails.report.description&&"RESTRICTED_POST_ONLY"===e.value&&(s=!1),"Statistics Report by Comparison"===t.selectedEntityDetails.report.description?(a=_.filter(u,function(e){return"YESTERDAY"===e.value}),t.scheduleTimePeriods=a):(a=_.filter(u,function(e){return"YESTERDAY"!==e.value}),t.scheduleTimePeriods=a),t.filters.hasGeneralOptions.data.push({paramKey:e.value.toLowerCase(),description:e.description,selected:s,mustSend:n}),"Arriving Guests"!==t.selectedEntityDetails.report.description&&"Departing Guests"!==t.selectedEntityDetails.report.description||(t.filters.hasGeneralOptions.options.noSelectAll=!0)):"RATE_CODE"===e.value&&r.fillRateCodes(t.filters,t.selectedEntityDetails.filter_values,t.scheduleParams)}),b()},P=function(){_.each(t.selectedEntityDetails.filter_values,function(e,a){var r,s;s=a.toUpperCase(),v[s]&&e&&(r=_.find(t.filters.hasGeneralOptions.data,{paramKey:a}),angular.isDefined(r)&&(r.selected=!0)),g[e]&&(t.scheduleParams.sort_field=e)}),b()},L=function(a){var r=_.find(t.originalScheduleFrequency,{value:"DAILY"}),s=_.find(t.originalScheduleFrequency,{value:"RUN_ONCE"}),n=_.find(t.originalScheduleFreqType,{originalValue:"DAILY"}),o=_.find(t.originalScheduleFreqType,{originalValue:"WEEKLY"}),i=_.find(t.originalScheduleFreqType,{originalValue:"MONTHLY"}),l=_.find(t.originalScheduleFreqType,{originalValue:"HOURLY"}),c=_.find(t.originalScheduleFrequency,{value:"WEEKLY"}),u=_.find(t.originalScheduleFrequency,{value:"MONTHLY"}),d=_.find(t.originalScheduleFrequency,{value:"HOURLY"}),p=_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"});t.scheduleFrequency=[],t.scheduleFreqType=[];var h={"Financial Transactions":!0,"Stash Rewards Membership Export":!0,Reservations:!0,Rooms:!0,"Future Reservations":!0,"Journal Export":!0,"Clairvoyix Stays Export":!0,"Clairvoyix Reservations Export":!0,"Synxis - Reservations":!0,"Synxis - Upcoming Reservation Export (Future Reservation Export)":!0,"Police Report Export":!0,"Switzerland Zurich Police Export":!0,"Spain Barcelona Police Export":!0,"Invoice / Folio Export":!0,"Nationality Export - France":!0,"Criterion Hospitality CC Export":!0,"Guest Details by Arrival Date":!0,"Cancellations by Arrival Date":!0,"Cancellations by Cancel Date":!0,"HESTA Switzerland":!0,"Ad Notum - Rate of the Day Export":!0},E={"Financial Transactions":!0,"Stash Rewards Membership Export":!0,Reservations:!0,Rooms:!0,"Future Reservations":!0,"Last Week Reservations":!0,"Past Reservations - Monthly":!0,"Nationality Statistics":!0,Commissions:!0,"Clairvoyix Stays Export":!0,"Clairvoyix Reservations Export":!0,"Synxis - Reservations":!0,"Synxis - Upcoming Reservation Export (Future Reservation Export)":!0,"Police Report Export":!0,"Switzerland Zurich Police Export":!0,"Spain Barcelona Police Export":!0,"Austria Residence Country Export":!0,"Nationality Export - France":!0,"Criterion Hospitality CC Export":!0,"GOBD Export":!0,"GOBD Admin Charge Code Actions Export":!0,"Cancellations by Arrival Date":!0,"Cancellations by Cancel Date":!0,"HESTA Switzerland":!0},R={"Future Reservations":!0,"Last Week Reservations":!0,"Clairvoyix Reservations Export":!0,"Synxis - Upcoming Reservation Export (Future Reservation Export)":!0,"Police Report Export":!0,"Switzerland Zurich Police Export":!0,"Spain Barcelona Police Export":!0,"Invoice / Folio Export":!0,"Cancellations by Arrival Date":!0,"Cancellations by Cancel Date":!0,"HESTA Switzerland":!0},f={"Future Reservations":!0,"Past Reservations - Monthly":!0,"Nationality Statistics":!0,Commissions:!0,"Clairvoyix Reservations Export":!0,"Synxis - Upcoming Reservation Export (Future Reservation Export)":!0,"Police Report Export":!0,"Belgium Nationality Export":!0,"Switzerland Zurich Police Export":!0,"Spain Barcelona Police Export":!0,"Austria Nationality Export":!0,"Invoice / Folio Export":!0,"Nationality Export - France":!0,"Criterion Hospitality CC Export":!0,"Cancellations by Arrival Date":!0,"Cancellations by Cancel Date":!0,"HESTA Switzerland":!0,"Austria Residence Country Export":!0},T={"Future Reservations":!0,"Clairvoyix Reservations Export":!0,"Synxis - Upcoming Reservation Export (Future Reservation Export)":!0,"Police Report Export":!0,"Synxis - Reservations":!0,"Switzerland Zurich Police Export":!0,"Spain Barcelona Police Export":!0,"Cancellations by Arrival Date":!0,"Cancellations by Cancel Date":!0,"HESTA Switzerland":!0,"Ad Notum - Rate of the Day Export":!0};T[a.report.title]&&(t.scheduleFrequency.push(d),t.scheduleFreqType.push(l)),h[a.report.title]&&(t.scheduleFrequency.push(r),t.scheduleFreqType.push(n)),R[a.report.title]&&(t.scheduleFrequency.push(c),t.scheduleFreqType.push(o)),f[a.report.title]&&(t.scheduleFrequency.push(u),t.scheduleFreqType.push(i)),E[a.report.title]&&t.scheduleFrequency.push(s),e.isStandAlone&&t.scheduleFrequency.push(p)},I=function(e){t.scheduleTimePeriods=[];var r=a.getReportExportTimePeriods(e.report.title);_.each(r,function(e){t.scheduleTimePeriods.push(_.find(t.originalScheduleTimePeriods,{value:e}))})},U=function(a){var s,n,o=30,i={dateFormat:e.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(){angular.element("#ui-datepicker-div"),angular.element('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(){angular.element("#ui-datepicker-div"),angular.element("#ui-datepicker-overlay").remove()}},l=moment(tzIndependentDate(e.businessDate)).subtract(1,"days").format(e.momentFormatForAPI),c=t.selectedEntityDetails.starts_on||e.businessDate,u=t.selectedEntityDetails.ends_on_date||e.businessDate,d=t.selectedEntityDetails.from_date||null,p=t.selectedEntityDetails.to_date||l;if(s=_.find(a.filters,function(e){return"ACCOUNT"===e.value||"GUEST"===e.value}),t.scheduleParams={},angular.isDefined(s)?(n=_.find(t.scheduleTimePeriods,function(e){return"TODAY"===e.value}),t.scheduleParams.time_period_id=n.id,t.isGuestBalanceReport=!0):angular.isDefined(t.selectedEntityDetails.time_period_id)?t.scheduleParams.time_period_id=t.selectedEntityDetails.time_period_id:t.scheduleParams.time_period_id=void 0,angular.isDefined(t.selectedEntityDetails.from_date))t.scheduleParams.from_date=t.selectedEntityDetails.from_date;else{t.scheduleParams.from_date=moment(tzIndependentDate(e.businessDate)).subtract(1,"days");var h=moment().startOf("day"),E=moment.duration(h.diff(t.scheduleParams.from_date)).asDays();E<7?t.scheduleParams.from_date=t.scheduleParams.from_date.format("L"):t.scheduleParams.from_date=t.scheduleParams.from_date.calendar()}if(angular.isDefined(t.selectedEntityDetails.to_date))t.scheduleParams.to_date=t.selectedEntityDetails.to_date;else{t.scheduleParams.to_date=moment(tzIndependentDate(e.businessDate)).subtract(1,"days");var h=moment().startOf("day"),E=moment.duration(h.diff(t.scheduleParams.to_date)).asDays();E<7?t.scheduleParams.to_date=t.scheduleParams.to_date.format("L"):t.scheduleParams.to_date=t.scheduleParams.to_date.calendar()}angular.isDefined(t.selectedEntityDetails.time)?t.scheduleParams.time=t.selectedEntityDetails.time:t.scheduleParams.time=void 0,angular.isDefined(t.selectedEntityDetails.frequency_id)?t.scheduleParams.frequency_id=t.selectedEntityDetails.frequency_id:t.scheduleParams.frequency_id=void 0,angular.isDefined(t.selectedEntityDetails.repeats_every)?t.scheduleParams.repeats_every=t.selectedEntityDetails.repeats_every:t.scheduleParams.repeats_every=void 0,null!==t.selectedEntityDetails.ends_on_date&&null===t.selectedEntityDetails.ends_on_after?t.scheduleParams.scheduleEndsOn="DATE":null===t.selectedEntityDetails.ends_on_date&&null!==t.selectedEntityDetails.ends_on_after?(t.scheduleParams.ends_on_after=t.selectedEntityDetails.ends_on_after,t.scheduleParams.scheduleEndsOn="NUMBER"):t.scheduleParams.scheduleEndsOn="NEVER";var l=moment(tzIndependentDate(e.businessDate)).subtract(1,"days").format(e.momentFormatForAPI),h=moment().startOf("day"),R=moment(tzIndependentDate(h)).subtract(90,"days").format(e.momentFormatForAPI);"Cancellations by Arrival Date"===t.selectedEntityDetails.report.title||"Cancellations by Cancel Date"===t.selectedEntityDetails.report.title||"Guest Details by Arrival Date"===t.selectedEntityDetails.report.title?t.exportFromCalenderOptions=angular.extend({maxDate:null,minDate:null,onSelect:function(e){t.exportCalenderToOptions.minDate=e}},i):"GOBD Export"!==t.selectedEntityDetails.report.title&&"GOBD Admin Charge Code Actions Export"!==t.selectedEntityDetails.report.title?t.exportFromCalenderOptions=angular.extend({maxDate:tzIndependentDate(l),minDate:tzIndependentDate(null),onSelect:function(e){t.exportCalenderToOptions.minDate=e}},i):t.exportFromCalenderOptions=angular.extend({maxDate:tzIndependentDate(h),minDate:tzIndependentDate(R),onSelect:function(e){t.exportCalenderToOptions.minDate=e}},i),t.scheduleParams.from_date=null===d?null:r.processDate(d).today,"GOBD Export"===t.selectedEntityDetails.report.title||"GOBD Admin Charge Code Actions Export"===t.selectedEntityDetails.report.title?(null===d&&(d=R),t.exportCalenderToOptions=angular.extend({maxDate:tzIndependentDate(h),minDate:tzIndependentDate(d)},i)):"Cancellations by Arrival Date"===t.selectedEntityDetails.report.title||"Cancellations by Cancel Date"===t.selectedEntityDetails.report.title?t.exportCalenderToOptions=angular.extend({maxDate:null,minDate:null},i):t.exportCalenderToOptions=angular.extend({maxDate:tzIndependentDate(l),minDate:tzIndependentDate(d)},i),t.scheduleParams.to_date=null===d?null:r.processDate(p).today,t.startsOnOptions=angular.extend({minDate:tzIndependentDate(e.businessDate),onSelect:function(e){t.endsOnOptions.minDate=e,t.scheduleParams.ends_on_date<t.scheduleParams.starts_on&&(t.scheduleParams.ends_on_date=t.scheduleParams.starts_on)}},i),t.scheduleParams.starts_on=r.processDate(c).today,t.endsOnOptions=angular.extend({onSelect:function(e){t.startsOnOptions.maxDate=e}},i),t.scheduleParams.ends_on_date=r.processDate(u).today,t.scheduleParams.delivery_id=t.selectedEntityDetails.delivery_type?t.selectedEntityDetails.delivery_type.value:null,t.scheduleParams.format_id=t.selectedEntityDetails.format?t.selectedEntityDetails.format.id:O(),"CLOUD_DRIVE"===t.scheduleParams.delivery_id&&(t.scheduleParams.delivery_id=t.selectedEntityDetails.cloud_drive_type),"EMAIL"===t.scheduleParams.delivery_id?t.emailList=t.selectedEntityDetails.emails.split(", "):"SFTP"===t.scheduleParams.delivery_id?t.scheduleParams.selectedFtpRecipient=t.selectedEntityDetails.sftp_server_id:"GOOGLE DRIVE"!==t.scheduleParams.delivery_id&&"DROPBOX"!==t.scheduleParams.delivery_id||(t.scheduleParams.selectedCloudAccount=t.selectedEntityDetails.cloud_drive_id),"Ad Notum - Rate of the Day Export"===t.selectedEntityDetails.report.title&&(t.isAdNotumExport=!0),t.scheduleParams.includeTitleHeader=t.selectedEntityDetails.include_title_header,t.timeSlots=r.createTimeSlots(o)},M=function(){var e=!0,r=function(a){function r(e){switch(e){case"DAILY":return"Day";case"HOURLY":return"Hour";case"WEEKLY":return"Week";case"MONTHLY":return"Month";case"RUN_ONCE":return"Once";default:return"Per"}}t.originalScheduleFrequency=a.scheduleFrequency,c=_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"}).id,t.originalScheduleTimePeriods=a.scheduleTimePeriods,t.$parent.$parent.schedulesList=[],t.$parent.$parent.schedulableReports=[],t.ftpServerList=a.ftpServerList,t.dropBoxAccountList=a.dropBoxAccounts,t.googleDriveAccountList=a.googleDriveAccounts,t.scheduleDeliveryTypes=a.scheduleDeliveryTypes,t.scheduleFormat=a.scheduleFormat,t.CSV_FORMAT_ID=_.find(t.scheduleFormat,{value:"CSV"}).id,t.$parent.$parent.schedulesList=_.sortBy(a.schedulesList,function(e){return e.report.title}),_.each(t.$parent.$parent.schedulesList,function(e){e.filteredOut=!1,e.occurance=S(e)}),_.each(a.schedulableReports,function(e){t.$parent.$parent.schedulableReports.push({id:e.id,report:{id:e.id,description:e.description,title:e.title},sort_fields:e.sort_fields,active:!1,filteredOut:!1})}),t.$parent.$parent.schedulableReports=_.sortBy(t.$parent.$parent.schedulableReports,function(e){return e.report.title}),t.originalScheduleFreqType=_.map(t.originalScheduleFrequency,function(e){return{id:e.id,value:r(e.value),originalValue:e.value}}),_.each(t.$parent.$parent.schedulesList,function(e){angular.isDefined(C[e.report.description])&&(e.reportIconCls=C[e.report.description])}),t.refreshReportSchedulesScroll(e),t.$emit("hideLoader")},s=function(e){t.errors=e,t.$emit("hideLoader")};t.invokeApi(a.reportExportPayload,{},r,s)},b=function(){t.$$phase||t.$digest()},F={SHOW_SCHEDULE_LIST:"SHOW_SCHEDULE_LIST",SHOW_PARAMETERS:"SHOW_PARAMETERS",SHOW_DETAILS:"SHOW_DETAILS",SHOW_DISTRIBUTION:"SHOW_DISTRIBUTION"};BaseCtrl.call(this,t),t.runScheduleNow=function(){var e={id:t.selectedEntityDetails.id},r=function(e){var a,r={description:"",url:""};return t.ftpServerList.length&&(a=_.find(t.ftpServerList,{id:e})||r,r={description:a.description,url:a.url}),r},s=function(){t.runNowData={isEmail:t.checkDeliveryType("EMAIL"),isFtp:t.checkDeliveryType("SFTP"),isSingleEmail:1===t.emailList.length,ftpAddress:r(t.scheduleParams.selectedFtpRecipient)},i.open({template:"/assets/partials/reports/scheduleReport/rvRunScheduleNowUpdate.html",scope:t})},n=function(){t.errorMessage="",t.$emit("hideLoader"),t.runScheduleNowSuccess=!0,s()},o=function(e){t.errorMessage=e,t.$emit("hideLoader"),t.runScheduleNowSuccess=!1,s()};t.invokeApi(a.runScheduleNow,e,n,o)},t.removeEmail=function(e){var a=!0;t.emailList=[].concat(t.emailList.slice(0,e),t.emailList.slice(e+1)),t.refreshFourthColumnScroll(a)},t.userAutoCompleteSimple={minLength:3,source:function(e,a){var r,s;r=_.map(t.activeUserList,function(e){return{label:e.full_name||e.email,value:e.email}}),s=$.ui.autocomplete.filter(r,e.term),a(s)},select:function(e,a){var r=!0,s=_.find(t.emailList,function(e){return e===a.item.value});return s||t.emailList.push(a.item.value),this.value="",b(),t.refreshFourthColumnScroll(r),!1},focus:function(){return!1}},t.userEmailTyped=function(){},t.pickSchedule=function(e,r){var s=function(a){t.selectedEntityDetails=a,t.isGuestBalanceReport=!1,t.isAdNotumExport=!1,t.selectedSchedule&&t.selectedSchedule.active&&(t.selectedSchedule.active=!1),t.selectedSchedule=t.$parent.$parent.schedulesList[r],t.selectedSchedule.active=!0,t.selectedReport.active=!1,t.addingStage=F.SHOW_DISTRIBUTION,t.updateViewCol(t.viewColsActions.FOUR),I(t.selectedEntityDetails),L(t.selectedEntityDetails),U(e),N(),P(),t.refreshAllOtherColumnScrolls(),t.$emit("hideLoader")},n=function(e){t.errors=e,t.$emit("hideLoader")},o={id:e.id};t.invokeApi(a.fetchOneSchedule,o,s,n)},t.check=function(){i.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDiscard.html",scope:t})},t.pickReport=function(e,a){t.selectedEntityDetails=t.$parent.$parent.schedulableReports[a],t.isGuestBalanceReport=!1,t.isAdNotumExport=!1,t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.selectedReport=t.$parent.$parent.schedulableReports[a],t.selectedReport.active=!0,t.selectedSchedule.active=!1,t.addingStage=F.SHOW_PARAMETERS,t.updateViewCol(t.viewColsActions.TWO),I(t.selectedEntityDetails),L(t.selectedEntityDetails),U(e),N(),P(),t.refreshAllOtherColumnScrolls()},t.getRepeatPer=function(){var e=_.find(t.scheduleFreqType,{id:t.scheduleParams.frequency_id});return e?e.value:"Per"},t.checkCanCreateSchedule=function(){A()?D():(m(),i.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:t}))},t.checkCanSaveSchedule=function(){A()?y():(m(),i.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:t}))},t.confirmDelete=function(){i.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDeleteSchedule.html",scope:t})},t.deleteSchedule=function(){var e=function(){t.errorMessage="",t.$emit("hideLoader"),t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.updateViewCol(t.viewColsActions.ONE),t.addingStage=F.SHOW_SCHEDULE_LIST,M()},r=function(e){t.errorMessage=e,t.$emit("hideLoader")};t.closeDialog(),t.invokeApi(a.deleteSchedule,{id:t.selectedEntityDetails.id},e,r)},t.refreshReportSchedulesScroll=function(e){T(d,e)},t.refreshSecondColumnScroll=function(e){T(p,e)},t.refreshThirdColumnScroll=function(e){T(h,e)},t.refreshFourthColumnScroll=function(e){T(E,e)},t.refreshAllOtherColumnScrolls=function(){var e=!0;t.refreshSecondColumnScroll(e),t.refreshThirdColumnScroll(e),t.refreshFourthColumnScroll(e)},t.scheduleReport=function(){var e=!0;t.isAddingNew=!0,t.selectedSchedule.active=!1,t.updateView(t.reportViewActions.SHOW_EXPORT_A_REPORT),t.updateViewCol(t.viewColsActions.ONE),t.refreshReportSchedulesScroll(e),t.addingStage=F.SHOW_SCHEDULE_LIST,t.$emit("UPDATE_TITLE_AND_HEADING")},t.checkCanCancel=function(){t.selectedReport&&t.selectedReport.active?i.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDiscard.html",scope:t}):t.cancelScheduleReport()},t.cancelScheduleReport=function(){var e=!0;t.isAddingNew=!1,t.addingStage=F.SHOW_SCHEDULE_LIST,t.selectedReport.active=!1,t.updateView(t.reportViewActions.SHOW_EXPORT_REPORTS),t.updateViewCol(t.viewColsActions.ONE),t.refreshReportSchedulesScroll(e),t.closeDialog()},t.goToNext=function(){var e=!0,a=!0;t.addingStage===F.SHOW_PARAMETERS?(t.addingStage=F.SHOW_DETAILS,t.updateViewCol(t.viewColsActions.THREE,e),t.refreshThirdColumnScroll(a)):t.addingStage===F.SHOW_DETAILS&&(t.addingStage=F.SHOW_DISTRIBUTION,t.updateViewCol(t.viewColsActions.FOUR,e),t.refreshFourthColumnScroll(a)),t.scrollToLast()},t.shouldHideParametersCol=function(){return t.addingStage===F.SHOW_SCHEDULE_LIST},t.shouldHideDetailsCol=function(){return t.addingStage===F.SHOW_SCHEDULE_LIST||t.addingStage===F.SHOW_PARAMETERS},t.shouldHideDistributionCol=function(){return t.addingStage===F.SHOW_SCHEDULE_LIST||t.addingStage===F.SHOW_PARAMETERS||t.addingStage===F.SHOW_DETAILS},t.updateScrollOnUpdate=function(){o(function(){t.refreshSecondColumnScroll(!0)},1e3)};var w=function(e){return _.find(t.originalScheduleTimePeriods,function(t){return t.value===e})};t.shouldShowExportCalenderFromDate=function(){var e,a=!1;if(_.isEmpty(t.selectedEntityDetails.report))return a;switch(t.selectedEntityDetails.report.title){case"Guest Details by Arrival Date":case"Journal Export":e=w("DATE");break;case"Cancellations by Arrival Date":case"Cancellations by Cancel Date":case"GOBD Admin Charge Code Actions Export":case"GOBD Export":case"Invoice / Folio Export":e=w("DATE_RANGE")}return e&&e.id===t.scheduleParams.time_period_id&&(a=!0),a},t.shouldShowExportCalenderToDate=function(){var e,a=!1;if(_.isEmpty(t.selectedEntityDetails.report))return a;switch(t.selectedEntityDetails.report.title){case"Cancellations by Arrival Date":case"Cancellations by Cancel Date":case"GOBD Admin Charge Code Actions Export":case"GOBD Export":case"Invoice / Folio Export":e=w("DATE_RANGE")}return e&&e.id===t.scheduleParams.time_period_id&&(a=!0),a},t.notRunOnce=function(){var e=_.find(t.originalScheduleFrequency,{id:t.scheduleParams.frequency_id})||{};return"RUN_ONCE"!==e.value},t.checkDeliveryType=function(e){return e===t.scheduleParams.delivery_id},t.getDeliveryId=function(e){var a=_.find(t.scheduleDeliveryTypes,{value:e})||{};return a.id};var G=t.$on("CREATE_NEW_EXPORT_SCHEDULE",function(){t.scheduleReport()});t.$on("$destroy",G),t.addListener("RESET_CURRENT_STAGE",function(){t.addingStage=F.SHOW_SCHEDULE_LIST}),t.onDeliveryOptionChange=function(){t.scheduleParams.selectedCloudAccount=null},t.shouldShowFileFormat=function(a){return a.report&&"Journal Export"===a.report.title&&e.isGOBDExportEnabled&&(t.scheduleFormat=_.filter(t.scheduleFormat,function(e){return"CSV"===e.value})),a.report&&"Journal Export"===a.report.title&&e.isGOBDExportEnabled},t.shallDisableRepeatsEvery=function(){return t.originalScheduleFrequency&&t.scheduleParams.frequency_id===_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"}).id},l()}]),angular.module("sntRover").controller("RVGroupRoomsReportController",["$scope","RVreportsSrv","$filter","RVReportMsgsConst","rvUtilSrv","$timeout",function(e,t,a,r,s,n){BaseCtrl.call(this,e);var o="group-rooms-scroll",i=function(){e.setScroller(o,{preventDefault:!1,probeType:3})},l=function(){e.myScroll.hasOwnProperty(o)&&e.refreshScroller(o)},c=t.getChoosenReport(),u=function(e,t){var a=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,""),r=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,""),s=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,"");_.each(e.rooms_count,function(e){var n=t.indexOf(e.date);r[n]=e.available,s[n]=e.picked_up,a[n]=e.blocked}),e.availableCounts=r,e.pickedUpCounts=s,e.blockedCounts=a},d=function(e,t){var a,r,s;t.length;_.each(e,function(n,o){a=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,""),r=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,""),s=Array.apply(null,Array(t.length)).map(String.prototype.valueOf,""),_.each(n.rooms_count,function(e){var n=t.indexOf(e.date);r[n]=e.available,s[n]=e.picked_up,a[n]=e.blocked}),e[o].availableCounts=r,e[o].pickedUpCounts=s,e[o].blockedCounts=a})},p=function(t,a,r){var n=moment(c.fromDate),o=moment(c.untilDate);e.fromMonth=n.format("MMMM"),e.fromYear=n.format("YYYY"),e.toMonth=o.format("MMMM"),e.toYear=o.format("YYYY"),e.showNextMonth=!1,e.fromMonth!==e.toMonth&&(e.showNextMonth=!0),e.days=s.getDayBetweenTwoDates(t,a);var i=c.fromDate.getMonth(),l=c.untilDate.getMonth();if(i===l)e.noOfDaysFromMonth=e.days.length;else{var u=0,d=0;_.each(r,function(e){s.getMonthFromDateString(e)===i?u++:d++}),e.noOfDaysFromMonth=u,e.noOfDaysToMonth=d}e.columnWidth=100/e.days.length},h=function(){var t=new Date(c.fromDate),a=new Date(c.untilDate),r=s.getFormattedDatesBetweenTwoDates(t,a);p(t,a,r),u(e.summaryCounts,r),d(e.results,r),n(function(){l()},1e3)};e.isEmpty=function(e){return""===e};var E=function(){i();var t=null!==navigator.userAgent.match(/iPad/i);t?n(function(){h()},100):h();var a=e.$on(r.REPORT_SUBMITED,h),s=e.$on(r.REPORT_PRINTING,h),o=e.$on(r.REPORT_UPDATED,h),l=e.$on(r.REPORT_PAGE_CHANGED,h);e.$on("$destroy",a),e.$on("$destroy",o),e.$on("$destroy",s),e.$on("$destroy",l)};E()}]),sntRover.controller("rvMarketSourceReportCtrl",["$scope","$rootScope","$filter","RVreportsSrv","$timeout",function(e,t,a,r,s){var n=function(e){if(!e)return{maxValue:10,breakingPoint:10,upperLimit:10,ticks:1};var t=Math.max.apply(null,e),a=10;t>100&&t<=200?a=20:t>200&&t<=400?a=40:t>400&&t<=800?a=80:t>800&&t<=1e3?a=100:t>1e3&&t<=1500?a=200:t>1500&&(a=300);var r=Math.ceil(t/a),s=r*a;return{maxValue:t,breakingPoint:a,upperLimit:s,ticks:r}};e.reportStatus={sort:{source:{name:void 0,ascending:void 0},market:{name:void 0,ascending:void 0}}},e.sort=function(t,a){var r=e.reportStatus;a?t?(r.sort.market.name=!1,r.sort.market.ascending?(e.markets.sort(function(t,a){return e.results.market[t]>e.results.market[a]?-1:e.results.market[t]<e.results.market[a]?1:0}),r.sort.market.ascending=!1):(e.markets.sort(function(t,a){return e.results.market[t]>e.results.market[a]?1:e.results.market[t]<e.results.market[a]?-1:0}),r.sort.market.ascending=!0)):(r.sort.source.name=!1,r.sort.source.ascending?(e.sources.sort(function(t,a){return e.results.source[t]>e.results.source[a]?-1:e.results.source[t]<e.results.source[a]?1:0}),r.sort.source.ascending=!1):(e.sources.sort(function(t,a){return e.results.source[t]>e.results.source[a]?1:e.results.source[t]<e.results.source[a]?-1:0}),r.sort.source.ascending=!0)):t?(r.sort.market.name=!0,r.sort.market.ascending?(e.markets.sort(),r.sort.market.ascending=!1):(e.markets.reverse(),r.sort.market.ascending=!0)):(r.sort.source.name=!0,r.sort.source.ascending?(e.sources.reverse(),r.sort.source.ascending=!1):(e.sources.sort(),r.sort.source.ascending=!0)),e.sources&&e.sources.indexOf("Not Defined")>-1&&(e.sources=_.without(e.sources,"Not Defined"),e.sources.push("Not Defined")),e.markets&&e.markets.indexOf("Not Defined")>-1&&(e.markets=_.without(e.markets,"Not Defined"),e.markets.push("Not Defined"))},e.setScroller("report-details-scroll"),e.getTimes=function(e){return new Array(e)},e.getPercentage=function(e,t,a){var r=e/t*a;return Math.min(r,100)+"%"};var o=function(){if(e.sources=[],e.markets=[],_.isEmpty(e.results.source)&&_.isEmpty(e.results.market))e.hasNoData=!0;else{if(e.hasNoData=!1,!_.isEmpty(e.results.source)){e.sources=_.keys(e.results.source);var t=_.values(e.results.source);e.sourcesValuesTotal=t.reduce(function(e,t){return e+t});var a=[];_.each(t,function(t){a.push(t/e.sourcesValuesTotal)})}if(!_.isEmpty(e.results.market)){e.markets=_.keys(e.results.market);var r=_.values(e.results.market);e.marketsValuesTotal=r.reduce(function(e,t){return e+t});var o=[];_.each(r,function(t){o.push(t/e.marketsValuesTotal)})}e.reportStatus.graph={sourceNumber:n(t),marketNumber:n(r)}}s(function(){e.refreshScroller("report-details-scroll")},1e3)};e.$on("report.updated",function(){o()}),e.$on("report.submited",function(){e.sources&&o()}),o()}]),sntRover.controller("RVOccRevPrintPopupCtrl",["$rootScope","$scope","$filter","$timeout","RVReportUtilsFac",function(e,t,a,r,s){function n(t,a,r){var s,n,o,i,l=e.dateFormat.toUpperCase();return"MM-DD-YYYY"===l||"MM/DD/YYYY"===l?(s=parseInt(t.substring(3,5)),n=parseInt(t.substring(0,2))):"DD-MM-YYYY"!==l&&"DD/MM/YYYY"!==l||(s=parseInt(t.substring(0,2)),n=parseInt(t.substring(3,5))),o=parseInt(t.substring(6,10)),i=new Date(o,n-1,s+a),r?void(r.maxDate=i):i}var o=t.$parent.chosenReport;t.occupancyMaxDate=0,o.chosenVariance&&o.chosenLastYear?t.occupancyMaxDate=4:o.chosenVariance||o.chosenLastYear?t.occupancyMaxDate=9:t.occupancyMaxDate=14;var i={dateFormat:e.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(e,t){$("#ui-datepicker-div"),$('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(e){$("#ui-datepicker-div"),$("#ui-datepicker-overlay").remove(),t.showRemoveDateBtn()}};t.fromDateOptions=angular.extend({},i),t.untilDateOptions=angular.extend({},i);var l=a("date")(o.fromDate,e.dateFormat);o.untilDate=n(l,t.occupancyMaxDate),t.untilDateOptions.minDate=o.fromDate,t.untilDateOptions.maxDate=o.untilDate,t.adjustUntilDate=function(){var r=a("date")(o.fromDate,e.dateFormat);t.untilDateOptions.minDate=o.fromDate,t.untilDateOptions.maxDate=n(r,t.occupancyMaxDate)}}]),sntRover.controller("rvOccupancyRevenueReportCtrl",["$scope","$rootScope","$filter","RVreportsSrv","$timeout","dateFilter","ngDialog","RVReportMsgsConst",function(e,t,a,r,s,n,o,i){function l(){e.refreshScroller("rightPanelScroll"),e.refreshScroller("leftPanelScroll")}function c(){if(!e.$parent.errorMessage.length){var a=r.getChoosenReport(),o=1*new tzIndependentDate(a.fromDate),i=1*new tzIndependentDate(a.untilDate),c=864e5;e.marketExists=!1,e.markets=JSON.parse(JSON.stringify(a.hasMarketsList)),e.isUndefinedMarketSelected=!1,t.isBackgroundReportsEnabled&&u(a.appliedFilter.market_ids),angular.forEach(e.markets.data,function(t,a){if(t.hasOwnProperty("selected")&&t.selected)return e.marketExists=!0,!0}),_.find(e.markets.data,{name:"UNDEFINED"}).name="Unassigned";var d=_.find(a.hasGeneralOptions.data,{paramKey:"include_last_year"});e.chosenLastYear=!!d&&d.selected,e.chosenLastYear=e.chosenLastYear||e.$parent.chosenReport.usedFilters&&e.$parent.chosenReport.usedFilters.include_last_year;var p=_.find(a.hasGeneralOptions.data,{paramKey:"include_variance"});for(e.chosenVariance=!!p&&p.selected,e.chosenVariance=e.chosenVariance||e.$parent.chosenReport.usedFilters&&e.$parent.chosenReport.usedFilters.include_variance,e.showDayUseComponent=a.usedFilters?a.usedFilters.include_day_use:a.include_day_use,e.selectedDays=[];o<=i;o+=c)e.selectedDays.push(n(new tzIndependentDate(o),"yyyy-MM-dd"));s(function(){l()},400)}}e.occupanyRevenueState={name:"Occupancy & Revenue Summary"},e.stateStore={occupancy:[{key:"available_rooms",name:"Available Rooms"},{key:"out_of_order_rooms",name:"Out of Order Rooms"},{key:"occupied_rooms",name:"Occupied Rooms"},{key:"complimentary_rooms",name:"Complimentary Rooms"},{key:"occupied_minus_comp",name:"Occupied Rooms (Excl. Comp.)"}],dayUseOccupancy:[{key:"occupied_day_use_rooms",name:"Occupied Day Use Reservations"},{key:"complimentary_day_use_rooms",name:"Day Use Complimentary Rooms"},{key:"occupied_day_use_minus_comp",name:"Occupied Day Use Rooms (Excl. Comp.)"}],occupancyTotals:[{key:"total_occupancy_in_percentage",name:"Total Occ."},{key:"total_occupancy_minus_comp_in_percentage",name:"Total Occ. (Excl. Comp.)"}],dayUseOccTotals:[{key:"total_day_use_occupancy_in_percentage",name:"Total Day Use Occ."},{key:"total_day_use_occupancy_minus_comp_in_percentage",name:"Total Day Use Occ. (Excl. Comp.)"}],revenues:[{key:"rev_par",name:"RevPar"},{key:"adr_inclusive_complimentary_rooms",name:"ADR (Incl. Comp.)"},{key:"adr_exclusive_complimentary_rooms",name:"ADR (Excl. Comp.)"}],dayUseRevenue:[{key:"day_use_adr_inclusive_complimentary_rooms",name:"Day Use ADR (Incl. Comp.)"},{key:"day_use_adr_exclusive_complimentary_rooms",name:"Day Use ADR (Excl. Comp.)"}],revenueTotals:[{key:"total_revenue",name:"Total Revenue"}]},e.setScroller("leftPanelScroll",{preventDefault:!1,probeType:3}),e.setScroller("rightPanelScroll",{preventDefault:!1,probeType:3,scrollX:!0}),e.chosenLastYear=e.$parent.chosenReport.chosenOptions.include_last_year||e.$parent.chosenReport.usedFilters&&e.$parent.chosenReport.usedFilters.include_last_year,e.chosenVariance=e.$parent.chosenReport.chosenOptions.include_variance||e.$parent.chosenReport.usedFilters&&e.$parent.chosenReport.usedFilters.include_variance,e.selectedDays=[],e.absoulte=Math.abs,s(function(){e.$parent.myScroll.leftPanelScroll.on("scroll",function(){var t=this.y;e.$parent.myScroll.rightPanelScroll.scrollTo(0,t)}),e.$parent.myScroll.rightPanelScroll.on("scroll",function(){var t=this.y;e.$parent.myScroll.leftPanelScroll.scrollTo(0,t)})},1e3),e.getNumber=function(){return new Array((1+!!e.chosenLastYear+!!e.chosenVariance)*e.selectedDays.length)},e.getHeader=function(t){return e.chosenLastYear&&e.chosenVariance?t%3===0?"This Year":t%3===2?"Variance":"Last Year":e.chosenLastYear||e.chosenVariance?t%2===0?"This Year":e.chosenVariance?"Variance":"Last Year":"This Year"},e.getValue=function(t,a){var r=e.results[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]];return r?e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year:-1;
},e.getNigtlyValue=function(t,a){var r=e.results.nightly[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]];return r?e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year:-1},e.getClass=function(t){return e.chosenLastYear&&e.chosenVariance?t%3===0?"":t%3===2?"day-end":"last-year":e.chosenLastYear||e.chosenVariance?t%2===0?"":e.chosenVariance?"day-end":"last-year day-end":"day-end"},e.getChargeCodeValue=function(t,a){var r=e.results.charge_groups[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]];return r?e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year:""},e.getChargeCodeDayUseValue=function(t,a){var r=e.results.day_use_charge_groups[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]],s="";return r&&(s=e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year),s},e.getMarketOccupancyValue=function(t,a){var r=e.results.market_room_number[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]];return r?e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year:-1},e.getMarketRevenueValue=function(t,a){var r=e.results.market_revenue[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]];return r?e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year:""},e.getDayUseMarketRevenueValue=function(t,a){var r=e.results.day_use_market_revenue[t][e.selectedDays[parseInt(a/(1+!!e.chosenLastYear+!!e.chosenVariance))]],s="";return r&&(s=e.chosenLastYear&&e.chosenVariance?a%3===0?r.this_year:a%3===2?r.this_year-r.last_year:r.last_year:e.chosenLastYear||e.chosenVariance?a%2===0?r.this_year:e.chosenVariance?r.this_year-r.last_year:r.last_year:r.this_year),s};var u=function(t){t&&_.each(e.markets.data,function(e){var a=_.find(t,{value:e.value});a&&(e.selected=!0)})};c();var d=e.$on(i.REPORT_SUBMITED,c),p=e.$on(i.REPORT_PRINTING,c),h=e.$on(i.REPORT_UPDATED,c),E=e.$on(i.REPORT_PAGE_CHANGED,c),R=e.$on(i.REPORT_FILTER_CHANGED,function(){s(function(){l()},400)});e.$on("$destroy",d),e.$on("$destroy",h),e.$on("$destroy",p),e.$on("$destroy",E),e.$on("$destroy",R);var f=e.$parent,T=f.$parent,S=f.chosenReport,A=function(){var e,t,a,r=0;return e=S.untilDate.getTime()-S.fromDate.getTime(),e=e/864e5|0,t=!!S.chosenOptions.include_variance,a=!!S.chosenOptions.include_last_year,r=t&&a?4:t||a?9:14,e>r};T.printOptions.showModal=function(){S.fromDateCopy=angular.copy(S.fromDate),S.untilDateCopy=angular.copy(S.untilDate),A()?o.open({controller:"RVOccRevPrintPopupCtrl",template:"/assets/partials/reports/occupancyRevenueReport/rvOccRevPrintPopup.html",className:"ngdialog-theme-default",closeByDocument:!0,scope:e,data:[]}):e.$emit(i.REPORT_PRE_PRINT_DONE)},T.printOptions.afterPrint=function(){S.fromDate=angular.copy(S.fromDateCopy),S.untilDate=angular.copy(S.untilDateCopy),s(function(){S.fromDateCopy=void 0,S.untilDateCopy=void 0},0)},e.closeDialog=function(){T.printOptions.afterPrint(),o.close()},e.continueWithPrint=function(){o.close(),e.$emit(i.REPORT_PRE_PRINT_DONE)}}]),sntRover.controller("RVReportDetailsCtrl",["$scope","$rootScope","$filter","$timeout","$window","RVreportsSrv","RVReportParserFac","RVReportMsgsConst","RVReportNamesConst","ngDialog","$state","RVReportPaginationIdsConst","$log","RVReportUtilsFac","sntActivity","$q","RVReportsInboxSrv","RVreportsSubSrv",function(e,t,a,r,s,n,o,i,l,c,u,d,p,h,E,R,f,T){function S(e,a,r){if(e instanceof Date)return e;var s,n,o,i,l=t.dateFormat.toUpperCase();return"MM-DD-YYYY"===l||"MM/DD/YYYY"===l?(s=parseInt(e.substring(3,5)),n=parseInt(e.substring(0,2))):"DD-MM-YYYY"!==l&&"DD/MM/YYYY"!==l||(s=parseInt(e.substring(0,2)),n=parseInt(e.substring(3,5))),o=parseInt(e.substring(6,10)),i=new Date(o,n-1,s+a),r?void(r.maxDate=i):i}function A(){e.returnToPage=g;var a=1e3;t.isBackgroundReportsEnabled&&(a=99999),e.genReport(!1,1,a)}BaseCtrl.call(this,e);var m="report-details-scroll",O="report-filter-sidebar-scroll",D={dateFormat:t.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(e,t){$("#ui-datepicker-div"),$('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(t){$("#ui-datepicker-div"),$("#ui-datepicker-overlay").remove(),e.showRemoveDateBtn()}},y=function(){var t={tap:!0,preventDefault:!1};e.setScroller(m,t),e.setScroller(O,t)};y(),e.refreshScroll=function(t){e.refreshScroller(m),!t&&e.myScroll&&e.myScroll.hasOwnProperty(m)&&e.myScroll[m].scrollTo(0,0,100)},e.refreshSidebarScroll=function(){e.refreshScroller(O)};var v=e.$on(i.REPORT_DETAILS_FILTER_SCROLL_REFRESH,function(){e.refreshSidebarScroll()});e.$on("$destroy",v);var g=1,C=25;e.$on("NG_REPEAT_COMPLETED_RENDERING",function(){r(e.refreshScroll,1e3)}),e.parsedApiFor=void 0,e.currencySymbol=t.currencySymbol,e.printTACommissionFlag={summary:!1,agent:!1};var N=function(){var r=e.$parent.totals,s=e.$parent.headers,i=(e.$parent.subHeaders,e.$parent.results);e.$parent.resultsTotalRow,e.$parent.totalCount;switch(e.chosenReport=n.getChoosenReport(),e.setTitle(e.chosenReport.title+" "+(e.chosenReport.sub_title?e.chosenReport.sub_title:"")),e.$parent.heading=e.chosenReport.title+" "+(e.chosenReport.sub_title?e.chosenReport.sub_title:""),e.parsedApiFor=void 0,e.isGuestReport=!1,e.isLargeReport=!1,e.isLogReport=!1,e.isTransactionReport=!1,e.isDepositReport=!1,e.isCondensedPrint=!1,e.isBalanceReport=!1,e.isDepositBalanceReport=!1,e.isCancellationReport=!1,e.isActionsManager=!1,e.isArAgingReport=!1,e.isVacantRoomsReport=!1,e.isForecastGuestGroup=!1,e.hasNoSorting=!1,e.hasNoTotals=!1,e.hasPagination=!0,e.chosenReport.title){case l.IN_HOUSE_GUEST:case l.DEPARTURE:case l.ARRIVAL:e.hasNoTotals=!0,e.isGuestReport=!0;break;case l.EARLY_CHECKIN:e.isGuestReport=!0;break;case l.CANCELLATION_NO_SHOW:e.hasNoTotals=!0,e.isGuestReport=!0,e.isCancellationReport=!0,e.hasNoSorting=!0;break;case l.LOGIN_AND_OUT_ACTIVITY:e.hasNoTotals=!0,e.isGuestReport=!0,e.isLogReport=!0;break;case l.RESERVATIONS_BY_USER:e.hasNoTotals=!0,e.isGuestReport=!0;break;case l.LATE_CHECK_OUT:e.hasNoTotals=!0;break;case l.CHECK_IN_CHECK_OUT:"IN"!==e.chosenReport.chosenCico&&"OUT"!==e.chosenReport.chosenCico||(e.hasNoTotals=!0);break;case l.EMAIL_CHECKIN_SUMMARY:e.hasNoTotals=!0;break;case l.WEB_CHECK_IN_CONVERSION:case l.WEB_CHECK_OUT_CONVERSION:case l.MARKET_SEGMENT_STAT_REPORT:e.isLargeReport=!0;break;case l.BOOKING_SOURCE_MARKET_REPORT:e.hasPagination=!1;break;case l.DAILY_TRANSACTIONS:case l.DAILY_PAYMENTS:e.hasNoTotals=!0,e.isTransactionReport=!0;break;case l.DEPOSIT_REPORT:case l.RATE_ADJUSTMENTS_REPORT:e.hasNoTotals=!0,e.isDepositReport=!0;break;case l.GROUP_PICKUP_REPORT:e.hasNoTotals=!0,e.isDepositReport=!0,e.isCondensedPrint=!0;break;case l.GROUP_DEPOSIT_REPORT:e.isDepositReport=!0;break;case l.AR_SUMMARY_REPORT:e.hasNoTotals=!1,e.isBalanceReport=!0;break;case l.GUEST_BALANCE_REPORT:e.hasNoTotals=!1,e.isBalanceReport=!0;break;case l.DEPOSIT_SUMMARY:e.hasNoTotals=!0,e.isDepositBalanceReport=!0,e.isBalanceReport=!0;break;case l.FINANCIAL_TRANSACTION_REVENUE_REPORT:case l.FINANCIAL_TRANSACTION_PAYMENT_REPORT:case l.FINANCIAL_TRANSACTION_SUMMARY_REPORT:case l.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:e.hasPagination=!1;break;case l.MOBILE_CHECKIN_NOW:e.hasReportTotals=!0,e.hasNoResults=!1,e.hasNoTotals=!1;break;case l.MOBILE_CHECKIN:e.hasReportTotals=!0,e.hasNoResults=!1,e.hasNoTotals=!1;break;case l.ROOM_UPSELL:e.hasReportTotals=!0,e.hasNoResults=!1,e.hasNoTotals=!1;break;case l.ACTIONS_MANAGER:e.isActionsManager=!0;break;case l["A/R_AGING"]:e.hasNoTotals=!1,e.isBalanceReport=!0,e.isArAgingReport=!0;break;case l.FOLIO_TAX_REPORT:e.hasNoTotals=!1,e.isFolioTaxReport=!0;break;case l.FORECAST_GUEST_GROUPS:e.isForecastGuestGroup=!0}switch(e.chosenReport.title){case l.CHECK_IN_CHECK_OUT:"BOTH"===e.chosenReport.chosenCico?(e.leftColSpan=6,e.rightColSpan=5):(e.leftColSpan=4,e.rightColSpan=5);break;case l.EMAIL_CHECKIN_SUMMARY:e.leftColSpan=4,e.rightColSpan=5;break;case l.UPSELL:e.leftColSpan=6,e.rightColSpan=6;break;case l.LOGIN_AND_OUT_ACTIVITY:e.leftColSpan=2,e.rightColSpan=3;break;case l.DEPARTURE:e.leftColSpan=3,e.rightColSpan=3;break;case l.ARRIVAL:case l.IN_HOUSE_GUEST:case l.DEPOSIT_REPORT:case l.RESERVATIONS_BY_USER:e.leftColSpan=3,e.rightColSpan=3;break;case l.ZEST_CAMPAIGN_REPORT:case l.ADDON_FORECAST:e.leftColSpan=3,e.rightColSpan=4;break;case l.CANCELLATION_NO_SHOW:e.leftColSpan=3,e.rightColSpan=3;break;case l.DAILY_TRANSACTIONS:case l.DAILY_PAYMENTS:e.leftColSpan=5,e.rightColSpan=5;break;case l.WEB_CHECK_IN_CONVERSION:case l.WEB_CHECK_OUT_CONVERSION:case l.WEB_CHECK_IN_CONV_BY_DAY:e.leftColSpan=8,e.rightColSpan=8;break;case l.ROOMS_QUEUED:e.leftColSpan=3,e.rightColSpan=3;break;case l.FORECAST_BY_DATE:e.leftColSpan=8,e.rightColSpan=4;break;case l.FORECAST_GUEST_GROUPS:e.leftColSpan=9,e.rightColSpan=5;break;case l.MARKET_SEGMENT_STAT_REPORT:e.leftColSpan=8,e.rightColSpan=8;break;case l.COMPARISION_BY_DATE:e.leftColSpan=4,e.rightColSpan=4;break;case l.RATE_ADJUSTMENTS_REPORT:e.leftColSpan=3,e.rightColSpan=4;break;case l.GROUP_PICKUP_REPORT:e.leftColSpan=6,e.rightColSpan=3;break;case l.GROUP_DEPOSIT_REPORT:e.leftColSpan=3,e.rightColSpan=3;break;case l.AR_SUMMARY_REPORT:e.leftColSpan=2,e.rightColSpan=3;break;case l.GUEST_BALANCE_REPORT:e.leftColSpan=2,e.rightColSpan=3;break;case l.COMPANY_TA_TOP_PRODUCERS:e.leftColSpan=4,e.rightColSpan=6;break;case l.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:e.leftColSpan=5,e.rightColSpan=5;break;case l.CREDIT_CHECK_REPORT:e.leftColSpan=5,e.rightColSpan=2;break;case l.DEPOSIT_SUMMARY:e.leftColSpan=3,e.rightColSpan=3;break;case l.ROOM_UPSELL:case l.MOBILE_CHECKIN:case l.MOBILE_CHECKIN_NOW:e.leftColSpan=3,e.rightColSpan=4;break;case l.ROOMS_OOO_OOS:e.leftColSpan=3,e.rightColSpan=4;break;case l.COMPLIMENTARY_ROOM_REPORT:e.leftColSpan=5,e.rightColSpan=3;break;case l.TAX_EXEMPT:e.leftColSpan=5,e.rightColSpan=3;break;default:e.leftColSpan=2,e.rightColSpan=2}switch(e.chosenReport.title){case l.CHECK_IN_CHECK_OUT:"Total Check Ins"==r[0].label?10==r.length?e.$parent.summaryCounts={has_both:!0,check_ins:r[0].value,ins_via_rover:r[1].value,ins_via_web:r[2].value,ins_via_zest:r[3].value,ins_via_kiosk:r[4].value,check_outs:r[5].value,outs_via_rover:r[6].value,outs_via_web:r[7].value,outs_via_zest:r[8].value,outs_via_kiosk:r[9].value}:e.$parent.summaryCounts={has_in:!0,check_ins:r[0].value,ins_via_rover:r[1].value,ins_via_web:r[2].value,ins_via_zest:r[3].value,ins_via_kiosk:r[4].value}:"Total Check Outs"==r[0].label&&(e.$parent.summaryCounts={has_out:!0,check_outs:r[0].value,outs_via_rover:r[1].value,outs_via_web:r[2].value,outs_via_zest:r[3].value,outs_via_kiosk:r[4].value});break;case l.EMAIL_CHECKIN_SUMMARY:e.$parent.summaryCounts=r;break;case l.UPSELL:e.$parent.summaryCounts={rooms_upsold:r[0].value,upsell_revenue:r[1].value,rover_revenue:r[2].value,zest_app_revenue:r[3].value,zest_station_revenue:r[4].value,zest_web_revenue:r[5].value};break;case l.WEB_CHECK_IN_CONVERSION:e.$parent.summaryCounts={emails_sent:r[0].value,up_sell_conv:r[1].value,revenue:r[2].value,conversion:r[4].value,total_checkin:r[3].value};break;case l.WEB_CHECK_OUT_CONVERSION:e.$parent.summaryCounts={emails_sent:r[0].value,late_checkout_conv:r[1].value,revenue:r[2].value,conversion:r[4].value,total_checkout:r[3].value};break;case l.WEB_CHECK_IN_CONV_BY_DAY:e.$parent.summaryCounts={emails_sent:r[0].value,up_sell_conv:r[1].value,revenue:r[2].value,conversion:r[4].value,total_checkin:r[3].value};break;case l.LATE_CHECK_OUT:e.$parent.summaryCounts={rooms:r[0].value,revenue:r[1].value}}for(var c=0,u=i.length;c<u;c++)i[c][0]=a("date")(i[c][0],t.dateFormat),e.chosenReport.title===l.LATE_CHECK_OUT&&(i[c][i[c].length-1]=t.currencySymbol+i[c][i[c].length-1],i[c][i[c].length-2]+=":00 PM");if(e.chosenReport.title===l.LATE_CHECK_OUT)for(var c=0,u=s.length;c<u;c++)if("Late Check Out Time"===s[c]){s[c]="Selected Late Check Out Time";break}e.chosenReport.title===l.ADDON_UPSELLS&&(s.splice(_.indexOf(s,function(){return"Revenue"===value}),1),_.each(i,function(e){e.pop()}),e.$parent.resultsTotalRow.splice(_.indexOf(e.$parent.resultsTotalRow,function(){return"Revenue"===label}),1)),e.parsedApiFor=e.chosenReport.title;var d=function(){var a={include_actions:!1,include_guest_notes:!1,include_reservation_notes:!1,show_guests:!1,include_cancelled:!1,show_rate_adjustments_only:!1},r=t.isBackgroundReportsEnabled,s=e.chosenReport.usedFilters;return e.chosenReport.hasGeneralOptions&&_.each(e.chosenReport.hasGeneralOptions.data,function(e){"include_actions"===e.paramKey&&(r&&s.include_actions||e.selected)&&(a.include_actions=!0),"include_guest_notes"===e.paramKey&&(r&&s.include_guest_notes||e.selected)&&(a.include_guest_notes=!0),"include_reservation_notes"===e.paramKey&&(r&&s.include_reservation_notes||e.selected)&&(a.include_reservation_notes=!0),"show_guests"===e.paramKey&&(r&&s.show_guests||e.selected)&&(a.show_guests=!0),"include_cancelled"===e.paramKey&&(r&&s.include_cancelled||e.selected)&&(a.include_cancelled=!0),"show_rate_adjustments_only"===e.paramKey&&(r&&s.show_rate_adjustments_only||e.selected)&&(a.show_rate_adjustments_only=!0)}),a}(),p={groupedByKey:e.$parent.reportGroupedBy,checkAction:d.include_actions,checkGuestNote:d.include_guest_notes,checkReservationNote:d.include_reservation_notes,checkNote:d.include_notes,checkGuest:d.show_guests,checkCancel:d.include_cancelled,checkRateAdjust:d.show_rate_adjustments_only,chosenSortBy:e.chosenReport.chosenSortBy};switch(e.$parent.results=angular.copy(o.parseAPI(e.parsedApiFor,e.$parent.results,p,e.$parent.resultsTotalRow)),e.hasNoResults=_.isEmpty(e.$parent.results),e.showPrintOption=!0,e.parsedApiFor){case l.UPSELL:e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/upsellReport/rvUpsellReport.html";break;case l.BOOKING_SOURCE_MARKET_REPORT:e.hasReportTotals=!1,e.showReportHeader=!_.isEmpty(e.$parent.results.market)||!_.isEmpty(e.$parent.results.source),e.detailsTemplateUrl="/assets/partials/reports/bookingSourceMarketReport/rvBookingSourceMarketReport.html";break;case l.OCCUPANCY_REVENUE_SUMMARY:e.hasReportTotals=!1,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/occupancyRevenueReport/rvOccupancyRevenueReport.html";break;case l.RESERVATIONS_BY_USER:e.$parent.reportGroupedBy?(e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/reservationByUserReport/rvReservationByUserReport.html"):(e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/shared/rvCommonReportDetails.html");break;case l.DEPOSIT_SUMMARY:e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/depositBalanceSummary/rvGuestAndGroupDepositBalanceDetails.html";break;case l.FORECAST_BY_DATE:e.hasReportTotals=!1,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/forecastByDateReport/rvForecastByDateReport.html";break;case l.FORECAST_GUEST_GROUPS:e.hasReportTotals=!1,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/forecastGuestGroupReport/rvForecastGuestGroupReport.html";break;case l.MARKET_SEGMENT_STAT_REPORT:e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/marketSegmentStatReport/rvMarketSegmentStatReport.html";break;case l.COMPARISION_BY_DATE:e.hasReportTotals=!1,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/comparisonStatReport/rvComparisonStatReport.html";break;case l.ADDON_FORECAST:e.hasReportTotals=!1,e.showReportHeader=!0,"ADDON"==e.chosenReport.chosenGroupBy?e.detailsTemplateUrl="/assets/partials/reports/addonForecastReport/rvAddonForecastReportByAddon.html":e.detailsTemplateUrl="/assets/partials/reports/addonForecastReport/rvAddonForecastReportByDate.html";break;case l.ALLOWANCE_FORECAST:e.hasReportTotals=!0,e.hasNoResults=!1,e.showReportHeader=!0,"DATE"==e.chosenReport.chosenGroupBy?e.detailsTemplateUrl="/assets/partials/reports/allowanceForecastReport/rvAllowanceForecastReportByDate.html":e.detailsTemplateUrl="/assets/partials/reports/allowanceForecastReport/rvAllowanceForecastReportByAllowance.html";break;case l.DAILY_PRODUCTION_ROOM_TYPE:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/dailyProduction/rvDailyProductionRoomTypeReport.html";break;case l.DAILY_PRODUCTION_DEMO:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/dailyProduction/rvDailyProductionDemographics.html";break;case l.DAILY_PRODUCTION_RATE:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/dailyProduction/rvDailyProductionRateReport.html";break;case l.COMPANY_TA_TOP_PRODUCERS:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/compayTaTopProducers/rvCompayTaTopProducers.html";break;case l.FINANCIAL_TRANSACTION_SUMMARY_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/financialTransactionsSummaryReport/reportDetails.html";break;case l.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/financialTransactionsAdjustmentReport/reportMain.html";break;case l.FINANCIAL_TRANSACTION_REVENUE_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/financialTransactionRevenueReport/reportDetails.html";break;case l.FINANCIAL_TRANSACTION_PAYMENT_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/financialTransactionsPaymentReport/reportDetails.html";break;case l.CREDIT_CHECK_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/creditCheckReport/rvCreditCheckReport.html";break;case l.ROOMS_OOO_OOS:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/roomOooOosReport/rvRoomOooOosReport.html";break;case l.BUSINESS_ON_BOOKS:e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/businessOnBooks/rvBusinessOnBooksReport.html";break;case l.TRAVEL_AGENT_COMMISSIONS:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/travelAgentCommission/rvTravelAgentCommissionReportRow.html";break;case l.COMPLIMENTARY_ROOM_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/complimentaryRoomReport/rvComplimentaryRoomReport.html";break;case l.GROUP_ROOMS_REPORT:e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/groupRoomsReport/rvGroupRoomsReport.html";break;case l.YEARLY_TAX:e.hasReportTotals=!0,e.showReportHeader=!0,e.detailsTemplateUrl="/assets/partials/reports/yearlyVat/yearlyVatReportDetails.html";break;case l.TAX_EXEMPT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/taxExempt/taxExemptReportDetails.html";break;case l.FOLIO_TAX_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/folioTax/folioTaxReportDetails.html";break;case l.TAX_OUTPUT_REPORT:e.hasReportTotals=!0,e.showReportHeader=!0,e.showPrintOption=!0,e.detailsTemplateUrl="/assets/partials/reports/taxOutput/rvTaxOutputReport.html";break;default:e.hasReportTotals=!0,e.showReportHeader=!_.isEmpty(e.$parent.results),e.detailsTemplateUrl="/assets/partials/reports/shared/rvCommonReportDetails.html"}};e.parsedApiTemplate=function(){var t="";switch(e.parsedApiFor){case l.AR_SUMMARY_REPORT:t="/assets/partials/reports/accountsReceivablesSummary/rvAccountsReceivablesSummaryRow.html";break;case l.ARRIVAL:t="/assets/partials/reports/generalReportRows/rvArrivalReportRow.html";break;case l.CANCELLATION_NO_SHOW:t="/assets/partials/reports/generalReportRows/rvCancellationReportRow.html";break;case l.DAILY_TRANSACTIONS:case l.DAILY_PAYMENTS:t="/assets/partials/reports/generalReportRows/rvDailyTransPaymentsReportRow.html";break;case l.DEPARTURE:t="/assets/partials/reports/generalReportRows/rvDepartureReportRow.html";break;case l.DEPOSIT_REPORT:t="/assets/partials/reports/generalReportRows/rvDepositReportRow.html";break;case l.GROUP_DEPOSIT_REPORT:t="/assets/partials/reports/generalReportRows/rvGroupDepositReportRow.html";break;case l.IN_HOUSE_GUEST:t="/assets/partials/reports/generalReportRows/rvInHouseReportRow.html";break;case l.RATE_ADJUSTMENTS_REPORT:t="/assets/partials/reports/generalReportRows/rvRateAdjustmentReportRow.html";break;case l.ROOMS_QUEUED:t="/assets/partials/reports/generalReportRows/rvRoomQueuedReportRow.html";break;case l.LOGIN_AND_OUT_ACTIVITY:t="/assets/partials/reports/generalReportRows/rvLoginActivityReportRow.html";break;case l.GROUP_PICKUP_REPORT:t="/assets/partials/reports/generalReportRows/rvGroupPickupReportRow.html";break;case l.GUEST_BALANCE_REPORT:t="/assets/partials/reports/guestBalanceReport/rvGuestBalanceReportRow.html";break;case l.RESERVATIONS_BY_USER:t="/assets/partials/reports/reservationByUserReport/rvReservationByUserReportRow.html";break;case l.FORECAST_BY_DATE:t="/assets/partials/reports/forecastByDateReport/rvForecastByDateReportRow.html";break;case l.FORECAST_GUEST_GROUPS:t="/assets/partials/reports/forecastGuestGroupReport/rvForecastGuestGroupReportRow.html";break;case l.MARKET_SEGMENT_STAT_REPORT:t="/assets/partials/reports/marketSegmentStatReport/rvMarketSegmentStatReportRow.html";break;case l.COMPANY_TA_TOP_PRODUCERS:t="/assets/partials/reports/compayTaTopProducers/rvCompayTaTopProducersRow.html";break;case l.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:t="/assets/partials/reports/financialTransactionsAdjustmentReport/reportRow.html";break;case l.ACTIONS_MANAGER:t="/assets/partials/reports/actionManager/reportRow.html";break;case l["A/R_AGING"]:t="/assets/partials/reports/aging/reportRow.html";break;case l.VACANT_ROOMS_REPORT:t="/assets/partials/reports/vacantRoomsReport/rvVacantRoomsReportRow.html";break;case l.COMPLIMENTARY_ROOM_REPORT:t="/assets/partials/reports/complimentaryRoomReport/rvComplimentaryRoomReport.html";break;case l.TAX_EXEMPT:t="/assets/partials/reports/taxExempt/rvComplimentaryRoomReport.html";break;case l.GUESTS_INHOUSE_BY_NATIONALITY:t="/assets/partials/reports/guestInhouseByNationalityReport/reportRow.html";break;default:t="/assets/partials/reports/shared/rvCommonReportRow.html"}return t},e.isThisReport=function(t){return"string"==typeof t?e.parsedApiFor==l[t]:!!_.find(t,function(t){return e.parsedApiFor==l[t]})};var P=function(){e.hasPagination&&(e.netTotalCount=e.$parent.totalCount,angular.isArray(e.$parent.results)?e.uiTotalCount=e.$parent.results.length:angular.isObject(e.$parent.results)&&(e.uiTotalCount=0,_.each(e.$parent.results,function(t){"array"==typeof t&&(e.uiTotalCount+=t.length)})),0===e.netTotalCount&&0===e.uiTotalCount?(e.disablePrevBtn=!0,e.disableNextBtn=!0):1===g?(e.resultFrom=1,e.resultUpto=e.netTotalCount<C?e.netTotalCount:C,e.disablePrevBtn=!0,e.disableNextBtn=!(e.netTotalCount>C)):(e.resultFrom=C*(g-1)+1,e.resultUpto=e.resultFrom+C-1<e.netTotalCount?e.resultFrom+C-1:e.netTotalCount,e.disablePrevBtn=!1,e.disableNextBtn=e.resultUpto===e.netTotalCount))},L=function(){if("BOTH"===e.chosenReport.chosenCico?e.transcationTypes="check In, Check Out":"IN"===e.chosenReport.chosenCico?e.transcationTypes="check In":"OUT"===e.chosenReport.chosenCico&&(e.transcationTypes="check OUT"),e.chosenReport.chosenUsers){var t=[];_.each(e.activeUserList,function(a){var r=_.find(e.chosenReport.chosenUsers,function(e){return e===a.id});r&&t.push(a.full_name)}),e.userNames=t.join(", ")}};e.fetchNextPage=function(t){if(t)g=t,e.genReport(!1,g);else{if(e.disableNextBtn)return;g++,e.genReport(!1,g)}},e.fetchPrevPage=function(){e.disablePrevBtn||(g--,e.genReport(!1,g))},e.sortResultBy=function(t,a){if(t){e.chosenReport.chosenGroupBy&&(e.chosenReport.chosenGroupBy="BLANK"),_.each(e.chosenReport.sortByOptions,function(e){e&&e.value!==t.value&&(e.sortDir=void 0)}),a.title===l.COMPANY_TA_TOP_PRODUCERS&&"ROOM_NIGHTS"===t.value?t.sortDir=void 0!==t.sortDir&&t.sortDir!==!0:t.sortDir=void 0===t.sortDir||t.sortDir===!1,e.chosenReport.chosenSortBy=t.value,g=1;var r=1;e.chosenReport.title===l.COMPLIMENTARY_ROOM_REPORT&&(r=e.currentPage),e.genReport(!1,r)}},e.fetchUpdatedReport=function(){e.$parent.showSidebar=!1,g=1,e.genReport(!1)},e.fetchFullReport=function(){var a=n.getSelectedReport();"function"==typeof e.printOptions.showModal?e.printOptions.showModal():t.isBackgroundReportsEnabled?e.printReport(a,!1):A()};var I=t.$on(i.REPORT_PRE_PRINT_DONE,A);e.$on("$destroy",I);var U=function(){var t="portrait";switch(e.chosenReport.title){case l.AR_SUMMARY_REPORT:case l.ARRIVAL:case l.IN_HOUSE_GUEST:case l.DEPARTURE:case l.DEPOSIT_REPORT:case l.GROUP_DEPOSIT_REPORT:case l.CANCELLATION_NO_SHOW:case l.WEB_CHECK_OUT_CONVERSION:case l.WEB_CHECK_IN_CONVERSION:case l.WEB_CHECK_IN_CONV_BY_DAY:case l.OCCUPANCY_REVENUE_SUMMARY:case l.DAILY_TRANSACTIONS:case l.DAILY_PAYMENTS:case l.FORECAST_BY_DATE:case l.FORECAST_GUEST_GROUPS:case l.GROUP_PICKUP_REPORT:case l.MARKET_SEGMENT_STAT_REPORT:case l.RATE_ADJUSTMENTS_REPORT:case l.DAILY_PRODUCTION_ROOM_TYPE:case l.GUEST_BALANCE_REPORT:case l.ADDON_FORECAST:case l.ALLOWANCE_FORECAST:case l.CREDIT_CHECK_REPORT:case l.DEPOSIT_SUMMARY:case l.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT:case l["A/R_AGING"]:case l.BUSINESS_ON_BOOKS:case l.COMPLIMENTARY_ROOM_REPORT:case l.GROUP_ROOMS_REPORT:case l.TRAVEL_AGENT_COMMISSIONS:case l.DAILY_PRODUCTION_RATE:case l.DAILY_PRODUCTION_DEMO:case l.FOLIO_TAX_REPORT:t="landscape"}return t},M=function(){var e=U();$("head").append("<style id='print-orientation'>@page { size: "+e+"; }</style>"),$("#loading").addClass("ng-hide")},b=function(){$("#print-orientation").remove()},F=function(){var t=e.chosenReport.title,o=!1;M(),e.chosenReport.title===l.TRAVEL_AGENT_COMMISSIONS&&(e.printTACommissionFlag.summary=!0);var i=$("#print-orientation").css("background-image"),c=i.replace(/(^url\()|(\)$|[\"\'])/g,""),d=$("<img>").attr("src",c);d.on("load",function(){$(this).off("load"),$(this).remove();var i=function(){E.start("POST_PRINT_STATE_RESTORE"),r(function(){b(),e.chosenReport.title===l.TRAVEL_AGENT_COMMISSIONS&&(e.printTACommissionFlag.summary=!1),e.chosenReport.title===l.YEARLY_TAX&&e.$broadcast("YEARLY_TAX_PRINT_COMPLETED"),"function"==typeof e.printOptions.afterPrint&&e.printOptions.afterPrint(),E.stop("POST_PRINT_STATE_RESTORE"),n.getPrintClickedState()?(e.$emit("UPDATE_REPORT_HEADING",{heading:a("translate")("MENU_REPORTS_INBOX")}),n.setPrintClicked(!1),e.viewStatus.showDetails=!1,"rover.reports.show"!==u.$current.name&&n.getChoosenReport()&&n.setChoosenReport({}),E.stop("PRINTING_FROM_REPORT_INBOX")):e.fetchNextPage(e.returnToPage)},2e3),t!==l.DAILY_PRODUCTION_ROOM_TYPE&&t!==l.DAILY_PRODUCTION_DEMO&&t!==l.DAILY_PRODUCTION_RATE||(o=!0),e.reportDatesInitialized&&o&&e.showGeneratedReport()};r(function(){if(sntapp.cordovaLoaded){var e="landscape"===U()?"L":"P";cordova.exec(i,function(){i()},"RVCardPlugin","printWebView",["","0","",e])}else s.print(),i()},1e3)})};e.emailReport=function(){p.warn("Email Report API yet to be completed/implemented/integrated")},e.saveFullReport=function(){p.warn("Download Full Report API yet to be completed/implemented/integrated")},e.hasSubString=function(e,t){var t=t.toLowerCase(),e=e.toLowerCase();return t.indexOf(e)>-1},e.hasSort=function(t){var a=e.chosenReport.sortByOptions||[];return!!a[t]},e.isAsc=function(t){var a=e.chosenReport.sortByOptions||[];return!!a[t]&&a[t].sortDir===!0},e.isDesc=function(t){var a=e.chosenReport.sortByOptions||[];return!!a[t]&&a[t].sortDir===!1},e.getReservationClass=function(e){var t="";switch(e.toUpperCase()){case"RESERVED":t="arrival";break;case"DUE IN":t="check-in";break;case"CHECKEDIN":t="inhouse";break;case"DUE OUT":t="check-out";break;case"CHECKEDOUT":t="departed";break;case"CANCELED":t="cancel";break;case"NOSHOW":case"NOSHOW_CURRENT":t="no-show";break;case"IN HOUSE":t="inhouse";break;default:t=""}return t},e.gotoStayCard=function(e){u.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:e.reservation_id,confirmationId:e.confirm_no,isrefresh:!0})},e.gotoAccount=function(e){u.go("rover.accounts.config",{id:e.posting_account_id,activeTab:"ACCOUNT"})},e.gotoNavigation=function(t){if("Reservation"===t.entity_type){var a={reservation_id:t.entity_id,confirm_no:t.number};e.gotoStayCard(a)}else if("PostingAccount"===t.entity_type){var r={posting_account_id:t.entity_id};e.gotoAccount(r)}};var w=function(){g=1,e.errorMessage=[],y(),N(),L(),P(),e.refreshScroll()},G=function(){e.errorMessage=[],N(),P(),e.refreshScroll()},Y=e.$on(i.REPORT_SUBMITED,w),k=e.$on(i.REPORT_PAGE_CHANGED,G),V=e.$on(i.REPORT_UPDATED,function(){e.errorMessage=[],y(),N(),L(),P(),e.refreshScroll()}),H=e.$on(i.REPORT_PRINTING,function(){e.errorMessage=[],N(),L(),F()}),x=e.$on(i.REPORT_API_FAILED,function(){e.errorMessage=e.$parent.errorMessage,N(),P(),e.refreshScroll()}),B=e.$on("PRINT_SELECTED_REPORT",function(){F()});e.$on("$destroy",Y),e.$on("$destroy",V),e.$on("$destroy",k),e.$on("$destroy",H),e.$on("$destroy",x),e.$on("$destroy",B),e.isRoomRevenueSelected=!0,e.isBookingsSelected=!0,e.toggleRevenue=function(){e.isRoomRevenueSelected=!e.isRoomRevenueSelected,n.setReportRequestParam("showRoomRevenue",e.isRoomRevenueSelected),e.genReport(!1)},e.toggleBookings=function(){e.isBookingsSelected=!e.isBookingsSelected},e.showTotals=function(){return _.isArray(e.resultsTotalRow)?e.resultsTotalRow.length:e.resultsTotalRow},e.shouldShowNewPagination=function(){return!!d[e.chosenReport.title]},e.fetchFullYearlyTaxReport=function(){e.$broadcast("FETCH_FULL_YEARLY_TAX_REPORT")},e.getReservationStatus=function(e){return getReservationStatusClass(e)};var W=t.$on("PRINT_INBOX_REPORT",function(){var t=n.getSelectedReport();e.reportDatesInitialized=!1,e.printReport(t,!0)});e.$on("$destroy",W);var K=function(){r(function(){E.stop("PRINTING_FROM_REPORT_INBOX"),"function"==typeof e.printOptions.showModal?e.printOptions.showModal():F()},2e3)},j=function(a){e.errorMessage=[],N(),e.$emit("UPDATE_REPORT_HEADING",{heading:e.heading}),L(),a&&t.$broadcast("RELOAD_RESULTS"),K()},J=e.$on("PRINT_REPORT",function(e){j(e.targetScope.reloadreportNeeded)}),X=e.$on("PRINT_MODAL_REPORT",function(){F()});e.printReport=function(r,s){var o,i=r.name;n.setSelectedReport(r),e.currentReport=r,i===l.DAILY_PRODUCTION_RATE?e.maxDateRange=2:e.maxDateRange=1,i===l.DAILY_PRODUCTION_ROOM_TYPE||i===l.DAILY_PRODUCTION_DEMO||i===l.DAILY_PRODUCTION_RATE?(e.fromDateOptions=angular.extend({},D),e.untilDateOptions=angular.extend({},D),e.fromDateOptions.minDate=e.currentReport.fromDate,e.fromDateOptions.maxDate=e.currentReport.toDate,o=a("date")(e.currentReport.fromDate,t.dateFormat),e.currentReport.filterToDate=S(e.fromDateOptions.maxDate,0),e.currentReport.filterFromDate=S(o,0),e.untilDateOptions.minDate=e.currentReport.fromDate,e.untilDateOptions.maxDate=e.currentReport.toDate,c.open({template:"/assets/partials/reports/rvPrintReportSelectDatePopup.html",
className:"ngdialog-theme-default",scope:e})):(q(e.currentReport).then(function(){A()}),s&&n.setPrintClicked(!0))},e.continuePrint=function(){var t=e.$parent,a=moment(e.currentReport.filterFromDate,"D/M/YYYY"),r=moment(e.currentReport.filterToDate,"D/M/YYYY"),s=r.diff(a,"days")+1;e.errorMsg="",s>e.maxDateRange?e.errorMsg="Allowed limit exceeded":(c.close(),q(e.currentReport).then(function(){t.genReport(!1,1,99999,!0)}),n.setPrintClicked(!0))},e.adjustStartDate=function(){e.currentReport.filterFromDate>e.currentReport.filterToDate&&(e.currentReport.filterFromDate=e.currentReport.filterToDate),e.errorMsg="",e.errorMessage=[]},e.adjustUntilDate=function(){e.currentReport.filterFromDate>e.currentReport.filterToDate&&(e.currentReport.filterFromDate=e.currentReport.filterToDate),e.errorMessage=[],e.errorMsg=""},e.deleteModal=function(){e.errorMsg="",c.close()},self.getFormatedGeneratedReports=function(e,t){return f.formatReportList(e,t)},e.shouldDisableInboxItem=function(e){return e.message||"IN_PROGRESS"===e.status.value||"REQUESTED"===e.status.value},e.showGeneratedReport=function(){var t=e.$parent,a=n.getSelectedReport();delete a.filterFromDate,delete a.filterToDate,delete a.filters.from_date,delete a.filters.to_date,r(function(){q(a).then(function(){t.genReport(null,null,null,!1)})},1e3)};var q=function(t){var r=n.getChoosenReport()?n.getChoosenReport().id:null,s=e.$parent,o=_.find(e.reportList,function(e){return t.report_id===e.id}),i=R.defer(),c=t.name;return o.usedFilters=t.filters,c!==l.DAILY_PRODUCTION_ROOM_TYPE&&c!==l.DAILY_PRODUCTION_DEMO&&c!==l.DAILY_PRODUCTION_RATE||(o.usedFilters.to_date=a("date")(t.filterToDate,"yyyy-MM-dd"),o.usedFilters.from_date=a("date")(t.filterFromDate,"yyyy-MM-dd")),o.generatedReportId=t.id,r!==t.id&&s.printOptions.resetSelf(),n.processSelectedReport(o,n.getCofigurationData()),h.findFillFilters(o,e.$parent.reportList).then(function(){o=_.extend(JSON.parse(JSON.stringify(o)),t.rawData),o.appliedFilter=t.appliedFilter,n.setChoosenReport(o),i.resolve()}),i.promise};e.$on("$destroy",J),e.$on("$destroy",X),function(){var r=u.params.date?u.params.date:t.serverDate;if(e.reportDatesInitialized=!0,e.reportInboxData={selectedReportAppliedFilters:{},generatedReports:[],filter:{selectedDate:a("date")(r,"yyyy-MM-dd"),searchTerm:""},isReportInboxOpen:!1},!n.getPrintClickedState()){var s=a("translate")("REPORTS");n.getChoosenReport().generatedReportId&&(s=a("translate")("MENU_REPORTS_INBOX")),t.setPrevState={title:s,callback:"goBackReportList",name:"rover.reports.dashboard",scope:e}}switch(u.params.action){case i.REPORT_SUBMITED:w();break;case i.REPORT_PAGE_CHANGED:G();break;case i.REPORT_LOAD_LAST_REPORT:}}()}]),sntRover.controller("RVReportListCrl",["$scope","$rootScope","$filter","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportMsgsConst","$timeout","RVReportApplyIconClass","RVReportApplyFlags","RVReportSetupDates","RVReportNamesConst","$state",function(e,t,a,r,s,n,o,i,l,c,u,d,p){BaseCtrl.call(this,e);var h="report-list-scroll",E="report-filters-scroll",R=e.$on(o.REPORT_API_FAILED,function(){e.errorMessage=e.$parent.errorMessage});e.refreshFilterScroll=function(t){e.refreshScroller(E),t&&e.myScroll.hasOwnProperty(E)&&e.myScroll[E].scrollTo(0,0,100)},e.refreshAllScroll=function(){e.refreshScroller(h),e.myScroll.hasOwnProperty(h)&&e.myScroll[h].scrollTo(0,0,100),e.refreshFilterScroll()};var f=function(){var t={tap:!0,preventDefault:!1};e.setScroller(h,t),e.setScroller(E,t),i(function(){e.getScroller(h).scrollToElement(".report-item.active",500,0,0)},300)},T=function(a){for(var r=0,s=a.length;r<s;r++)if(a[r].filteredOut=!1,(!t.isFolioTaxEnabled&&"folio_tax_report"===a[r].method||"room_status"===a[r].method)&&(a[r].filteredOut=!0),l.init(a[r]),c.init(a[r]),n.addIncludeUserFilter(a[r]),n.addIncludeOtherFilter(a[r]),u.init(a[r]),_.each(a[r].filters,function(e){u.execFilter(a[r],e)}),n.processFilters(a[r],{guaranteeTypes:e.$parent.guaranteeTypes,markets:e.$parent.markets,sources:e.$parent.sources,origins:e.$parent.origins,codeSettings:e.$parent.codeSettings,holdStatus:e.$parent.holdStatus,chargeNAddonGroups:e.$parent.chargeNAddonGroups,chargeCodes:e.$parent.chargeCodes,addons:e.$parent.addons,reservationStatus:e.$parent.reservationStatus,assigned_departments:e.$parent.assigned_departments,activeUserList:e.$parent.activeUserList,travel_agent_ids:e.$parent.travel_agents}),n.reOrderSortBy(a[r]),n.processSortBy(a[r]),n.processGroupBy(a[r]),"Yotel London Heathrow"===t.currentHotelData){var o=_.find(a[r].sortByOptions,function(e){return"DATE"===e.value});o&&(a[r].chosenSortBy=o.value)}i(function(){e.$parent.uiChosenReport||e.refreshAllScroll()},2010)},S=function(r){var s=n.processDate();e.fromDateOptions.maxDate=a("date")(t.businessDate,t.dateFormat),e.untilDateOptions.maxDate=a("date")(t.businessDate,t.dateFormat),e.fromDateOptionsTillYesterday=function(){var e=new tzIndependentDate(t.businessDate);return e.setDate(e.getDate()-1),a("date")(e,t.dateFormat)}(),e.untilDateOptionsTillYesterday.maxDate=function(){var e=new tzIndependentDate(t.businessDate);return e.setDate(e.getDate()-1),a("date")(e,t.dateFormat)}(),e.fromDateOptionsForecast.minDate=function(){var e=new tzIndependentDate(t.businessDate);return e.setDate(e.getDate()+1),a("date")(e,t.dateFormat)}(),e.fromDateOptionsTillBD.maxDate=new tzIndependentDate(t.businessDate),e.untilDateOptionsTillBD.maxDate=new tzIndependentDate(t.businessDate),e.fromDateOptionsSysLimit.maxDate=new Date,e.untilDateOptionsSysLimit.maxDate=new Date,e.toDateOptionsOneYearLimit.minDate=s.monthStart,e.toDateOptionsOneYearLimit.maxDate=n.processDate(s.monthStart).aYearAfter,e.toDateOptionsOneMonthLimit.minDate=new tzIndependentDate(t.businessDate),e.toDateOptionsOneMonthLimit.maxDate=n.processDate(t.businessDate).aMonthAfter,e.toDateOptionsSixMonthsLimit.minDate=new tzIndependentDate(t.businessDate),e.toDateOptionsSixMonthsLimit.maxDate=n.processDate(t.businessDate).sixMonthsAfter,e.toDateOptionsThirtyOneDaysLimit.minDate=new tzIndependentDate(t.businessDate),e.toDateOptionsThirtyOneDaysLimit.maxDate=n.processDate(t.businessDate).thirtyOneDaysAfter,u.init(r)};e.toggleFilter=function(t,a){t&&(t.preventDefault(),t.stopPropagation());var r=function(){_.map(e.$parent.reportList,function(e){e.uiChosen=!1}),a.uiChosen=!0,e.$parent.uiChosenReport=a,e.selectedReport.report=a,S(a),e.updateViewCol(e.viewColsActions.TWO),i(function(){e.refreshFilterScroll("scrollUp"),e.$emit("hideLoader")},1e3)};e.$emit("showLoader"),a.allFiltersProcessed?r():n.findFillFilters(a,e.$parent.reportList).then(r)},e.setnGenReport=function(t){var a=r.getChoosenReport().id,s=e.$parent;a!=t.id&&s.printOptions.resetSelf(),t.generatedReportId&&(t.generatedReportId=null),r.setChoosenReport(t),s.genReport()};var A=e.$on(o.REPORT_LIST_SCROLL_REFRESH,function(){i(e.refreshScroller.bind(e,h),200)});e.$on("$destroy",A),e.$on("$destroy",R),function(){p.params.refresh&&(e.$parent.refreshReportList(),T(e.$parent.reportList));var t=_.find(e.$parent.reportList,{uiChosen:!0});t&&e.toggleFilter(null,t),f()}()}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("sntRover").controller("RVReportsMainCtrl",["$rootScope","$scope","payload","RVreportsSrv","RVreportsSubSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout","rvUtilSrv","rvPermissionSrv","RVReportPaginationIdsConst","$state","$log","ngDialog","sntActivity",function(e,t,a,r,s,n,o,i,l,c,u,d,p,h,E,R,f,T){function S(a,s,i,u){var d={page:s,per_page:i,fiterFromDate:a.usedFilters&&a.usedFilters.from_date?a.usedFilters.from_date:null,filterToDate:a.usedFilters&&a.usedFilters.to_date?a.usedFilters.to_date:null};if(a.generatedReportId)return d.id=a.generatedReportId,d;d.id=a.id;var p={},h="",E="",R="",f="",T="",S=[],A=r.getChoosenReport();if(u="boolean"!=typeof u||u,i=A.title===l.TRAVEL_AGENT_COMMISSIONS?o.TRAVEL_AGENTS_PER_PAGE_COUNT:i,u&&(t.appliedFilter={options:[],display:[],show:[],markets:[],sources:[],origins:[],origin_urls:[],guarantees:[],chargeGroups:[],chargeCodes:[],holdStatuses:[],addonGroups:[],addons:[],reservationStatus:[],guestOrAccount:[],chargeTypes:[],users:[],campaign_types:[],floorList:[],rates:[],assigned_departments:[],completion_status:[],age_buckets:[],account_ids:[],travel_agent_ids:[],segments:[],market_ids:[],tax_exempt_type_ids:[],group_code:[],country_ids:[],include_long_stays:[],transaction_category:[],payment_types:[],collapsed_or_expanded:[]}),a.hasDateFilter&&(a.fromDate&&(E=o.FROM_DATE,d[E]=c("date")(a.fromDate,"yyyy/MM/dd"),u&&(t.appliedFilter.fromDate=angular.copy(a.fromDate)),p.fromDate=d[E]),a.untilDate&&(E=o.TO_DATE,d[E]=c("date")(a.untilDate,"yyyy/MM/dd"),u&&(t.appliedFilter.toDate=angular.copy(a.untilDate)),p.untilDate=d[E])),a.hasCancelDateFilter&&(E=o.CANCEL_FROM_DATE,R=o.CANCEL_TO_DATE,d[E]=c("date")(a.fromCancelDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilCancelDate,"yyyy/MM/dd"),u&&(t.appliedFilter.cancelFromDate=angular.copy(a.fromCancelDate),t.appliedFilter.cancelToDate=angular.copy(a.untilCancelDate)),p.fromCancelDate=d[E],p.untilCancelDate=d[R]),a.hasArrivalDateFilter&&a.fromArrivalDate&&a.untilArrivalDate&&(E=o.ARRIVAL_FROM_DATE,R=o.ARRIVAL_TO_DATE,d[E]=c("date")(a.fromArrivalDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilArrivalDate,"yyyy/MM/dd"),u&&(t.appliedFilter.arrivalFromDate=angular.copy(a.fromArrivalDate),t.appliedFilter.arrivalToDate=angular.copy(a.untilArrivalDate)),p.fromArrivalDate=d[E],p.untilArrivalDate=d[R]),a.hasGroupStartDateRange&&a.groupStartDate&&a.groupEndDate&&(E=o.GROUP_START_DATE,R=o.GROUP_END_DATE,d[E]=c("date")(a.groupStartDate,"yyyy/MM/dd"),d[R]=c("date")(a.groupEndDate,"yyyy/MM/dd"),u&&(t.appliedFilter.groupFromDate=angular.copy(a.groupStartDate),t.appliedFilter.groupToDate=angular.copy(a.groupEndDate)),p.groupStartDate=d[E],p.groupEndDate=d[R]),a.hasDepositDateFilter&&(E=o.DEPOSIT_FROM_DATE,R=o.DEPOSIT_TO_DATE,d[E]=c("date")(a.fromDepositDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilDepositDate,"yyyy/MM/dd"),u&&(t.appliedFilter.depositFromDate=angular.copy(a.fromDepositDate),t.appliedFilter.depositToDate=angular.copy(a.untilDepositDate)),p.fromDepositDate=d[E],p.untilDepositDate=d[R]),a.hasPaidDateRange&&(E=o.PAID_FROM_DATE,R=o.PAID_TO_DATE,d[E]=c("date")(a.fromPaidDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilPaidDate,"yyyy/MM/dd"),u&&(t.appliedFilter.paidFromDate=angular.copy(a.fromPaidDate),t.appliedFilter.paidToDate=angular.copy(a.untilPaidDate)),p.fromPaidDate=d[E],p.untilPaidDate=d[R]),a.hasCreateDateFilter&&(E=o.CREATE_FROM_DATE,R=o.CREATE_TO_DATE,d[E]=c("date")(a.fromCreateDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilCreateDate,"yyyy/MM/dd"),u&&(t.appliedFilter.createFromDate=angular.copy(a.fromCreateDate),t.appliedFilter.createToDate=angular.copy(a.untilCreateDate)),p.fromCreateDate=d[E],p.untilCreateDate=d[R]),a.hasOwnProperty("hasCollapsedOrExpanded")){var m=a.hasCollapsedOrExpanded.selected;d.summary_type=m.value,u&&(t.appliedFilter.collapsed_or_expanded=m.value)}if(a.hasSingleDateFilter&&(h=o.SINGLE_DATE,d[h]=c("date")(a.singleValueDate,"yyyy/MM/dd"),u&&(t.appliedFilter.singleValueDate=angular.copy(a.singleValueDate)),p.singleValueDate=d[h]),a.hasRateFilter&&(h=o.RATE_IDS,d[h]=_.pluck(_.where(U(a),{selected:!0}),"id"),l.DAILY_PRODUCTION_RATE===a.title)){var O=_.pluck(_.where(U(a),{selected:!0,id:null}),"group_id");O.length>0&&(d[h]=_.without(d[h],null),d.custom_rate_group_ids=O)}if(a.hasRestrictionListFilter&&(d[o.RESTRICTION_IDS]=_.pluck(_.where(a.hasRestrictionListFilter.data,{selected:!0}),"id")),a.hasDayUseFilter){var D=a[o.INCLUDE_DAYUSE];t.appliedFilter[o.INCLUDE_DAYUSE]=D,d[o.INCLUDE_DAYUSE]=D}if(a.hasRateCodeFilter)if(a.hasRateCodeFilter.options.singleSelect){var y=_.findWhere(a.hasRateCodeFilter.data,{selected:!0});y&&(d[o.RATE_ID]=y.id)}else{h=o.RATE_IDS;var v=M(a);v.length>0&&(d[h]=[],_.each(v,function(e){d[h].push(e.id),u&&t.appliedFilter.rates.push(e.description)}),u&&a.hasRateCodeFilter.data.length===d[o.RATE_IDS].length&&(t.appliedFilter.rates=["All Rates"]))}if(a.hasRoomTypeFilter&&(d[o.ROOM_TYPE_IDS]=_.pluck(_.where(a.hasRoomTypeFilter.data,{selected:!0}),"id")),a.hasRateTypeFilter&&(h=o.RATE_TYPE_IDS,d[h]=I(a)),a.hasAdjustmentDateRange&&(E=o.ADJUSTMENT_FROM_DATE,R=o.ADJUSTMENT_TO_DATE,d[E]=c("date")(a.fromAdjustmentDate,"yyyy/MM/dd"),d[R]=c("date")(a.untilAdjustmentDate,"yyyy/MM/dd"),u&&(t.appliedFilter.adjustmentFromDate=angular.copy(a.fromAdjustmentDate),t.appliedFilter.adjustmentToDate=angular.copy(a.untilAdjustmentDate)),p.fromAdjustmentDate=d[E],p.untilAdjustmentDate=d[R]),a.hasTimeFilter&&(a.fromTime&&(h=o.FROM_TIME,d[h]=a.fromTime,u&&(t.appliedFilter.fromTime=angular.copy(a.fromTime))),a.untilTime&&(h=o.TO_TIME,d[h]=a.untilTime,u&&(t.appliedFilter.toTime=angular.copy(a.untilTime)))),a.hasLanguages&&(h=o.SELECTED_LANGUAGE,d[h]=a.locale,u&&(t.appliedFilter.selected_language=a.language)),a.hasVatYear&&(h=o.VAT_YEAR,d[h]=a.year,u&&(t.appliedFilter.year=a.year)),a.hasCompanyTravelAgentWithOrWithoutVat&&(h=o.WITH_VAT_NUMBER,d[h]=a.with_vat_number,h=o.WITHOUT_VAT_NUMBER,d[h]=a.without_vat_number,u&&(t.appliedFilter.with_vat_number=a.with_vat_number,t.appliedFilter.without_vat_number=a.without_vat_number)),a.hasShowIncludeLongStays&&(h=o.INCLUDE_LONG_STAYS,d[h]=a.include_long_stays,u&&(t.appliedFilter.include_long_stays=a.include_long_stays)),a.hasShowVatWithRates&&(h=o.SHOW_VAT_WITH_RATES,d[h]=a.show_vat_with_rates,u&&(t.appliedFilter.show_vat_with_rates=a.show_vat_with_rates)),a.hasCicoFilter&&(f=o.CHECKED_IN,T=o.CHECKED_OUT,d[f]=C("checked_in"),d[T]=C("checked_out"),u&&(d[f]&&d[T]?t.appliedFilter.cicoTypes="Check Ins & Check Outs":d[f]?t.appliedFilter.cicoTypes="Only Check Ins":d[T]&&(t.appliedFilter.cicoTypes="Only Check Outs"))),a.hasUserFilter&&a.empList.data.length&&(S=_.where(a.empList.data,{selected:!0}),S.length>0&&(h=o.USER_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.users.push(e.full_name||e.email)}),u&&a.empList.data.length===S.length&&(t.appliedFilter.users=["All Users"],delete d[h]))),a.sortByOptions){p.sortOptions=a.sortByOptions,a.chosenSortBy&&(h=o.SORT_FIELD,d[h]=a.chosenSortBy);var g=_.find(a.sortByOptions,function(e){return e&&e.value===a.chosenSortBy});g&&"boolean"==typeof g.sortDir&&(h=o.SORT_DIR,d[h]=g.sortDir),u&&(g&&(t.appliedFilter.sortBy=g.description),g&&"boolean"==typeof g.sortDir&&(t.appliedFilter.sortDir=g.sortDir?"Ascending":"Descending"))}if(a.groupByOptions&&(h="","DATE"===a.chosenGroupBy?h=o.GROUP_BY_DATE:"USER"===a.chosenGroupBy?h=o.GROUP_BY_USER:"GROUP_NAME"===a.chosenGroupBy?h=o.GROUP_BY_GROUP_NAME:"CHARGE_TYPE"===a.chosenGroupBy&&(h=o.GROUP_BY_CHARGE_TYPE),h&&(d[h]=!0,u&&(t.appliedFilter.groupBy=h.replace("group_by_","").replace("_"," "))),a.title!==l.ADDON_FORECAST||"ADDON"!==a.chosenGroupBy&&"DATE"!==a.chosenGroupBy||(h=o.ADDON_GROUP_BY,d[h]=a.chosenGroupBy,p.chosenGroupBy=a.chosenGroupBy,u&&(t.appliedFilter.groupBy="GROUP BY "+a.chosenGroupBy)),a.title!==l.ALLOWANCE_FORECAST||"ALLOWANCE_CODE"!==a.chosenGroupBy&&"DATE"!==a.chosenGroupBy||(h=o.ADDON_GROUP_BY,d[h]=a.chosenGroupBy,p.chosenGroupBy=a.chosenGroupBy,u&&(t.appliedFilter.groupBy="GROUP BY "+a.chosenGroupBy))),a.hasGeneralOptions.data.length&&_.each(a.hasGeneralOptions.data,function(e){e.selected?(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.options.push(e.description)):!e.selected&&e.mustSend&&(h=e.paramKey,d[h]=!1)}),a.hasDisplay.data.length&&_.each(a.hasDisplay.data,function(e){e.selected&&(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.display.push(e.description))}),a.hasShow.data.length&&_.each(a.hasShow.data,function(e){e.selected&&(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.show.push(e.description))}),a.hasChargeTypes.data.length&&(_.each(a.hasChargeTypes.data,function(e){e.selected&&(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.chargeTypes.push(e.description))}),u&&a.hasChargeTypes.selectAll&&(t.appliedFilter.chargeTypes=["Both"])),a.hasExclusions.data.length&&_.each(a.hasExclusions.data,function(e){e.selected&&(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.display.push(e.description))}),a.hasGuestOrAccountFilter.data.length&&_.each(a.hasGuestOrAccountFilter.data,function(e){e.selected&&(h=e.paramKey,d[h]=!0,u&&t.appliedFilter.guestOrAccount.push(e.description))}),a.hasOwnProperty("hasIncludeCompanyTa")&&a.chosenIncludeCompanyTa&&(h=a.hasIncludeCompanyTa.value.toLowerCase(),d[h]=[],_.each(a.chosenIncludeCompanyTa.split(", "),function(e){d[h].push(e)}),u&&(t.appliedFilter.companyTa=a.uiChosenIncludeCompanyTa)),a.hasOwnProperty("hasIncludeCompanyTaGroup")&&a.chosenIncludeCompanyTaGroup&&(h=a.hasIncludeCompanyTaGroup.value.toLowerCase(),d[h]=a.chosenIncludeCompanyTaGroup,d[o.ENTITY_TYPE]=a.chosenIncludeCompanyTaGroupType,u&&(t.appliedFilter.companyTaGroup=a.uiChosenIncludeCompanyTaGroup)),a.hasOwnProperty("hasGroupCode")&&a.uiChosenIncludeGroupCode&&(h=a.hasGroupCode.value.toLowerCase(),d[h]=[],_.each(a.chosenIncludeGroupCode.split(", "),function(e){d[h].push(e)}),u&&(t.appliedFilter.groupCode=a.uiChosenIncludeGroupCode)),a.hasOwnProperty("hasIncludeGroup")&&a.chosenIncludeGroup&&(h=a.hasIncludeGroup.value.toLowerCase(),d[h]=a.chosenIncludeGroup,u&&(t.appliedFilter.group=a.uiChosenIncludeGroup)),a.hasOwnProperty("hasMarketsList")&&(S=_.where(a.hasMarketsList.data,{selected:!0}),S.length>0&&(h=o.MARKET_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&(t.appliedFilter.markets.push(e.name),t.appliedFilter.market_ids.push(e))}),u&&a.hasMarketsList.data.length===S.length&&(t.appliedFilter.markets=["All Markets"]))),a.hasOwnProperty("hasSourcesList")&&(S=_.where(a.hasSourcesList.data,{selected:!0}),S.length>0&&(h=o.SOURCE_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&t.appliedFilter.sources.push(e.name)}),u&&a.hasSourcesList.data.length===S.length&&(t.appliedFilter.sources=["All Sources"]))),a.hasOwnProperty("hasOriginsList")&&(S=_.where(a.hasOriginsList.data,{selected:!0}),S.length>0&&(h=o.BOOKING_ORIGIN_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&t.appliedFilter.origins.push(e.name)}),u&&a.hasOriginsList.data.length===S.length&&(t.appliedFilter.origins=["All Origins"]))),a.hasOwnProperty("hasGuaranteeType")&&(S=_.where(a.hasGuaranteeType.data,{selected:!0}),S.length>0&&(h=o.INCLUDE_GUARANTEE_TYPE,d[h]=[],_.each(S,function(e){d[h].push(e.name),u&&t.appliedFilter.guarantees.push(e.name)}),u&&a.hasGuaranteeType.data.length===S.length&&(t.appliedFilter.guarantees=["All Guarantees"]))),a.hasOwnProperty("hasSegmentsList")&&(S=_.where(a.hasSegmentsList.data,{selected:!0}),S.length>0&&(h=o.SEGMENT_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&t.appliedFilter.segments.push(e.name)}),u&&a.hasSegmentsList.data.length===S.length&&(t.appliedFilter.segments=["All Segments"]))),a.hasOwnProperty("hasByChargeGroup")&&(S=_.where(a.hasByChargeGroup.data,{selected:!0}),S.length>0&&(h=o.CHARGE_GROUP_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.chargeGroups.push(e.description)}),u&&a.hasByChargeGroup.data.length===S.length&&(t.appliedFilter.chargeGroups=["All Groups"]))),a.hasOwnProperty("hasByChargeCode")&&(S=_.where(a.hasByChargeCode.data,{selected:!0}),S.length>0&&(h=o.CHARGE_CODE_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.chargeCodes.push(e.description)}),u&&a.hasByChargeCode.data.length===S.length&&(t.appliedFilter.chargeCodes=["All Codes"]))),a.hasOwnProperty("hasTransactionCategory")){var N=a.hasTransactionCategory.selected?a.hasTransactionCategory.selected:a.hasTransactionCategory.data[0];h=o.TRANSACTION_CATEGORY,d[h]=N.value,u&&(t.appliedFilter.transaction_category=N.value)}return a.hasOwnProperty("hasHoldStatus")&&(S=_.where(a.hasHoldStatus.data,{selected:!0}),S.length>0&&(h=o.HOLD_STATUS_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.holdStatuses.push(e.description)}),u&&a.hasHoldStatus.data.length===S.length&&(t.appliedFilter.holdStatuses=["All Status"]))),a.hasOwnProperty("hasAddonGroups")&&(S=_.where(a.hasAddonGroups.data,{selected:!0}),S.length>0&&(h=o.ADDONS_GROUPS_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.addonGroups.push(e.description)}),u&&a.hasAddonGroups.data.length===S.length&&(t.appliedFilter.addonGroups=["All Addon Groups"]))),a.hasOwnProperty("hasAddons")&&(S=_.where(a.hasAddons.data,{selected:!0}),S.length>0&&(h=o.ADDONS_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.addon_id),u&&t.appliedFilter.addons.push(e.addon_name)}),u&&a.hasAddons.data.length===S.length&&(t.appliedFilter.addons=["All Addons"]))),a.hasOwnProperty("hasAllowanceCodes")&&(S=_.where(a.hasAllowanceCodes.data,{selected:!0}),S.length>0&&(h=o.ADDONS_IDS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.addons.push(e.addon_name)}),u&&a.hasAllowanceCodes.data.length===S.length&&(t.appliedFilter.addons=["All Addons"]))),a.hasOwnProperty("hasReservationStatus")&&(S=_.where(a.hasReservationStatus.data,{selected:!0}),S.length>0&&(h=o.RESERVATION_STATUS,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.reservationStatus.push(e.status)}),u&&a.hasReservationStatus.data.length===S.length&&(t.appliedFilter.reservationStatus=["All Reservation Status"]))),a.hasOwnProperty("hasDepartments")&&(S=_.where(a.hasDepartments.data,{selected:!0}),S.length>0&&(h=o.ASSIGNED_DEPARTMENTS,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.assigned_departments.push(e.name)}),u&&a.hasDepartments.data.length===S.length&&(t.appliedFilter.assigned_departments=["All Departments"]))),a.hasOwnProperty("hasPaymentType")&&(S=_.where(a.hasPaymentType.data,{selected:!0}),S.length>0&&(h=o.PAYMENT_TYPES,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.payment_types.push(e.description)}),u&&a.hasPaymentType.data.length===S.length&&(t.appliedFilter.payment_types=["All Payments"],delete d[h]))),a.hasOwnProperty("hasTravelAgentsSearch")&&(S=_.where(a.hasTravelAgentsSearch.data,{selected:!0}),S.length>0&&(h=o.TRAVEL_AGENTS,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.travel_agent_ids.push(e.name)}),u&&a.hasTravelAgentsSearch.data.length===S.length&&(t.appliedFilter.travel_agent_ids=["All Travel Agents"]))),a.hasOwnProperty("hasIncludeCountry")&&(S=_.where(a.hasIncludeCountry.data,{selected:!0}),S.length>0&&(h=o.COUNTRY,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.country_ids.push(e.id)}),u&&a.hasIncludeCountry.data.length===S.length&&(t.appliedFilter.hasIncludeCountry=["All countries"],d[h].push("-1")))),a.hasOwnProperty("hasIncludeAgingBalance")&&(S=_.where(a.hasIncludeAgingBalance.data,{selected:!0}),S.length>0&&(h=o.AGING_BALANCE,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.age_buckets.push(e.id)}),u&&a.hasIncludeAgingBalance.data.length===S.length&&(t.appliedFilter.age_buckets=["All Aging Balance"]))),a.hasOwnProperty("hasIncludeTaxExempts")&&(S=_.where(a.hasIncludeTaxExempts.data,{selected:!0}),S.length>0&&(h=o.TAX_EXEMPT_TYPE,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.tax_exempt_type_ids.push(e.id)}),u&&a.hasIncludeTaxExempts.data.length===S.length&&(t.appliedFilter.tax_exempt_type_ids=[],d[h]=[]))),a.hasOwnProperty("hasAccountSearch")&&(S=_.where(a.hasAccountSearch.data,{selected:!0}),S.length>0&&(h=o.ACCOUNT_SEARCH,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.account_ids.push(e.id)}),u&&a.hasAccountSearch.data.length===S.length&&(t.appliedFilter.guarantees=["All Accounts"]))),a.hasOwnProperty("hasCompletionStatus")&&(S=_.where(a.hasCompletionStatus.data,{selected:!0}),S.length>0&&(h=o.COMPLETION_STATUS,d[h]=[],_.each(S,function(e){d[h].push(e.id.toString()),u&&t.appliedFilter.completion_status.push(e.id)}),u&&a.hasCompletionStatus.data.length===S.length&&(t.appliedFilter.completion_status=["All Status"]))),a.hasOwnProperty("hasOriginFilter")&&(S=_.where(a.hasOriginFilter.data,{selected:!0}),S.length>0&&(h=o.ORIGIN_VALUES,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&t.appliedFilter.origins.push(e.description)}),u&&a.hasOriginFilter.data.length===S.length&&(t.appliedFilter.origins=["All Origins"]))),a.hasOwnProperty("hasURLsList")&&(S=_.where(a.hasURLsList.data,{selected:!0}),S.length>0&&(h=o.ORIGIN_URLS,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.origin_urls.push(e.name)}),u&&a.hasURLsList.data.length===S.length&&(t.appliedFilter.origin_urls=["All URLs"]))),a.hasOwnProperty("hasCampaignTypes")&&(S=_.where(a.hasCampaignTypes.data,{selected:!0}),S.length>0&&(h=o.CAMPAIGN_TYPES,d[h]=[],_.each(S,function(e){d[h].push(e.value),u&&t.appliedFilter.campaign_types.push(e.name)}),u&&a.hasCampaignTypes.data.length===S.length&&(t.appliedFilter.campaign_types=["All Campaigns"]))),a.hasOwnProperty("hasFloorList")&&(S=_.where(a.hasFloorList.data,{selected:!0}),S.length>0&&a.hasFloorList.data.length!==S.length&&(h=o.FLOOR,d[h]=[],_.each(S,function(e){d[h].push(e.id),u&&t.appliedFilter.floorList.push(e.floor_number)})),u&&a.hasFloorList.data.length===S.length&&(t.appliedFilter.floorList=["All Floors"])),a.hasOwnProperty("hasMinRevenue")&&a.hasMinRevenue.data&&(h=a.hasMinRevenue.value.toLowerCase(),d[h]=a.hasMinRevenue.data,u&&(t.appliedFilter.hasMinRevenue=a.hasMinRevenue.data)),a.hasOwnProperty("hasMinRoomNights")&&a.hasMinRoomNights.data&&(h=a.hasMinRoomNights.value.toLowerCase(),d[h]=a.hasMinRoomNights.data,u&&(t.appliedFilter.hasMinRoomNights=a.hasMinRoomNights.data)),a.hasOwnProperty("hasMinNoOfDaysNotOccupied")&&a.hasMinNoOfDaysNotOccupied.data&&(h=a.hasMinNoOfDaysNotOccupied.value.toLowerCase(),d[h]=a.hasMinNoOfDaysNotOccupied.data,u&&(t.appliedFilter.hasMinNoOfDaysNotOccupied=a.hasMinNoOfDaysNotOccupied.data)),a.hasShowActionables&&a.showActionables&&(h=o.SHOW_ACTIONABLES,"BOTH"===a.showActionables?d[h]=["GUEST","GROUP"]:d[h]=[a.showActionables],u&&("BOTH"===a.showActionables?(t.appliedFilter.show.push("GUESTS"),t.appliedFilter.show.push("GROUPS")):t.appliedFilter.show.push(a.showActionables))),a.hasShowUpsellOnly&&(h=o.SHOW_UPSELL_ONLY,d[h]=a.show_upsell_only,u&&(t.appliedFilter.show_upsell_only=a.show_upsell_only)),a.title===l.MARKET_SEGMENT_STAT_REPORT&&(d.show_room_revenue=!!_.isUndefined(a.showRoomRevenue)||a.showRoomRevenue),t.oldParams=angular.copy(d),e.isBackgroundReportsEnabled&&(d.per_page=99999,d.rawData=_.extend(n.reduceObject(a),p),d.appliedFilter=t.appliedFilter),a.hasTaxPaymentReceiptTypes&&(d[o.TAX_RECEIPT_TYPE_VALUES]=_.pluck(_.where(a.hasTaxPaymentReceiptTypes.data,{selected:!0}),"value")),d}var A,m=this,O=!1,D=c("translate")("STATS_&_REPORTS_TITLE");BaseCtrl.call(this,t),t.isVisible=!1,t.setTitle(D),t.heading=D,t.$emit("updateRoverLeftMenu","reports"),t.reportList=angular.copy(a.reportsResponse.results),t.reportCount=angular.copy(a.reportsResponse.total_count),t.codeSettings=angular.copy(a.codeSettings),t.activeUserList=angular.copy(a.activeUserList),t.schedulesList=[],t.schedulableReports=[],t.refreshReportList=function(){t.reportList=angular.copy(a.reportsResponse.results)},t.selectedReport={report:null},t.viewStatus={showDetails:!1},t.reportListCopy=JSON.parse(JSON.stringify(a.reportsResponse.results)),t.reportInboxPageState={returnPage:1,returnDate:e.serverDate},t.scrollToLast=function(){u(function(){t.$parent.myScroll.hasOwnProperty("FULL_REPORT_SCROLL")&&t.$parent.myScroll.FULL_REPORT_SCROLL.scrollTo(t.myScroll.FULL_REPORT_SCROLL.maxScrollX,0,299)},300)},t.hasPermissionToViewScheduleReport=function(){return p.getPermissionValue("ADD_EDIT_DELETE_REPORT_SCHEDULE")},t.hasPermissionToViewExportReport=function(){return p.getPermissionValue("EXPORT_REPORTS")},t.shouldShowScheduleReport=function(){return t.hasPermissionToViewScheduleReport()},t.shouldShowExportReport=function(){return t.hasPermissionToViewExportReport()},t.uiChosenReport=void 0,t.hideExportOption=!!sntapp.cordovaLoaded||d.checkDevice.any(),t.printOptions={resetSelf:function(){this.showModal=void 0,this.afterPrint=void 0}},t.printOptions.resetSelf(),t.resultsPerPage=25,t.goBackReportList=function(){if(t.heading=D,t.showSidebar=!1,t.resetFilterItemsToggle(),t.$broadcast(i.REPORT_LIST_SCROLL_REFRESH),r.getChoosenReport().generatedReportId)E.go("rover.reports.inbox",{page:t.reportInboxPageState.returnPage,date:t.reportInboxPageState.returnDate});else{var e=!!t.shouldProcessReportList&&t.shouldProcessReportList;E.go("rover.reports.dashboard",{refresh:e}),t.shouldProcessReportList=!1}},t.errorMessage=[],t.showSidebar=!1,t.toggleSidebar=function(e){e?($(e.target).is(".ui-resizable-handle")&&(t.showSidebar=!t.showSidebar),e.stopPropagation()):t.showSidebar=!1},t.filterItemsToggle={item_01:!1,item_02:!1,item_03:!1,item_04:!1,item_05:!1,item_06:!1,item_07:!1,item_08:!1,item_09:!1,item_10:!1,item_11:!1,item_12:!1,item_13:!1,item_14:!1,item_15:!1,item_16:!1,item_17:!1,item_18:!1,item_19:!1,item_20:!1,item_21:!1,item_22:!1,item_23:!1,item_24:!1,item_25:!1,item_26:!1,item_27:!1,item_28:!1,item_29:!1,item_30:!1,item_32:!1,item_33:!1,item_34:!1,item_35:!1,item_36:!1,item_37:!1,item_38:!1,item_39:!1,item_40:!1,item_41:!1,item_42:!1,item_43:!1,item_44:!1,item_45:!1,item_46:!1,item_47:!1,item_48:!1,item_49:!1,item_50:!1,item_51:!1,item_52:!1,item_53:!1,item_54:!1,item_55:!1,item_56:!1,item_57:!1,item_58:!1,item_59:!1,item_60:!1},t.toggleFilterItems=function(a){t.filterItemsToggle.hasOwnProperty(a)||(t.filterItemsToggle[a]=!1),t.filterItemsToggle[a]=!t.filterItemsToggle[a],R.info(i.REPORT_DETAILS_FILTER_SCROLL_REFRESH),e.$broadcast(i.REPORT_DETAILS_FILTER_SCROLL_REFRESH),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.resetFilterItemsToggle=function(){_.each(t.filterItemsToggle,function(e,a){t.filterItemsToggle[a]=!1})},t.showValidSortBy=function(e){return!!e&&!!e.value},t.replaceWithSpace=function(e,t){return e?e.replace(/_/g," "):""},t.$on("NG_REPEAT_COMPLETED_RENDERING",function(e){t.refreshScroller("report-list-scroll")});var y={dateFormat:e.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(e,t){$("#ui-datepicker-div"),$('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(e){$("#ui-datepicker-div"),$("#ui-datepicker-overlay").remove(),t.showRemoveDateBtn()}};t.fromDateOptions=angular.extend({maxDate:c("date")(e.businessDate,e.dateFormat),onSelect:function(e){t.untilDateOptions.minDate=e}},y),t.untilDateOptions=angular.extend({maxDate:c("date")(e.businessDate,e.dateFormat),onSelect:function(e){t.fromDateOptions.maxDate=e}},y),t.fromDateOptionsTillYesterday=angular.extend({maxDate:function(){var t=new tzIndependentDate(e.businessDate);return t.setDate(t.getDate()-1),c("date")(t,e.dateFormat)}(),onSelect:function(e){t.untilDateOptions.minDate=e}},y),t.untilDateOptionsTillYesterday=angular.extend({maxDate:function(){var t=new tzIndependentDate(e.businessDate);return t.setDate(t.getDate()-1),c("date")(t,e.dateFormat)}(),onSelect:function(e){t.fromDateOptions.maxDate=e}},y),t.fromDateOptionsTillBD=angular.extend({maxDate:new tzIndependentDate(e.businessDate),onSelect:function(e){t.untilDateOptions.minDate=e}},y),t.untilDateOptionsTillBD=angular.extend({maxDate:new tzIndependentDate(e.businessDate),onSelect:function(e){t.fromDateOptions.maxDate=e}},y),t.fromDateOptionsSysLimit=angular.extend({maxDate:new Date,onSelect:function(e){t.untilDateOptions.minDate=e}},y),t.untilDateOptionsSysLimit=angular.extend({maxDate:new Date,onSelect:function(e){t.fromDateOptions.maxDate=e}},y),t.fromDateOptionsOneYearLimit=angular.extend({onSelect:function(e,a){var r=new tzIndependentDate(d.get_date_from_date_picker(a));t.toDateOptionsOneYearLimit.minDate=r,t.toDateOptionsOneYearLimit.maxDate=n.processDate(r).aYearAfter,t.touchedReport.untilDate<r&&(t.touchedReport.untilDate=r),t.touchedReport.untilDate>t.toDateOptionsOneYearLimit.maxDate&&(t.touchedReport.untilDate=t.toDateOptionsOneYearLimit.maxDate)}},y),t.fromDateOptionsOneMonthLimit=angular.extend({onSelect:function(e,a){var r=new tzIndependentDate(d.get_date_from_date_picker(a));
t.toDateOptionsOneMonthLimit.minDate=r,t.toDateOptionsOneMonthLimit.maxDate=n.processDate(r).aMonthAfter,t.touchedReport.untilDate<r&&(t.touchedReport.untilDate=r),t.touchedReport.untilDate>t.toDateOptionsOneMonthLimit.maxDate&&(t.touchedReport.untilDate=t.toDateOptionsOneMonthLimit.maxDate)}},y);var v=n.processDate();t.toDateOptionsOneYearLimit=angular.extend({minDate:v.monthStart,maxDate:n.processDate(v.monthStart).aYearAfter},y),t.fromDateOptionsForecast=angular.extend({minDate:new tzIndependentDate(e.businessDate),onSelect:function(e,a){var r=new tzIndependentDate(d.get_date_from_date_picker(a));t.toDateOptionsForecast.minDate=r,t.toDateOptionsForecast.maxDate=n.processDate(r).aYearAfter,t.touchedReport.untilDate<r&&(t.touchedReport.untilDate=r),t.touchedReport.untilDate>t.toDateOptionsForecast.maxDate&&(t.touchedReport.untilDate=t.toDateOptionsForecast.maxDate)}},y),t.toDateOptionsForecast=angular.extend({minDate:t.fromDateOptionsForecast.minDate,maxDate:n.processDate(v.businessDate).aYearAfter},y),t.toDateOptionsOneMonthLimit=angular.extend({minDate:new tzIndependentDate(e.businessDate),maxDate:n.processDate(e.businessDate).aMonthAfter},y),t.fromDateOptionsSixMonthsLimit=angular.extend({onSelect:function(e,a){var r=new tzIndependentDate(d.get_date_from_date_picker(a));t.toDateOptionsSixMonthsLimit.minDate=r,t.toDateOptionsSixMonthsLimit.maxDate=n.processDate(r).sixMonthsAfter}},y),t.toDateOptionsSixMonthsLimit=angular.extend({minDate:new tzIndependentDate(e.businessDate),maxDate:n.processDate(e.businessDate).sixMonthsAfter},y),t.fromDateOptionsThirtyOneDaysLimit=angular.extend({onSelect:function(e,a){var r=new tzIndependentDate(d.get_date_from_date_picker(a));t.toDateOptionsThirtyOneDaysLimit.minDate=r,t.toDateOptionsThirtyOneDaysLimit.maxDate=n.processDate(r).thirtyOneDaysAfter,t.touchedReport.untilDate=t.toDateOptionsThirtyOneDaysLimit.maxDate}},y),t.toDateOptionsThirtyOneDaysLimit=angular.extend({minDate:new tzIndependentDate(e.businessDate),maxDate:n.processDate(e.businessDate).thirtyOneDaysAfter},y),t.fromDateOptionsNoLimit=angular.extend({},y),t.untilDateOptionsNoLimit=angular.extend({},y);var g=n.processDate().businessDate;t.dateChanged=function(e,a){t.touchedReport=e,t.touchedDate=a,e.title!==l.DAILY_PRODUCTION_RATE&&e.title!==l.BUSINESS_ON_BOOKS||e.fromDate>e.untilDate&&(e.untilDate=e.fromDate),e.title===l.DAILY_PRODUCTION_DEMO&&e.fromDate>e.untilDate&&(e.untilDate=e.fromDate),e.title===l.RATE_RESTRICTION_REPORT&&e.fromDate>e.untilDate&&(e.untilDate=e.fromDate),e.title===l.DAILY_PRODUCTION_ROOM_TYPE&&e.fromDate>e.untilDate&&(e.untilDate=e.fromDate),e.title===l.DAILY_PRODUCTION_ROOM_TYPE&&e.fromDate>e.untilDate&&(e.untilDate=e.fromDate),e.title===l.COMPANY_TA_TOP_PRODUCERS&&(e.fromDate&&void 0===e.untilDate&&(e.untilDate=e.fromDate),e.untilDate&&void 0===e.fromDate&&(e.fromDate=e.untilDate)),e.title===l.ARRIVAL&&(angular.equals(e.fromDate,g)&&angular.equals(e.untilDate,g)||(e.chosenDueInArrivals=!1),e.fromDate>e.untilDate&&(e.untilDate=e.fromDate)),e.title===l.DEPARTURE&&(angular.equals(e.fromDate,g)&&angular.equals(e.untilDate,g)||(e.chosenDueOutDepartures=!1),e.fromDate>e.untilDate&&(e.untilDate=e.fromDate))},t.setTomorrowDate=function(e){e.fromDate=n.processDate().tomorrow,e.untilDate=n.processDate().tomorrow},t.showRemoveDateBtn=function(){function e(e,t){var a=!0,r=!0,s=e[t];return s.hasOwnProperty("fromModel")&&void 0===e[s.fromModel]&&(a=!1),s.hasOwnProperty("untilModel")&&void 0===e[s.untilModel]&&(r=!1),!(!a||!r)}function a(){var e=function e(){t&&"function"==typeof t.apply?t.apply():u(e,100)};u(e,100)}var r,s,n,o=t.touchedReport,i=t.touchedDate;"object"===("undefined"==typeof o?"undefined":_typeof(o))&&o.hasOwnProperty(i)&&(r=o[i],e(o,i)&&(1===o.allDates.length?r.showRemove=!0:(s=_.without(o.allDates,i),n=_.find(s,function(t){return e(o,t)}),n&&(r.showRemove=!0,o[n].showRemove=!0)),a()))},t.clearDateFromFilter=function(e,t){var a,r=e[t].fromModel,s=e[t].untilModel,n=_.without(e.allDates,t),o=0;e.hasOwnProperty(r)&&(e[r]=void 0),e.hasOwnProperty(s)&&(e[s]=void 0),e[t].showRemove=!1,1===n.length?(a=n[0],e[a].showRemove=!1):(_.each(n,function(t){e[t].showRemove&&(a=t,o+=1)}),1===o&&(e[a].showRemove=!1))};var C=function(e){var t=r.getChoosenReport();if(t.title===l.CHECK_IN_CHECK_OUT)return t.chosenCico?"checked_in"===e?"IN"===t.chosenCico||"BOTH"===t.chosenCico:"checked_out"===e?"OUT"===t.chosenCico||"BOTH"===t.chosenCico:void 0:(t.chosenCico="BOTH",!0)};t.sortByChanged=function(e){var t;_.each(e.sortByOptions,function(a){a&&a.value!==e.chosenSortBy?a.sortDir=void 0:a&&a.value===e.chosenSortBy&&(t=a)}),t&&(t.sortDir=!0)};var N=function(e){var t=_.where(e.hasRestrictionListFilter.data,{selected:!0});e.hasRestrictionListFilter.selectAll=!1,e.hasRestrictionListFilter.data.length===t.length?(e.hasRestrictionListFilter.title="All Selected",e.hasRestrictionListFilter.selectAll=!0):0===t.length?e.hasRestrictionListFilter.title=e.hasRestrictionListFilter.defaultTitle:1===t.length?e.hasRestrictionListFilter.title=t[0].description:e.hasRestrictionListFilter.title=t.length+" Selected"};t.restrictionChanged=function(t){N(t),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.toggleRestrictionSelectAll=function(e){_.each(e.hasRestrictionListFilter.data,function(t){t.selected=e.hasRestrictionListFilter.selectAll}),t.restrictionChanged(e)};var P=function(e){var t=_.where(e.hasRoomTypeFilter.data,{selected:!0});e.hasRoomTypeFilter.selectAll=!1,e.hasRoomTypeFilter.data.length===t.length?(e.hasRoomTypeFilter.title="All Selected",e.hasRoomTypeFilter.selectAll=!0):0===t.length?e.hasRoomTypeFilter.title=e.hasRoomTypeFilter.defaultTitle:1===t.length?e.hasRoomTypeFilter.title=t[0].name:e.hasRoomTypeFilter.title=t.length+" Selected"};t.roomTypeChanged=function(t){P(t),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.toggleRoomTypeSelectAll=function(e){_.each(e.hasRoomTypeFilter.data,function(t){t.selected=e.hasRoomTypeFilter.selectAll}),t.roomTypeChanged(e)},t.rateCodeChanged=function(t,a){_.each(t.hasRateCodeFilter.data,function(e){e.id!==a.id&&(e.selected=!1)});var r=_.where(t.hasRateCodeFilter.data,{selected:!0});0===r.length?t.hasRateCodeFilter.title=t.hasRateCodeFilter.defaultTitle:1===r.length&&(t.hasRateCodeFilter.title=r[0].description),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.toggleRateTypeSelectAll=function(a){_.each(a.hasRateTypeFilter.data,function(e){e.selected=a.hasRateTypeFilter.selectAll}),t.fauxSelectChange(a,a.hasRateTypeFilter,a.hasRateTypeFilter.selectAll),L(a),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.rateTypeChanged=function(a){t.fauxSelectChange(a,a.hasRateTypeFilter),L(a),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)};var L=function(e){var a=t.getRates(e),r=_.where(a,{selected:!0});e.hasRateFilter.selectAll=!1,a.length===r.length&&0!==a.length?(e.hasRateFilter.title="All Selected",e.hasRateFilter.selectAll=!0):0===r.length?e.hasRateFilter.title=e.hasRateFilter.defaultTitle:1===r.length?e.hasRateFilter.title=r[0].rate_name:e.hasRateFilter.title=r.length+" Selected"};t.rateChanged=function(t){L(t),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)},t.toggleRateSelectAll=function(a){t.getRates(a),_.each(a.hasRateFilter.data,function(e){e.selected=a.hasRateFilter.selectAll}),L(a),e.$broadcast(i.REPORT_LIST_FILTER_SCROLL_REFRESH)};var I=function(e){return _.pluck(_.where(e.hasRateTypeFilter.data,{selected:!0}),"rate_type_id")},U=function(e){var t=e.hasRateTypeFilter.data,a=_.where(t,{selected:!0}),r=_.pluck(a,"rate_type_id");return _.filter(e.hasRateFilter.data,function(e){return r.indexOf(e.rate_type_id)>-1})},M=function(e){var t=e.hasRateCodeFilter.data,a=_.where(t,{selected:!0});return a};t.shouldShowThisRate=function(e,t){var a=t.hasRateTypeFilter.data,r=_.where(a,{selected:!0}),s=_.pluck(r,"rate_type_id");return s.indexOf(e.rate_type_id)>-1},t.getRates=function(e){var t=e.hasRateTypeFilter.selectAll;return t?e.hasRateFilter.data:U(e)},t.catchFauxSelectClick=function(e,a){e&&e.stopPropagation(),_.each(t.reportList,function(e){_.each(e,function(e,t){t!==a&&e&&"FAUX_SELECT"===e.type&&(e.show=!1)})})},t.toggleFauxSelect=function(e,a){u(function(){t.$$childTail.myScroll["report-filters-scroll"].refresh()},100),e&&a&&(a.show=!a.show)},t.fauxSelectChange=function(a,r,s){var n;return s?(r.selectAll?r.title=r.allTitle||"All Selected":r.title=r.defaultTitle,_.each(r.data,function(e){e.selected=r.selectAll}),n=_.where(r.data,{selected:!0})):(n=_.where(r.data,{selected:!0}),0===n.length?r.title=r.defaultTitle:1===n.length?(r.selectAll=!1,r.title=n[0].description||n[0].name||n[0].status):n.length===r.data.length?(r.selectAll=!0,r.title=r.allTitle||"All Selected"):(r.selectAll=!1,r.title=n.length+" Selected"),R.info(i.REPORT_FILTER_CHANGED),t.$broadcast(i.REPORT_FILTER_CHANGED)),R.info(i.REPORT_DETAILS_FILTER_SCROLL_REFRESH),e.$broadcast(i.REPORT_DETAILS_FILTER_SCROLL_REFRESH),n},t.chargeGroupfauxSelectChange=function(e,a,r){var s=t.fauxSelectChange(e,a,r);_.each(e.hasByChargeCode.originalData,function(e){e.disabled=!0}),_.each(e.hasByChargeCode.originalData,function(e){_.each(e.associcated_charge_groups,function(t){_.each(s,function(a){t.id===a.id&&(e.disabled=!1)})})}),t.chargeCodeFauxSelectChange(e,e.hasByChargeCode,r)},t.chargeCodeFauxSelectChange=function(e,a,r){var s=[];_.each(a.originalData,function(e){e.disabled||s.push(e)}),a.data=s,t.fauxSelectChange(e,a,r)},t.toggleAddons=function(){t.isVisible=!t.isVisible},t.getGroupName=function(e){var a;return angular.forEach(t.addonGroups,function(t){t.id==e&&(a=t.name)}),a},t.getAddons=function(e,a,r){var s=t.fauxSelectChange(e,a,r);O&&clearTimeout(A),O=!0,A=setTimeout(function(){O=!1,b(e,s)},2e3),t.fauxSelectChange(e,a)};var b=function(e,a){var r=[];angular.forEach(a,function(e){r.push(e.id)});var n={addon_group_ids:r},o=function(a){var a=a;_.each(a,function(e){_.each(e.list_of_addons,function(e){e.selected=!0})}),e.hasAddons.data=a,t.$emit("hideLoader")},i=function(){t.$emit("hideLoader")};t.invokeApi(s.fetchAddons,n,o,i)};t.shouldShowExportButton=function(e){var t=e||r.getChoosenReport();return!_.isUndefined(t)&&!_.isEmpty(t)&&t.display_export_button},t.exportCSV=function(e){var a=e||r.getChoosenReport(),s=1,n=!0,o=!1;t.invokeApi(r.exportCSV,{url:t.getExportPOSTUrl(a),payload:S(a,s,n,o)},function(e){t.$emit("hideLoader")},function(e){t.$emit("hideLoader"),t.errorMessage=e})},t.getExportPOSTUrl=function(e){var t=e||r.getChoosenReport(),a="";return _.isEmpty(t)?a:a=t.generatedReportId?"api/generated_reports/"+t.generatedReportId+"/export":"/api/reports/"+t.id+"/submit.csv?"},t.genReport=function(a,n,c,d){var p=r.getChoosenReport(),A=n||1,O="";t.reloadreportNeeded=d,a="boolean"!=typeof a||a;var D=S(p,A,c||t.resultsPerPage),y=function(e,a){var r={};if(r.travel_agent_id=e,r.page=a,r.from_date=D.fiterFromDate,r.to_date=D.filterToDate,r.per_page=o.TRAVEL_AGENTS_PER_PAGE_COUNT,r.reportTitle=l.TRAVEL_AGENT_COMMISSIONS,p.generatedReportId){var n={params:r,successCallBack:m.sucssCallback,failureCallBack:L};t.callAPI(s.fetchGeneratedReportDetails,n)}},v=function(e){return _.each(e.results,function(e){e.insidePaginationData={id:e.travel_agent_id,api:[y,e.travel_agent_id],perPage:o.TRAVEL_AGENTS_PER_PAGE_COUNT},u(function(){t.$broadcast("updatePagination",e.travel_agent_id)},1e3)}),e},g=function(e,a){var r={};r.receipt_sub_category_type_id=e,r.page=a,r.per_page=o.RECEIPTS_PER_PAGE_COUNT,r.from_date=t.summaryCounts.vat_date_from,r.to_date=t.summaryCounts.vat_date_to,t.$broadcast("updateReceipts",r)},C=function(e){return _.each(e.results,function(e){e.insidePaginationData={id:e.sub_category_type_id,api:[g,e.sub_category_type_id],perPage:o.RECEIPTS_PER_PAGE_COUNT},u(function(){t.$broadcast("updatePagination",e.sub_category_type_id)},1e3)}),e},N=function(e){return _.each(e.results,function(e){var t="",a=[],r=0,s=0;_.each(e.dates,function(n,o){var i=n.tax_exempt_type_id;t!==i?(a.push(n.tax_exempt_type_id),t=i,0!==o&&(e.dates[o].is_next=!0,e.dates[r].rowSpanValue=s,e.dates[r].isRowSpanApplied=!0,e.dates[r].isLastTaxExemptType=!1,r=o),s=1):(s++,e.dates[o].isRowSpanApplied=!1),e.dates.length===o+1&&(e.dates[r].rowSpanValue=s,e.dates[r].isRowSpanApplied=!0,e.dates[r].isLastTaxExemptType=!0)}),e.totalTaxExempts=a.length}),e},P=function(e){p.title===l.TRAVEL_AGENT_COMMISSIONS&&(e=v(e)),p.title===l.TAX_OUTPUT_REPORT&&(e=C(e)),p.title===l.TAX_EXEMPT&&(e=N(e)),t.totals=e.totals||[],t.headers=e.headers||[],t.subHeaders=e.sub_headers||[],t.results=e.results||[],t.resultsTotalRow=e.results_total_row||[],t.summaryCounts=e.summary_counts||!1,t.reportGroupedBy=e.group_by||p.chosenGroupBy||"",t.totalCount=e.total_count||0,t.currCount=e.results?e.results.length:0,p.title===l.COMPARISION_BY_DATE&&u(function(){t.$broadcast("updatePagination","COMPARISION_BY_DATE")},50),p.title===l.TRAVEL_AGENT_COMMISSIONS&&(t.$broadcast("UPDATE_RESULTS",t.results),u(function(){t.$broadcast("updatePagination","TA_COMMISSION_REPORT_MAIN")},50)),p.title===l.TAX_OUTPUT_REPORT&&t.$broadcast("UPDATE_TAX_OUTPUT_RESULTS",t.results),h[p.title]&&u(function(){t.$broadcast("updatePagination",h[p.title])},50);var a=s.weekendDays||[];p.title!==l.FORECAST_BY_DATE&&p.title!==l.FORECAST_GUEST_GROUPS||_.each(t.results,function(e){var t=tzIndependentDate(e.date);e.isWeekend=isWeekendDay(a,t)}),1!==A&&u(function(){t.$broadcast("updatePageNo",A)},50)};m.sucssCallback=function(a){return e.isBackgroundReportsEnabled&&"rover.reports.inbox"!==E.current.name&&!a.isPaginatedResponse?(t.$emit("hideLoader"),void f.open({template:"/assets/partials/reports/backgroundReports/rvReportGenerationStatusPopup.html",scope:t,closeByDocument:!0})):(P(a),t.errorMessage=[],t.$emit("hideLoader"),e.isBackgroundReportsEnabled&&(t.appliedFilter=p.appliedFilter),void(r.getPrintClickedState()?(T.start("PRINTING_FROM_REPORT_INBOX"),t.viewStatus.showDetails=!0,_.isUndefined(t.printOptions.showModal)?u(function(){t.$broadcast("PRINT_REPORT")},1e3):t.$broadcast("PRINT_MODAL_REPORT")):("rover.reports.show"!==E.current.name?E.go("rover.reports.show",{action:O||"",report:angular.copy(t.selectedReport)||p}):E.go(".",{page:n,action:O||""},{location:!0,inherit:!0,relative:E.$current,notify:!1}),t.$broadcast("FILTER_SELECTION_UPDATED",t.filter_selected_value),O&&t.$broadcast(O))))};var L=function(a){P(a),t.errorMessage=a,t.$emit("hideLoader"),R.info(i.REPORT_API_FAILED),e.$broadcast(i.REPORT_API_FAILED,a)};t.clearErrorMessage(),D.reportTitle=p.title;var I=function(e){t.currentPage=e,t.genReport(!1,e)};if(p.title===l.COMPARISION_BY_DATE&&(I=function(e){t.genReport(!1,e)},t.comparisonByDatePagination={id:"COMPARISION_BY_DATE",api:I,perPage:25}),p.title===l.TRAVEL_AGENT_COMMISSIONS&&(I=function(e){t.genReport(!1,e),t.$broadcast("TRAVEL_AGENT_COMMISSIONS_SCROLL")},t.commisionReportTAPagination={id:"TA_COMMISSION_REPORT_MAIN",api:I,perPage:o.TRAVEL_AGENTS_PER_PAGE_COUNT}),O=a||n?n&&!c?i.REPORT_PAGE_CHANGED:c?i.REPORT_PRINTING:i.REPORT_SUBMITED:i.REPORT_UPDATED,h[p.title]&&(t.paginationConfig={id:h[p.title],api:I,perPage:25,currentPage:n}),D.action=E.params.action||O,p.generatedReportId){var U={params:D,successCallBack:m.sucssCallback,failureCallBack:L};t.callAPI(s.fetchGeneratedReportDetails,U)}else t.invokeApi(s.fetchReportDetails,D,m.sucssCallback,L)},t.clearErrorMessage=function(){t.errorMessage=[]};var F;t.returnuiChosenReport=function(e){F=e},t.removeCompTaGrpId=function(e,t,a){e[t]||(e[a]="")};var w=function(e){return e.split(/,\s*/)},G=function(e){return w(e).pop()},Y=[],k={source:function(e,a){var r=G(e.term);t.$emit("showLoader"),s.fetchActiveUsers(r).then(function(e){var s,n={};t.activeUserList=e,Y=[],$.map(e,function(e){n={label:e.full_name||e.email,value:e.id},Y.push(n)}),s=$.ui.autocomplete.filter(Y,r),a(s),t.$emit("hideLoader")})},select:function(e,a){var r=w(this.value);return r.pop(),r.push(a.item.label),r.push(""),this.value=r.join(", "),setTimeout(function(){t.$apply(function(){F.uiChosenUsers=r.join(", ")})},100),!1},close:function(){var e=w(this.value),a=[];_.each(Y,function(t){var r=_.find(e,function(e){return e===t.label});r&&a.push(t.value)}),setTimeout(function(){t.$apply(function(){F.chosenUsers=a})},10)},change:function(){var e=w(this.value),a=[];_.each(Y,function(t){var r=_.find(e,function(e){return e===t.label});r&&a.push(t.value)}),setTimeout(function(){t.$apply(function(){F.chosenUsers=a})},10)},focus:function(e,t){return!1}};t.listUserAutoCompleteOptions=angular.extend({position:{my:"left bottom",at:"left top",collision:"flip"}},k),t.detailsUserAutoCompleteOptions=angular.extend({position:{my:"left bottom",at:"right+20 bottom",collision:"flip"}},k);var V=[],H={source:function(e,a){var r=G(e.term);t.$emit("showLoader"),s.fetchComTaGrp(r,!0).then(function(e){var s;_.each(e,function(e){var t=_.find(V,function(t){return t.value===e.id.replace("account_","")});t||V.push({label:e.name,value:e.id.replace("account_",""),type:e.type})}),s=$.ui.autocomplete.filter(V,r),a(s),t.$emit("hideLoader")})},select:function(e,a){var r=w(this.value);return r.pop(),r.push(a.item.label),r.push(""),this.value=r.join(", "),u(function(){t.$apply(function(){F.uiChosenIncludeCompanyTa=r.join(", ")})},100),!1},close:function(){var e=w(this.value),a=[];R.info(V),e.length?(_.each(V,function(t){var r=_.find(e,function(e){return e===t.label});r&&a.push(t.value)}),u(function(){t.$apply(function(){F.chosenIncludeCompanyTa=a.join(", ")})},10)):(V=[],u(function(){t.$apply(function(){F.chosenIncludeCompanyTa=a.join("")})},10))},change:function(){var e=w(this.value),a=[];R.info(V),_.each(V,function(t){var r=_.find(e,function(e){return e===t.label});r&&a.push(t.value)}),u(function(){t.$apply(function(){F.chosenIncludeCompanyTa=a.join(", ")})},10)},focus:function(){return!1}};t.compTaAutoCompleteOnList=angular.extend({position:{my:"left top",at:"left bottom",collision:"flip"}},H),t.compTaAutoCompleteOnDetails=angular.extend({position:{my:"left bottom",at:"right+20 bottom",collision:"flip"}},H);var x={source:function(e,a){t.$emit("showLoader"),s.fetchComTaGrp(e.term).then(function(e){var r=[],s={};$.map(e,function(e){s={label:e.name,value:e.id,type:e.type},r.push(s)}),a(r),t.$emit("hideLoader")})},select:function(e,a){return this.value=a.item.label,u(function(){t.$apply(function(){F.uiChosenIncludeCompanyTaGroup=a.item.label,F.chosenIncludeCompanyTaGroup=a.item.value,F.chosenIncludeCompanyTaGroupType=a.item.type})},100),!1},focus:function(){return!1}};t.compTaGrpAutoCompleteOnList=angular.extend({position:{my:"left top",at:"left bottom",collision:"flip"}},x),t.compTaGrpAutoCompleteOnDetails=angular.extend({position:{my:"left bottom",at:"right+20 bottom",collision:"flip"}},x);var B=[],W=[],K={source:function(e,a){var r=G(e.term);t.$emit("showLoader"),s.fetchGroupCode(r).then(function(e){var s;B=[],_.each(e,function(e){B.push({label:e.group_code,value:e.id})}),s=$.ui.autocomplete.filter(B,r),a(s),t.$emit("hideLoader")})},select:function(e,a){var r=w(this.value);return r.pop(),r.push(a.item.label),r.push(""),W.push(a.item.value),this.value=r.join(", "),u(function(){t.$apply(function(){F.uiChosenIncludeGroupCode=r.join(", "),F.chosenIncludeGroupCode=_.uniq(W).join(", ")})},100),!1},focus:function(){return!1}};t.groupCodeOnList=angular.extend({position:{my:"left top",at:"left bottom",collision:"flip"}},K),t.groupCodeOnDetails=angular.extend({position:{my:"left bottom",at:"right+20 bottom",collision:"flip"}},K);var j={source:function(e,a){t.$emit("showLoader");var r=t.selectedReport.report,n={},i="",u="";n.q=e.term,r&&r.title===l.GROUP_ROOMS_REPORT&&(r.fromDate&&(i=o.FROM_DATE,n[i]=c("date")(r.fromDate,"yyyy/MM/dd")),r.untilDate&&(u=o.TO_DATE,n[u]=c("date")(r.untilDate,"yyyy/MM/dd"))),s.fetchGroups(n).then(function(e){var r=[],s={};$.map(e,function(e){s={label:e.group_name,value:e.id,type:"GROUP"},r.push(s)}),a(r),t.$emit("hideLoader")})},select:function(e,a){return this.value=a.item.label,u(function(){t.$apply(function(){F.uiChosenIncludeGroup=a.item.label,F.chosenIncludeGroup=a.item.value})},100),!1},focus:function(){return!1}};t.grpAutoCompleteOnList=angular.extend({position:{my:"left top",at:"left bottom",collision:"flip"}},j),t.grpAutoCompleteOnDetails=angular.extend({position:{my:"left bottom",at:"right+20 bottom",collision:"flip"}},j),t.closeDialog=function(){f.close()},t.navigateToReportInbox=function(){t.closeDialog(),E.go("rover.reports.inbox")},t.reload=function(){E.reload()};var J=t.$on("UPDATE_REPORT_HEADING",function(e,a){t.heading=a.heading});t.$on("$destroy",J),function(){var e=E.transition.params();t.reloadreportNeeded=!1,e.report&&(t.selectedReport=e.report,t.genReport(!0,e.page),t.shouldProcessReportList=!0)}()}]),angular.module("sntRover").controller("RVScheduleReportsCtrl",["$rootScope","$scope","RVreportsSrv","RVReportUtilsFac","RVReportParamsConst","RVReportMsgsConst","RVReportNamesConst","$filter","$timeout","rvUtilSrv","ngDialog","RVReportApplyIconClass","RVReportSetupDates",function(e,t,a,r,s,n,o,i,l,c,u,d,p){function h(){t.isAddingNew=!1,t.addingStage=X.SHOW_SCHEDULE_LIST,t.selectedSchedule={},t.selectedReport={},t.selectedEntityDetails={},t.$parent.$parent.schedulesList=[],t.$parent.$parent.scheduleReport=[],t.scheduleTimePeriods=[],t.scheduleFrequency=[],t.scheduleFormat=[],t.scheduleYearList=Array.from({length:10},function(e,t){return{value:moment().add(-1*t,"y").format("YYYY")}}),t.scheduleFreqType=[],t.emailList=[],t.scheduleParams={},t.creationDateTimePeriods=[],t.arrivalDateTimePeriods=[],t.adjustmentDateTimePeriods=[],t.cancellationDateTimePeriods=[],D(),J()}var E,R="REPORT_SCHEDULES_SCROLL",f="SECOND_COLUMN_SCROLL",T="THIRD_COLUMN_SCROLL",S="FOURTH_COLUMN_SCROLL",A="SHOW_ERROR_MSG_EVENT",m=[],O=["INCLUDE_DUE_OUT","INCLUDE_INHOUSE","EXCEEDED_ONLY","OOO","OOS"],D=function(){var e={tap:!0,preventDefault:!1};t.setScroller(R,e),t.setScroller(f,e),t.setScroller(T,e),t.setScroller(S,e)},y=function(e,a){var r=100;t.refreshScroller(e),a&&t.myScroll.hasOwnProperty(e)&&t.myScroll[e].scrollTo(0,0,r)},v=function(){t.$$phase||t.$digest()},g=function(a){var r="Runs ",s=_.find(t.originalScheduleFrequency,{id:a.frequency_id}),n="",o="",l={DAILY:"DAILY",HOURLY:"HOURLY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY"};return s&&(n=s.description,o=s.value),0!==a.repeats_every&&a.repeats_every?(r+="after every "+a.repeats_every+" ",o===l.DAILY?r+=1===a.repeats_every?"day":"days":o===l.HOURLY?r+=1===a.repeats_every?"hour":"hours":o===l.WEEKLY?r+=1===a.repeats_every?"week":"weeks":o===l.MONTHLY?r+=1===a.repeats_every?"month":"months":o===l.MONTHLY&&(r+=1===a.repeats_every?"month":"months")):r+=n.toLowerCase(),r+=a.time?" at "+a.time+". ":". ",a.starts_on&&(r+="Started on "+i("date")(a.starts_on,e.dateFormat)+". "),r+=a.ends_on_after?"Ends after "+a.ends_on_after+" times.":a.ends_on_date?"Ends on "+i("date")(a.ends_on_date,e.dateFormat)+".":"Runs forever."},C=function(){var e=function(){var e=!1;return(t.isYearlyTaxReport||t.isGuestBalanceReport||t.isCreditCheckReport||t.isRoomStatusReport||angular.isDefined(t.scheduleParams.time_period_id))&&(e=!0),t.isReservationsByUserReport&&(e=t.scheduleParams.create_date_range||t.scheduleParams.arrival_date_range),t.isRateAdjustmentReport&&(e=t.scheduleParams.arrival_date_range||t.scheduleParams.adjustment_date_range),t.isCancellationNoShowReport&&(e=t.scheduleParams.date_range||t.scheduleParams.cancelation_date_range),e},a=function(){return!!t.scheduleParams.frequency_id},r=function(){var e=t.checkDeliveryType("EMAIL")&&t.emailList.length,a=t.checkDeliveryType("SFTP")&&!!t.scheduleParams.selectedFtpRecipient,r=t.checkDeliveryType("DROPBOX")&&!!t.scheduleParams.selectedCloudAccount,s=t.checkDeliveryType("GOOGLE DRIVE")&&!!t.scheduleParams.selectedCloudAccount;return e||a||r||s};return e()&&a()&&r()},N=function(){t.createErrors=[],t.isYearlyTaxReport||t.isGuestBalanceReport||t.scheduleParams.time_period_id||t.createErrors.push("Time period in parameters"),t.scheduleParams.frequency_id||t.createErrors.push("Repeat frequency in details"),t.emailList.length||t.scheduleParams.selectedFtpRecipient||t.scheduleParams.selectedCloudAccount||t.createErrors.push("Emails/SFTP/Dropbox/Google Drive in distribution list")},P=function(e){var t=e.hasRateTypeFilter.data,a=_.where(t,{selected:!0}),r=_.pluck(a,"rate_type_id");return _.filter(e.hasRateFilter.data,function(e){return r.indexOf(e.rate_type_id)>-1})},L=function(e){return _.pluck(_.where(e.hasRateTypeFilter.data,{selected:!0}),"rate_type_id")},I=function(){return t.selectedEntityDetails.report.title===o.DAILY_PRODUCTION_ROOM_TYPE||t.selectedEntityDetails.report.title===o.DAILY_PRODUCTION_DEMO||t.selectedEntityDetails.report.title===o.DAILY_PRODUCTION_RATE};t.navigateToSchedulableReportList=function(){u.close(),t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.updateViewCol(t.viewColsActions.ONE),t.addingStage=X.SHOW_SCHEDULE_LIST,J()};var U=function(){var r,n={report_id:t.selectedEntityDetails.report.id,hotel_id:e.hotelDetails.userHotelsData.current_hotel_id,format_id:t.scheduleParams.format_id,delivery_type_id:""},l={page:1,per_page:99999},c=function(e){t.errorMessage="",t.$emit("hideLoader"),e.is_export_already_exist?u.open({template:"/assets/partials/reports/rvDuplicateScheduleWarningPopup.html",scope:t,closeByEscape:!1,data:{isUpdate:!1}}):t.navigateToSchedulableReportList()},d=function(e){t.errorMessage=e,t.$emit(A,e),t.$emit("hideLoader")};t.scheduleParams.time&&(n.time=t.scheduleParams.time),t.scheduleParams.time_period_id&&(n.time_period_id=t.scheduleParams.time_period_id),t.scheduleParams.create_date_range&&(l.create_date_range=t.scheduleParams.create_date_range),t.scheduleParams.arrival_date_range&&(l.arrival_date_range=t.scheduleParams.arrival_date_range),t.scheduleParams.adjustment_date_range&&(l.adjustment_date_range=t.scheduleParams.adjustment_date_range),t.scheduleParams.date_range&&(l.date_range=t.scheduleParams.date_range),t.scheduleParams.cancelation_date_range&&(l.cancelation_date_range=t.scheduleParams.cancelation_date_range),t.scheduleParams.time_period_id===t.dateRangeTimePeriodId&&(n.from_date=i("date")(t.selectedEntityDetails.report.fromDate,"yyyy/MM/dd"),n.to_date=i("date")(t.selectedEntityDetails.report.untilDate,"yyyy/MM/dd"),l.from_date=i("date")(t.selectedEntityDetails.report.fromDate,"yyyy/MM/dd"),l.to_date=i("date")(t.selectedEntityDetails.report.untilDate,"yyyy/MM/dd")),t.scheduleParams.time_period_id===t.dateTimePeriodId&&(n.from_date=i("date")(t.selectedEntityDetails.report.singleValueDate,"yyyy/MM/dd"),l.from_date=i("date")(t.selectedEntityDetails.report.singleValueDate,"yyyy/MM/dd")),n.frequency_id=t.scheduleParams.frequency_id,t.scheduleParams.starts_on&&(n.starts_on=i("date")(t.scheduleParams.starts_on,"yyyy/MM/dd")),t.scheduleParams.frequency_id===E?n.repeats_every=null:t.scheduleParams.repeats_every?n.repeats_every=t.scheduleParams.repeats_every:n.repeats_every=0,"NUMBER"===t.scheduleParams.scheduleEndsOn?n.ends_on_after=t.scheduleParams.ends_on_after:"DATE"===t.scheduleParams.scheduleEndsOn?n.ends_on_date=i("date")(t.scheduleParams.ends_on_date,"yyyy/MM/dd"):(n.ends_on_after=null,n.ends_on_date=null);var p=_.find(t.scheduleDeliveryTypes,{value:t.scheduleParams.delivery_id});if(p&&(n.delivery_type_id=parseInt(p.id)),t.checkDeliveryType("EMAIL")&&t.emailList.length?n.emails=t.emailList.join(", "):t.checkDeliveryType("SFTP")&&t.scheduleParams.selectedFtpRecipient?n.sftp_server_id=t.scheduleParams.selectedFtpRecipient:(t.checkDeliveryType("GOOGLE DRIVE")||t.checkDeliveryType("DROPBOX"))&&t.scheduleParams.selectedCloudAccount?n.cloud_drive_id=t.scheduleParams.selectedCloudAccount:(n.emails="",n.sftp_server_id=""),t.scheduleParams.sort_field&&(l.sort_field=t.scheduleParams.sort_field),t.isYearlyTaxReport&&(l.year=t.scheduleParams.year,l.with_vat_number=t.scheduleParams.with_vat_number,l.without_vat_number=t.scheduleParams.without_vat_number),t.isOccupancyRevenueSummaryReport&&(l.include_day_use=t.scheduleParams.include_day_use),t.selectedEntityDetails.group_fields.length>0){var h="";"DATE"===t.scheduleParams.groupBy?h=s.GROUP_BY_DATE:"USER"===t.scheduleParams.groupBy?h=s.GROUP_BY_USER:"ADDON"===t.scheduleParams.groupBy&&(h=s.ADDON_GROUP_BY),h&&(l[h]=!0)}_.each(t.filters,function(e,a){if("hasRateTypeFilter"===a)l[s.RATE_TYPE_IDS]=L(t.filters);else if("hasRateFilter"===a){if(r=s.RATE_IDS,l[r]=_.pluck(_.where(P(t.filters),{selected:!0}),"id"),o.DAILY_PRODUCTION_RATE===t.selectedEntityDetails.report.title){var i=_.pluck(_.where(P(t.filters),{selected:!0,id:null}),"group_id");i.length>0&&(n[r]=_.without(n[r],null),n.custom_rate_group_ids=i)}}else if("hasByChargeGroup"===a)r=s.CHARGE_GROUP_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasByChargeCode"===a)r=s.CHARGE_CODE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasDepartments"===a)r=s.ASSIGNED_DEPARTMENTS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasIncludeCountry"===a)r=s.COUNTRY,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasCompletionStatus"===a)r=s.COMPLETION_STATUS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasShowActionables"===a)r=s.SHOW_ACTIONABLES,"BOTH"===t.filters.showActionables?l[r]=["GUEST","GROUP"]:l[r]=[t.filters.showActionables];else if("hasUsers"===a)r=s.USER_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id"),l[r].length===e.data.length&&(l.all_users_selected=!0);else if("hasMarketsList"===a)r=s.MARKET_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasOriginsList"===a)r=s.BOOKING_ORIGIN_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasSourcesList"===a)r=s.SOURCE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasHkReservationStatus"===a)r=s.HK_RESERVATION_STATUSES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"status");else if("hasReservationStatus"===a){r=s.RESERVATION_STATUS;var c=_.pluck(_.where(e.data,{selected:!0}),"id");c=c.map(function(e){return e.toString()}),l[r]=c}else"hasFloorList"===a?(r=s.FLOOR,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasIncludeWorkTypes"===a?(r=s.WORK_TYPE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasFrontOfficeStatus"===a?(r=s.HK_FRONT_OFFICE_STATUSES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"status")):"hasHouseKeepingStatus"===a?(r=s.HOUSEKEEPING_STATUS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasIncludeCompanyTaGroup"===a&&t.selectedEntityDetails.chosenIncludeCompanyTaGroup?(r=e.value.toLowerCase(),l[r]=t.selectedEntityDetails.chosenIncludeCompanyTaGroup,l[s.ENTITY_TYPE]=t.selectedEntityDetails.chosenIncludeCompanyTaGroupType,l[s.ENTITY_NAME]=t.selectedEntityDetails.uiChosenIncludeCompanyTaGroup):"hasGuaranteeTypeList"===a?(r=s.INCLUDE_GUARANTEE_TYPE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasSegmentList"===a?(r=s.SEGMENT_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasRoomTypeList"===a?(r=s.ROOM_TYPE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasRateCodeList"===a?(r=s.RATE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAddonGroups"===a?(r=s.ADDONS_GROUPS_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAddons"===a?(r=s.ADDONS_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"addon_id")):"hasIncludeAgingBalance"===a?(r=s.AGING_BALANCE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAccountSearch"===a?(r=s.ACCOUNT_SEARCH,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasTransactionCategory"===a?(r=s.TRANSACTION_CATEGORY,l[r]=t.filters.hasTransactionCategory.selected.id):"empList"===a?(r=s.USER_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id"),l[r].length===e.data.length&&(l.all_users_selected=!0)):"hasPaymentType"===a?(r=s.PAYMENT_TYPES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasCollapsedOrExpanded"===a?(r=s.EXPANDED_OR_COLLAPSED,l[r]=t.filters.hasCollapsedOrExpanded.selected.value):_.each(e.data,function(e){e.selected&&(l[e.paramKey]=!0)})}),n.filter_values=l,I()&&(n.filter_values.exclude_tax=!0),t.scheduleParams.includeTitleHeader&&t.scheduleParams.format_id===t.CSV_FORMAT_ID&&(n.include_title_header=t.scheduleParams.includeTitleHeader),t.invokeApi(a.createSchedule,n,c,d);
};t.navigateToSchedulesList=function(e){u.close();var a=_.findIndex(t.$parent.$parent.schedulesList,{id:e.id});t.selectedSchedule&&t.selectedSchedule.active&&(t.selectedSchedule.active=!1),t.updateViewCol(t.viewColsActions.ONE),t.addingStage=X.SHOW_SCHEDULE_LIST,a>=0&&(t.$parent.$parent.schedulesList[a].frequency_id=e.frequency_id,t.$parent.$parent.schedulesList[a].repeats_every=e.repeats_every,t.$parent.$parent.schedulesList[a].time=e.time,t.$parent.$parent.schedulesList[a].starts_on=e.starts_on,t.$parent.$parent.schedulesList[a].ends_on_after=e.ends_on_after,t.$parent.$parent.schedulesList[a].ends_on_date=e.ends_on_date,t.$parent.$parent.schedulesList[a].occurance=g(t.$parent.$parent.schedulesList[a]))};var M=function(){var r,n={id:t.selectedEntityDetails.id,report_id:t.selectedEntityDetails.report.id,hotel_id:e.hotelDetails.userHotelsData.current_hotel_id,format_id:t.scheduleParams.format_id,delivery_type_id:""},l={page:1,per_page:99999},c=function(e){t.errorMessage="",t.$emit("hideLoader"),e.is_export_already_exist?u.open({template:"/assets/partials/reports/rvDuplicateScheduleWarningPopup.html",scope:t,closeByEscape:!1,data:{isUpdate:!0,params:n}}):t.navigateToSchedulesList(n)},d=function(e){t.errorMessage=e,t.$emit(A,e),t.$emit("hideLoader")};t.scheduleParams.time&&(n.time=t.scheduleParams.time),t.scheduleParams.time_period_id&&(n.time_period_id=t.scheduleParams.time_period_id),t.scheduleParams.create_date_range&&(l.create_date_range=t.scheduleParams.create_date_range),t.scheduleParams.arrival_date_range&&(l.arrival_date_range=t.scheduleParams.arrival_date_range),t.scheduleParams.adjustment_date_range&&(l.adjustment_date_range=t.scheduleParams.adjustment_date_range),t.scheduleParams.date_range&&(l.date_range=t.scheduleParams.date_range),t.scheduleParams.cancelation_date_range&&(l.cancelation_date_range=t.scheduleParams.cancelation_date_range),n.format_id=parseInt(t.scheduleParams.format_id),t.scheduleParams.time_period_id===t.dateRangeTimePeriodId&&(n.from_date=i("date")(t.selectedEntityDetails.report.fromDate,"yyyy/MM/dd"),n.to_date=i("date")(t.selectedEntityDetails.report.untilDate,"yyyy/MM/dd"),l.from_date=i("date")(t.selectedEntityDetails.report.fromDate,"yyyy/MM/dd"),l.to_date=i("date")(t.selectedEntityDetails.report.untilDate,"yyyy/MM/dd")),t.scheduleParams.time_period_id===t.dateTimePeriodId&&(n.from_date=i("date")(t.selectedEntityDetails.report.singleValueDate,"yyyy/MM/dd"),l.from_date=i("date")(t.selectedEntityDetails.report.singleValueDate,"yyyy/MM/dd")),n.frequency_id=t.scheduleParams.frequency_id,t.scheduleParams.starts_on&&(n.starts_on=i("date")(t.scheduleParams.starts_on,"yyyy/MM/dd")),t.scheduleParams.frequency_id===E?n.repeats_every=null:t.scheduleParams.repeats_every?n.repeats_every=t.scheduleParams.repeats_every:n.repeats_every=0,"NUMBER"===t.scheduleParams.scheduleEndsOn?n.ends_on_after=t.scheduleParams.ends_on_after:"DATE"===t.scheduleParams.scheduleEndsOn?n.ends_on_date=i("date")(t.scheduleParams.ends_on_date,"yyyy/MM/dd"):(n.ends_on_after=null,n.ends_on_date=null);var p=_.find(t.scheduleDeliveryTypes,{value:t.scheduleParams.delivery_id});if(p&&(n.delivery_type_id=parseInt(p.id)),t.checkDeliveryType("EMAIL")&&t.emailList.length?n.emails=t.emailList.join(", "):t.checkDeliveryType("SFTP")&&t.scheduleParams.selectedFtpRecipient?n.sftp_server_id=t.scheduleParams.selectedFtpRecipient:(t.checkDeliveryType("GOOGLE DRIVE")||t.checkDeliveryType("DROPBOX"))&&t.scheduleParams.selectedCloudAccount?n.cloud_drive_id=t.scheduleParams.selectedCloudAccount:(n.emails="",n.sftp_server_id=""),t.scheduleParams.sort_field&&(l.sort_field=t.scheduleParams.sort_field),t.isYearlyTaxReport&&(l.year=t.scheduleParams.year,l.with_vat_number=t.scheduleParams.with_vat_number,l.without_vat_number=t.scheduleParams.without_vat_number),t.isOccupancyRevenueSummaryReport&&(l.include_day_use=t.scheduleParams.include_day_use),t.selectedEntityDetails.group_fields.length>0){var h="";"DATE"===t.scheduleParams.groupBy?h=s.GROUP_BY_DATE:"USER"===t.scheduleParams.groupBy?h=s.GROUP_BY_USER:"ADDON"===t.scheduleParams.groupBy&&(h=s.ADDON_GROUP_BY),h&&(l[h]=!0)}_.each(t.filters,function(e,a){if("hasRateTypeFilter"===a)l[s.RATE_TYPE_IDS]=L(t.filters);else if("hasRateFilter"===a){if(r=s.RATE_IDS,l[r]=_.pluck(_.where(P(t.filters),{selected:!0}),"id"),o.DAILY_PRODUCTION_RATE===t.selectedEntityDetails.report.title){var i=_.pluck(_.where(P(t.filters),{selected:!0,id:null}),"group_id");i.length>0&&(n[r]=_.without(n[r],null),n.custom_rate_group_ids=i)}}else if("hasByChargeGroup"===a)r=s.CHARGE_GROUP_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasByChargeCode"===a)r=s.CHARGE_CODE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasDepartments"===a)r=s.ASSIGNED_DEPARTMENTS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasIncludeCountry"===a)r=s.COUNTRY,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasMarketsList"===a)r=s.MARKET_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasOriginsList"===a)r=s.BOOKING_ORIGIN_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasSourcesList"===a)r=s.SOURCE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasSegmentsList"===a)r=s.SEGMENT_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasCompletionStatus"===a)r=s.COMPLETION_STATUS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id");else if("hasHkReservationStatus"===a)r=s.HK_RESERVATION_STATUSES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"status");else if("hasReservationStatus"===a){r=s.RESERVATION_STATUS;var c=_.pluck(_.where(e.data,{selected:!0}),"id");c=c.map(function(e){return e.toString()}),l[r]=c}else"hasFloorList"===a?(r=s.FLOOR,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasIncludeWorkTypes"===a?(r=s.WORK_TYPE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasFrontOfficeStatus"===a?(r=s.HK_FRONT_OFFICE_STATUSES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"status")):"hasHouseKeepingStatus"===a?(r=s.HOUSEKEEPING_STATUS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasShowActionables"===a?(r=s.SHOW_ACTIONABLES,"BOTH"===t.filters.showActionables?l[r]=["GUEST","GROUP"]:l[r]=[t.filters.showActionables]):"hasUsers"===a?(r=s.USER_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id"),l[r].length===e.data.length&&(l.all_users_selected=!0)):"hasIncludeCompanyTaGroup"===a&&t.selectedEntityDetails.chosenIncludeCompanyTaGroup?(r=e.value.toLowerCase(),l[r]=t.selectedEntityDetails.chosenIncludeCompanyTaGroup,l[s.ENTITY_TYPE]=t.selectedEntityDetails.chosenIncludeCompanyTaGroupType,l[s.ENTITY_NAME]=t.selectedEntityDetails.uiChosenIncludeCompanyTaGroup):"hasGuaranteeTypeList"===a?(r=s.INCLUDE_GUARANTEE_TYPE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasSegmentList"===a?(r=s.SEGMENT_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasRoomTypeList"===a?(r=s.ROOM_TYPE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasRateCodeList"===a?(r=s.RATE_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAddonGroups"===a?(r=s.ADDONS_GROUPS_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAddons"===a?(r=s.ADDONS_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"addon_id")):"hasIncludeAgingBalance"===a?(r=s.AGING_BALANCE,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasAccountSearch"===a?(r=s.ACCOUNT_SEARCH,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasTransactionCategory"===a?(r=s.TRANSACTION_CATEGORY,l[r]=t.filters.hasTransactionCategory.selected.id):"empList"===a?(r=s.USER_IDS,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id"),l[r].length===e.data.length&&(l.all_users_selected=!0)):"hasPaymentType"===a?(r=s.PAYMENT_TYPES,l[r]=_.pluck(_.where(e.data,{selected:!0}),"id")):"hasCollapsedOrExpanded"===a?(r=s.EXPANDED_OR_COLLAPSED,l[r]=t.filters.hasCollapsedOrExpanded.selected.value):_.each(e.data,function(e){e.selected&&(l[e.paramKey]=!0)})}),n.filter_values=l,I()&&(n.filter_values.exclude_tax=!0),t.scheduleParams.includeTitleHeader&&t.scheduleParams.format_id===t.CSV_FORMAT_ID&&(n.include_title_header=t.scheduleParams.includeTitleHeader),t.invokeApi(a.updateSchedule,n,c,d)},b={DUE_IN_ARRIVALS:"DUE_IN_ARRIVALS",DUE_OUT_DEPARTURES:"DUE_OUT_DEPARTURES",INCLUDE_CANCELED:"INCLUDE_CANCELED",INCLUDE_NO_SHOW:"INCLUDE_NO_SHOW",INCLUDE_GUEST_NOTES:"INCLUDE_GUEST_NOTES",INCLUDE_RESERVATION_NOTES:"INCLUDE_RESERVATION_NOTES",INCLUDE_ACTIONS:"INCLUDE_ACTIONS",SHOW_GUESTS:"SHOW_GUESTS",VIP_ONLY:"VIP_ONLY",HAS_VEHICLE_REG_NO:"HAS_VEHICLE_REG_NO",SHOW_PHONE_NUMBER:"SHOW_PHONE_NUMBER",INCLUDE_DUE_OUT:"INCLUDE_DUE_OUT",RESTRICTED_POST_ONLY:"RESTRICTED_POST_ONLY",INCLUDE_TAX:"INCLUDE_TAX",INCLUDE_LEDGER_DATA:"INCLUDE_LEDGER_DATA",NO_NATIONALITY:"NO_NATIONALITY",EXCLUDE_NON_GTD:"EXCLUDE_NON_GTD",INCLUDE_NEW:"INCLUDE_NEW",INCLUDE_BOTH:"INCLUDE_BOTH",SHOW_RATE_ADJUSTMENTS_ONLY:"SHOW_RATE_ADJUSTMENTS_ONLY",INCLUDE_CANCELLED:"INCLUDE_CANCELLED",INCLUDE_LAST_YEAR:"INCLUDE_LAST_YEAR",INCLUDE_VARIANCE:"INCLUDE_VARIANCE",ACCOUNT:"ACCOUNT",GUEST:"GUEST"},F={DATE:"DATE",NAME:"NAME",ROOM:"ROOM",BALANCE:"BALANCE",ROOM_NO:"ROOM_NO",DEPARTMENT:"DEPARTMENT",CHARGE_CODE:"CHARGE_CODE",USER:"USER",CREATE_DATE:"CREATE_DATE",GUARANTEE_TYPE:"GUARANTEE_TYPE",OVERRIDE_AMOUNT:"OVERRIDE_AMOUNT",RATE_AMOUNT:"RATE_AMOUNT",RESERVATION:"RESERVATION",TYPE:"TYPE",END_DATE:"END_DATE",ROOM_TYPE:"ROOM_TYPE",START_DATE:"START_DATE",GUEST_USER:"GUEST_USER",CREDIT:"CREDIT",DEBIT:"DEBIT",AR_NUMBER:"AR_NUMBER",ACCOUNT_NAME:"ACCOUNT_NAME",GUEST_NAME:"GUEST_NAME",RESERVATION_STATUS:"RESERVATION_STATUS"},w={GROUP_BY_DATE:"DATE",GROUP_BY_USER:"USER",GROUP_FIELD:"ADDON"},G={"Arriving Guests":"guest-status check-in","Departing Guests":"guest-status check-out","All In-House Guests":"guest-status inhouse","Balance for all Outstanding Accounts":"icon-report icon-balance","Statistics Report by Comparison":"icon-report icon-comparison","Company or Travel Agent Accounts with total net revenue over EUR 250.00.":"icon-report icon-forecast"},Y={INCLUDE_MARKET:!0,INCLUDE_SOURCE:!0,INCLUDE_ORIGIN:!0,INCLUDE_SEGMENT:!0},k=function(e){t.filters.hasDisplay.data.push({paramKey:e.value.toLowerCase(),description:e.description,selected:!0})},V=function(e){var a=[];return _.each(e,function(e){a.push(_.find(t.originalScheduleTimePeriods,{value:e}))}),a},H=function(){t.selectedEntityDetails.report.title===o.RESERVATIONS_BY_USER&&(t.selectedEntityDetails.sort_fields=_.reject(t.selectedEntityDetails.sort_fields,function(e){return"TYPE"===e.value}))},x=function(){var e=angular.copy(t.$parent.activeUserList);if(t.selectedEntityDetails.report.title===o.ROOM_STATUS_REPORT){var a={full_name:"UNDEFINED",id:-1};e.push(a)}return e},B=function(){t.filters={},t.selectedEntityDetails.report.title===o.CREDIT_CHECK_REPORT&&(t.scheduleParams.sort_field="ROOM_NO"),t.filters.hasGeneralOptions={data:[],options:{selectAll:!1,hasSearch:!1,key:"description"},affectsFilter:{name:"hasReservationStatus",process:function(e,a){if(t.selectedEntityDetails.report.title===o.GUEST_BALANCE_REPORT){var s=!!_.find(a,{paramKey:"guest"});!s&&t.filters.hasReservationStatus.data.length>0?t.filters.hasReservationStatus.data=[]:s&&0===t.filters.hasReservationStatus.data.length&&r.fillResStatus(t.filters,t.selectedEntityDetails.filter_values,!0)}}}},t.filters.hasDisplay={data:[],options:{selectAll:!0,hasSearch:!1,key:"description",defaultValue:"Select displays"}},t.filters.hasShow={data:[],options:{selectAll:!1,hasSearch:!1,key:"description",allValue:"Both",defaultValue:"Select options"}};var e=function(e){t.filters.hasShow.data.push({paramKey:e.value.toLowerCase(),description:e.description,selected:"EXCEEDED_ONLY"!==e.value})};t.selectedEntityDetails.report.title===o.RESERVATIONS_BY_USER&&t.selectedEntityDetails.filters.push({value:"SHOW_EMPLOYEES"}),_.each(t.selectedEntityDetails.filters,function(s){var n=!1,i=!1;if(b[s.value]&&!t.isCreditCheckReport)"Arriving Guests"===t.selectedEntityDetails.report.description&&"DUE_IN_ARRIVALS"===s.value&&(n=!0),"Departing Guests"===t.selectedEntityDetails.report.description&&"DUE_OUT_DEPARTURES"===s.value&&(n=!0),"All In-House Guests"===t.selectedEntityDetails.report.description&&"INCLUDE_DUE_OUT"===s.value&&(n=!0),"Restricted Post only"===t.selectedEntityDetails.report.description&&"RESTRICTED_POST_ONLY"===s.value&&(n=!1),t.selectedEntityDetails.report.title===o.RESERVATIONS_BY_USER&&"INCLUDE_NEW"===s.value&&(n=!0),t.selectedEntityDetails.report.title===o.OCCUPANCY_REVENUE_SUMMARY&&(n=!0),"ACCOUNT"!==s.value&&"GUEST"!==s.value||(n=!0),t.selectedEntityDetails.report.title===o.FORECAST_GUEST_GROUPS&&"EXCLUDE_NON_GTD"===s.value&&(n=!0),t.selectedEntityDetails.report.title===o.CANCELLATION_NO_SHOW&&"INCLUDE_CANCELED"===s.value&&(n=!0),t.filters.hasGeneralOptions.data.push({paramKey:s.value.toLowerCase(),description:s.description,selected:n,mustSend:i}),"Arriving Guests"!==t.selectedEntityDetails.report.description&&"Departing Guests"!==t.selectedEntityDetails.report.description||(t.filters.hasGeneralOptions.options.noSelectAll=!0);else if(Y[s.value])"INCLUDE_MARKET"!==s.value&&"INCLUDE_ORIGIN"!==s.value&&"INCLUDE_SEGMENT"!==s.value&&"INCLUDE_SOURCE"!==s.value||k(s);else if("RATE"===s.value)r.fillRateTypesAndRatesForScheduledReports(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title);else if("COMPLETION_STATUS"===s.value)r.fillCompletionStatus(t.filters);else if("DEPARTMENT_ASSIGNED"===s.value)r.fillDepartments(t.filters,t.selectedEntityDetails.filter_values);else if("COUNTRY"===s.value)r.fillCountries(t.filters,t.selectedEntityDetails.filter_values);else if("ACTIONS_BY"===s.value)r.fillActionsBy(t.filters),t.filters.showActionables="BOTH";else if("INCLUDE_CHARGE_GROUP"===s.value||"INCLUDE_CHARGE_CODE"===s.value||"SHOW_CHARGE_CODES"===s.value)r.fillChargeGroupsAndChargeCodes(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title);else if("CHOOSE_MARKET"===s.value)r.fillMarkets(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title);else if("CHOOSE_SOURCE"===s.value)r.fillSources(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title);else if("CHOOSE_BOOKING_ORIGIN"===s.value)r.fillBookingOrigins(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title);else if("RESERVATION_STATUS"===s.value)switch(t.selectedEntityDetails.report.title){case o.ADDON_FORECAST:case o.COMPLIMENTARY_ROOM_REPORT:r.fillResStatus(t.filters,t.selectedEntityDetails.filter_values);break;case o.ROOM_STATUS_REPORT:r.fillReservationStatus(t.filters,t.selectedEntityDetails.filter_values);break;case o.GUEST_BALANCE_REPORT:r.fillResStatus(t.filters,t.selectedEntityDetails.filter_values,!1,!0);break;default:throw new Error("Report needs explicit code to support 'RESERVATION_STATUS' filter")}else"FLOOR"===s.value?r.fillFloors(t.filters,t.selectedEntityDetails.filter_values):"WORK_TYPE"===s.value?r.fillWorkTypes(t.filters,t.selectedEntityDetails.filter_values):"FRONT_OFFICE_STATUS"===s.value&&t.selectedEntityDetails.report.title===o.ROOM_STATUS_REPORT?r.fillFrontOfficeStatus(t.filters,t.selectedEntityDetails.filter_values):"HOUSEKEEPING_STATUS"===s.value?r.fillHouseKeepingStatus(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"ADDON_GROUPS"===s.value?r.fillAddonGroups(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"SHOW_EMPLOYEES"===s.value?t.filters.hasUsers={title:t.selectedEntityDetails.report.title===o.RESERVATIONS_BY_USER?"Users":"Employees",data:x(),options:{selectAll:!0,hasSearch:!0,key:"full_name",altKey:"email"}}:"SHOW_DELETED_CHARGES"===s.value||"SHOW_ADJUSTMENTS"===s.value?(t.filters.hasChargeTypes||(t.filters.hasChargeTypes={data:[],options:{selectAll:!0,hasSearch:!1,key:"description"}}),t.filters.hasChargeTypes.data.push({paramKey:s.value.toLowerCase(),description:s.description,selected:!0})):O.indexOf(s.value)>-1&&t.selectedEntityDetails.report.title!==o.IN_HOUSE_GUEST?e(s):"GROUP_COMPANY_TA_CARD"===s.value?t.filters.hasIncludeCompanyTaGroup=s:"RATE_CODE"===s.value?r.fillRateCodesList(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"ROOM_TYPE"===s.value?r.fillRoomTypes(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"CHOOSE_SEGMENT"===s.value?r.fillSegments(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"INCLUDE_GUARANTEE_TYPE"===s.value?r.fillGuaranteeTypes(t.filters,t.selectedEntityDetails.filter_values,t.selectedEntityDetails.report.title):"CREATE_DATE_RANGE"===s.value?(t.creationDateTimePeriods=a.getScheduleReportTimePeriods(t.selectedEntityDetails.report.title+":"+s.value),t.creationDateTimePeriods=V(t.creationDateTimePeriods)):"ARRIVAL_DATE_RANGE"===s.value||"DATE_RANGE"===s.value?(t.arrivalDateTimePeriods=a.getScheduleReportTimePeriods(t.selectedEntityDetails.report.title+":"+s.value),t.arrivalDateTimePeriods=V(t.arrivalDateTimePeriods)):"EMPLOYEE"===s.value?r.fillEmployeeList(t.filters,t.selectedEntityDetails.filter_values):"ADJUSTMENT_DATE_RANGE"===s.value?(t.adjustmentDateTimePeriods=a.getScheduleReportTimePeriods(t.selectedEntityDetails.report.title+":"+s.value),t.adjustmentDateTimePeriods=V(t.adjustmentDateTimePeriods)):"INCLUDE_DAY_USE"===s.value?(t.filters.hasDayUseFilter=!0,t.filters.include_day_use=!1):"AGING_BALANCE"===s.value?r.fillAgingBalances(t.filters,t.selectedEntityDetails.filter_values):"ACCOUNT_NAME"===s.value?r.fillAccountNames(t.filters,t.selectedEntityDetails.filter_values):"TRANSACTION_CATEGORY"===s.value?r.fillTransactionCategory(t.filters,t.selectedEntityDetails.filter_values):"SHOW_EMPLOYEES_INCLUDING_EOD"===s.value?r.fillEmployees(t.filters,t.selectedEntityDetails.filter_values):"PAYMENT_TYPES"===s.value?r.fillPaymentTypes(t.filters,t.selectedEntityDetails.filter_values):"EXPANDED_OR_COLLAPSED"===s.value?r.fillCollapsedOrExpanded(t.filters,t.selectedEntityDetails.filter_values):"CANCELATION_DATE_RANGE"===s.value&&(t.cancellationDateTimePeriods=a.getScheduleReportTimePeriods(t.selectedEntityDetails.report.title+":"+s.value),t.cancellationDateTimePeriods=V(t.cancellationDateTimePeriods))});var s=a.getScheduleReportTimePeriods(t.selectedEntityDetails.report.title);t.scheduleTimePeriods=V(s),t.selectedEntityDetails.group_fields&&t.selectedEntityDetails.group_fields.length&&(t.selectedEntityDetails.group_fields=_.reject(t.selectedEntityDetails.group_fields,{value:"BLANK"})),H(),v()},W=function(e){var a=_.find(t.filters.hasChargeTypes.data,{paramKey:e});a.selected=!0,t.filters.hasChargeTypes.options.selectAll=2===t.filters.hasChargeTypes.data.filter(function(e){return e.selected}).length},K=function(e){e||(t.filters.hasDisplay.options.selectAll=!1,_.map(t.filters.hasDisplay.data,function(e){e.selected=!1}),t.filters.hasShow.options.selectAll=!1,_.map(t.filters.hasShow.data,function(e){e.selected=!1})),!e&&t.filters.hasChargeTypes&&(t.filters.hasChargeTypes.data=t.filters.hasChargeTypes.data.map(function(e){return e.selected=!1,e})),!_.isEmpty(t.selectedEntityDetails.filter_values)&&t.filters.hasGeneralOptions.data.length>0&&(t.filters.hasGeneralOptions.data=t.filters.hasGeneralOptions.data.map(function(e){return e.selected=!1,e})),_.each(t.selectedEntityDetails.filter_values,function(e,a){var r,n;if(n=a.toUpperCase(),b[n]&&e&&(r=_.find(t.filters.hasGeneralOptions.data,{paramKey:a}),angular.isDefined(r)&&(r.selected=!0)),F[e]&&(t.scheduleParams.sort_field=e),Y[n]&&e)r=_.find(t.filters.hasDisplay.data,{paramKey:a}),angular.isDefined(r)&&(r.selected=!0);else if(a===s.SHOW_ACTIONABLES)2===e.length?t.filters.showActionables="BOTH":t.filters.showActionables=e[0];else if(a===s.COMPLETION_STATUS)t.filters.hasCompletionStatus.data=t.filters.hasCompletionStatus.data.map(function(t){return t.selected=!1,e.indexOf(t.id)>-1&&(t.selected=!0),t}),t.filters.hasCompletionStatus.options.selectAll=t.filters.hasCompletionStatus.data.length===e.length;else if(a===s.USER_IDS&&e.length>0&&t.filters.hasUsers){var o=[],i=x();i.forEach(function(t){t.selected=!1,e.indexOf(t.id)>-1&&(t.selected=!0),o.push(t)}),t.filters.hasUsers.data=o,t.filters.hasUsers.options.selectAll=o.length===e.length}else if(O.indexOf(n)>-1){var l=_.find(t.filters.hasShow.data,{paramKey:a});l&&(l.selected=!0),t.filters.hasShow.options.selectAll=t.filters.hasShow.data.filter(function(e){return e.selected}).length===t.filters.hasShow.data.length}else"SHOW_ADJUSTMENTS"===n||"SHOW_DELETED_CHARGES"===n?W(a):a===s.GROUP_COMPANY_TA_CARD?(t.selectedEntityDetails.uiChosenIncludeCompanyTaGroup=e,t.selectedEntityDetails.chosenIncludeCompanyTaGroupType=t.selectedEntityDetails.filter_values[s.ENTITY_TYPE],t.selectedEntityDetails.uiChosenIncludeCompanyTaGroup=t.selectedEntityDetails.filter_values[s.ENTITY_NAME]):w[a.toUpperCase()]?t.scheduleParams.groupBy=w[a.toUpperCase()]:"CREATE_DATE_RANGE"!==n&&"ARRIVAL_DATE_RANGE"!==n&&"ADJUSTMENT_DATE_RANGE"!==n&&"DATE_RANGE"!==n&&"CANCELATION_DATE_RANGE"!==n||(t.scheduleParams[a]=e)}),v()},j=function(a){var s,n=30,i={dateFormat:e.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(){angular.element("#ui-datepicker-div"),angular.element('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div")},onClose:function(){angular.element("#ui-datepicker-div"),angular.element("#ui-datepicker-overlay").remove()}},l=t.selectedEntityDetails.starts_on||e.businessDate,c=t.selectedEntityDetails.ends_on_date||e.businessDate;if(t.creationDateTimePeriods=[],t.arrivalDateTimePeriods=[],t.adjustmentDateTimePeriods=[],t.cancellationDateTimePeriods=[],t.scheduleTimePeriods=[],t.scheduleParams={},t.isYearlyTaxReport=t.selectedEntityDetails.report.title===o.YEARLY_TAX,t.isForecastReport=t.selectedEntityDetails.report.title===o.FORECAST_BY_DATE,t.isReservationsByUserReport=t.selectedEntityDetails.report.title===o.RESERVATIONS_BY_USER,t.isRoomStatusReport=t.selectedEntityDetails.report.title===o.ROOM_STATUS_REPORT,t.isRateAdjustmentReport=t.selectedEntityDetails.report.title===o.RATE_ADJUSTMENTS_REPORT,t.isOccupancyRevenueSummaryReport=t.selectedEntityDetails.report.title===o.OCCUPANCY_REVENUE_SUMMARY,t.isCancellationNoShowReport=t.selectedEntityDetails.report.title===o.CANCELLATION_NO_SHOW,t.scheduleParams.format_id=null,angular.isDefined(t.selectedEntityDetails.schedule_formats))t.schedule_formats=t.selectedEntityDetails.schedule_formats,t.scheduleParams.format_id=t.selectedEntityDetails.format.id;else if(t.isYearlyTaxReport||t.selectedEntityDetails.report.title===o.BUSINESS_ON_THE_BOOKS)t.scheduleParams.format_id=_.find(t.scheduleFormat,{value:"CSV"}).id;else if(t.selectedEntityDetails.report.title===o.ARRIVAL||t.selectedEntityDetails.report.title===o.DEPARTURE||t.selectedEntityDetails.report.title===o.IN_HOUSE_GUEST){var u=_.find(t.scheduleFormat,{value:"PDF"});u||(u=_.find(m,{value:"PDF"})),u&&(t.scheduleParams.format_id=u.id)}t.isYearlyTaxReport&&(t.scheduleParams.year=moment().format("YYYY")),s=_.find(a.filters,function(e){return"ACCOUNT"===e.value||"GUEST"===e.value}),angular.isDefined(s)?(t.scheduleParams.time_period_id=_.find(t.originalScheduleTimePeriods,{value:"ALL"}).id,t.isGuestBalanceReport=!0):t.isYearlyTaxReport||t.isCreditCheckReport||t.isRoomStatusReport?t.scheduleParams.time_period_id=_.find(t.originalScheduleTimePeriods,{value:"ALL"}).id:angular.isDefined(t.selectedEntityDetails.time_period_id)?t.scheduleParams.time_period_id=t.selectedEntityDetails.time_period_id:t.scheduleParams.time_period_id=void 0,angular.isDefined(t.selectedEntityDetails.time)?t.scheduleParams.time=t.selectedEntityDetails.time:t.scheduleParams.time=void 0,angular.isDefined(t.selectedEntityDetails.frequency_id)?t.scheduleParams.frequency_id=t.selectedEntityDetails.frequency_id:t.scheduleParams.frequency_id=void 0,angular.isDefined(t.selectedEntityDetails.repeats_every)?t.scheduleParams.repeats_every=t.selectedEntityDetails.repeats_every:t.scheduleParams.repeats_every=void 0,null!==t.selectedEntityDetails.ends_on_date&&null===t.selectedEntityDetails.ends_on_after?t.scheduleParams.scheduleEndsOn="DATE":null===t.selectedEntityDetails.ends_on_date&&null!==t.selectedEntityDetails.ends_on_after?(t.scheduleParams.ends_on_after=t.selectedEntityDetails.ends_on_after,t.scheduleParams.scheduleEndsOn="NUMBER"):t.scheduleParams.scheduleEndsOn="NEVER",t.startsOnOptions=angular.extend({minDate:tzIndependentDate(e.businessDate),onSelect:function(e){t.endsOnOptions.minDate=e,t.scheduleParams.ends_on_date<t.scheduleParams.starts_on&&(t.scheduleParams.ends_on_date=t.scheduleParams.starts_on)}},i),t.scheduleParams.starts_on=r.processDate(l).today,t.endsOnOptions=angular.extend({onSelect:function(e){t.startsOnOptions.maxDate=e}},i),t.scheduleParams.ends_on_date=r.processDate(c).today,t.scheduleParams.delivery_id=t.selectedEntityDetails.delivery_type?t.selectedEntityDetails.delivery_type.value:null,"CLOUD_DRIVE"===t.scheduleParams.delivery_id&&(t.scheduleParams.delivery_id=t.selectedEntityDetails.cloud_drive_type),"EMAIL"===t.scheduleParams.delivery_id?t.emailList=t.selectedEntityDetails.emails.split(", "):"SFTP"===t.scheduleParams.delivery_id?t.scheduleParams.selectedFtpRecipient=t.selectedEntityDetails.sftp_server_id:"GOOGLE DRIVE"!==t.scheduleParams.delivery_id&&"DROPBOX"!==t.scheduleParams.delivery_id||(t.scheduleParams.selectedCloudAccount=t.selectedEntityDetails.cloud_drive_id),t.selectedEntityDetails.filter_values&&t.isYearlyTaxReport&&(t.scheduleParams.year=t.selectedEntityDetails.filter_values.year,t.scheduleParams.with_vat_number=t.selectedEntityDetails.filter_values.with_vat_number,t.scheduleParams.without_vat_number=t.selectedEntityDetails.filter_values.without_vat_number),t.selectedEntityDetails.filter_values&&t.isOccupancyRevenueSummaryReport&&(t.scheduleParams.include_day_use=t.selectedEntityDetails.filter_values.include_day_use),t.timeSlots=r.createTimeSlots(n),t.scheduleParams.includeTitleHeader=t.selectedEntityDetails.include_title_header,t.selectedEntityDetails.report.title===o.FINANCIAL_TRANSACTION_REVENUE_REPORT||t.selectedEntityDetails.report.title===o.FINANCIAL_TRANSACTION_PAYMENT_REPORT?(t.fromDateOptions=angular.extend({maxDate:tzIndependentDate(e.businessDate),onSelect:function(e){t.untilDateOptions.minDate=e}},i),t.untilDateOptions=angular.extend({maxDate:tzIndependentDate(e.businessDate),onSelect:function(e){t.fromDateOptions.maxDate=e}},i),p.init(t.selectedEntityDetails.report),t.selectedEntityDetails.from_date&&t.selectedEntityDetails.to_date&&(t.selectedEntityDetails.report.fromDate=t.selectedEntityDetails.from_date,t.selectedEntityDetails.report.untilDate=t.selectedEntityDetails.to_date)):t.selectedEntityDetails.report.title===o.FINANCIAL_TRANSACTION_SUMMARY_REPORT&&(t.dateOptions=angular.extend({maxDate:tzIndependentDate(e.businessDate)},i),p.init(t.selectedEntityDetails.report),t.selectedEntityDetails.from_date&&(t.selectedEntityDetails.report.singleValueDate=t.selectedEntityDetails.from_date))},J=function(){var e=function(e){var a,r=!0,s=function(e){switch(e){case"DAILY":return"Day";case"HOURLY":return"Hour";case"WEEKLY":return"Week";case"MONTHLY":return"Month";default:return"Per"}};t.originalScheduleTimePeriods=e.scheduleTimePeriods,t.originalScheduleFrequency=e.scheduleFrequency,t.dateRangeTimePeriodId=_.filter(t.originalScheduleTimePeriods,function(e){return"DATE_RANGE"===e.value})[0].id,t.dateTimePeriodId=_.find(t.originalScheduleTimePeriods,{value:"DATE"}).id,E=_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"}).id,t.scheduleFormat=e.scheduleFormat,m=dclone(e.scheduleFormat),t.$parent.$parent.schedulesList=[],t.$parent.$parent.schedulableReports=[],t.CSV_FORMAT_ID=_.find(t.scheduleFormat,{value:"CSV"}).id,t.$parent.$parent.schedulesList=_.sortBy(e.schedulesList,function(e){return e.report.title}),_.each(t.$parent.$parent.schedulesList,function(e){e.filteredOut=!1,e.occurance=g(e)}),_.each(e.schedulableReports,function(e){a=_.find(t.$parent.$parent.reportList,{id:e}),angular.isDefined(a)&&(d.init(a),t.$parent.$parent.schedulableReports.push({id:a.id,filters:a.filters,sort_fields:a.sort_fields,group_fields:a.group_fields,report:{id:a.id,description:a.description,title:a.title},reportIconCls:a.reportIconCls,active:!1,filteredOut:!1}))}),t.$parent.$parent.schedulableReports=_.sortBy(t.$parent.$parent.schedulableReports,function(e){return e.report.title}),t.originalScheduleFreqType=_.map(t.originalScheduleFrequency,function(e){return{id:e.id,value:s(e.value),originalValue:e.value}}),_.each(t.$parent.$parent.schedulesList,function(e){angular.isDefined(G[e.report.description])&&(e.reportIconCls=G[e.report.description])}),t.scheduleDeliveryTypes=e.scheduleDeliveryTypes,t.ftpServerList=e.ftpServerList,t.dropBoxAccountList=e.dropBoxAccounts,t.googleDriveAccountList=e.googleDriveAccounts,t.refreshReportSchedulesScroll(r),t.$emit("hideLoader")},r=function(e){t.errors=e,t.$emit("hideLoader")};t.invokeApi(a.reportSchedulesPayload,{},e,r)},X={SHOW_SCHEDULE_LIST:"SHOW_SCHEDULE_LIST",SHOW_PARAMETERS:"SHOW_PARAMETERS",SHOW_DETAILS:"SHOW_DETAILS",SHOW_DISTRIBUTION:"SHOW_DISTRIBUTION"};BaseCtrl.call(this,t),t.removeEmail=function(e){var a=!0;t.emailList=[].concat(t.emailList.slice(0,e),t.emailList.slice(e+1)),t.refreshFourthColumnScroll(a)},t.userAutoCompleteSimple={minLength:3,source:function(e,a){var r,s;r=_.map(t.activeUserList,function(e){return{label:e.full_name||e.email,value:e.email}}),s=$.ui.autocomplete.filter(r,e.term),a(s)},select:function(e,a){var r=!0,s=_.find(t.emailList,function(e){return e===a.item.value});return s||t.emailList.push(a.item.value),this.value="",v(),t.refreshFourthColumnScroll(r),!1},focus:function(){return!1}},t.userEmailTyped=function(){},t.pickSchedule=function(e,r){var s=function(a){t.selectedEntityDetails=a,t.touchedReport=t.selectedEntityDetails,t.isGuestBalanceReport=!1,t.isYearlyTaxReport=!1,t.isCreditCheckReport=!1,t.isForecastReport=!1,t.isOccupancyRevenueSummaryReport=!1,t.selectedEntityDetails.report.title===o.CREDIT_CHECK_REPORT&&(t.isCreditCheckReport=!0),t.selectedSchedule&&t.selectedSchedule.active&&(t.selectedSchedule.active=!1),t.selectedSchedule=t.$parent.$parent.schedulesList[r],t.selectedSchedule.active=!0,t.selectedReport.active=!1,t.addingStage=X.SHOW_DISTRIBUTION,t.updateViewCol(t.viewColsActions.FOUR),j(e),q(t.selectedEntityDetails),B(),K(!1),t.refreshAllOtherColumnScrolls(),t.$emit("hideLoader")},n=function(e){t.errors=e,t.$emit("hideLoader")},i={id:e.id};t.invokeApi(a.fetchOneSchedule,i,s,n)},t.check=function(){u.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDiscard.html",scope:t})};var q=function(a){var r=_.find(t.originalScheduleFrequency,{value:"DAILY"}),s=_.find(t.originalScheduleFreqType,{originalValue:"DAILY"}),n=_.find(t.originalScheduleFreqType,{originalValue:"WEEKLY"}),o=_.find(t.originalScheduleFreqType,{originalValue:"MONTHLY"}),i=_.find(t.originalScheduleFreqType,{originalValue:"HOURLY"}),l=_.find(t.originalScheduleFrequency,{value:"WEEKLY"}),c=_.find(t.originalScheduleFrequency,{value:"MONTHLY"}),u=_.find(t.originalScheduleFrequency,{value:"HOURLY"}),d=_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"});t.scheduleFrequency=[],t.scheduleFreqType=[];var p={Arrival:!0,Departure:!0,"In-House Guests":!0,Comparison:!0,"Guest Balance Report":!0,"Yearly Tax Report":!0,"Daily Production":!0,"Daily Production by Demographics":!0,"Daily Production by Rate":!0,"Business on the Books":!0,"Daily Transactions":!0,"Action Manager":!0,"Financial Transactions - Adjustment Report":!0,"Credit Check Report":!0,Forecast:!0,"Reservations By User":!0,"Room Status Report":!0,"Rate Adjustment Report":!0,"Occupancy & Revenue Summary":!0,"Rooms OOO/OOS":!0,"Deposit Balance Summary":!0,"Add-On Forecast":!0,"Forecast Guests & Groups":!0,"Market Segment Statistics Report":!0,"A/R Aging":!0,"Complimentary Room Report":!0,"Cancellation & No Show":!0,"Financial Transaction - Revenue Report":!0,"Financial Transaction - Payment Report":!0,"Financial Transaction - Summary Report":!0},h={Arrival:!0,
Departure:!0,"In-House Guests":!0,Comparison:!0,"Guest Balance Report":!0,"Yearly Tax Report":!0,"Business on the Books":!0,"Daily Transactions":!0,"Action Manager":!0,"Financial Transactions - Adjustment Report":!0,"Credit Check Report":!0,Forecast:!0,"Reservations By User":!0,"Room Status Report":!0,"Rate Adjustment Report":!0,"Occupancy & Revenue Summary":!0,"Rooms OOO/OOS":!0,"Deposit Balance Summary":!0,"Add-On Forecast":!0,"Forecast Guests & Groups":!0,"A/R Aging":!0,"Complimentary Room Report":!0,"Cancellation & No Show":!0,"Financial Transaction - Revenue Report":!0,"Financial Transaction - Payment Report":!0,"Financial Transaction - Summary Report":!0},E={Arrival:!0,Departure:!0,"In-House Guests":!0,Comparison:!0,"Guest Balance Report":!0,"Yearly Tax Report":!0,"Business on the Books":!0,"Daily Transactions":!0,"Action Manager":!0,"Financial Transactions - Adjustment Report":!0,"Credit Check Report":!0,Forecast:!0,"Reservations By User":!0,"Room Status Report":!0,"Rate Adjustment Report":!0,"Occupancy & Revenue Summary":!0,"Rooms OOO/OOS":!0,"Deposit Balance Summary":!0,"Add-On Forecast":!0,"Forecast Guests & Groups":!0,"A/R Aging":!0,"Complimentary Room Report":!0,"Cancellation & No Show":!0,"Financial Transaction - Revenue Report":!0,"Financial Transaction - Payment Report":!0,"Financial Transaction - Summary Report":!0},R={Arrival:!0,Departure:!0,"In-House Guests":!0,Comparison:!0,"Guest Balance Report":!0,"Yearly Tax Report":!0,"Business on the Books":!0,"Credit Check Report":!0,Forecast:!0,"Reservations By User":!0,"Room Status Report":!0,"Rate Adjustment Report":!0,"Occupancy & Revenue Summary":!0,"Rooms OOO/OOS":!0,"Deposit Balance Summary":!0,"Add-On Forecast":!0,"Forecast Guests & Groups":!0,"A/R Aging":!0,"Complimentary Room Report":!0,"Cancellation & No Show":!0};R[a.report.title]&&(t.scheduleFrequency.push(u),t.scheduleFreqType.push(i)),p[a.report.title]&&(t.scheduleFrequency.push(r),t.scheduleFreqType.push(s)),h[a.report.title]&&(t.scheduleFrequency.push(l),t.scheduleFreqType.push(n)),E[a.report.title]&&(t.scheduleFrequency.push(c),t.scheduleFreqType.push(o)),e.isStandAlone&&t.scheduleFrequency.push(d)};t.pickReport=function(e,a){t.selectedEntityDetails=t.$parent.$parent.schedulableReports[a],t.touchedReport=t.selectedEntityDetails,t.isGuestBalanceReport=!1,t.isCreditCheckReport=!1,t.isYearlyTaxReport=!1,t.isForecastReport=!1,t.isOccupancyRevenueSummaryReport=!1,t.selectedEntityDetails.report.title===o.CREDIT_CHECK_REPORT&&(t.isCreditCheckReport=!0),t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.selectedReport=t.$parent.$parent.schedulableReports[a],t.selectedReport.active=!0,t.selectedSchedule.active=!1,t.addingStage=X.SHOW_PARAMETERS,t.updateViewCol(t.viewColsActions.TWO),j(e),q(t.selectedEntityDetails),B(),K(!0),t.refreshAllOtherColumnScrolls()},t.getRepeatPer=function(){var e=_.find(t.scheduleFreqType,{id:t.scheduleParams.frequency_id});return e?e.value:"Per"},t.checkCanCreateSchedule=function(){C()?U():(N(),u.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:t}))},t.checkCanSaveSchedule=function(){C()?M():(N(),u.open({template:"/assets/partials/reports/scheduleReport/rvCantCreateSchedule.html",scope:t}))},t.confirmDelete=function(){u.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDeleteSchedule.html",scope:t})},t.deleteSchedule=function(){var e=function(){t.errorMessage="",t.$emit("hideLoader"),t.selectedReport&&t.selectedReport.active&&(t.selectedReport.active=!1),t.updateViewCol(t.viewColsActions.ONE),t.addingStage=X.SHOW_SCHEDULE_LIST,J()},r=function(e){t.errorMessage=e,t.$emit("hideLoader")};t.closeDialog(),t.invokeApi(a.deleteSchedule,{id:t.selectedEntityDetails.id},e,r)},t.refreshReportSchedulesScroll=function(e){y(R,e)},t.refreshSecondColumnScroll=function(e){y(f,e)},t.refreshThirdColumnScroll=function(e){y(T,e)},t.refreshFourthColumnScroll=function(e){y(S,e)},t.refreshAllOtherColumnScrolls=function(){var e=!0;t.refreshSecondColumnScroll(e),t.refreshThirdColumnScroll(e),t.refreshFourthColumnScroll(e)},t.scheduleReport=function(){var e=!0;t.isAddingNew=!0,t.selectedSchedule.active=!1,t.updateView(t.reportViewActions.SHOW_SCHEDULE_A_REPORT),t.updateViewCol(t.viewColsActions.ONE),t.refreshReportSchedulesScroll(e),t.addingStage=X.SHOW_SCHEDULE_LIST,t.$emit("UPDATE_TITLE_AND_HEADING")},t.checkCanCancel=function(){t.selectedReport&&t.selectedReport.active?u.open({template:"/assets/partials/reports/scheduleReport/rvConfirmDiscard.html",scope:t}):t.cancelScheduleReport()},t.cancelScheduleReport=function(){var e=!0;t.isAddingNew=!1,t.addingStage=X.SHOW_SCHEDULE_LIST,t.selectedReport.active=!1,t.updateView(t.reportViewActions.SHOW_SCHEDULED_REPORTS),t.updateViewCol(t.viewColsActions.ONE),t.refreshReportSchedulesScroll(e),t.closeDialog()},t.goToNext=function(){var e=!0,a=!0;t.addingStage===X.SHOW_PARAMETERS?(t.addingStage=X.SHOW_DETAILS,t.updateViewCol(t.viewColsActions.THREE,e),t.refreshThirdColumnScroll(a)):t.addingStage===X.SHOW_DETAILS&&(t.addingStage=X.SHOW_DISTRIBUTION,t.updateViewCol(t.viewColsActions.FOUR,e),t.refreshFourthColumnScroll(a)),t.scrollToLast()},t.shouldHideParametersCol=function(){return t.addingStage===X.SHOW_SCHEDULE_LIST},t.shouldHideDetailsCol=function(){return t.addingStage===X.SHOW_SCHEDULE_LIST||t.addingStage===X.SHOW_PARAMETERS},t.shouldHideDistributionCol=function(){return t.addingStage===X.SHOW_SCHEDULE_LIST||t.addingStage===X.SHOW_PARAMETERS||t.addingStage===X.SHOW_DETAILS},t.shouldShowFileFormat=function(e){return e.report&&e.report.title===o.COMPARISION_BY_DATE?t.scheduleFormat=_.filter(m,function(e){return"XML"!==e.value}):!e.report||e.report.title!==o.DAILY_PRODUCTION_ROOM_TYPE&&e.report.title!==o.DAILY_PRODUCTION_DEMO&&e.report.title!==o.DAILY_PRODUCTION_RATE&&e.report.title!==o.DAILY_TRANSACTIONS&&e.report.title!==o.RESERVATIONS_BY_USER&&e.report.title!==o.ROOM_STATUS_REPORT&&e.report.title!==o.OCCUPANCY_REVENUE_SUMMARY&&e.report.title!==o.ADDON_FORECAST&&e.report.title!==o.COMPLIMENTARY_ROOM_REPORT&&e.report.title!==o.FINANCIAL_TRANSACTION_REVENUE_REPORT&&e.report.title!==o.FINANCIAL_TRANSACTION_PAYMENT_REPORT&&e.report.title!==o.FINANCIAL_TRANSACTION_SUMMARY_REPORT?!e.report||e.report.title!==o.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT&&e.report.title!==o.ROOMS_OOO_OOS&&e.report.title!==o.GUEST_BALANCE_REPORT&&e.report.title!==o.DEPOSIT_SUMMARY&&e.report.title!==o.FORECAST_BY_DATE&&e.report.title!==o["A/R_AGING"]&&e.report.title!==o.ACTIONS_MANAGER&&e.report.title!==o.CANCELLATION_NO_SHOW&&e.report.title!==o.MARKET_SEGMENT_STAT_REPORT&&e.report.title!==o.RATE_ADJUSTMENTS_REPORT&&e.report.title!==o.FORECAST_GUEST_GROUPS&&e.report.title!==o.CREDIT_CHECK_REPORT&&e.report.title!==o.ALLOWANCE_FORECAST||(t.scheduleFormat=_.filter(m,function(e){return"CSV"===e.value||"PDF"===e.value})):t.scheduleFormat=_.filter(m,function(e){return"CSV"===e.value}),e.report&&(e.report.title===o.COMPARISION_BY_DATE||e.report.title===o.DAILY_PRODUCTION_ROOM_TYPE||e.report.title===o.DAILY_PRODUCTION_DEMO||e.report.title===o.DAILY_PRODUCTION_RATE||e.report.title===o.DAILY_TRANSACTIONS||e.report.title===o.GUEST_BALANCE_REPORT||e.report.title===o.FINANCIAL_TRANSACTIONS_ADJUSTMENT_REPORT||e.report.title===o.ACTIONS_MANAGER||e.report.title===o.CREDIT_CHECK_REPORT||e.report.title===o.FORECAST_BY_DATE||e.report.title===o.RESERVATIONS_BY_USER||e.report.title===o.ROOM_STATUS_REPORT||e.report.title===o.RATE_ADJUSTMENTS_REPORT||e.report.title===o.ROOMS_OOO_OOS||e.report.title===o.DEPOSIT_SUMMARY||e.report.title===o.OCCUPANCY_REVENUE_SUMMARY||e.report.title===o.ADDON_FORECAST||e.report.title===o.FORECAST_GUEST_GROUPS||e.report.title===o.MARKET_SEGMENT_STAT_REPORT||e.report.title===o["A/R_AGING"]||e.report.title===o.COMPLIMENTARY_ROOM_REPORT||e.report.title===o.CANCELLATION_NO_SHOW||e.report.title===o.FINANCIAL_TRANSACTION_REVENUE_REPORT||e.report.title===o.FINANCIAL_TRANSACTION_PAYMENT_REPORT||e.report.title===o.FINANCIAL_TRANSACTION_SUMMARY_REPORT||e.report.title===o.ALLOWANCE_FORECAST)};var z=t.$on("CREATE_NEW_REPORT_SCHEDULE",function(){t.scheduleReport()});t.$on("$destroy",z),t.addListener("RESET_CURRENT_STAGE",function(){t.addingStage=X.SHOW_SCHEDULE_LIST}),t.onDeliveryOptionChange=function(){t.scheduleParams.selectedCloudAccount=null},t.checkDeliveryType=function(e){return e===t.scheduleParams.delivery_id},t.shallDisableRepeatsEvery=function(){return t.originalScheduleFrequency&&t.scheduleParams.frequency_id===_.find(t.originalScheduleFrequency,{value:"RUN_DURING_EOD"}).id},h()}]),angular.module("sntRover").controller("RVTaxOutputReportCtrl",["$scope","$timeout","RVreportsSubSrv",function(e,t,a){BaseCtrl.call(this,e);var r,s="report-details-scroll",n=function(){t(function(){e.refreshScroller(s),e.myScroll[s].scrollTo(0,0,100)},1e3)},o=function(t){e.results=_.each(e.results,function(e){return e.sub_category_type_id===r&&(e.receipt_details=t),e}),n()};e.addListener("updateReceipts",function(t,s){r=s.receipt_sub_category_type_id,e.callAPI(a.getReceiptsOfCategories,{params:s,onSuccess:o})}),e.addListener("UPDATE_TAX_OUTPUT_RESULTS",function(t,a){e.results=a,n()});var i=function(){var t={nonVatableSum:0,vatableSum:0,vatSum:0,totalAggregate:0};return _.each(e.results,function(e){t.nonVatableSum+=parseFloat(e.sub_category_total.sub_category_non_vatable_sum),t.vatableSum+=parseFloat(e.sub_category_total.sub_category_vatable_sum),t.vatSum+=parseFloat(e.sub_category_total.sub_category_vat_sum),t.totalAggregate+=parseFloat(e.sub_category_total.sub_category_total_aggregate)}),t};e.calculateNonVatGrandTotal=function(){return parseFloat(i().nonVatableSum).toFixed(2)},e.calculateVatableAmountGrandTotal=function(){return parseFloat(i().vatableSum).toFixed(2)},e.calculateVatGrandTotal=function(){return parseFloat(i().vatSum).toFixed(2)},e.calculateGrandTotal=function(){return parseFloat(i().totalAggregate).toFixed(2)},n()}]),angular.module("sntRover").controller("RVTravelAgentsCommissionReportCtrl",["$scope","RVReportParserFac","$timeout","RVReportMsgsConst","RVreportsSubSrv",function(e,t,a,r,s){var n,o="report-details-scroll",i=function(){a(function(){e.refreshScroller(o),e.myScroll[o].scrollTo(0,0,100)},1e3)},l=function(t){e.results=_.each(e.results,function(a){return e.$emit("hideLoader"),a.travel_agent_id===n&&(a.reservation_details=t),a}),i()};e.$on("updateReservations",function(t,a){n=a.travel_agent_id,e.invokeApi(s.getReservationsOfTravelAgents,a,l)}),e.$on("UPDATE_RESULTS",function(t,a){e.results=a,i()}),i()}]);var DailyProductionAvailabilityToggle=React.createClass({displayName:"DailyProductionAvailabilityToggle",toggleTheAvailability:function(){var e=this.props.toggleAvailability;setTimeout(function(){e()},0)},componentDidMount:function(){ReactDOM.findDOMNode(this).addEventListener("click",this.toggleTheAvailability),ReactDOM.findDOMNode(this).checked=this.props.header.showAvailable},componentDidUpdate:function(){ReactDOM.findDOMNode(this).checked=this.props.header.showAvailable},render:function(){return React.DOM.div({className:"switch-button "+(this.props.header.showAvailable?"on":"disabled"),id:"report-availability-toggle-parent"},React.DOM.input({name:"report-toggle",id:"report-availability-toggle",type:"checkbox"}),React.DOM.label({className:"data-off"},React.DOM.span({className:"value"},"Availability"),React.DOM.span({className:"switch-icon"},"Hidden")),React.DOM.label({className:"data-on"},React.DOM.span({className:"value"},"Availability"),React.DOM.span({className:"switch-icon"},"Showing")))}}),DailyProductionLeftSide=React.createClass({displayName:"DailyProductionLeftSide",componentDidMount:function(){var e=this.props.scroll.left=new IScroll($("#stats-report-heading-scroll")[0],{probeType:3,scrollbars:"custom",scrollX:!1,scrollY:!0,mouseWheel:!0,useTransition:!0,interactiveScrollbars:!0});setTimeout(function(){e.refresh()},150)},componentDidUpdate:function(){var e=this.props.scroll.left;setTimeout(function(){e.refresh()},150)},render:function(){return React.DOM.div({className:"statistics-headings",id:"stats-report-heading"},React.DOM.div({className:"scrollable",id:"stats-report-heading-scroll"},React.createElement(DailyProductionListDemographics,{data:this.props.data.listing,header:this.props.header,toggleRevenue:this.props.toggleRevenue,toggleAvailability:this.props.toggleAvailability})))}}),DailyProductionListDemographics=React.createClass({displayName:"DailyProductionListDemographics",render:function(){return React.DOM.ul({className:"wrapper"},React.DOM.li({className:"main-heading action-row"},React.createElement(DailyProductionRevenueToggle,{header:this.props.header,toggleRevenue:this.props.toggleRevenue}),React.createElement(DailyProductionAvailabilityToggle,{header:this.props.header,toggleAvailability:this.props.toggleAvailability})),_.map(this.props.data,function(e,t){var a=React.DOM.em({},e.displayLabel);return e.showInBold&&(a=React.DOM.strong({},e.displayLabel)),React.DOM.li({},a)}))}}),DailyProductionRevenueToggle=React.createClass({displayName:"DailyProductionRevenueToggle",toggleTheRevenue:function(){var e=this.props.toggleRevenue;setTimeout(function(){e()},0)},componentDidMount:function(){ReactDOM.findDOMNode(this).addEventListener("click",this.toggleTheRevenue),ReactDOM.findDOMNode(this).checked=this.props.header.showRevenue},componentWillUnmount:function(){ReactDOM.findDOMNode(this).removeEventListener("click",this.toggleTheRevenue)},componentDidUpdate:function(){ReactDOM.findDOMNode(this).checked=this.props.header.showRevenue},render:function(){return React.DOM.div({className:"switch-button "+(this.props.header.showRevenue?"on":"disabled"),id:"report-revenue-toggle-parent"},React.DOM.input({name:"report-toggle",id:"report-availability-toggle",type:"checkbox"}),React.DOM.label({className:"data-off"},React.DOM.span({className:"value"},"Revenue"),React.DOM.span({className:"switch-icon"},"Hidden")),React.DOM.label({className:"data-on"},React.DOM.span({className:"value"},"Revenue"),React.DOM.span({className:"switch-icon"},"Showing")))}}),DailyProductionRightSide=React.createClass({displayName:"DailyProductionRightSide",componentDidMount:function(){$("#stats-report-content .wrapper")[0].style.width=110*this.props.header.colspan*this.props.data.dates.length+"px";var e=this.props.scroll.right=new IScroll($("#stats-report-content")[0],{probeType:3,scrollbars:"custom",interactiveScrollbars:!0,scrollX:!0,scrollY:!0,mouseWheel:!0,useTransition:!0});setTimeout(function(){e.refresh()},150)},componentDidUpdate:function(){$("#stats-report-content .wrapper")[0].style.width=110*this.props.header.colspan*this.props.data.dates.length+"px";var e=this.props.scroll.right;setTimeout(function(){e.refresh()},150)},render:function(){return React.DOM.div({id:"stats-report-content",className:"statistics-content scrollable"},React.DOM.div({className:"wrapper"},React.createElement(DailyProductionByDemographicsTable,{data:this.props.data,header:this.props.header,businessDate:this.props.businessDate})))}}),DailyProductionByDemographics=React.createClass({displayName:"DailyProductionByDemographics",toggleRevenue:function(){var e=this.state.header;e.showRevenue=!e.showRevenue,e.showRevenue?e.colspan=e.colspan+8:(e.colspan=5,e.showAvailable=!0),this.props.startedRendering(),setTimeout(function(){this.setState({header:e})}.bind(this),20)},toggleAvailability:function(){var e=this.state.header;e.showAvailable=!e.showAvailable,e.showAvailable?e.colspan=e.colspan+2:(e.colspan=11,e.showRevenue=!0),this.props.startedRendering(),setTimeout(function(){this.setState({header:e})}.bind(this),20)},componentWillReceiveProps:function(e){var t={};t.data=e.data,t.header=this.getInitialState().header,this.props.startedRendering(),setTimeout(function(){this.setState(t)}.bind(this),50)},getInitialState:function(){var e={colspan:13,showAvailable:!0,showRevenue:!0},t={data:this.props.data,businessDate:this.props.businessDate,header:e,scroll:{left:null,right:null},toggleRevenue:this.toggleRevenue,toggleAvailability:this.toggleAvailability};return t},componentDidMount:function(){var e=this.state.scroll.left,t=this.state.scroll.right;e.on("scroll",function(){t.scrollTo(t.x,e.y)}),t.on("scroll",function(){e.scrollTo(e.x,t.y)}),this.props.completedRendering()},componentDidUpdate:function(){this.props.completedUpdating();var e=this.state.scroll.left,t=this.state.scroll.right;e.scrollTo(0,0),t.scrollTo(0,0)},componentWillUnmount:function(){var e=this.state.scroll.left,t=this.state.scroll.right;e.off("scroll"),t.off("scroll"),e.destroy(),t.destroy()},render:function(){return React.DOM.span({},React.createElement(DailyProductionLeftSide,this.state),React.createElement(DailyProductionRightSide,this.state))}}),DailyProductionByDemographicsTableHeader=React.createClass({displayName:"DailyProductionByDemographicsTableHeader",componentWillReceiveProps:function(e){this.setState(e)},render:function(){var e=this.props.header,t={dataCell:"colspan",colSpan:e.colspan},a=[React.DOM.th({className:e.showAvailable?"":"hidden",style:{whiteSpace:"nowrap"}},"Rooms#"),React.DOM.th({className:e.showAvailable?"":"hidden",style:{whiteSpace:"nowrap"}},"Avl. Rooms"),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Rate Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"ADR"),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Actual Rev."),React.DOM.th({style:{whiteSpace:"nowrap"}},"Arrivals"),React.DOM.th({style:{whiteSpace:"nowrap"}},"Adults"),React.DOM.th({style:{whiteSpace:"nowrap"}},"Children"),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Forecast F&B Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Actual F&B Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Forecast Other Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Actual Other Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Forecast Total Rev."),React.DOM.th({className:e.showRevenue?"":"hidden",style:{whiteSpace:"nowrap"}},"Actual Total Rev.")],r=[],s=[],n=new Date(this.props.businessDate);return _.map(this.props.data.dates,function(e,o){r.push(React.DOM.th(t,tzIndependentDate(e).toComponents().date.toShortDateString()));var i=a.slice();new Date(e)<new Date(n.getFullYear(),n.getMonth(),n.getDate())?i.splice(2,1):i.splice(4,1),s=s.concat(i)}),React.DOM.thead({},React.DOM.tr({},r),React.DOM.tr({className:"bottom-row"},s))}}),DailyProductionByDemographicsTableRows=React.createClass({displayName:"DailyProductionByDemographicsTableRows",componentWillReceiveProps:function(e){this.setState(e)},render:function(){var e="",t=13,a=this.props.header,r="",s=0,n=new Date(this.props.businessDate);a.showRevenue?a.showAvailable||(t-=2):t-=8;var o=_.map(this.props.data.listing,function(o,i){return React.DOM.tr({},_.map(o.valueList,function(i,l){return e="",(s+1)%t===0&&(e="day-end"),_.indexOf(["future_revenue","adr","rate_revenue","fnb_actual_revenue","fnb_future_revenue","others_actual_revenue","others_future_revenue","total_future_revenue","total_actual_revenue"],i.key)>=0&&!a.showRevenue?e+=" hidden":_.indexOf(["available","res_count"],i.key)>=0&&!a.showAvailable?e+=" hidden":s++,new Date(o)<new Date(n.getFullYear(),n.getMonth(),n.getDate())?"future_revenue"===i.key&&a.showRevenue&&(e+=" hidden",s--):"rate_revenue"===i.key&&a.showRevenue&&(e+=" hidden",s--),r=o.showInBold?React.DOM.strong({},i.value):i.value,React.DOM.td({className:e},r)}))});return React.DOM.tbody({},o)}}),DailyProductionByDemographicsTable=React.createClass({displayName:"DailyProductionByDemographicsTable",componentWillReceiveProps:function(e){this.setState(e)},render:function(){var e={header:this.props.header,data:this.props.data,businessDate:this.props.businessDate},t={header:this.props.header,data:this.props.data,businessDate:this.props.businessDate};return React.DOM.table({className:"statistics-reports"},React.createElement(DailyProductionByDemographicsTableHeader,e),React.createElement(DailyProductionByDemographicsTableRows,t))}}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DPthCell=function(e){return React.DOM.th({className:e.className,colSpan:e.colspan,style:{whiteSpace:"nowrap"}},e.data)};DPthCell.propTypes={className:React.PropTypes.string.isRequired,colspan:React.PropTypes.any.isRequired,data:React.PropTypes.any},DPthCell.defaultProps={className:"",colspan:1,data:"NA"};var DPHeadPanel=function(e){var t,a,r=[],s=[],n=React.DOM.th({className:"only-print"});return"Daily Production"===e.reportType&&(r.push(n),s.push(n)),e.headerTop.map(function(t,a){r.push(React.createElement(DPthCell,{colspan:e.colspanArray?e.colspanArray[a]:e.colspan,data:t.name}))}),e.headerBot.map(function(e){s.push(React.createElement(DPthCell,{className:e.cls,data:e.name}))}),t=React.DOM.tr({},r),a=React.DOM.tr({className:"bottom-row"},s),React.DOM.thead({},t,a)},DPtdCell=function(e){var t;return e.isLastRow||e.isBold?t="strong":e.isAvail?t="em":e.isRev&&(t="span"),React.DOM.td({className:e.className},React.DOM[t]({},e.data))};DPtdCell.propTypes={isLastRow:React.PropTypes.bool,isBold:React.PropTypes.bool,isAvail:React.PropTypes.bool,isRev:React.PropTypes.bool,data:React.PropTypes.any,className:React.PropTypes.string},DPtdCell.defaultProps={isRev:!0,data:"0",className:""};var DPBodyRow=function(e){var t=[];return"Daily Production"===e.reportType&&t.push(React.createElement(DPtdCell,{className:"only-print with-background",data:e.roomName,isLastRow:e.isLastRow})),e.rowData.map(function(a,r){t.push(React.createElement(DPtdCell,{isLastRow:e.isLastRow,isAvail:a.isAvail,isRev:a.isRev,className:a.cls,data:a.value,isBold:a.isRateType}))}),React.DOM.tr({},t)},DPBodyPanel=function(e){var t=e.reportData.length-1,a=[];return e.reportData.map(function(r,s){a.push(React.createElement(DPBodyRow,{rowData:r,isLastRow:e.isLastRowSum&&t===s,roomName:e.roomNames?e.roomNames[s]:"",reportType:e.reportType}))}),React.DOM.tbody({},a)},DPContent=React.createClass({displayName:"DPContent",componentDidMount:function(){_typeof(this.props.reactRenderDone)===_typeof(function(){})&&this.props.reactRenderDone(),document.getElementById("daily-production-render").style.width=this.props.rightPaneWidth},componentDidUpdate:function(){_typeof(this.props.reactRenderDone)===_typeof(function(){})&&this.props.reactRenderDone(),document.getElementById("daily-production-render").style.width=this.props.rightPaneWidth},render:function(){return React.DOM.table({className:"statistics-reports"},React.createElement(DPHeadPanel,{colspan:this.props.colspan,headerTop:this.props.headerTop,headerBot:this.props.headerBot,colspanArray:this.props.colspanArray,reportType:this.props.reportType}),React.createElement(DPBodyPanel,{reportData:this.props.reportData,isLastRowSum:this.props.isLastRowSum,roomNames:this.props.roomNames,reportType:this.props.reportType}))}});angular.module("numbersOnly",[]).directive("numbersOnly",function(){return{require:"ngModel",link:function(e,t,a,r){function s(e){if(e){var t=e.replace(/[^0-9]/g,"");return t!==e&&(r.$setViewValue(t),r.$render()),parseInt(t)}}r.$parsers.push(s)}}}),angular.module("sntRover").service("RVReservationBaseSearchSrv",["$q","rvBaseWebSrvV2","sntBaseWebSrv","dateFilter",function(e,t,a,r){var s=this;this.reservation={settings:{},roomTypes:{},businessDate:{}},this.rateDetailsList={},this.cache={config:{lifeSpan:3600},responses:{restrictionTypes:null,rateDetails:null,sortOrder:null,taxMeta:null,customMeta:null}},this.getRoomRatesDefaultView=function(){var e="ROOM_TYPE";return s.reservation.settings&&s.reservation.settings.default_rate_display_name&&("Recommended"===s.reservation.settings.default_rate_display_name?e="RECOMMENDED":"By Rate"===s.reservation.settings.default_rate_display_name&&(e="RATE")),e},this.getRoomTypeLevel=function(e){var t=-1;if(s.reservation.roomTypes){var a=_.find(s.reservation.roomTypes,{id:e});t=a.level}return t},this.timeSlots=[{value:"12:00 AM",label:"12:00 AM",fullDayValue:0},{value:"12:15 AM",label:"12:15 AM",fullDayValue:15},{value:"12:30 AM",label:"12:30 AM",fullDayValue:30},{value:"12:45 AM",label:"12:45 AM",fullDayValue:45},{value:"01:00 AM",label:"01:00 AM",fullDayValue:100},{value:"01:15 AM",label:"01:15 AM",fullDayValue:115},{value:"01:30 AM",label:"01:30 AM",fullDayValue:130},{value:"01:45 AM",label:"01:45 AM",fullDayValue:145},{value:"02:00 AM",label:"02:00 AM",fullDayValue:200},{value:"02:15 AM",label:"02:15 AM",fullDayValue:215},{value:"02:30 AM",label:"02:30 AM",fullDayValue:230},{value:"02:45 AM",label:"02:45 AM",fullDayValue:245},{value:"03:00 AM",label:"03:00 AM",fullDayValue:300},{value:"03:15 AM",label:"03:15 AM",fullDayValue:315},{value:"03:30 AM",label:"03:30 AM",fullDayValue:330},{value:"03:45 AM",label:"03:45 AM",fullDayValue:345},{value:"04:00 AM",label:"04:00 AM",fullDayValue:400},{value:"04:15 AM",label:"04:15 AM",fullDayValue:415},{value:"04:30 AM",label:"04:30 AM",fullDayValue:430},{value:"04:45 AM",label:"04:45 AM",fullDayValue:445},{value:"05:00 AM",label:"05:00 AM",fullDayValue:500},{value:"05:15 AM",label:"05:15 AM",fullDayValue:515},{value:"05:30 AM",label:"05:30 AM",fullDayValue:530},{value:"05:45 AM",label:"05:45 AM",fullDayValue:545},{value:"06:00 AM",label:"06:00 AM",fullDayValue:600},{value:"06:15 AM",label:"06:15 AM",fullDayValue:615},{value:"06:30 AM",label:"06:30 AM",fullDayValue:630},{value:"06:45 AM",label:"06:45 AM",fullDayValue:645},{value:"07:00 AM",label:"07:00 AM",fullDayValue:700},{value:"07:15 AM",label:"07:15 AM",fullDayValue:715},{value:"07:30 AM",label:"07:30 AM",fullDayValue:730},{value:"07:45 AM",label:"07:45 AM",fullDayValue:745},{value:"08:00 AM",label:"08:00 AM",fullDayValue:800},{value:"08:15 AM",label:"08:15 AM",fullDayValue:815},{value:"08:30 AM",label:"08:30 AM",fullDayValue:830},{value:"08:45 AM",label:"08:45 AM",fullDayValue:845},{value:"09:00 AM",label:"09:00 AM",fullDayValue:900},{value:"09:15 AM",label:"09:15 AM",fullDayValue:915},{value:"09:30 AM",label:"09:30 AM",fullDayValue:930},{value:"09:45 AM",label:"09:45 AM",fullDayValue:945},{value:"10:00 AM",label:"10:00 AM",fullDayValue:1e3},{value:"10:15 AM",label:"10:15 AM",fullDayValue:1015},{value:"10:30 AM",label:"10:30 AM",fullDayValue:1030},{value:"10:45 AM",label:"10:45 AM",fullDayValue:1045},{value:"11:00 AM",label:"11:00 AM",fullDayValue:1100},{value:"11:15 AM",label:"11:15 AM",fullDayValue:1115},{value:"11:30 AM",label:"11:30 AM",fullDayValue:1130},{value:"11:45 AM",label:"11:45 AM",fullDayValue:1145},{value:"12:00 PM",label:"12:00 PM",fullDayValue:1200},{value:"12:15 PM",label:"12:15 PM",fullDayValue:1215},{value:"12:30 PM",label:"12:30 PM",fullDayValue:1230},{value:"12:45 PM",label:"12:45 PM",fullDayValue:1245},{value:"01:00 PM",label:"01:00 PM",fullDayValue:1300},{value:"01:15 PM",label:"01:15 PM",fullDayValue:1315},{value:"01:30 PM",label:"01:30 PM",fullDayValue:1330},{value:"01:45 PM",label:"01:45 PM",fullDayValue:1345},{value:"02:00 PM",label:"02:00 PM",fullDayValue:1400},{value:"02:15 PM",label:"02:15 PM",fullDayValue:1415},{value:"02:30 PM",label:"02:30 PM",fullDayValue:1430},{value:"02:45 PM",label:"02:45 PM",fullDayValue:1445},{value:"03:00 PM",label:"03:00 PM",fullDayValue:1500},{value:"03:15 PM",label:"03:15 PM",fullDayValue:1515},{value:"03:30 PM",label:"03:30 PM",fullDayValue:1530},{value:"03:45 PM",label:"03:45 PM",fullDayValue:1545},{value:"04:00 PM",label:"04:00 PM",fullDayValue:1600},{value:"04:15 PM",label:"04:15 PM",fullDayValue:1615},{value:"04:30 PM",label:"04:30 PM",fullDayValue:1630},{value:"04:45 AM",label:"04:45 PM",fullDayValue:1645},{value:"05:00 PM",label:"05:00 PM",fullDayValue:1700},{value:"05:15 PM",label:"05:15 PM",fullDayValue:1715},{value:"05:30 PM",label:"05:30 PM",fullDayValue:1730},{value:"05:45 PM",label:"05:45 PM",fullDayValue:1745},{value:"06:00 PM",label:"06:00 PM",fullDayValue:1800},{value:"06:15 PM",label:"06:15 PM",fullDayValue:1815},{value:"06:30 PM",label:"06:30 PM",fullDayValue:1830},{value:"06:45 PM",label:"06:45 PM",fullDayValue:1845},{value:"07:00 PM",label:"07:00 PM",fullDayValue:1900},{value:"07:15 PM",label:"07:15 PM",fullDayValue:1915},{value:"07:30 PM",label:"07:30 PM",fullDayValue:1930},{value:"07:45 PM",label:"07:45 PM",fullDayValue:1945},{value:"08:00 PM",label:"08:00 PM",fullDayValue:2e3},{value:"08:15 PM",label:"08:15 PM",fullDayValue:2015},{value:"08:30 PM",label:"08:30 PM",fullDayValue:2030},{value:"08:45 PM",label:"08:45 PM",fullDayValue:2045},{value:"09:00 PM",label:"09:00 PM",fullDayValue:2100},{value:"09:15 PM",label:"09:15 PM",fullDayValue:2115},{value:"09:30 PM",label:"09:30 PM",fullDayValue:2130},{value:"09:45 PM",label:"09:45 PM",fullDayValue:2145},{value:"10:00 PM",label:"10:00 PM",fullDayValue:2200},{value:"10:15 PM",label:"10:15 PM",fullDayValue:2215},{value:"10:30 PM",label:"10:30 PM",fullDayValue:2230},{value:"10:45 PM",label:"10:45 PM",fullDayValue:2245},{value:"11:00 PM",label:"11:00 PM",fullDayValue:2300},{value:"11:15 PM",label:"11:15 PM",fullDayValue:2315},{value:"11:30 PM",label:"11:30 PM",fullDayValue:2330},{value:"11:45 PM",label:"11:45 PM",fullDayValue:2345}],this.fetchBaseSearchData=function(){var a=e.defer();if(s.fetchBussinessDate=function(){var e="/api/business_dates/active";return t.getJSON(e).then(function(e){s.reservation.businessDate=e.business_date,a.resolve(s.reservation)},function(e){a.reject(e)}),a.promise},s.fetchRoomTypes=function(){var e="api/room_types.json?exclude_pseudo=true&per_page=100";return t.getJSON(e).then(function(e){s.reservation.roomTypes=e.results,s.fetchBussinessDate()},function(e){a.reject(e)}),a.promise},isEmpty(s.reservation.settings)&&isEmpty(s.reservation.roomTypes)&&isEmpty(s.reservation.businessDate)){var r="/api/hotel_settings/show_hotel_reservation_settings";t.getJSON(r).then(function(e){s.reservation.settings=e,s.fetchRoomTypes()},function(e){a.reject(e)})}else a.resolve(s.reservation);return a.promise},this.fetchCompanyCard=function(a){var r=e.defer(),s="/api/accounts";return t.getJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.autoCompleteCodes=function(a){var r=e.defer(),s="/api/code_search";return t.getJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCurrentTime=function(a){var r=e.defer(),s="/api/hotel_current_time";return t.getJSON(s).then(function(e){a&&"string"==typeof a&&(e.hotel_time.date=a),r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchAvailability=function(a){var r=e.defer(),s="/api/availability?from_date="+a.from_date+"&to_date="+a.to_date+"&override_restrictions=true";return a.company_id&&(s+="&company_id="+a.company_id),a.travel_agent_id&&(s+="&travel_agent_id="+a.travel_agent_id),a.group_id&&(s+="&group_id="+a.group_id),a.promotion_code&&(s+="&promotion_code="+encodeURI(a.promotion_code)),a.allotment_id&&(s+="&allotment_id="+encodeURI(a.allotment_id)),t.getJSON(s).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchMinTime=function(){var a=e.defer(),r="/api/hourly_rate_min_hours";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchSortPreferences=function(){var a=e.defer(),r="/api/sort_preferences/list_selections";return null===s.cache.responses.sortOrder||Date.now()>s.cache.responses.sortOrder.expiryDate?t.getJSON(r).then(function(e){s.cache.responses.sortOrder={data:e.room_rates,expiryDate:Date.now()+1e3*s.cache.config.lifeSpan},a.resolve(e.room_rates)},function(e){a.reject(e)}):a.resolve(s.cache.responses.sortOrder.data),a.promise},this.fetchAddonsForRates=function(a){var r=e.defer(),s="/api/addons/rate_addons";return t.getJSON(s,a).then(function(e){r.resolve(e.rate_addons)},function(e){r.reject(e)}),r.promise},this.hasAnyConfiguredAddons=function(a){var r=e.defer(),s="/api/addons/configured";
return t.getJSON(s,a).then(function(e){r.resolve(e.addons_configured)},function(e){r.reject(e)}),r.promise},this.getActivePromotions=function(){var a=e.defer(),r="/api/promotions?is_active=true";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchUserMemberships=function(a){var r=e.defer(),s="/staff/user_memberships.json?user_id="+a;return t.getJSON(s).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},this.checkOverbooking=function(a){var r=e.defer(),s="/api/availability/overbooking_check";return t.getJSON(s,a).then(function(e){r.resolve(e.results)},function(e){r.reject(e)}),r.promise},this.checkDiaryAvailability=function(a){var r=e.defer(),s="/api/nightly_diary/availability";return t.postJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchOrdinaryRates=function(a){var r=e.defer(),s="/api/availability/rates";return t.getJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchContractRates=function(a){var r=e.defer(),s="/api/availability/contracts";return t.getJSON(s,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchGroupRates=function(a){var r=e.defer(),s=a.group_id||a.allotment_id,n="/api/availability/groups/"+s;return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchRates=function(t){var a=e.defer(),r=[];return s.rates=[],t.group_id?r.push(s.fetchGroupRates(t).then(function(e){_.each(e.rates,function(e){null===e.id&&(e.id="_CUSTOM_"+t.group_id)}),s.rates=s.rates.concat(e.rates)})):(r.push(s.fetchOrdinaryRates(t).then(function(e){s.rates=s.rates.concat(e.rates)})),(t.company_id||t.travel_agent_id)&&r.push(s.fetchContractRates(t).then(function(e){_.each(e.rates,function(e){e.isCorporate=!0}),s.rates=s.rates.concat(e.rates)}))),e.all(r).then(function(){a.resolve(s.rates)},function(e){a.reject(e)}),a.promise},this.fetchRestricitonTypes=function(){var a=e.defer(),r="/api/restriction_types";return null===s.cache.responses.restrictionTypes||Date.now()>s.cache.responses.restrictionTypes.expiryDate?t.getJSON(r).then(function(e){e.results.push({id:98,value:"INVALID_PROMO",description:"PROMOTION INVALID",activated:!0}),e.results.push({id:99,activated:!0,value:"HOUSE_FULL",description:"NO HOUSE AVAILABILITY"});var t={};_.each(e.results,function(e){t[e.id]={key:e.value,value:["CLOSED","CLOSED_ARRIVAL","CLOSED_DEPARTURE","HOUSE_FULL","INVALID_PROMO"].indexOf(e.value)>-1?e.description:e.description+":"}}),s.cache.responses.restrictionTypes={data:t,expiryDate:Date.now()+1e3*s.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(s.cache.responses.restrictionTypes.data),a.promise};var n=function(e){var t=_.reject(e.rate_ids,function(e){return!!(s.rateDetailsList[e]&&Date.now()<s.rateDetailsList[e].expiryDate)});return t};this.fetchRatesDetails=function(a){var r=n(a),o=e.defer(),i="/api/rates/search.json",l={};return l.rate_ids=r,0===r.length?o.resolve({}):t.postJSON(i,l).then(function(e){_.each(e.results,function(e){s.rateDetailsList[e.id]={expiryDate:Date.now()+1e3*s.cache.config.lifeSpan,details:e}}),o.resolve(e.results)},function(e){o.reject(e)}),o.promise},this.fetchCustomRateConfig=function(){var a=e.defer(),r="api/rates/custom_group_rate_taxes";return null===s.cache.responses.customMeta||Date.now()>s.cache.responses.customMeta.expiryDate?t.getJSON(r).then(function(e){var t=e;s.cache.responses.customMeta={data:t,expiryDate:Date.now()+1e3*s.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(s.cache.responses.customMeta.data),a.promise},this.fetchRatesMeta=function(t){var a=e.defer(),r=[];return s["rates-restrictions"]={},r.push(s.fetchRestricitonTypes(t).then(function(e){s["rates-restrictions"].restrictions=e})),r.push(s.fetchCustomRateConfig().then(function(e){s["rates-restrictions"].customRates=e})),e.all(r).then(function(){a.resolve(s["rates-restrictions"])},function(e){a.reject(e)}),a.promise},this.fetchTaxInformation=function(){var a=e.defer(),r="api/rates/tax_information";return null===s.cache.responses.taxMeta||Date.now()>s.cache.responses.taxMeta.expiryDate?t.getJSON(r).then(function(e){var t=e.tax_codes;s.cache.responses.taxMeta={data:t,expiryDate:Date.now()+1e3*s.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(s.cache.responses.taxMeta.data),a.promise},this.fetchHouseAvailability=function(a){var r=e.defer(),s="api/availability/house";return t.getJSON(s,a).then(function(e){var t={};_.each(e.results,function(e){t[e.date]=e.availability}),r.resolve(t)},function(e){r.reject(e)}),r.promise},this.fetchHouseRestrictions=function(a){var r=e.defer(),s="/api/availability/house_restrictions";return t.getJSON(s,a).then(function(e){r.resolve(e.restrictions)},function(e){r.reject(e)}),r.promise},this.fetchTaxRateAddonMeta=function(t){var a=e.defer(),r=[];return s.meta={},r.push(s.fetchTaxInformation().then(function(e){s.meta.taxInfo=e})),r.push(s.fetchAddonsForRates(t).then(function(e){s.meta.rateAddons=e})),e.all(r).then(function(){a.resolve(s.meta)},function(e){a.reject(e)}),a.promise},this.fetchHotelReservationSettings=function(){var a=e.defer(),r="/api/hotel_settings/show_hotel_reservation_settings";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.searchForRates=function(a){var r=e.defer(),s={},n="/api/rates.json?&sort_dir=true&sort_field=rate";return s.query=a.query,s.per_page=25,s.page=1,t.getJSON(n,s).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchRateDetailsForIds=function(a){var r=n(a),o=e.defer(),i="/api/rates/search.json",l={};return l.rate_ids=r,0===r.length?o.resolve({}):t.postJSON(i,l).then(function(e){_.each(e.results,function(e){s.rateDetailsList[e.id]={expiryDate:Date.now()+1e3*s.cache.config.lifeSpan,details:e}});var t=_.difference(a.rate_ids,r);_.each(t,function(t){e.results.push(s.rateDetailsList[t].details)}),o.resolve(e.results)},function(e){o.reject(e)}),o.promise},this.checkTimeBasedAvailabilityAPI=function(t){var r=e.defer(),s="api/availability/time_based_room_type_and_house_avl";return a.postJSON(s,t).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("snt.utils").service("Toggles",["$q","sntBaseWebSrv",function(e,t){var a,r=this;r.initialize=function(){var r=e.defer();return t.getJSON("/api/features/list").then(function(e){a=e,r.resolve(e)}),r.promise},r.isEnabled=function(e){if(!a)throw new Error("Attempt to access feature toggles without initializing");return a[e]===!0||angular.isUndefined(a[e])}}]),sntRover.directive("durationFilter",[function(){var e=function(e){e.removeFilter=function(){e.onRemove({filterPos:e.filterPos})}};return e.$inject=["$scope"],{restrict:"E",templateUrl:"/assets/directives/customExports/durationFilter/durationFilter.html",replace:!0,scope:{firstLevelData:"=",secondLevelData:"=",selectedFirstLevel:"=",selectedSecondLevel:"=",filterPos:"=",onRemove:"&"},controller:e}}]),sntRover.directive("rangeFilter",[function(){var e=function(e){e.removeFilter=function(){e.onRemove({filterPos:e.filterPos})},e.onFieldNameChange=function(){e.onFirstLevelFieldChange({fieldName:e.selectedFirstLevel,filterPos:e.filterPos})}};return e.$inject=["$scope"],{restrict:"E",templateUrl:"/assets/directives/customExports/rangeFilter/rangeFilter.html",replace:!0,scope:{firstLevelData:"=",secondLevelData:"=",selectedFirstLevel:"=",selectedSecondLevel:"=",filterPos:"=",rangeValue:"=",onRemove:"&",onFirstLevelFieldChange:"&"},controller:e}}]),sntRover.directive("optionFilter",[function(){var e=function(e){e.removeFilter=function(){e.onRemove({filterPos:e.filterPos})},e.onFieldNameChange=function(){e.onFirstLevelFieldChange({fieldName:e.selectedFirstLevel,filterPos:e.filterPos})}};return e.$inject=["$scope"],{restrict:"E",templateUrl:"/assets/directives/customExports/optionFilter/optionFilter.html",replace:!0,scope:{firstLevelData:"=",secondLevelData:"=",selectedFirstLevel:"=",selectedSecondLevel:"=",filterPos:"=",onRemove:"&",isMultiSelect:"=",options:"=",onFirstLevelFieldChange:"&",onSelectboxExpand:"=",hasDualState:"=",entryDisplayStyle:"="},controller:e}}]),sntRover.directive("generalFilter",[function(){var e=function(e){e.removeFilter=function(){e.onRemove({filterPos:e.filterPos})},e.onFieldNameChange=function(){e.onFirstLevelFieldChange({fieldName:e.selectedFirstLevel,filterPos:e.filterPos})}};return e.$inject=["$scope"],{restrict:"E",templateUrl:"/assets/directives/customExports/generalFilter/generalFilter.html",replace:!0,scope:{firstLevelData:"=",secondLevelData:"=",selectedFirstLevel:"=",selectedSecondLevel:"=",filterPos:"=",onRemove:"&",onFirstLevelFieldChange:"&"},controller:e}}]);