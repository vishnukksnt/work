angular.module("sntRover").controller("rvAvailabilityButtonController",["$scope","$timeout","$filter","rvAvailabilitySrv","jsMappings",function(e,t,a,o,r){var n=function(){$("html").addClass("availability-print")},i=function(){$("html").removeClass("availability-print")};BaseCtrl.call(this,e),e.showAvailability=!1,e.isClosing=!1,e.clickedOnAvailabilityButton=function(a){var l={},s=1e3;e.showAvailability?(e.isClosing=!0,t(function(){e.isClosing=!1,e.showAvailability=!1},s),o.updateData(l),i()):(e.$emit("showLoader"),r.fetchAssets(["rover.availability","highcharts"],["highcharts-ng"]).then(function(){e.$emit("hideLoader"),t(function(){e.showAvailability=!0},0)}),n())},e.getAvailabilityTemplateUrl=function(){return e.showAvailability?"/assets/partials/availability/availability.html":""},e.$on("CLOSE_AVAILIBILTY_SLIDER",function(t){e.clickedOnAvailabilityButton(null)})}]),angular.module("sntRover").controller("rvAvailabilityMainController",["$scope","rvAvailabilitySrv","$rootScope",function(e,t,a){e.availabilityToShow="room",e.page={},e.page.title="Availability",e.setAvailability=function(){e.$emit("showLoader")},e.getTemplateUrl=function(){return"room"===e.availabilityToShow?"/assets/partials/availability/roomAvailabilityMain.html":"house"===e.availabilityToShow?"/assets/partials/availability/houseAvailabilityStatus.html":"item-inventory"===e.availabilityToShow?"/assets/partials/availability/itemInventoryMain.html":"groups"===e.availabilityToShow?"/assets/partials/availability/groupAvailabilityMain.html":"allotments"===e.availabilityToShow?"/assets/partials/availability/allotmentAvailabilityMain.html":void 0},e.shouldShowGroupInSelectBox=function(){return!a.isHourlyRateOn},e.shouldShowAllotmentInSelectBox=function(){return!a.isHourlyRateOn}}]),angular.module("sntRover").controller("RVHouseAvailabilityStatusCtrl",["$scope","$timeout","ngDialog","$rootScope","$filter","rvAvailabilitySrv",function(e,t,a,o,r,n){e.$on("$includeContentLoaded",function(t){e.$emit("hideLoader")});var i=function(){e.page.title="House Status",e.houseStatus={},l(),e.setScroller("house-status-grid"),e.houseDetailsFetched=!1},l=function(){var a=function(a){e.$emit("hideLoader"),e.houseDetails=a,e.houseDetailsFetched=!0,t(function(){e.refreshScroller("house-status-grid"),e.$parent.myScroll["house-status-grid"].refresh()},300)},i=tzIndependentDate(o.businessDate),l=i.clone();l.setDate(l.getDate()-1);var s=i.clone();s.setDate(s.getDate()+1);var u={from_date:r("date")(l,o.dateFormatForAPI),to_date:r("date")(s,o.dateFormatForAPI),business_date:o.businessDate};e.invokeApi(n.fetchHouseStatusDetails,u,a)};i()}]),angular.module("sntRover").controller("itemInventoryMainController",["$scope","rvAvailabilitySrv","$rootScope","ngDialog","$filter","$timeout",function(e,t,a,o,r,n){BaseCtrl.call(this,e),e.selectedView="grid",e.page.title="Item Inventory",e.numberOfDaysSelected="14",e.data={},e.data.selectedDate=a.businessDate,e.data.formattedSelectedDate=r("date")(e.data.selectedDate,a.dateFormat),e.setSelectedView=function(t){e.$emit("showLoader"),e.selectedView=t},e.loadSelectedView=function(){return"grid"===e.selectedView?"/assets/partials/availability/itemInventoryGridStatus.html":"graph"===e.selectedView?"/assets/partials/availability/itemInventoryGraphStatus.html":void 0},e.showDatePicker=function(){o.open({template:"/assets/partials/common/rvDatePicker.html",controller:"rvRoomAvailabilityDatePickerController",className:"",scope:e,closeByDocument:!0})};var i=function(t){e.$emit("hideLoader"),e.$broadcast("changedRoomAvailableData")},l=function(t){e.$emit("hideLoader")};e.changedAvailabilityDataParams=function(){n(function(){var o=tzIndependentDate(e.data.selectedDate);o.setDate(o.getDate()+parseInt(e.numberOfDaysSelected)-1);var n={from_date:r("date")(tzIndependentDate(e.data.selectedDate),a.dateFormatForAPI),to_date:r("date")(tzIndependentDate(o),a.dateFormatForAPI)};e.invokeApi(t.fetchItemInventoryDetails,n,i,l)},0)},e.changedAvailabilityDataParams()}]),angular.module("sntRover").controller("roomAvailabilityMainController",["$scope","rvAvailabilitySrv","$rootScope","ngDialog","$filter","$timeout","$q","$state",function(e,t,a,o,r,n,i,l){BaseCtrl.call(this,e),e.selectedView="grid",e.page.title="Availability",e.setSelectedView=function(t){e.$emit("showLoader"),e.selectedView=t},e.loadSelectedView=function(){return"grid"===e.selectedView?"/assets/partials/availability/roomAvailabilityGridStatus.html":"graph"===e.selectedView?"/assets/partials/availability/roomAvailabilityGraphStatus.html":void 0},e.numberOfDaysSelected="14",e.data={},e.data.selectedDate=a.businessDate,e.data.formattedSelectedDate=r("date")(e.data.selectedDate,a.dateFormat),e.data.isIncludeOverbooking=!1,e.clickedOnDatePicker=function(){o.open({template:"/assets/partials/common/rvDatePicker.html",controller:"rvRoomAvailabilityDatePickerController",className:"",scope:e,closeByDocument:!0})};var s=function(t){a.isSellLimitEnabled=t.is_sell_limit_enabled,"graph"===e.selectedView?e.fetchAdditionalData():(e.$emit("hideLoader"),e.$broadcast("changedRoomAvailableData"))},u=function(t){e.$emit("hideLoader"),e.$broadcast("changedRoomAvailableData")},c=function(t){e.$emit("hideLoader")};e.getDateParams=function(){var t=tzIndependentDate(e.data.selectedDate);t.setDate(t.getDate()+parseInt(e.numberOfDaysSelected)-1);var o={from_date:r("date")(tzIndependentDate(e.data.selectedDate),a.dateFormatForAPI),to_date:r("date")(tzIndependentDate(t),a.dateFormatForAPI),is_include_overbooking:e.data.isIncludeOverbooking};return o},e.fetchAdditionalData=function(){n(function(){e.invokeApi(t.fetchAvailabilityAdditionalDetails,e.getDateParams(),u,c)},0)},e.fetchGrpNAllotData=function(){var a=i.defer(),o=function(){var t=e.getDateParams(),a=e.oldDateParams||{from_date:"",to_date:""};return t.from_date==a.from_date&&t.to_date==a.to_date},r=function(){e.$emit("hideLoader"),e.$broadcast("changedGrpNAllotData"),a.resolve(!0)};return o()?r():n(function(){e.oldDateParams=e.getDateParams(),e.invokeApi(t.fetchGrpNAllotAvailDetails,e.getDateParams(),r,c)},0),a.promise},e.printAvaiability=function(){e.$broadcast("PRINT_AVAILABILITY")},e.shouldShowPrint=function(){var t="14",a="room";return t===e.numberOfDaysSelected&&a===e.availabilityToShow},e.changedAvailabilityDataParams=function(){n(function(){e.invokeApi(t.fetchAvailabilityAndBestAvailableRates,e.getDateParams(),s,c)},0)},e.clickedIncludeOverbooking=function(){e.data.isIncludeOverbooking=!e.data.isIncludeOverbooking,e.$broadcast("INCLUDE_OVERBOOKING",e.data.isIncludeOverbooking),e.changedAvailabilityDataParams()},e.changedAvailabilityDataParams(),e.navigateToCreateReservation=function(t,a,o){l.go("rover.reservation.search",{selectedArrivalDate:a[o].date,selectedRoomTypeId:t.id,numNights:1}),e.$emit("CLOSE_AVAILIBILTY_SLIDER")}}]),angular.module("sntRover").controller("rvRoomAvailabilityDatePickerController",["$scope","$rootScope","ngDialog","$filter",function(e,t,a,o){var r=e.data.selectedDate;e.setUpCalendar=function(){e.dateOptions={changeYear:!0,changeMonth:!0,minDate:tzIndependentDate(t.businessDate),yearRange:"-10:+10",dateFormat:"mm-dd-yy",onSelect:function(n,i){e.data.selectedDate!==r&&(e.data.formattedSelectedDate=o("date")(e.data.selectedDate,t.dateFormat),e.changedAvailabilityDataParams()),a.close()}}},e.setUpCalendar()}]),angular.module("sntRover").controller("rvAllotmentAvailabilityStatusController",["$scope","rvAvailabilitySrv","$state","ngDialog","rvAllotmentConfigurationSrv","$timeout",function(e,t,a,o,r,n){BaseCtrl.call(this,e),e.togleHoldStatusVisibility=function(t){"groupRoomTotal"===t?e.hideHoldStatusOf.groupRoomTotal=!e.hideHoldStatusOf.groupRoomTotal:"groupRoomPicked"===t&&(e.hideHoldStatusOf.groupRoomPicked=!e.hideHoldStatusOf.groupRoomPicked),e.refreshScroller("groupscroller")},e.$on("changedRoomAvailableData",function(a){e.hideBeforeDataFetch=!1,e.data=t.getGridDataForAllotmentAvailability(),e.refreshScroller("groupscroller"),e.$emit("hideLoader")});var i=function(){var t={scrollX:!0,preventDefault:!1};e.setScroller("groupscroller",t)};e.gotoAllotmentScreen=function(t){e.selectedAllotmentId=t,e.$emit("CLOSE_AVAILIBILTY_SLIDER")},e.$on("CLOSED_AVAILIBILTY_SLIDER",function(t){var o=e.selectedAllotmentId;n(function(){a.go("rover.allotments.config",{id:o,activeTab:"RESERVATIONS"},{reload:!0}),e.$emit("showLoader")},1e3)}),e.showDropDownForGroup=function(t){return _.contains(e.idsOfDropDownOpenedGroups,e.data.groupDetails[t].id)},e.getWidthForTable=function(){if(!_.has(e.data,"dates"))return 0;var t=273,a=e.data&&e.data.dates&&e.data.dates.length,o=0;return a<=7?o=147:a<=14?o=71:a<=30&&(o=100),a*o+t},e.getGroupName=function(t){var a=_.findWhere(e.data.holdStatus,{id:t});return a&&a.name},e.getClassForHoldStatusRowInPickedUp=function(t){var a,o,r;return e.hideHoldStatusOf.groupRoomPicked?r="hidden":(a=_.findWhere(e.data.holdStatus,{id:t}),o=a&&a.is_take_from_inventory,r=a&&o?"":"hidden"),r};e.toggleButtonClicked=function(t){if(_.contains(e.idsOfDropDownOpenedGroups,e.data.groupDetails[t].id)){var a=_.filter(e.idsOfDropDownOpenedGroups,function(a){return a!==e.data.groupDetails[t].id});e.idsOfDropDownOpenedGroups=a}else e.idsOfDropDownOpenedGroups.push(e.data.groupDetails[t].id);e.refreshScroller("groupscroller")},e.roomHeldButtonClicked=function(t){e.data.clickedHeldRoomDetail=t,o.open({template:"/assets/partials/availability/releaseRoomPopup.html",scope:e,closeByDocument:!0})},e.releaseRooms=function(){var t=function(t){e.$emit("hideLoader"),e.closeDialog(),e.$parent.changedAvailabilityDataParams()},a=function(t){e.$emit("hideLoader"),e.closeDialog(),e.errorMessage=t},o={allotmentId:e.data.clickedHeldRoomDetail.id,date:e.data.clickedHeldRoomDetail.date};e.$emit("showLoader"),n(function(){e.invokeApi(r.releaseRooms,o,t,a)},0)};var l=function(){e.idsOfDropDownOpenedGroups=[],e.hideBeforeDataFetch=!0,e.hideHoldStatusOf={},e.hideHoldStatusOf.groupRoomTotal=!0,e.hideHoldStatusOf.groupRoomPicked=!0,e.selectedAllotmentId=null,e.data=t.getGridDataForAllotmentAvailability(),i(),isEmptyObject(e.data)||(e.hideBeforeDataFetch=!1,e.refreshScroller("groupscroller"),e.$emit("hideLoader"))};l()}]),angular.module("sntRover").controller("allotmentAvailabilityMainController",["$scope","rvAvailabilitySrv","$rootScope","ngDialog","$filter","$timeout",function(e,t,a,o,r,n){BaseCtrl.call(this,e),e.page.title="Allotments",e.numberOfDaysSelected="14",e.data={},e.data.selectedDate=a.businessDate,e.data.formattedSelectedDate=r("date")(e.data.selectedDate,a.dateFormat),e.clickedOnDatePicker=function(){o.open({template:"/assets/partials/common/rvDatePicker.html",controller:"rvRoomAvailabilityDatePickerController",className:"",scope:e,closeByDocument:!0})};var i=function(t){e.$emit("hideLoader"),e.$broadcast("changedRoomAvailableData")},l=function(t){e.$emit("hideLoader")};e.changedAvailabilityDataParams=function(){n(function(){var o=tzIndependentDate(e.data.selectedDate);o.setDate(o.getDate()+parseInt(e.numberOfDaysSelected)-1);var n={from_date:r("date")(tzIndependentDate(e.data.selectedDate),a.dateFormatForAPI),to_date:r("date")(tzIndependentDate(o),a.dateFormatForAPI)};e.invokeApi(t.fetchAllotmentAvailabilityDetails,n,i,l)},0)},e.changedAvailabilityDataParams()}]),angular.module("sntRover").controller("groupAvailabilityMainController",["$scope","rvAvailabilitySrv","$rootScope","ngDialog","$filter","$timeout",function(e,t,a,o,r,n){BaseCtrl.call(this,e),e.page.title="Groups",e.numberOfDaysSelected="14",e.data={},e.data.selectedDate=a.businessDate,e.data.formattedSelectedDate=r("date")(e.data.selectedDate,a.dateFormat),e.clickedOnDatePicker=function(){o.open({template:"/assets/partials/common/rvDatePicker.html",controller:"rvRoomAvailabilityDatePickerController",className:"",scope:e,closeByDocument:!0})};var i=function(t){e.$emit("hideLoader"),e.$broadcast("changedRoomAvailableData")},l=function(t){e.$emit("hideLoader")};e.changedAvailabilityDataParams=function(){n(function(){var o=tzIndependentDate(e.data.selectedDate);o.setDate(o.getDate()+parseInt(e.numberOfDaysSelected)-1);var n={from_date:r("date")(tzIndependentDate(e.data.selectedDate),a.dateFormatForAPI),to_date:r("date")(tzIndependentDate(o),a.dateFormatForAPI)};e.invokeApi(t.fetchGroupAvailabilityDetails,n,i,l)},0)},e.changedAvailabilityDataParams()}]),angular.module("sntRover").controller("rvGroupAvailabilityStatusController",["$scope","rvAvailabilitySrv","$state","ngDialog","rvGroupConfigurationSrv","$timeout",function(e,t,a,o,r,n){BaseCtrl.call(this,e),e.togleHoldStatusVisibility=function(t){"groupRoomTotal"===t?e.hideHoldStatusOf.groupRoomTotal=!e.hideHoldStatusOf.groupRoomTotal:"groupRoomPicked"===t&&(e.hideHoldStatusOf.groupRoomPicked=!e.hideHoldStatusOf.groupRoomPicked),e.refreshScroller("groupscroller")},e.$on("changedRoomAvailableData",function(a){e.hideBeforeDataFetch=!1,e.data=t.getGridDataForGroupAvailability(),e.refreshScroller("groupscroller"),e.$emit("hideLoader")});var i=function(){var t={scrollX:!0,preventDefault:!1};e.setScroller("groupscroller",t)};e.gotoGroupScreen=function(t){e.selectedGroupId=t,e.$emit("CLOSE_AVAILIBILTY_SLIDER")},e.$on("CLOSED_AVAILIBILTY_SLIDER",function(t){var o=e.selectedGroupId;n(function(){a.go("rover.groups.config",{id:o,activeTab:"ROOMING"},{reload:!0}),e.$emit("showLoader")},1e3)}),e.showDropDownForGroup=function(t){return _.contains(e.idsOfDropDownOpenedGroups,e.data.groupDetails[t].id)},e.getWidthForTable=function(){var t=130,a=e.data&&e.data.dates&&e.data.dates.length,o=100;return!_.has(e.data,"dates")&&a<30?0:30==a?a*o+t:void 0},e.getGroupName=function(t){var a=_.findWhere(e.data.holdStatus,{id:t});return a&&a.name},e.getClassForHoldStatusRowInPickedUp=function(t){return!l(t)||e.hideHoldStatusOf.groupRoomPicked?"hidden":""};var l=function(t){var a=_.findWhere(e.data.holdStatus,{id:t});return a&&a.is_take_from_inventory};e.toggleButtonClicked=function(t){if(_.contains(e.idsOfDropDownOpenedGroups,e.data.groupDetails[t].id)){var a=_.filter(e.idsOfDropDownOpenedGroups,function(a){return a!==e.data.groupDetails[t].id});e.idsOfDropDownOpenedGroups=a}else e.idsOfDropDownOpenedGroups.push(e.data.groupDetails[t].id);e.refreshScroller("groupscroller")},e.roomHeldButtonClicked=function(t){e.data.clickedHeldRoomDetail=t,o.open({template:"/assets/partials/availability/releaseRoomPopup.html",controller:"rvGroupAvailabilityStatusController",scope:e,closeByDocument:!0})},e.releaseRooms=function(){var t=function(t){e.closeDialog(),e.$parent.changedAvailabilityDataParams()},a=function(t){e.closeDialog(),e.errorMessage=t};e.callAPI(r.releaseRooms,{successCallBack:t,failureCallBack:a,params:{groupId:e.data.clickedHeldRoomDetail.id,date:e.data.clickedHeldRoomDetail.date}})};var s=function(){e.idsOfDropDownOpenedGroups=[],e.hideBeforeDataFetch=!0,e.hideHoldStatusOf={},e.hideHoldStatusOf.groupRoomTotal=!0,e.hideHoldStatusOf.groupRoomPicked=!0,e.selectedGroupId=null,e.data=t.getGridDataForGroupAvailability(),i(),isEmptyObject(e.data)||(e.hideBeforeDataFetch=!1,e.refreshScroller("groupscroller"),e.$emit("hideLoader"))};s()}]),angular.module("sntRover").controller("rvItemInventoryGraphStatusController",["$scope","rvAvailabilitySrv","dateFilter","$rootScope","$timeout",function(e,t,a,o,r){BaseCtrl.call(this,e);var n=null,i=!1;e.hideMeBeforeFetching=!1,e.graphWidth="1000";var l={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("graph-scroller",l);for(var s=["#c1c1c1","#dc829c","#83c3df","#82de89","#f6981a","#f2d6af"],u=[],c=null,d=0;d<s.length;d++)u.push("background: "+s[d]+" !important;");e.returnLegendStyle=function(e,t){return t?u[e]:""};var p=function(){var t=$("#graph-showing-area #nav-listing"),a=t.find("ul li");t.css({left:n.plotLeft,width:n.plotSizeX});var o=0;e.graphWidth=75*f(),0!==f()?o=100/f():t.css("width",0),a.css("width",o+"%"),e.refreshScroller("graph-scroller")},f=function(){for(var e=0,t=0;t<n.series.length;t++)n.series[t].visible&&(e=e<n.series[t].data.length?n.series[t].data.length:e);return e},m=function(){e.graphData=[{name:"Bookable Rooms",data:e.data.bookableRooms,yAxis:0,checked:!1,color:s[0]},{name:"Out of Order Rooms",data:e.data.outOfOrderRooms,yAxis:0,checked:!1,color:s[1]},{name:"Total Reserved",data:e.data.reservedRooms,yAxis:0,checked:!0,color:s[2]},{name:"Available Rooms",data:e.data.availableRooms,yAxis:0,checked:!1,color:s[3]},{name:"Occupancy Actual",data:e.data.occupanciesActual,yAxis:0,checked:!1,marker:{symbol:"circle",radius:5},color:s[4]}],e.data.IsOccupancyTargetSetBetween&&e.graphData.push({name:"Occupancy Target",data:e.data.occupanciesTargeted,yAxis:0,checked:!1})};e.clickedOnLegend=function(e,t){for(var a=0;a<n.series.length;a++)if(n.series[a].name===e){t?n.series[a].hide():n.series[a].show();break}p()};var h=function(){e.data=t.getGraphData(),m(),Highcharts.theme={colors:s,chart:{backgroundColor:"white",borderColor:"#FFFF",borderWidth:2,plotBackgroundColor:"#F7F7F7",plotBorderColor:"#FFF",plotBorderWidth:2,marginLeft:4},xAxis:{gridLineColor:"#FFF",gridLineWidth:2,labels:{useHTML:!0},lineColor:"#FFF",tickColor:"#FFF",title:{style:{color:"#CCC",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}},opposite:!0},yAxis:[{gridLineColor:"#dedede",labels:{style:{color:"#f6981a",fontWeight:"bold"}},lineColor:"#A0A0A0",minorTickInterval:null,tickColor:"#A0A0A0",tickWidth:1,title:{style:{color:"#CCC",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}}}],tooltip:{backgroundColor:"rgba(0, 0, 0, 0.75)",style:{color:"#F0F0F0"}},plotOptions:{series:{fillOpacity:.25}}};Highcharts.setOptions(Highcharts.theme);e.availabilityGraphCongif={options:{chart:{type:"area"},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+a(this.x.dateObj,o.dayInWeek)+" "+a(this.x.dateObj,o.shortMonthAndDate)+"</b><br/>"+this.series.name+": "+Math.round(this.y/100*e.data.totalRooms)+" Rooms ("+this.y.toFixed(2)+"%)"}}},title:{text:""},xAxis:{showLastLabel:!0,endOnTick:!0,min:0,categories:e.data.dates,type:"category",labels:{enabled:!1,x:0,y:-50,useHTML:!0,opposite:!0},tickPosition:"inside",tickWidth:0},yAxis:[{showLastLabel:!0,endOnTick:!0,floor:0,ceiling:100,title:{text:""},max:100,minRange:100,tickInterval:10,labels:{align:"left",x:0,y:-2,style:{color:"#f6981a"},formatter:function(){return this.value+"%"}},tickPosition:"outside",tickWidth:0}],series:e.graphData,func:function(t){n=t,setTimeout(function(){e.$apply(function(){for(var t=0;t<e.graphData.length;t++)e.clickedOnLegend(e.graphData[t].name,!e.graphData[t].checked);e.graphWidth=75*f(),p()})},150),$(window).resize(function(){c=r(function(){p(),e.refreshScroller("graph-scroller")},500)})}},e.$emit("hideLoader")};e.data=t.getGraphData(),isEmptyObject(e.data)||(m(),h(),e.$emit("hideLoader"),setTimeout(function(){e.$apply(function(){p(),e.hideMeBeforeFetching=!0}),$(window).resize()},500));e.$on("changedRoomAvailableData",function(t){i||(e.hideMeBeforeFetching=!1,h(),setTimeout(function(){for(var t=0;t<e.graphData.length;t++)e.clickedOnLegend(e.graphData[t].name,!e.graphData[t].checked);e.$apply(function(){p(),e.hideMeBeforeFetching=!0}),$(window).resize()},1e3))});e.$on("$destroy",function(){i=!0,$(window).unbind("resize"),c&&r.cancel(c)})}]),angular.module("sntRover").controller("rvItemInventoryGridStatusController",["$scope","rvAvailabilitySrv",function(e,t){BaseCtrl.call(this,e),e.hideMeBeforeFetching=!1,e.showRoomTypeWiseAvailableRooms=!1,e.showRoomTypeWiseBookedRooms=!1,e.data=t.getGridDataForInventory(),isEmptyObject(e.data)||(e.refreshScroller("room_availability_scroller"),e.hideMeBeforeFetching=!0,e.$emit("hideLoader"));var a={scrollX:!0,preventDefault:!1};e.setScroller("room_availability_scroller",a),e.$on("$includeContentLoaded",function(t){e.$emit("hideLoader"),e.refreshScroller("room_availability_scroller")}),e.$on("changedRoomAvailableData",function(a){e.data=t.getGridDataForInventory(),e.refreshScroller("room_availability_scroller"),e.hideMeBeforeFetching=!0,e.$emit("hideLoader")}),e.toggleShowRoomTypeWiseBookedRooms=function(){e.showRoomTypeWiseBookedRooms=!e.showRoomTypeWiseBookedRooms,e.refreshScroller("room_availability_scroller")},e.toggleShowRoomTypeWiseAvailableRooms=function(){e.showRoomTypeWiseAvailableRooms=!e.showRoomTypeWiseAvailableRooms,e.refreshScroller("room_availability_scroller")},e.getWidthForTable=function(){if(!_.has(e.data,"dates"))return 0;var t=273,a=e.data&&e.data.dates&&e.data.dates.length,o=0;return a<=14?o=71:a<=30&&(o=100),a*o+t}}]),angular.module("sntRover").controller("rvRoomAvailabilityGraphStatusController",["$scope","rvAvailabilitySrv","dateFilter","$rootScope","$timeout",function(e,t,a,o,r){BaseCtrl.call(this,e);var n=null,i=!1;e.hideMeBeforeFetching=!1,e.graphWidth="1000";var l={scrollX:!0,click:!0,preventDefault:!1};e.setScroller("graph-scroller",l);for(var s=["#c1c1c1","#dc829c","#83c3df","#82de89","#f6981a","#f2d6af"],u=[],c=null,d=0;d<s.length;d++)u.push("background: "+s[d]+" !important;");e.returnLegendStyle=function(e,t){return t?u[e]:""};var p=function(){var t=$("#graph-showing-area #nav-listing"),a=t.find("ul li");t.css({left:n.plotLeft,width:n.plotSizeX});var o=0;e.graphWidth=75*f(),0!==f()?o=100/f():t.css("width",0),a.css("width",o+"%"),e.refreshScroller("graph-scroller")},f=function(){for(var e=0,t=0;t<n.series.length;t++)n.series[t].visible&&(e=e<n.series[t].data.length?n.series[t].data.length:e);return e},m=function(){e.graphData=[{name:"Bookable Rooms",data:e.data.bookableRooms,yAxis:0,checked:!1,color:s[0]},{name:"Out of Order Rooms",data:e.data.outOfOrderRooms,yAxis:0,checked:!1,color:s[1]},{name:"Total Reserved",data:e.data.reservedRooms,yAxis:0,checked:!0,color:s[2]},{name:"Available Rooms",data:e.data.availableRooms,yAxis:0,checked:!1,color:s[3]},{name:"Occupancy Actual",data:e.data.occupanciesActual,yAxis:0,checked:!1,marker:{symbol:"circle",radius:5},color:s[4]}],e.data.IsOccupancyTargetSetBetween&&e.graphData.push({name:"Occupancy Target",data:e.data.occupanciesTargeted,yAxis:0,checked:!1})};e.clickedOnLegend=function(e,t){for(var a=0;a<n.series.length;a++)if(n.series[a].name===e){t?n.series[a].hide():n.series[a].show();break}p()};var h=function(){e.data=t.getGraphData(),m(),Highcharts.theme={colors:s,chart:{backgroundColor:"white",borderColor:"#FFFF",borderWidth:2,plotBackgroundColor:"#F7F7F7",plotBorderColor:"#FFF",plotBorderWidth:2,marginLeft:4},xAxis:{gridLineColor:"#FFF",gridLineWidth:2,labels:{useHTML:!0},lineColor:"#FFF",tickColor:"#FFF",title:{style:{color:"#CCC",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}},opposite:!0},yAxis:[{gridLineColor:"#dedede",labels:{style:{color:"#f6981a",fontWeight:"bold"}},lineColor:"#A0A0A0",minorTickInterval:null,tickColor:"#A0A0A0",tickWidth:1,title:{style:{color:"#CCC",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}}}],tooltip:{backgroundColor:"rgba(0, 0, 0, 0.75)",style:{color:"#F0F0F0"}},plotOptions:{series:{fillOpacity:.25}}};Highcharts.setOptions(Highcharts.theme);e.availabilityGraphCongif={options:{chart:{type:"area"},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+a(this.x.dateObj,o.dayInWeek)+" "+a(this.x.dateObj,o.shortMonthAndDate)+"</b><br/>"+this.series.name+": "+Math.round(this.y/100*e.data.totalRooms)+" Rooms ("+this.y.toFixed(2)+"%)"}}},title:{text:""},xAxis:{showLastLabel:!0,endOnTick:!0,min:0,categories:e.data.dates,type:"category",labels:{enabled:!1,x:0,y:-50,useHTML:!0,opposite:!0},tickPosition:"inside",tickWidth:0},yAxis:[{showLastLabel:!0,endOnTick:!0,floor:0,ceiling:100,title:{text:""},max:100,minRange:100,tickInterval:10,labels:{align:"left",x:0,y:-2,style:{color:"#f6981a"},formatter:function(){return this.value+"%"}},tickPosition:"outside",tickWidth:0}],series:e.graphData,func:function(t){n=t,setTimeout(function(){e.$apply(function(){for(var t=0;t<e.graphData.length;t++)e.clickedOnLegend(e.graphData[t].name,!e.graphData[t].checked);e.graphWidth=75*f(),p()})},150),$(window).resize(function(){c=r(function(){p(),e.refreshScroller("graph-scroller")},500)})}},e.$emit("hideLoader")};e.data=t.getGraphData(),isEmptyObject(e.data)?e.$parent.fetchAdditionalData():(h(),e.$emit("hideLoader"),setTimeout(function(){e.$apply(function(){p(),e.hideMeBeforeFetching=!0}),$(window).resize()},500));e.$on("changedRoomAvailableData",function(t){i||(e.hideMeBeforeFetching=!1,h(),setTimeout(function(){for(var t=0;t<e.graphData.length;t++)e.clickedOnLegend(e.graphData[t].name,!e.graphData[t].checked);e.$apply(function(){p(),e.hideMeBeforeFetching=!0}),$(window).resize()},1e3))});e.$on("$destroy",function(){i=!0,$(window).unbind("resize"),c&&r.cancel(c)})}]),angular.module("sntRover").controller("rvRoomAvailabilityGridStatusController",["$scope","rvAvailabilitySrv","$q","$window","$timeout","ngDialog",function(e,t,a,o,r,n){var i=14,l=30,s=function(){e.toggleStatusOf={},e.toggleStatusOf.availableRooms=!1,e.toggleStatusOf.roomsSold=!1,e.toggleStatusOf.overbooking=!1,e.toggleStatusOf.occupancy=!1,e.toggleStatusOf.roomInventory=!1,e.toggleStatusOf.bar=!1,e.showShowGroupAllotmentTotals=!1},u=function(){var a={scrollX:!0,preventDefault:!1};e.setScroller("room_availability_scroller",a),e.hideMeBeforeFetching=!1,e.isIncludeOverbooking=!1,s(),e.data=t.getGridData(),isEmptyObject(e.data)||(e.refreshScroller("room_availability_scroller"),e.hideMeBeforeFetching=!0,e.$emit("hideLoader"))},c=function(t){return e.toggleStatusOf.hasOwnProperty(t)&&!!e.toggleStatusOf[t]},d=function(t,a){e.toggleStatusOf.hasOwnProperty(t)&&(typeof a==typeof!0?e.toggleStatusOf[t]=a:e.toggleStatusOf[t]=!e.toggleStatusOf[t])},p=function(t,o,n){return function(i,l){var s="room_availability_scroller",u=a.defer(),c=100;return n()?(d(t,i),e.refreshScroller(s),r(u.resolve,c)):e.invokeApi(o,e.getDateParams(),function(){b(l),d(t,!0),r(u.resolve,c)}),u.promise}},f=function(){var t=a.defer(),o=!0,n=!0,i=[e.toggleOverbooking(o),e.toggleOccupancy(o,n),e.toggleAvailableRooms(o,n),e.toggleSoldRooms(o,n),e.toggleShowGroupAllotmentTotals(o),e.toggleBar(o,n)],l=500;return a.all(i).then(function(){e.toggleRoomInventory(o),r(t.resolve,l)}),t.promise},m=function(){var t=!1;e.toggleRoomInventory(),e.toggleOverbooking(t),e.toggleOccupancy(t),e.toggleAvailableRooms(t),e.toggleSoldRooms(t),e.toggleShowGroupAllotmentTotals(t),e.toggleBar(t)};BaseCtrl.call(this,e),e.toggleOverbooking=p("overbooking",t.fetchOverbooking,function(){return c("overbooking")}),e.toggleOccupancy=p("occupancy",t.fetchBARs,function(){return c("occupancy")}),e.toggleAvailableRooms=p("availableRooms",t.getRoomsAvailability,function(){return c("availableRooms")}),e.toggleSoldRooms=p("roomsSold",t.getOccupancyCount,function(){return c("roomsSold")}),e.toggleRoomInventory=function(t){d("roomInventory",t),e.refreshScroller("room_availability_scroller")},e.toggleBar=p("bar",t.getBestAvailableRatesByRoomType,function(){return c("bar")}),e.toggleShowGroupAllotmentTotals=function(t){var o=a.defer(),n=100;return t===!0?e.$parent.fetchGrpNAllotData().then(function(){r(o.resolve,n)}):e.showShowGroupAllotmentTotals?(e.showShowGroupAllotmentTotals=!1,e.refreshScroller("room_availability_scroller"),r(o.resolve,n)):e.$parent.fetchGrpNAllotData().then(function(){r(o.resolve,n)}),o.promise};var h=function(){$("head").append("<style id='print-orientation'>@page { size: landscape; }</style>")},v=function(){$("#print-orientation").remove()},g={};g.PRINT_AVAILABILITY=e.$on("PRINT_AVAILABILITY",function(e){f().then(function(){var e=500,t=1e3;$("#loading").addClass("ng-hide"),h();var a=function(){r(m,t),v()};r(function(){sntapp.cordovaLoaded?cordova.exec(a,function(){a()},"RVCardPlugin","printWebView",[]):(o.print(),a())},e)})}),g.$includeContentLoaded=e.$on("$includeContentLoaded",function(t){e.$emit("hideLoader"),e.refreshScroller("room_availability_scroller")});var y=function(){return e.data.hasOwnProperty("additionalData")},b=function(a){e.data=t.getGridData(),y()||s(),e.refreshScroller("room_availability_scroller"),e.hideMeBeforeFetching=!0,a||e.$emit("hideLoader")};g.changedRoomAvailableData=e.$on("changedRoomAvailableData",b),g.changedGrpNAllotData=e.$on("changedGrpNAllotData",function(){e.data.gridDataForGroupAvailability=t.getGridDataForGroupAvailability(),e.data.gridDataForAllotmentAvailability=t.getGridDataForAllotmentAvailability(),e.showShowGroupAllotmentTotals=!0,e.refreshScroller("room_availability_scroller"),e.$emit("hideLoader")}),e.getGroupAllotmentName=function(e,t){var a=_.findWhere(e.holdStatus,{id:t});return a&&a.name},e.getWidthForTable=function(){var t=130,a=e.data&&e.data.dates&&e.data.dates.length,o=100;return!_.has(e.data,"dates")&&a<i?0:a===i||a===l?a*o+t:void 0},e.getClassForHoldStatusRow=function(t,a){var o,r,n;return e.showShowGroupAllotmentTotals&&t?(o=_.findWhere(t.holdStatus,{id:a}),r=o&&o.is_take_from_inventory,n=o&&r?"":"hide-row"):n="hide-row",n},g.INCLUDE_OVERBOOKING=e.$on("INCLUDE_OVERBOOKING",function(t,a){e.isIncludeOverbooking=a}),u(),angular.forEach(g,function(t){e.$on("$destroy",t)}),e.showHouseEventsListPopup=function(t,a){a&&(e.selectedEventDisplayDate=t,n.open({template:"/assets/partials/popups/rvHouseEventsListPopup.html",scope:e,controller:"rvHouseEventsListPopupCtrl",className:"ngdialog-theme-default",closeByDocument:!1,closeByEscape:!0}))}}]),angular.module("sntRover").service("rvAvailabilitySrv",["$q","rvBaseWebSrvV2","RVHotelDetailsSrv","dateFilter","rvUtilSrv",function(e,t,a,o,r){var n=this;this.data={},this.getGraphData=function(){return n.data.hasOwnProperty("gridData")&&n.data.gridData.additionalGraphData},this.getGridData=function(){return n.data.gridData},this.getGridDataForGroupAvailability=function(){return n.data.gridDataForGroupAvailability},this.getGridDataForAllotmentAvailability=function(){return n.data.gridDataForAllotmentAvailability},this.updateData=function(e){n.data=e};var i=function(e,t){for(var a={},o=[],r=[],n=[],i=[],l=[],s=[],u=[],c=!1,d="",p="",f="",m="",h="",v="",g="",_=e.physical_count,y=null,b=0;b<e.results.length;b++)y=e.results[b],g={dateObj:new tzIndependentDate(y.date)},d=_-y.house.out_of_order,d=d/_*100,p=y.house.out_of_order/_*100,f=y.house.sold/_*100,m=y.house.availability/_*100,o.push(g),r.push(d),n.push(p),i.push(f),l.push(m);for(b=0;b<t.results.length;b++)y=t.results[b],h=""===escapeNull(y.actual)?0:y.actual,v=""===escapeNull(y.target)?0:y.target,s.push(h),u.push(v),v>0&&(c=!0);return a={dates:o,bookableRooms:r,outOfOrderRooms:n,reservedRooms:i,availableRooms:l,occupanciesActual:s,occupanciesActual:s,occupanciesTargeted:u,totalRooms:_}},l=function(e){var t={},a=[],o=[],n=[],i=[],l=[],u=[];return _.each(e.results,function(t,l,s){var c=[],d=tzIndependentDate(t.date),p=r.isWeekendDay(e.weekend_days,d);a.push({date:t.date,isWeekend:p,dateObj:new Date(t.date)}),o.push(t.group_total_rooms),n.push(t.group_total_pickups),i.push(t.hold_status),_.each(t.group_availability,function(e,a,o){var r={id:e.group_id,Name:e.name,date:t.date,total_blocked_rooms:e.total_blocked_rooms,total_pickedup_rooms:e.total_pickedup_rooms};c.push(r)}),u.push(c)}),_.each(e.results[0].group_availability,function(t,a,o){var r={name:t.name,id:t.group_id,holdStatusName:s(t.hold_status_id,e.hold_status),details:_.zip.apply(null,u)[a]};l.push(r)}),t={dates:a,groupTotalRooms:o,groupTotalPickedUps:n,holdstatuses:_.zip.apply(null,i),groupDetails:l,holdStatus:e.hold_status}},s=function(e,t){var a=_.find(t,function(t){return t.id===e});return a?a.name:""};this.fetchGroupAvailabilityDetails=function(a){var o=a.from_date,r=a.to_date,i={from_date:o,to_date:r},s=e.defer(),u="api/group_availability";return t.getJSON(u,i).then(function(e){n.data.gridDataForGroupAvailability=l(e),s.resolve(n.data)},function(e){s.reject(e)}),s.promise};var u=function(e){var t={},o=[],n=[],i=[],l=[],s=[],u=[],c=[],d=[],p=[],f=[],m=a.hotelDetails.is_hourly_rate_on;return _.each(e.results,function(t){var a=tzIndependentDate(t.date),h=r.isWeekendDay(e.weekend_days,a);o.push({date:t.date,isWeekend:h,dateObj:new Date(t.date)}),n.push(t.house_sell_limit),i.push(t.occupancy.percentage),l.push(t.available_rooms),u.push(t.non_group_rooms),c.push(t.group_and_allotment),
p.push(t.physical_room_count),d.push(t.occupancy.out_of_order),f.push(t.rooms_to_sell),m||s.push(t.rooms_sold)}),t={dates:o,overbooking:n,occupancies:i,availableRooms:l,nonGroupRooms:u,groupAndAllotments:c,outOfOrder:d,inventory:p,roomTypes:e.room_types,roomToSell:f},m||_.extend(t,{bookedRooms:s}),t},c=function(e){var t,a,o={},r=[],n=[],i=[],l=[];return _.each(e.results,function(e){r.push(e.detailed_room_types),t=e.adults_count||0,a=e.children_count||0,l.push({bothCount:t+"/"+a,isWarning:5>=t&&5>=a,isUnavailable:0>=t&&0>=a}),i.push(0==e.best_available_rate_amount.rate_amount?"C":e.best_available_rate_amount.rate_amount)}),_.each(e.results[0].detailed_room_types,function(t){var a={};_.map(e.room_types,function(e){e.id===t.id&&(a.name=e.name,a.is_suite=e.is_suite)}),n.push(a)}),o={roomTypeWiseDetails:_.zip.apply(null,r),roomTypeNames:n,adultsChildrenCounts:l,bestAvailabilityRate:i}};this.fetchAllotmentAvailabilityDetails=function(a){var o=a.from_date,r=a.to_date,i={from_date:o,to_date:r},l=e.defer(),s="api/allotment_availability";return t.getJSON(s,i).then(function(e){n.data.gridDataForAllotmentAvailability=p(e),l.resolve(n.data)},function(e){l.reject(e)}),l.promise};var d=function(e,t){var a=_.find(t,function(t){return t.id===e});return a?a.name:""},p=function(e){var t={},a=[],o=[],n=[],i=[],l=[],s=[];return _.each(e.results,function(t,l,u){var c=[],d=tzIndependentDate(t.date),p=r.isWeekendDay(e.weekend_days,d);a.push({date:t.date,isWeekend:p,dateObj:new Date(t.date)}),o.push(t.total_rooms),n.push(t.total_pickups),i.push(t.hold_status),_.each(t.availability,function(e,a,o){var r={id:e.id,Name:e.name,date:t.date,total_blocked_rooms:e.total_blocked_rooms,total_pickedup_rooms:e.total_pickedup_rooms};c.push(r)}),s.push(c)}),_.each(e.results[0].availability,function(t,a,o){var r={name:t.name,id:t.id,holdStatusName:d(t.hold_status_id,e.hold_status),details:_.zip.apply(null,s)[a]};l.push(r)}),t={dates:a,groupTotalRooms:o,groupTotalPickedUps:n,holdstatuses:_.zip.apply(null,i),groupDetails:l,holdStatus:e.hold_status}};this.fetchAvailabilityDetails=function(a){var o=a.from_date,r=a.to_date,i={from_date:o,to_date:r,is_include_overbooking:a.is_include_overbooking},l=e.defer(),s="api/availability_main";return t.getJSON(s,i).then(function(e){n.data.gridData={},n.data.gridData=u(e),l.resolve(e)},function(e){l.reject(e)}),l.promise},this.fetchBARs=function(a){var o={from_date:a.from_date,to_date:a.to_date},r=e.defer(),i="api/availability/best_rates";return t.getJSON(i,o).then(function(e){var t=[];_.each(e.dates,function(e){t.push(null==e.amount?"C":e.amount)}),n.data.gridData.bestAvailabilityRates=t,r.resolve(t)},function(e){r.reject(e)}),r.promise},this.fetchAvailabilityAdditionalDetails=function(a){var o={from_date:a.from_date,to_date:a.to_date,is_from_availability_screen:!0},r=e.defer(),l="api/calendar_availability";return t.getJSON(l,o).then(function(e){n.fetchOccupancyDetails(a).then(function(t){_.extend(n.data.gridData,{additionalData:c(e),additionalGraphData:i(e,t)}),r.resolve(n.data.gridData)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},this.fetchOccupancyDetails=function(a){var o={from_date:a.from_date,to_date:a.to_date},r=e.defer(),n="api/daily_occupancies";return t.getJSON(n,o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise};var f=function(a){var o=e.defer(),r="/api/availability/house_statistics";return delete a.business_date,t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},m=function(a){var o=e.defer(),r="/api/availability/house";return delete a.business_date,t.getJSON(r,a).then(function(e){o.resolve(e.results)},function(e){o.reject(e)}),o.promise};this.fetchHouseStatusDetails=function(t){var a,o,r,i=e.defer(),l=[],s=tzIndependentDate(t.business_date).clone();return l.push(m(t).then(function(e){a=e})),l.push(f(t).then(function(e){o=e.results,r=e.physical_count})),e.all(l).then(function(){_.each(a,function(e,t){_.extend(o[t],e.house)}),i.resolve(n.restructureHouseDataForUI(o,r,s))},function(e){i.reject(e)}),i.promise},this.restructureHouseDataForUI=function(e,t,a){var o={};o.physical_count=t,o.dates=[],o.total_rooms_occupied={},o.total_guests_inhouse={},o.departues_expected={},o.departures_actual={},o.arrivals_expected={},o.arrivals_actual={},o.available_tonight={},o.occupied_tonight={},o.total_room_revenue={},o.avg_daily_rate={};var r,n,i;return angular.forEach(e,function(e,l){r={},r.date=e.date;var s=tzIndependentDate(e.date);s.getTime()===a.getTime()?r.day="TODAY":s.getTime()<a.getTime()?r.day="YESTERDAY":r.day="TOMORROW",o.dates.push(r),o.total_rooms_occupied[e.date]={},o.total_rooms_occupied[e.date].value=e.sold,o.total_rooms_occupied[e.date].percent=e.sold/t*100,n=e.departing+e.departed,o.departues_expected[e.date]={},o.departues_expected[e.date].value=e.departing,o.departues_expected[e.date].percent=e.departing/n*100,o.departures_actual[e.date]={},o.departures_actual[e.date].value=e.departed,o.departures_actual[e.date].percent=e.departed/n*100,i=e.arriving+e.arrived,o.arrivals_expected[e.date]={},o.arrivals_expected[e.date].value=e.arriving,o.arrivals_expected[e.date].percent=e.arriving/i*100,o.arrivals_actual[e.date]={},o.arrivals_actual[e.date].value=e.arrived,o.arrivals_actual[e.date].percent=e.arrived/i*100,o.available_tonight[e.date]={},o.available_tonight[e.date].value=Math.round(e.availability/t*100),o.available_tonight[e.date].percent=Math.round(e.availability/t*100),o.occupied_tonight[e.date]={},o.occupied_tonight[e.date].value=Math.round(e.sold/t*100),o.occupied_tonight[e.date].percent=Math.round(e.sold/t*100),o.total_room_revenue[e.date]=e.total_room_revenue,o.avg_daily_rate[e.date]=e.average_daily_rate}),o},this.fetchGrpNAllotAvailDetails=function(t){var a=e.defer(),o=2,r=function(){0==o&&a.resolve()},i=function(){o--,r()},l=function(){o--,r()};return n.fetchGroupAvailabilityDetails({from_date:t.from_date,to_date:t.to_date}).then(i,l),n.fetchAllotmentAvailabilityDetails({from_date:t.from_date,to_date:t.to_date}).then(i,l),a.promise},this.getGridDataForInventory=function(){return n.data.gridDataForItemInventory};var h=function(e,t,a){for(var n=[],i=1*new tzIndependentDate(e),l=1*new tzIndependentDate(t);i<=l;i+=864e5){var s=new tzIndependentDate(i),u=r.isWeekendDay(a,s);n.push({date:o(s,"yyyy-MM-dd"),isWeekend:u})}return n};this.fetchItemInventoryDetails=function(a){var o=a.from_date,r=a.to_date,i={from_date:o,to_date:r},l=e.defer(),s="/api/availability/addons";return t.getJSON(s,i).then(function(e){n.data.gridDataForItemInventory={addons:e.addons,dates:h(o,r,e.weekend_days)},l.resolve(n.data)},function(e){l.reject(e)}),l.promise},this.getRoomsAvailability=function(a){var o=e.defer(),r="/api/availability/room_types";return t.getJSON(r,a).then(function(e){var t=[];if(n.data.gridData.additionalData||(n.data.gridData.additionalData={}),e.results.length>0){var a=e.results[0].room_types,r=_.pluck(a,"id");_.each(r,function(e){var a={};a.name=_.find(n.data.gridData.roomTypes,{id:e}).name,a.is_suite=_.find(n.data.gridData.roomTypes,{id:e}).is_suite,t.push(a)})}_.extend(n.data.gridData.additionalData,{roomTypeWiseDetails:_.zip.apply(null,_.pluck(e.results,"room_types")),roomTypeNames:t}),o.resolve(!0)},function(e){o.reject(e)}),o.promise},this.fetchOverbooking=function(a){var o=e.defer(),r="/api/availability/room_type_sell_limits";return t.getJSON(r,a).then(function(e){var t=[];if(n.data.gridData.additionalData||(n.data.gridData.additionalData={}),e.results.length>0){var a=e.results[0].room_types,r=_.pluck(a,"id");_.each(r,function(e){var a={};a.name=_.find(n.data.gridData.roomTypes,{id:e}).name,a.is_suite=_.find(n.data.gridData.roomTypes,{id:e}).is_suite,t.push(a)})}_.extend(n.data.gridData.additionalData,{roomTypeWiseOverbookingDetails:_.zip.apply(null,_.pluck(e.results,"room_types")),roomTypeNamesOverbooking:t}),o.resolve(!0)},function(e){o.reject(e)}),o.promise},this.getGuestOccupancies=function(a){var o=e.defer(),r="/api/daily_occupancies/guest_counts";return t.getJSON(r,a).then(function(e){var t=[];n.data.gridData.additionalData||(n.data.gridData.additionalData={}),_.each(e.results,function(e){t.push({bothCount:e.adults+"/"+e.children})}),_.extend(n.data.gridData.additionalData,{adultsChildrenCounts:t}),o.resolve(!0)},function(e){o.reject(e)}),o.promise},this.getOccupancyCount=function(t){var a=e.defer(),o=[];return n.data.gridData.additionalData&&n.data.gridData.additionalData.roomTypeWiseDetails||o.push(n.getRoomsAvailability(t)),o.push(n.getGuestOccupancies(t)),e.all(o).then(function(){a.resolve(!0)},function(e){a.reject(e)}),a.promise},this.fetchAvailabilityAndBestAvailableRates=function(t){var a=e.defer(),o=[];return n.fetchAvailabilityDetails(t).then(function(r){o.push(n.fetchBARs(t)),o.push(n.fetchHouseEventsCount(t)),e.all(o).then(function(){a.resolve(r)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},this.getBestAvailableRatesByRoomType=function(a){var o=e.defer(),r="/api/availability/bar_for_room_types";return t.getJSON(r,a).then(function(e){var t=[];if(n.data.gridData.additionalData||(n.data.gridData.additionalData={}),e.results.length>0){var a=e.results[0].room_types,r=_.pluck(a,"id");_.each(r,function(e){var a={};a.name=_.find(n.data.gridData.roomTypes,{id:e}).name,a.is_suite=_.find(n.data.gridData.roomTypes,{id:e}).is_suite,t.push(a)})}_.extend(n.data.gridData.additionalData,{roomTypeBar:_.zip.apply(null,_.pluck(e.results,"room_types")),roomTypeList:t}),o.resolve(!0)},function(e){o.reject(e)}),o.promise},this.fetchHouseEventsCount=function(a){var o="/api/house_events/count_per_day",r=e.defer(),i={start_date:a.from_date,end_date:a.to_date};return t.getJSON(o,i).then(function(e){var t={};_.each(e.data,function(e){t[e.date]=e.count}),n.data.gridData.eventsCount=t,r.resolve({})},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("rvGroupConfigurationSrv",["$q","rvBaseWebSrvV2","rvAccountsConfigurationSrv","rvHouseEventsListSrv",function(e,t,a,o){var r=this;this.baseConfigurationSummary={group_id:null,group_name:"",group_code:null,first_name:"",last_name:"",contact_phone:null,contact_email:null,demographics:{reservation_type_id:"",market_segment_id:"",source_id:"",booking_origin_id:"",segment_id:""},travel_agent:null,company:null,hold_status:"",block_from:"",block_to:"",revenue_actual:null,revenue_potential:null,rooms_total:null,rooms_pickup:null,rate:"",addons_count:null,notes:[]},this.lastFetchedGroup={group_id:null,demographics:null},this.getHoldStatusList=function(a){var o=e.defer(),r="/api/group_hold_statuses";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveRoomBlockBookings=function(a){var o=e.defer(),r="/api/groups/save_inventories";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveMassUpdate=function(a){var o=e.defer(),r="/api/groups/save_bulk_inventories";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getGroupInventories=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/inventories";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRoomBlockGridDetails=function(t){var a=[],n=e.defer();return a.push(r.getGroupInventories(t)),a.push(o.fetchHouseEventsCount(t)),e.all(a).then(function(e){var t=e[0];t.eventsCount=e[1],n.resolve(t)},function(){n.reject({})}),n.promise},this.getAllRoomTypes=function(){var a=e.defer(),o="/api/room_types.json?is_exclude_pseudo=true";return t.getJSON(o).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getSelectedRoomTypesAndRates=function(a){var o=e.defer(),r=a.id,n="/api/groups/"+r+"/room_type_and_rates";return t.getJSON(n,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateSelectedRoomTypesAndRates=function(a){var o=e.defer(),r="/api/groups/update_room_type_and_rates";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.cancelGroup=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/cancel";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.sendGroupConfirmationEmail=function(a){var o=e.defer(),r=a.postData,n=" api/groups/"+a.groupId+"/group_email_confirmation";return t.postJSON(n,r).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRoomTypeBestAvailableRateAndOccupancyCount=function(a){var o=e.defer(),r="/api/groups/availability";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise};this.getGroupSummary=function(o){var n=e.defer(),i="";if("NEW_GROUP"===o.groupId)n.resolve(angular.copy({groupSummary:r.baseConfigurationSummary}));else{var i="api/groups/"+o.groupId;t.getJSON(i).then(function(e){var o,i=e.posting_account_id;null===e.rate&&(e.rate=-1),e.country_id=e.country_id?e.country_id:"",e.nationality=e.nationality?e.nationality:"",r.lastFetchedGroup={id:e.group_id,demographics:angular.copy(e.demographics)},"NEW_ACCOUNT"===i?n.resolve({accountSummary:angular.copy(a.baseAccountSummaryData)}):(o="api/posting_accounts/"+i,t.getJSON(o).then(function(t){_.defer(n.resolve,{groupSummary:e,accountSummary:t})},function(e){n.reject(e)}))},function(e){n.reject(e)})}return n.promise},this.searchCompanyCards=function(a){var o=e.defer(),r="api/accounts?account_type=COMPANY&query="+a;return t.getJSON(r).then(function(e){o.resolve(e.accounts)},function(e){o.reject(e)}),o.promise},this.searchTravelAgentCards=function(a){var o=e.defer(),r="api/accounts?account_type=TRAVELAGENT&query="+a;return t.getJSON(r).then(function(e){o.resolve(e.accounts)},function(e){o.reject(e)}),o.promise},this.updateGroupSummary=function(a){var o=e.defer(),n="api/groups/"+a.summary.group_id;return r.processGroupUpdatePostData(a.summary),t.putJSON(n,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveGroupSummary=function(a){var o=e.defer(),r="api/groups";return t.postJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.addGroupEnhancement=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/addons";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeGroupEnhancement=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/addons";return t.deleteJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getGroupEnhancements=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/addons";return t.getJSON(r).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveGroupNote=function(a){var o=e.defer(),r="api/groups/save_group_note";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateGroupNote=function(a){var o=e.defer(),r="api/notes/"+a.id;return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeGroupNote=function(a){var o=e.defer(),r="api/groups/delete_group_note";return t.deleteJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateRoomingListItem=function(a){var o=e.defer(),r="api/group_reservations/"+a.id;return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeRoomingListItem=function(a){var o=e.defer(),r="api/group_reservations/"+a.id+"/cancel";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.releaseRooms=function(a){var o=e.defer(),r="api/groups/"+a.groupId+"/release_now";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRates=function(a){var o=e.defer(),r="api/groups/rates";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.toggleHideRate=function(a){var o=e.defer(),r="api/groups/"+a.group_id+"/hide_rates";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateRate=function(a){var o=e.defer(),r="api/groups/"+a.group_id+"/change_rate";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.completeMoveGroup=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/move_dates",n={from_date:a.from_date,to_date:a.to_date,old_from_date:a.old_from_date,old_to_date:a.old_to_date,force_fully_over_book:a.force_fully_over_book};return t.postJSON(r,n).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.changeDates=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/change_dates",n=_.omit(a,"group_id");return t.postJSON(r,n).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.deleteBillingInfo=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/remove_routing";return t.postJSON(r,{}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.processGroupUpdatePostData=function(e){var t=isObjectAllValuesEmpty(e.company),a=isObjectAllValuesEmpty(e.travel_agent);t&&(e.company={}),a&&(e.travel_agent={}),e=replaceValueWithinObject(e,"",null)},this.updateAddonPosting=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/update_addon_posting";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateCompanyCard=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/update_company_card";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateHoldStatus=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/hold_status";return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.fetchRoomTypesRates=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/daily_rates";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRoomTypesOccupancyRateDetailsAndEventsCount=function(t){var a=[],n=e.defer();return a.push(r.fetchRoomTypesRates(t)),a.push(o.fetchHouseEventsCount(t)),e.all(a).then(function(e){var t={results:e[0],eventsCount:e[1]};n.resolve(t)},function(e){n.reject(e)}),n.promise},this.performRateMassUpdate=function(a){var o=e.defer(),r="/api/groups/"+a.groupId+"/daily_rates/bulk_update";return delete a.groupId,t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveRoomTypesDailyRates=function(a){var o=e.defer(),r="/api/groups/"+a.group_id+"/daily_rates";return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]),angular.module("sntRover").service("rvAccountsConfigurationSrv",["$q","rvBaseWebSrvV2",function(e,t){var a=this;this.baseAccountSummaryData={posting_account_id:"",posting_account_name:"",posting_account_number:"",posting_account_type:"HOUSE",posting_account_status:"OPEN",demographics:{market_segment_id:"",source_id:"",booking_origin_id:""},notes:[],travel_agent:null,company:null},this.getAccountSummary=function(o){var r=e.defer();if("NEW_ACCOUNT"===o.accountId)r.resolve(angular.copy(a.baseAccountSummaryData));else{var n="api/posting_accounts/"+o.accountId;t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)})}return r.promise},this.updateAccountSummary=function(a){var o=e.defer(),r="api/posting_accounts/"+a.summary.posting_account_id;return t.putJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateBillingRefNumber=function(a){var o=e.defer(),r="api/posting_accounts/"+a.summary.posting_account_id;return a.summary.custom_reference_number=a.custom_reference_number,t.putJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveAccountSummary=function(a){var o=e.defer(),r="api/posting_accounts";return t.postJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveAccountNote=function(a){var o=e.defer(),r="api/posting_accounts/save_posting_account_note";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateAccountNote=function(a){var o=e.defer(),r="api/notes/"+a.id;return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeAccountNote=function(a){var o=e.defer(),r="api/posting_accounts/delete_posting_account_note";return t.deleteJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.emailInvoice=function(a){var o=e.defer(),r="api/posting_accounts/email_bill_card";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]),angular.module("sntRover").service("rvAllotmentConfigurationSrv",["$q","rvBaseWebSrvV2","rvAccountsConfigurationSrv","rvHouseEventsListSrv",function(e,t,a,o){var r=this;this.baseConfigurationSummary={allotment_id:null,allotment_name:"",allotment_code:null,first_name:"",last_name:"",contact_phone:"",contact_email:"",demographics:{reservation_type_id:"",market_segment_id:"",source_id:"",booking_origin_id:""},travel_agent:null,company:null,hold_status:"",block_from:"",block_to:"",revenue_actual:null,revenue_potential:null,release_date:"",rooms_total:null,rooms_pickup:null,rate:"",addons_count:null,notes:[],selected_room_types_and_bookings:[],selected_room_types_and_occupanies:[],selected_room_types_and_rates:[]},this.lastFetchedAllotment={id:null,demographics:null},this.getHoldStatusList=function(a){var o=e.defer(),r="/api/group_hold_statuses";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveRoomBlockBookings=function(a){var o=e.defer(),r="/api/allotments/save_inventories";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveMassUpdate=function(a){var o=e.defer(),r="/api/allotments/save_bulk_inventories";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveRoomBlockReleaseDays=function(a){var o=e.defer(),r="/api/allotments/update_release_date";return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getAllotmentInventories=function(a){var o=e.defer(),r="/api/allotments/"+a.allotment_id+"/inventories";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRoomBlockGridDetails=function(t){var a=[],n=e.defer();return a.push(r.getAllotmentInventories(t)),a.push(o.fetchHouseEventsCount(t)),e.all(a).then(function(e){var t=e[0];t.eventsCount=e[1],n.resolve(t)},function(){n.reject({})}),n.promise},this.getAllRoomTypes=function(){var a=e.defer(),o="/api/room_types.json?is_exclude_pseudo=true";return t.getJSON(o).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getSelectedRoomTypesAndRates=function(a){var o=e.defer(),r=a.id,n="/api/allotments/"+r+"/room_type_and_rates";return t.getJSON(n,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateSelectedRoomTypesAndRates=function(a){var o=e.defer(),r="/api/allotments/update_room_type_and_rates";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.cancelAllotment=function(a){var o=e.defer(),r="/api/allotments/"+a.allotment_id+"/cancel";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRoomTypeBestAvailableRateAndOccupancyCount=function(a){var o=e.defer(),r="/api/allotments/availability";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise};var n={};this.getAllotmentSummary=function(a){var o=e.defer();if("NEW_ALLOTMENT"===a.allotmentId)o.resolve(angular.copy({allotmentSummary:r.baseConfigurationSummary}));else{var i="api/allotments/"+a.allotmentId;t.getJSON(i).then(function(e){null===e.rate&&(e.rate=-1),n.allotmentSummary=e,r.lastFetchedAllotment={id:e.allotment_id,demographics:e.demographics},o.resolve(n)},function(e){o.reject(e)})}return o.promise},this.searchCompanyCards=function(a){var o=e.defer(),r="api/accounts?account_type=COMPANY&query="+a;return t.getJSON(r).then(function(e){o.resolve(e.accounts)},function(e){o.reject(e)}),o.promise},this.searchTravelAgentCards=function(a){var o=e.defer(),r="api/accounts?account_type=TRAVELAGENT&query="+a;return t.getJSON(r).then(function(e){o.resolve(e.accounts)},function(e){o.reject(e)}),o.promise},this.updateAllotmentSummary=function(a){var o=e.defer(),r="api/allotments/"+a.summary.allotment_id;return t.putJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveAllotmentSummary=function(a){var o=e.defer(),r="api/allotments";return t.postJSON(r,a.summary).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.addAllotmentEnhancement=function(a){var o=e.defer(),r="/api/allotments/"+a.id+"/addons";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeAllotmentEnhancement=function(a){var o=e.defer(),r="/api/allotments/"+a.id+"/addons";return t.deleteJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateAddonPosting=function(a){var o=e.defer(),r="/api/allotments/"+a.id+"/update_addon_posting";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getAllotmentEnhancements=function(a){var o=e.defer(),r="/api/allotments/"+a.id+"/addons";return t.getJSON(r).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.saveAllotmentNote=function(a){var o=e.defer(),r="api/allotments/save_allotment_note";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeAllotmentNote=function(a){var o=e.defer(),r="api/allotments/delete_allotment_note";return t.deleteJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateRoomingListItem=function(a){var o=e.defer(),r="/api/allotments/"+a.id+"/update_reservation";return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.removeRoomingListItem=function(a){var o=e.defer(),r="api/allotment_reservations/"+a.id+"/cancel";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.releaseRooms=function(a){var o=e.defer(),r="api/allotments/"+a.allotmentId+"/release_now";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.getRates=function(a){var o=e.defer(),r="api/allotments/rates";return t.getJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.toggleHideRate=function(a){var o=e.defer(),r="api/allotments/"+a.allotment_id+"/hide_rates";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateRate=function(a){var o=e.defer(),r="api/allotments/"+a.allotment_id+"/change_rate";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.copyDefaultBillingInfo=function(a){var o=e.defer(),r="api/default_account_routings/copy_default_billing_info_to_allotments";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.copyContactToHeld=function(a){var o=e.defer(),r="api/allotments/copy_contract";return t.postJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.updateHoldStatus=function(a){var o=e.defer(),r="/api/groups/"+a.id+"/hold_status";return t.putJSON(r,a).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]);