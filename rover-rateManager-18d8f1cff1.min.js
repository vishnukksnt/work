"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function Model(e){var t=function(e){return{enumerable:!0,writable:!0,value:e}},a=Object.prototype.hasOwnProperty;if(!(this instanceof Model))return new Model(e);Object.defineProperties(this,{isUpdating:t(!1),isResolved:t(!1),isDirty:t(!1)});for(var r in e)a.call(e,r)&&(this[r]=e[r])}function Time(e){return this instanceof Time?(e=function(e){var t={};return e.toFixed?(t.milliseconds=e%1e3,t.seconds=Math.floor(e/1e3),t.minutes=Math.floor(e/6e4),t.hours=Math.floor(e/36e5),t):e}(e),void function(e){var t=function(e){return{enumerable:!0,writable:!0,value:e}};Object.defineProperties(this,{milliseconds:t(e.milliseconds||0),seconds:t(e.seconds||0),minutes:t(e.minutes||0),hours:t(e.hours||0)})}.call(this,e)):new Time(e)}var RateManagerActivityIndicatorComponent=function(e){var t=e.showLoader;return React.createElement("div",{style:{display:t?"block":"none"},id:"loading"},React.createElement("div",{id:"loading-spinner"}))},RateManagerBottomRestrictionListComponent=function(e){var t=(e.divClassNames,e.ulClassNames),a=e.restrictionTypes;return React.createElement("ul",{className:t},a.map(function(e,t){return React.createElement("li",{key:"restriction-type-"+t},React.createElement(RateManagerRestrictionIconComponent,{className:e.className,text:e.defaultText}),React.createElement("span",null,e.description))}))},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_React=React,createClass=_React.createClass,RateManagerGridViewRootComponent=createClass({componentDidMount:function(){this.commonIScrollOptions={probeType:3,scrollbars:!1,scrollX:!1,scrollY:!0,preventDefault:!0,preventDefaultException:{tagName:/^(BUTTON)$/i},mouseWheel:!0,deceleration:9e-4},this.leftScrollableElement=this.rightScrollableElement=this.rightHeadScrollableElement=null,this.leftScroller=this.rightScroller=this.rightHeaderScroller=null,this.scrolling=!1,this.startingScroll_Y_Position=0,this.setScrollers()},setScrollers:function(){this.setLeftScroller(),this.setRightScroller(),this.setRightHeadScroller(),this.setScrollerSync()},setLeftScroller:function(){this.props.shouldShow&&!this.leftScrollableElement&&(this.leftScrollableElement=$(findDOMNode(this)).find(".pinnedLeft-list")[0]),this.leftScroller&&this.leftScroller.wrapper instanceof Element&&!document.body.contains(this.leftScroller.wrapper)&&(this.leftScroller=null),this.props.shouldShow&&!this.leftScroller&&(this.leftScroller=new IScroll(this.leftScrollableElement,this.commonIScrollOptions))},setRightHeadScroller:function(){this.props.shouldShow&&!this.rightHeadScrollableElement&&(this.rightHeadScrollableElement=$(findDOMNode(this)).find(".calendar-rate-table-days.scrollable")[0]),this.rightHeadScroller&&this.rightHeadScroller.wrapper instanceof Element&&!document.body.contains(this.rightHeadScroller.wrapper)&&(this.rightHeadScroller=null),this.props.shouldShow&&!this.rightHeadScroller&&(this.rightHeadScroller=new IScroll(this.rightHeadScrollableElement,_extends({},this.commonIScrollOptions,{scrollX:!0,scrollY:!1,scrollbars:!1})))},setRightScroller:function(){this.props.shouldShow&&!this.rightScrollableElement&&(this.rightScrollableElement=$(findDOMNode(this)).find(".calendar-rate-table-grid.scrollable")[0]),this.rightScroller&&this.rightScroller.wrapper instanceof Element&&!document.body.contains(this.rightScroller.wrapper)&&(this.rightScroller=null),this.props.shouldShow&&!this.rightScroller&&(this.rightScroller=new IScroll(this.rightScrollableElement,_extends({},this.commonIScrollOptions,{scrollX:!0,click:!0,scrollbars:"custom"})))},setScrollerSync:function(){var e=this;this.rightScroller&&this.leftScroller&&this.rightHeadScroller&&(this.leftScroller.on("scroll",function(){e.rightScroller.scrollTo(e.rightScroller.x,e.leftScroller.y)}),this.rightScroller.on("scroll",function(){e.leftScroller.scrollTo(e.leftScroller.x,e.rightScroller.y),e.rightHeadScroller.scrollTo(e.rightScroller.x,e.rightHeadScroller.y)}),this.rightHeadScroller.on("scroll",function(){e.rightScroller.scrollTo(e.rightHeadScroller.x,e.rightScroller.y)}))},refreshScrollers:function(){var e=this,t=this.rightScroller instanceof IScroll,a=this.rightHeadScroller instanceof IScroll,r=this.leftScroller instanceof IScroll;t&&r&&a&&setTimeout(function(){if(e.rightScroller.refresh(),e.leftScroller.refresh(),e.rightHeadScroller.refresh(),e.props.scrollTo){var t=e.props.scrollTo,a=t.offsetX?t.offsetX:void 0,r=t.offsetY?t.offsetY:void 0;if(!_.isUndefined(t.col)){var n=".rate-calendar thead tr th:nth-child("+t.col+")";e.rightHeadScroller.scrollToElement(n,0,a,r),e.rightHeadScroller.refresh()}if(!_.isUndefined(t.row)){var i="tr:nth-child("+t.row+")",o=".pinnedLeft-list .rate-calendar tbody "+i;if(e.leftScroller.scrollToElement(o,0,a,r),e.leftScroller.refresh(),!_.isUndefined(t.col)){var s="#rateViewCalendar tbody "+i+" td:nth-child("+t.col+")";e.rightScroller.scrollToElement(s,0,a,r),e.rightScroller.refresh()}}}},200)},componentDidUpdate:function(){this.setScrollers(),this.refreshScrollers()},render:function(){var e=this;if(!this.props.shouldShow)return this.leftScrollableElement=this.rightScrollableElement=this.rightHeadScrollableElement=null,this.leftScroller=this.rightScroller=this.rightHeaderScroller=null,!1;var t=this.props.showAvailability&&(this.props.mode===RM_RX_CONST.ROOM_TYPE_VIEW_MODE||this.props.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE);return React.createElement("div",{className:this.props.wrapperClass+(t?" show-availability":"")},React.createElement(RateManagerGridLeftSideContainer,null),!this.props.showHierarchyHeader&&React.createElement(RateManagerGridRightSideHeaderContainer,null),this.props.showHierarchyHeader&&React.createElement(RateManagerGridRightSideHierarchyHeaderContainer,null),this.props.showHierarchyHeader&&""!==this.props.hierarchyRestrictionClass&&React.createElement("div",{onClick:function(){return e.props.handleToggler()},className:"calendar-rate-table-handle "+this.props.frozenPanelClass+this.props.hierarchyRestrictionClass}),React.createElement(RateManagerGridRightSideBottomComponent,{hierarchyRestrictionClass:this.props.frozenPanelClass+this.props.hierarchyRestrictionClass}),React.createElement(RateManagerBottomRestrictionListContainer,null))}}),_React=React,createClass=_React.createClass,RateManagerHierarchyRestrictionsComponent=createClass({selectRestriction:function(e){var t=e.target.value;this.props.changedHeirarchyRestriction(t)},render:function(){var e=this;return React.createElement("div",{className:"select"},React.createElement("select",{onChange:function(){return e.selectRestriction(event)}},this.props.listValues.map(function(e){return React.createElement("option",{key:e.value,value:e.value},e.name)})))}}),RateManagerNoResultsFoundComponent=function(e){var t=e.shouldShow;return t?React.createElement("div",{id:"rate-manager-not-configured",className:"no-content"},React.createElement("div",{className:"info"},React.createElement("span",{className:"icon-no-content icon-rates"}),React.createElement("strong",{className:"h1"},"No Results"),React.createElement("span",{className:"h2"},"Please change the selected filters and try again"))):React.createElement("noscript",null)},_React=React,PropTypes=_React.PropTypes;RateManagerNoResultsFoundComponent.propTypes={shouldShow:PropTypes.bool.isRequired};var RateManagerNotConfiguredComponent=function(e){var t=e.shouldShow;return!!t&&React.createElement("div",{id:"rate-manager-not-configured",className:"no-content"},React.createElement("div",{className:"info"},React.createElement("span",{className:"icon-no-content icon-rates"}),React.createElement("strong",{className:"h1"},"Rate Manager not configured"),React.createElement("span",{className:"h2"},"Please select filter options to begin")))},_React=React,PropTypes=_React.PropTypes;RateManagerNotConfiguredComponent.propTypes={shouldShow:PropTypes.bool.isRequired};var RateManagerRestrictionIconComponent=function(e){var t=e.className,a=e.text;return React.createElement("span",{className:t},a)},RateManagerRootComponent=function(){return React.createElement("div",{className:"calendar"},React.createElement(RateManagerNotConfiguredContainer,null),React.createElement(RateManagerNoResultsFoundContainer,null),React.createElement(RateManagerActivityIndicatorContainer,null),React.createElement(RateManagerGridViewRootContainer,null))},RateManagerGridLeftSideComponent=function(e){var t=e.hierarchyCount,a=e.hierarchyClass,r=e.panelToggleClass,n=e.mode;return React.createElement("div",{className:"pinnedLeft "+r+a},React.createElement(RateManagerGridLeftSideHeadButtonContainer,null),0!==t&&React.createElement(RateManagerGridLeftHierarchyHeaderContainer,null),0===t&&React.createElement("div",{className:"pinnedLeft-select last"},React.createElement(RateManagerGridLeftFirstRowContainer,null)),(n===RM_RX_CONST.RATE_VIEW_MODE||n===RM_RX_CONST.RATE_TYPE_VIEW_MODE)&&React.createElement("div",{className:"pinnedLeft-select-container pinnedLeft-availability"},React.createElement("div",{className:"pinnedLeft-select last"},React.createElement("div",{className:"name"},"Available Rooms"))),React.createElement("div",{className:"pinnedLeft-list"},React.createElement("div",{className:"wrapper"},React.createElement("table",{className:"rate-calendar"},React.createElement(RateManagerGridLeftRowsContainer,null)))))},RateManagerGridLeftFirstRowComponent=function(e){var t=e.text;return React.createElement("span",{className:"name"},t)},RateManagerGridLeftRowComponent=function(e){var t=e.trClassName,a=e.tdClassName,r=e.name,n=e.onClick,i=e.index,o=e.leftSpanClassName,s=(e.showIconBeforeText,e.iconClassBeforeText,e.textInIconArea),c=e.leftSpanText,l=(e.showRightSpan,e.rightSpanClassName),d=e.showIndicator;return React.createElement("tr",{className:t,onTouchEnd:function(e){return n(e,i)},onClick:function(e){return n(e,i)}},React.createElement("td",{className:a},React.createElement("a",{title:r},React.createElement("span",{className:o},"B"==s&&d?React.createElement("span",{className:"base-rate-indicator"},"B"):"",c),React.createElement("span",{className:l}))))},RateManagerGridLeftRowsComponent=function(e){var t=e.leftListingData,a=e.onItemClick;e.onItemClickActionType;return React.createElement("tbody",null,t.map(function(e,t){return React.createElement(RateManagerGridLeftRowComponent,{key:e.id,index:t,name:e.name,trClassName:e.trClassName,tdClassName:e.tdClassName,onClick:function(e,t){a(e,t)},leftSpanClassName:e.leftSpanClassName,showIconBeforeText:e.showIconBeforeText,iconClassBeforeText:e.iconClassBeforeText,textInIconArea:e.textInIconArea,leftSpanText:e.leftSpanText,showRightSpan:e.showRightSpan,rightSpanClassName:e.rightSpanClassName,showIndicator:e.showIndicator})}))},RateManagerGridLeftSideHeadButtonComponent=function(e){var t=e.shouldShowPagination,a=e.goToPrevPage,r=e.goToNextPage,n=e.isFirstPage,i=e.isLastPage,o=e.prevPageButtonText,s=e.nextPageButtonText;return React.createElement("div",{className:"pinnedLeft-actions"},t?React.createElement("div",null,n?"":React.createElement("button",{className:"button blue prev",onTouchEnd:function(e){e.stopPropagation(),a(e)},onClick:function(e){e.stopPropagation(),a(e)}},o),i?"":React.createElement("button",{className:"button blue next",onTouchEnd:function(e){e.stopPropagation(),r(e)},onClick:function(e){e.stopPropagation(),r(e)}},s)):"")},RateManagerLeftHierarchyHeaderComponent=function(e){var t=e.activeRestrictions;return React.createElement("div",{className:"pinnedLeft-select-container"},t.map(function(e,a){return React.createElement("div",{className:"pinnedLeft-select"+(a===t.length-1?" last":"")},React.createElement("span",{className:"name"},e))}))},RateManagerCellAvailabilityComponent=function(e){var t=e.availability;return React.createElement("span",{className:"cell-availability "+(t<1?"red":"")},t)},RateManagerCellsNoRateComponent=function(){return React.createElement("span",{className:"rate-single no-rate"},"NO RATE")},RateManagerCellsRateComponent=function(e){var t=e.amount;return React.createElement("span",{className:"rate-single"},t?React.createElement("span",{className:"rate-single-text"},"From"):"",t)},_React=React,createClass=_React.createClass,RateManagerGridRightSideAvailableRoomsHeaderComponent=createClass({render:function(){return React.createElement("table",{className:"rate-calendar rate-calendar-availability"},React.createElement("tbody",null,React.createElement("tr",{className:"last"},this.props.houseAvailability&&this.props.houseAvailability.map(function(e,t){return React.createElement("td",{className:"cell",key:"house-available-"+t},React.createElement("div",{className:"cell-container "+e.headerClass},React.createElement("div",{className:"cell-content"},e.count)))}))))}}),RateManagerGridRightSideBottomComponent=function(e){var t=e.hierarchyRestrictionClass;return React.createElement("div",{id:"rateViewCalendar",className:"calendar-rate-table calendar-rate-table-grid scrollable "+t},React.createElement("div",{className:"wrapper"},React.createElement("table",{className:"rate-calendar"},React.createElement(RateManagerGridRightSideRowsContainer,null))))},_React=React,createClass=_React.createClass,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,RateManagerGridRightSideHeaderComponent=createClass({componentDidMount:function(){this.setWidth()},componentDidUpdate:function(){this.setWidth()},setWidth:function(){var e=$(findDOMNode(this)),t=e.find(".wrapper")[0],a=e.find(".rate-calendar")[0];t.style.width=a.offsetWidth+"px"},render:function(){var e=this;return React.createElement("div",{className:"calendar-rate-table calendar-rate-table-days scrollable"},React.createElement("div",{className:"wrapper"},React.createElement("table",{className:"rate-calendar"},React.createElement("thead",null,React.createElement("tr",{className:"cell"},this.props.headerDataList.map(function(t,a){return React.createElement("th",{className:t.headerClass,key:"header-data-"+a},React.createElement("div",{className:"date-header"},0!==t.eventCount&&React.createElement("div",{onClick:function(){return e.props.onDailyEventCountClick(t.date)},"data-events":t.eventCount,className:"has-event-block border"},React.createElement("div",{className:t.cellClass},React.createElement("span",{className:t.topLabelContainerClass},t.topLabel),React.createElement("span",{className:t.bottomLabelContainerClass},t.bottomLabel))),0===t.eventCount&&React.createElement("div",{className:t.cellClass},React.createElement("span",{className:t.topLabelContainerClass},t.topLabel),React.createElement("span",{className:t.bottomLabelContainerClass},t.bottomLabel))))}))),!this.props.hideTopHeader&&React.createElement("tbody",null,this.props.summary.map(function(t,a){return React.createElement("tr",{key:"key-"+a,className:a+1===e.props.summary.length?"last":""},t.restrictionList.map(function(t,r){return React.createElement("td",{onClick:function(t){return e.props.onTdClick(t,a,r)},key:"key-"+r,className:"cell"},React.createElement("div",{className:"cell-container "+(e.props.dateList[r].isWeekEnd?"weekend_day":"")},React.createElement("div",{className:"cell-content "+(e.props.dateList[r].isPastDate?"isHistory-cell-content":"")},t.map(function(e,t){return React.createElement(RateManagerRestrictionIconComponent,{key:"key-"+t,className:""+e.className,text:e.days})}))))}))}))),(this.props.mode===RM_RX_CONST.RATE_VIEW_MODE||this.props.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE)&&React.createElement(RateManagerGridRightSideAvailableRoomsHeaderContainer,null)))}}),RateManagerGridRightSideHierarchyHeaderCellComponent=function(e){var t=e.onTdClick,a=e.restrictionSummary,r=e.dateList;return React.createElement("tr",null,a.length&&a[0].restrictionList.map(function(e,a){return React.createElement("td",{onClick:function(e){return t(e,a)},key:"key-"+a,className:"cell"},React.createElement("div",{className:"cell-container "+(r[a].isWeekEnd?"weekend_day":"")},React.createElement("div",{className:"cell-content "+(r[a].isPastDate?"isHistory-cell-content":"")},e.map(function(e,t){return React.createElement(RateManagerRestrictionIconComponent,{key:"key-"+t,className:""+e.className,text:e.days})}))))}))},_React=React,createClass=_React.createClass,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,RateManagerGridRightSideHierarchyHeaderComponent=createClass({componentDidMount:function(){this.setWidth()},componentDidUpdate:function(){this.setWidth()},setWidth:function(){var e=$(findDOMNode(this)),t=e.find(".wrapper")[0],a=e.find(".rate-calendar")[0];t.style.width=a.offsetWidth+"px"},render:function(){var e=this;return React.createElement("div",{className:"calendar-rate-table calendar-rate-table-days scrollable "+this.props.frozenPanelClass+this.props.hierarchyRestrictionClass},React.createElement("div",{className:"wrapper"},React.createElement("table",{className:"rate-calendar"},React.createElement("thead",null,React.createElement("tr",{className:"cell"},this.props.headerDataList.map(function(t,a){return React.createElement("th",{className:t.headerClass,key:"header-data-"+a},React.createElement("div",{className:"date-header"},0!==t.eventCount&&React.createElement("div",{onClick:function(){return e.props.onDailyEventCountClick(t.date)},"data-events":t.eventCount,className:"has-event-block border"},React.createElement("div",{className:t.cellClass},React.createElement("span",{className:t.topLabelContainerClass},t.topLabel),React.createElement("span",{className:t.bottomLabelContainerClass},t.bottomLabel))),0===t.eventCount&&React.createElement("div",{className:t.cellClass},React.createElement("span",{className:t.topLabelContainerClass},t.topLabel),React.createElement("span",{className:t.bottomLabelContainerClass},t.bottomLabel))))}))),React.createElement("tbody",null,this.props.showHouse&&React.createElement(RateManagerHierarchyHouseHeaderContainer,null),this.props.showRoomType&&React.createElement(RateManagerHierarchyRoomTypeHeaderContainer,null),this.props.showRateType&&React.createElement(RateManagerHierarchyRateTypeHeaderContainer,null),this.props.showRate&&React.createElement(RateManagerHierarchyRateHeaderContainer,null),this.props.showAllRoomTypes&&React.createElement(RateManagerGridRightSideHeaderAllRoomTypesContainer,null))),(this.props.mode===RM_RX_CONST.RATE_VIEW_MODE||this.props.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE)&&React.createElement(RateManagerGridRightSideAvailableRoomsHeaderContainer,null)))}}),_React=React,createClass=_React.createClass,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,RateManagerGridRightSideRowsComponent=createClass({componentDidMount:function(){this.setWidth(),this.props.hideLoader()},componentDidUpdate:function(){this.setWidth(),this.props.refreshScrollers(),this.props.hideLoader()},shouldComponentUpdate:function(e,t){return!(e.action===RM_RX_CONST.REFRESH_SCROLLERS)},setWidth:function(){var e=$(findDOMNode(this)),t=e.parents(".rate-calendar")[0],a=e.parents(".wrapper")[0];a.style.width=t.offsetWidth+"px"},render:function(){var e=this.props.mode;return e===RM_RX_CONST.RATE_VIEW_MODE||e===RM_RX_CONST.ROOM_TYPE_VIEW_MODE||e===RM_RX_CONST.RATE_TYPE_VIEW_MODE?React.createElement(RateManagerGridRightSideRowsRestrictionContainer,null):e===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE?React.createElement(RateManagerGridRightSideRowsRestrictionListAndAmountContainer,null):void 0}}),RateManagerGridRightSideRowsRestrictionComponent=function(e){var t=e.onTdClick,a=(e.mode,e.restrictionRows),r=e.dateList,n=e.showAvailability;return React.createElement("tbody",null,a.map(function(e,i){return React.createElement("tr",{key:"key-"+i,className:i+1===a.length?"last":""},e.restrictionList.map(function(a,o){return React.createElement("td",{onClick:function(e){return t(e,i,o)},key:"key-"+o,className:"cell"},React.createElement("div",{className:"cell-container "+(r[o].isWeekEnd?"weekend_day":"")},React.createElement("div",{className:"cell-content "+(r[o].isPastDate?"isHistory-cell-content":"")},n&&e.availabilityList&&null!==e.availabilityList[o]&&React.createElement(RateManagerCellAvailabilityComponent,{availability:e.availabilityList[o]}),e.amountList&&null!==e.amountList[o]?React.createElement(RateManagerCellsRateComponent,{amount:e.amountList[o]}):React.createElement(RateManagerCellsNoRateComponent,null),React.createElement("div",{className:"restriction_holder"},a.map(function(e,t){return React.createElement(RateManagerRestrictionIconComponent,{key:"key-"+t,className:""+e.className,text:e.days})})))))}))}))},RateManagerGridRightSideRowsRestrictionListAndAmountComponent=function(e){var t=e.onTdClick,a=(e.mode,e.roomTypeRowsData),r=e.dateList,n=e.showAvailability;return React.createElement("tbody",null,a.map(function(e,i){return React.createElement("tr",{key:"key-"+i,className:i+1===a.length?"last":""},e.restrictionList.map(function(a,o){return React.createElement("td",{key:"key-"+o,onClick:function(e){return t(e,i,o)},className:"cell"},React.createElement("div",{className:"cell-container"+(r[o].isWeekEnd?" weekend_day":"")+(e.expanded?" expanded-cell":"")},e.expanded?React.createElement("div",{className:"cell-content "+(r[o].isPastDate?"isHistory-cell-content":"")},React.createElement("div",{className:"restriction_holder"},a.map(function(e,t){return React.createElement(RateManagerRestrictionIconComponent,{key:"key-"+t,className:"right "+e.className,text:e.days})})),React.createElement("div",{className:"room-type-price"},React.createElement("span",{className:"room-type-price-name"},"Single"),React.createElement("span",{className:"room-type-price-value"+(e.rateDetails[o].single_overridden?" has-override":"")+(null!==e.rateDetails[o].single?"":" hidden")},e.rateDetails[o].rate_currency,e.rateDetails[o].single,React.createElement("span",{className:"icon-report icon-upsell"+(e.rateDetails[o].single_overridden?"":" hidden")}))),React.createElement("div",{className:"room-type-price"},React.createElement("span",{className:"room-type-price-name"},"Double"),React.createElement("span",{className:"room-type-price-value"+(e.rateDetails[o].double_overridden?" has-override":"")+(null!==e.rateDetails[o].double?"":" hidden")},e.rateDetails[o].rate_currency,e.rateDetails[o].double,React.createElement("span",{className:"icon-report icon-upsell"+(e.rateDetails[o].double_overridden?"":" hidden")}))),React.createElement("div",{className:"room-type-price"},React.createElement("span",{className:"room-type-price-name"},"Extra Adult"),React.createElement("span",{className:"room-type-price-value"+(e.rateDetails[o].extra_adult_overridden?" has-override":"")+(null!==e.rateDetails[o].extra_adult?"":" hidden")},e.rateDetails[o].rate_currency,e.rateDetails[o].extra_adult,React.createElement("span",{className:"icon-report icon-upsell"+(e.rateDetails[o].extra_adult_overridden?"":" hidden")}))),React.createElement("div",{className:"room-type-price"},React.createElement("span",{className:"room-type-price-name"},"Child"),React.createElement("span",{className:"room-type-price-value"+(e.rateDetails[o].child_overridden?" has-override":"")+(null!==e.rateDetails[o].child?"":" hidden")},e.rateDetails[o].rate_currency,e.rateDetails[o].child,React.createElement("span",{className:"icon-report icon-upsell"+(e.rateDetails[o].child_overridden?"":" hidden")})))):React.createElement("div",{className:"cell-content "+(r[o].isPastDate?"isHistory-cell-content":"")},n&&React.createElement(RateManagerCellAvailabilityComponent,{availability:e.availabilityList[o]}),React.createElement("span",{className:"rate-single"+(e.rateDetails[o].single_overridden||e.rateDetails[o].child_overridden||e.rateDetails[o].extra_adult_overridden||e.rateDetails[o].double_overridden?" has-override":"")+(null!==e.rateDetails[o].single?"":" hidden")},e.rateDetails[o].rate_currency,e.rateDetails[o].single,React.createElement("span",{className:"icon-report icon-upsell"+(e.rateDetails[o].single_overridden||e.rateDetails[o].child_overridden||e.rateDetails[o].extra_adult_overridden||e.rateDetails[o].double_overridden?"":" hidden")})),React.createElement("div",{className:"restriction_holder"},a.map(function(e,t){return React.createElement(RateManagerRestrictionIconComponent,{key:"key-"+t,className:"right "+e.className,text:e.days})})))))}))}))},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerActivityIndicatorComponentProps=function(e){return{showLoader:e.loader===RM_RX_CONST.ACTIVATE_LOADER}},RateManagerActivityIndicatorContainer=connect(mapStateToRateManagerActivityIndicatorComponentProps)(RateManagerActivityIndicatorComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertRestrictionsIntoProps=function(e){var t=null,a=[];return a=e.map(function(e){return t=RateManagerRestrictionTypes[e.value],_extends({},e,t)}),t=RateManagerRestrictionTypes.MORE_RESTRICTIONS,a.push(_extends({},t)),a},mapStateToRateManagerBottomRestrictionListProps=function(e){return{ulClassNames:"restriction-legends",restrictionTypes:convertRestrictionsIntoProps(e.restrictionTypes)}},RateManagerBottomRestrictionListContainer=connect(mapStateToRateManagerBottomRestrictionListProps)(RateManagerBottomRestrictionListComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,shouldShowGridViewRootContainer=function(e){var t=[RM_RX_CONST.NO_RESULTS_FOUND_MODE,RM_RX_CONST.NOT_CONFIGURED_MODE];return t.indexOf(e.mode)===-1},hierarchyRestrictionsActive=function(e){return e.isHierarchyHouseRestrictionEnabled||e.isHierarchyRoomTypeRestrictionEnabled||e.isHierarchyRateTypeRestrictionEnabled||e.isHierarchyRateRestrictionEnabled},mapStateToRateManagerGridViewRootComponentProps=function(e){return{shouldShow:shouldShowGridViewRootContainer(e),mode:e.mode,refreshScrollers:e.action===RM_RX_CONST.REFRESH_SCROLLERS,scrollTo:e.scrollTo,paginationStateData:e.paginationState,hierarchyRestrictionClass:e.hierarchyRestrictionClass,showHierarchyHeader:hierarchyRestrictionsActive(e),toggleFunction:e.callBacksFromAngular&&e.callBacksFromAngular.handlePanelToggle,frozenPanelClass:e.frozenPanelClass,houseAvailability:e.houseAvailability,showAvailability:e.showAvailability,eventsCount:e.eventsCount}},mapDispatchToRateManagerGridViewRootComponentProps=function(e,t,a){var r="calendar-wraper",n=e.mode===RM_RX_CONST.RATE_VIEW_MODE&&Math.ceil(e.paginationStateData.totalRows/e.paginationStateData.perPage)===e.paginationStateData.page;if(e.mode===RM_RX_CONST.RATE_VIEW_MODE&&e.paginationStateData.page>1&&(r+=" load-top"),e.mode!==RM_RX_CONST.RATE_VIEW_MODE||n||(r+=" load-bottom"),e.mode!==RM_RX_CONST.RATE_VIEW_MODE&&e.mode!==RM_RX_CONST.RATE_TYPE_VIEW_MODE||(r+=" with-availability"),e.toggleFunction)var i=function(){e.toggleFunction(e.frozenPanelClass)};return _extends({},e,{wrapperClass:r,handleToggler:i})},RateManagerGridViewRootContainer=connect(mapStateToRateManagerGridViewRootComponentProps,null,mapDispatchToRateManagerGridViewRootComponentProps)(RateManagerGridViewRootComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,getListValues=function(){var e=[{name:"House Restrictions",value:"HOUSE"}];return e},mapStateToRateManagerHierarchyRestrictionsComponentProps=function(e){return{listValues:getListValues(),changedHeirarchyRestriction:e.callBacksFromAngular.changedHeirarchyRestriction}},RateManagerHierarchyRestrictionsContainer=connect(mapStateToRateManagerHierarchyRestrictionsComponentProps)(RateManagerHierarchyRestrictionsComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerNoResultsFoundComponentProps=function(e){return{shouldShow:e.mode===RM_RX_CONST.NO_RESULTS_FOUND_MODE}},RateManagerNoResultsFoundContainer=connect(mapStateToRateManagerNoResultsFoundComponentProps)(RateManagerNoResultsFoundComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerNotConfiguredComponentProps=function(e){return{shouldShow:e.mode===RM_RX_CONST.NOT_CONFIGURED_MODE}},RateManagerNotConfiguredContainer=connect(mapStateToRateManagerNotConfiguredComponentProps)(RateManagerNotConfiguredComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerGridLeftFirstRowComponentProps=function(e){var t=e.isHierarchyHouseRestrictionEnabled||e.isHierarchyRoomTypeRestrictionEnabled&&e.mode===RM_RX_CONST.ROOM_TYPE_VIEW_MODE||e.isHierarchyRateTypeRestrictionEnabled&&e.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE,a=(e.isHierarchyHouseRestrictionEnabled&&1)+(e.isHierarchyRoomTypeRestrictionEnabled&&1)+(e.isHierarchyRateTypeRestrictionEnabled&&1)+(e.isHierarchyRateRestrictionEnabled&&1);return{hideTopHeader:t,hierarchyCount:a,hierarchyClass:e.hierarchyRestrictionClass,panelToggleClass:e.frozenPanelClass,mode:e.mode}},RateManagerGridLeftSideContainer=connect(mapStateToRateManagerGridLeftFirstRowComponentProps)(RateManagerGridLeftSideComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerGridLeftFirstRowComponentProps=function(e){return{text:RM_RX_CONST.VIEW_MODE_TEXT_MAPPINGS[e.mode]}},RateManagerGridLeftFirstRowContainer=connect(mapStateToRateManagerGridLeftFirstRowComponentProps)(RateManagerGridLeftFirstRowComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,getActiveHierarchyRestrictions=function(e){var t=[];return e.isHierarchyHouseRestrictionEnabled&&t.push("HOUSE"),e.isHierarchyRoomTypeRestrictionEnabled&&t.push("ROOM TYPE"),e.isHierarchyRateTypeRestrictionEnabled&&t.push("RATE TYPE"),e.isHierarchyRateRestrictionEnabled&&t.push("RATE"),e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE&&t.push("All room types"),t},mapStateToRateManagerLeftHierarchyHeaderComponentProps=function(e){return{activeRestrictions:getActiveHierarchyRestrictions(e)}},RateManagerGridLeftHierarchyHeaderContainer=connect(mapStateToRateManagerLeftHierarchyHeaderComponentProps)(RateManagerLeftHierarchyHeaderComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertRatesDataForLeftListing=function(e,t){var a=[],r=t==RM_RX_CONST.RATE_VIEW_MODE;return e.map(function(t,n){a.push({id:t.id,name:t.name,trClassName:"cell rate "+(n+1===e.length?"last":""),tdClassName:"",leftSpanClassName:"name "+(t.based_on_rate_id&&!t.is_copied?"gray":"base-rate")+(t.is_company_card||t.is_travel_agent?" contracted-rate":" contracted-rate contracted-rate-missing-info"),showIconBeforeText:!t.based_on_rate_id,iconClassBeforeText:t.based_on_rate_id?"":"base-rate-indicator",textInIconArea:t.based_on_rate_id?"":"B",leftSpanText:t.name,showRightSpan:!0,rightSpanClassName:"icons icon-double-arrow rotate-right",showIndicator:r})}),a},convertRateTypesDataForLeftListing=function(e,t,a){var r=[],n=t===RM_RX_CONST.RATE_TYPE_VIEW_MODE,i=t===RM_RX_CONST.RATE_TYPE_VIEW_MODE&&a;return e.map(function(t,a){r.push({id:t.id,name:t.name,trClassName:"cell rate "+(a+1===e.length?"last":"")+(i?" disable-element":""),tdClassName:"",leftSpanClassName:"name "+(t.based_on_rate_id&&!t.is_copied?"gray":"base-rate")+(t.is_company_card||t.is_travel_agent?" contracted-rate":" contracted-rate contracted-rate-missing-info"),showIconBeforeText:!t.based_on_rate_id,iconClassBeforeText:t.based_on_rate_id?"":"base-rate-indicator",textInIconArea:t.based_on_rate_id?"":"B",leftSpanText:t.name,showRightSpan:!0,rightSpanClassName:i?"":"icons icon-double-arrow rotate-right",showIndicator:n})}),r},convertRoomTypesDataForLeftListing=function(e){var t=[];
return e.map(function(a,r){t.push(_extends({},a,{trClassName:"cell rate "+(r+1===e.length?"last":"")+" disable-element",tdClassName:"",leftSpanClassName:"name ",showIconBeforeText:!1,textInIconArea:"",leftSpanText:a.name,showRightSpan:!1}))}),t},convertSingleRateRoomTypesDataForLeftListing=function(e,t){var a=[],r=!1;return e.map(function(n,i){r=t.indexOf(i)>-1,a.push(_extends({},n,{trClassName:"cell rate"+(i+1===e.length?" last":"")+(r?" expanded-row":""),tdClassName:"",leftSpanClassName:"name ",showIconBeforeText:!1,textInIconArea:"",leftSpanText:n.name,showRightSpan:!0,rightSpanClassName:"icons icon-double-arrow"+(r?" rotate-up":" rotate-down")}))}),a},mapStateToRateManagerGridLeftRowsContainerProps=function(e){return e.mode===RM_RX_CONST.RATE_VIEW_MODE?{leftListingData:convertRatesDataForLeftListing(e.list,e.mode),mode:e.mode,fromDate:e.dates[0],toDate:e.dates[e.dates.length-1],callBackForSingleRateFetch:e.callBacksFromAngular.singleRateViewCallback}:e.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE?{leftListingData:convertRateTypesDataForLeftListing(e.list,e.mode,e.isHierarchyRateTypeRestrictionEnabled),mode:e.mode,fromDate:e.dates[0],toDate:e.dates[e.dates.length-1],callBackForSingleRateTypeFetch:e.callBacksFromAngular.singleRateTypeViewCallback}:e.mode===RM_RX_CONST.ROOM_TYPE_VIEW_MODE?{leftListingData:convertRoomTypesDataForLeftListing(e.list)}:e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE?{leftListingData:convertSingleRateRoomTypesDataForLeftListing(e.list,e.expandedRows),mode:e.mode}:void 0},mapDispatchToRateManagerGridLeftRowsContainerProps=function(e,t,a){return{onItemClick:function(a,r){var n=t.dispatch;if(e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE)n({type:RM_RX_CONST.TOGGLE_EXPAND_COLLAPSE_ROW,payLoad:{index:r}});else if(e.mode===RM_RX_CONST.RATE_VIEW_MODE){var i=e.leftListingData[r];e.callBackForSingleRateFetch({fromDate:e.fromDate,toDate:e.toDate,selectedRates:[{id:i.id,name:i.name,accountName:i.accountName,address:i.address}]})}else if(e.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE){var o=e.leftListingData[r];e.callBackForSingleRateTypeFetch({fromDate:e.fromDate,toDate:e.toDate,selectedRateTypes:[{id:o.id,name:o.name}]})}},leftListingData:e.leftListingData}},RateManagerGridLeftRowsContainer=connect(mapStateToRateManagerGridLeftRowsContainerProps,null,mapDispatchToRateManagerGridLeftRowsContainerProps)(RateManagerGridLeftRowsComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerGridLeftSideHeadButtonContainerProps=function(e){var t={mode:e.mode,fromDate:e.dates[0],toDate:e.dates[e.dates.length-1]};return e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE?t.shouldShowPagination=!1:e.mode===RM_RX_CONST.RATE_VIEW_MODE?(t.shouldShowPagination=!0,t.goToPrevPage=e.callBacksFromAngular.goToPrevPage,t.goToNextPage=e.callBacksFromAngular.goToNextPage,t.paginationStateData=e.paginationState):e.mode===RM_RX_CONST.ROOM_TYPE_VIEW_MODE?t.shouldShowPagination=!1:e.mode===RM_RX_CONST.RATE_TYPE_VIEW_MODE&&(t.shouldShowPagination=!0,t.goToPrevPage=e.callBacksFromAngular.goToPrevPage,t.goToNextPage=e.callBacksFromAngular.goToNextPage,t.paginationStateData=e.paginationState),t},getPreviousPageButtonText=function(e,t){var a="PREVIOUS ";switch(e){case RM_RX_CONST.RATE_VIEW_MODE:a+=t.perPage+" RATES";break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:a+=t.perPage+" RATE TYPES"}return a},getNextPageButtonText=function(e,t){var a="NEXT ";switch(e){case RM_RX_CONST.RATE_VIEW_MODE:a+=Math.ceil(t.totalRows/t.perPage)===t.page+1?t.totalRows-t.perPage*t.page+" RATES":t.perPage+" RATES";break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:a+=Math.ceil(t.totalRows/t.perPage)===t.page+1?t.totalRows-t.perPage*t.page+" RATE TYPES":t.perPage+" RATE TYPES"}return a},mapActionToRateManagerGridLeftSideHeadButtonContainerProps=function(e,t,a){var r=!1,n=!1;return e.mode!==RM_RX_CONST.RATE_VIEW_MODE&&e.mode!==RM_RX_CONST.RATE_TYPE_VIEW_MODE||(1===e.paginationStateData.page&&(r=!0),Math.ceil(e.paginationStateData.totalRows/e.paginationStateData.perPage)===e.paginationStateData.page&&(n=!0)),_extends({},e,{goToPrevPage:e.goToPrevPage,goToNextPage:e.goToNextPage,isFirstPage:r,isLastPage:n,prevPageButtonText:getPreviousPageButtonText(e.mode,e.paginationStateData),nextPageButtonText:getNextPageButtonText(e.mode,e.paginationStateData)})},RateManagerGridLeftSideHeadButtonContainer=connect(mapStateToRateManagerGridLeftSideHeadButtonContainerProps,null,mapActionToRateManagerGridLeftSideHeadButtonContainerProps)(RateManagerGridLeftSideHeadButtonComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,processDataForHeader=function(e,t){if(!e)return[];var a=[],r=null,n=!1,i=!1,o="",s="";return e.map(function(e){r=tzIndependentDate(e.date),n=6===r.getDay()||0===r.getDay(),i=r<t,o=n?"weekend_day":"",s=i?"isHistory-cell-content":"",a.push({headerClass:o,count:e.available_rooms})}),a},mapStateToRateManagerGridRightSideAvailableRoomsHeaderContainerProps=function(e){var t={houseAvailability:processDataForHeader(e.houseAvailability,e.businessDate),hideAvailableRoomsHeader:e.mode===RM_RX_CONST.ROOM_TYPE_VIEW_MODE};return t},RateManagerGridRightSideAvailableRoomsHeaderContainer=connect(mapStateToRateManagerGridRightSideAvailableRoomsHeaderContainerProps)(RateManagerGridRightSideAvailableRoomsHeaderComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateForRateManagerGridRightSideHeaderAllRoomTypesContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,restrictionSummary:t.convertDataForRestrictionListing(e.summary[0].allRoomTypeSummary,e.restrictionTypes),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,cellClicked:e.callBacksFromAngular.clickedOnRoomTypeAndAmountCell};return a},mapDispatchForRateManagerGridRightSideHeaderAllRoomTypesContainerProps=function(e,t){var a=function(t,a){var r=e.dates[a],n=[];return e.cellClicked({roomTypeIDs:n,date:r})};return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerGridRightSideHeaderAllRoomTypesContainer=connect(mapStateForRateManagerGridRightSideHeaderAllRoomTypesContainerProps,null,mapDispatchForRateManagerGridRightSideHeaderAllRoomTypesContainerProps)(RateManagerGridRightSideHierarchyHeaderCellComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertDateDataForHeader=function(e,t,a){var r,n=[],i=null,o=null,s=null,c=!1,l=!1,d="",R="";return e.map(function(e){i=tzIndependentDate(e),o=i.toComponents().date,s=o.day.toString(),c=6===i.getDay()||0===i.getDay(),l=i<t,d=c?"weekend_day":"",R=c?"weekend_day":"",l&&(d="",R="isHistory-cell-content"),r=_.find(a,{date:e}),n.push({headerClass:d,cellClass:R,topLabel:o.weekday,topLabelContainerClass:"week-day",bottomLabel:o.monthName+" "+(1===s.length?"0"+s:s),bottomLabelContainerClass:"",eventCount:r&&r.count||0,date:e})}),n},mapStateToRateManagerGridRightSideHeaderContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,headerDataList:convertDateDataForHeader(e.dates,e.businessDate,e.eventsCount),summary:t.convertDataForRestrictionListing(e.summary,e.restrictionTypes),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,hideTopHeader:!1,onDailyEventCountClick:e.callBacksFromAngular.onDailyEventCountClick};switch(e.mode){case RM_RX_CONST.RATE_VIEW_MODE:a.clickedOnRateCellOnRateView=e.callBacksFromAngular.clickedOnRateViewCell;break;case RM_RX_CONST.ROOM_TYPE_VIEW_MODE:a.clickedOnRoomTypeViewCell=e.callBacksFromAngular.clickedOnRoomTypeViewCell,a.hideTopHeader=!e.isHierarchyHouseRestrictionEnabled&&e.isHierarchyRoomTypeRestrictionEnabled;break;case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE:a.clickedOnRoomTypeAndAmountCell=e.callBacksFromAngular.clickedOnRoomTypeAndAmountCell;break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:a.hideTopHeader=!e.isHierarchyHouseRestrictionEnabled&&e.isHierarchyRateTypeRestrictionEnabled,a.clickedOnRateTypeViewCell=e.callBacksFromAngular.clickedOnRateTypeViewCell}return a},mapDispatchToRateManagerGridRightSideHeaderContainerProps=function(e,t){var a=function(){};switch(e.mode){case RM_RX_CONST.RATE_VIEW_MODE:a=function(t,a,r){var n=e.dates[r],i=[];return e.clickedOnRateCellOnRateView({rateIDs:i,date:n})};break;case RM_RX_CONST.ROOM_TYPE_VIEW_MODE:a=function(t,a,r){var n=e.dates[r],i=[];return e.clickedOnRoomTypeViewCell({roomTypeIDs:i,date:n})};break;case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE:a=function(t,a,r){var n=e.dates[r],i=[];return e.clickedOnRoomTypeAndAmountCell({roomTypeIDs:i,date:n})};break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:a=function(t,a,r){var n=e.dates[r],i=[];return e.clickedOnRateTypeViewCell({rateTypeIDs:i,date:n})}}return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerGridRightSideHeaderContainer=connect(mapStateToRateManagerGridRightSideHeaderContainerProps,null,mapDispatchToRateManagerGridRightSideHeaderContainerProps)(RateManagerGridRightSideHeaderComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertDateDataForHeader=function(e,t,a){var r,n=[],i=null,o=null,s=null,c=!1,l=!1,d="",R="";return e.map(function(e){i=tzIndependentDate(e),o=i.toComponents().date,s=o.day.toString(),c=6===i.getDay()||0===i.getDay(),l=i<t,d=c?"weekend_day":"",R=c?"weekend_day":"",l&&(d="",R="isHistory-cell-content"),r=_.find(a,{date:e}),n.push({headerClass:d,cellClass:R,topLabel:o.weekday,topLabelContainerClass:"week-day",bottomLabel:o.monthName+" "+(1===s.length?"0"+s:s),bottomLabelContainerClass:"",eventCount:r&&r.count||0,date:e})}),n},mapStateToRateManagerGridRightSideHierarchyHeaderContainerProps=function(e){var t={headerDataList:convertDateDataForHeader(e.dates,e.businessDate,e.eventsCount),showHouse:e.isHierarchyHouseRestrictionEnabled,showRoomType:e.isHierarchyRoomTypeRestrictionEnabled,showRateType:e.isHierarchyRateTypeRestrictionEnabled,showRate:e.isHierarchyRateRestrictionEnabled,showAllRoomTypes:e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE,hierarchyRestrictionClass:e.hierarchyRestrictionClass,frozenPanelClass:e.frozenPanelClass,mode:e.mode,onDailyEventCountClick:e.callBacksFromAngular.onDailyEventCountClick};return t},mapDispatchToRateManagerGridRightSideHierarchyHeaderContainerProps=function(e,t){return _extends({},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerGridRightSideHierarchyHeaderContainer=connect(mapStateToRateManagerGridRightSideHierarchyHeaderContainerProps,null,mapDispatchToRateManagerGridRightSideHierarchyHeaderContainerProps)(RateManagerGridRightSideHierarchyHeaderComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerGridRightSideRowsContainerProps=function(e){return{mode:e.mode,action:e.action,list:e.list,expandedRows:e.expandedRows}},mapDispatchToRateManagerGridRightSideRowsContainerProps=function(e){return{refreshScrollers:function(){e({type:RM_RX_CONST.REFRESH_SCROLLERS})},hideLoader:function(){e({type:RM_RX_CONST.ACT_HIDE_ACTIVITY_INDICATOR})}}},RateManagerGridRightSideRowsContainer=connect(mapStateToRateManagerGridRightSideRowsContainerProps,mapDispatchToRateManagerGridRightSideRowsContainerProps)(RateManagerGridRightSideRowsComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToRateManagerGridRightSideRestrictionRowsContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a=t.convertDataForRestrictionListing(e.list,e.restrictionTypes),r={};switch(r={restrictionRows:a,mode:e.mode,dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,showAvailability:e.showAvailability},e.mode){case RM_RX_CONST.RATE_VIEW_MODE:r.clickedOnRateCellOnRateView=e.callBacksFromAngular.clickedOnRateViewCell;break;case RM_RX_CONST.ROOM_TYPE_VIEW_MODE:r.clickedOnRoomTypeViewCell=e.callBacksFromAngular.clickedOnRoomTypeViewCell;break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:r.clickedOnRateTypeViewCell=e.callBacksFromAngular.clickedOnRateTypeViewCell}return r},mapDispatchToRateManagerGridRightSideRowsRestrictionContainer=function(e,t,a){var r=function(){};switch(e.mode){case RM_RX_CONST.RATE_VIEW_MODE:r=function(t,a,r){var n=e.dates[r],i=[];return i=[e.restrictionRows[a].id],e.clickedOnRateCellOnRateView({rateIDs:i,date:n})};break;case RM_RX_CONST.ROOM_TYPE_VIEW_MODE:r=function(t,a,r){var n=e.dates[r],i=[];return i=[e.restrictionRows[a].id],e.clickedOnRoomTypeViewCell({roomTypeIDs:i,date:n})};break;case RM_RX_CONST.RATE_TYPE_VIEW_MODE:r=function(t,a,r){var n=e.dates[r],i=[];return i=[e.restrictionRows[a].id],e.clickedOnRateTypeViewCell({rateTypeIDs:i,date:n})}}return _extends({onTdClick:r},e)},RateManagerGridRightSideRowsRestrictionContainer=connect(mapStateToRateManagerGridRightSideRestrictionRowsContainerProps,null,mapDispatchToRateManagerGridRightSideRowsRestrictionContainer)(RateManagerGridRightSideRowsRestrictionComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertDateListForRestrictionAndAmountView=function(e,t){var a=[],r=null,n=null,i=!1,o=!1;return e.map(function(e){r=tzIndependentDate(e),n=r.toComponents().date,i=6===r.getDay()||0===r.getDay(),o=r<t,a.push({date:r,isWeekEnd:i,isPastDate:o})}),a},applyRestrictionLogicForSingleRateView=function(e,t,a){t=t.map(function(e){return _extends({},e,RateManagerRestrictionTypes[e.value])});var r=_.pluck(t,"id"),n=_.object(r,t),i=RateManagerRestrictionTypes.MORE_RESTRICTIONS;i.days=i.defaultText;var o=[];return e.map(function(e,t){o.push(_extends({},e,{expanded:a.indexOf(t)>-1,restrictionList:e.restrictionList.map(function(e){return e.length>=RM_RX_CONST.MAX_RESTRICTION_IN_COLUMN?[_extends({},i)]:e.map(function(e){return _extends({},e,n[e.restriction_type_id])})})}))}),o},mapStateToRateManagerGridRightSideRowsRestrictionListAndAmountContainerProps=function(e){var t=e.mode===RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE,a=t?applyRestrictionLogicForSingleRateView(e.list,e.restrictionTypes,e.expandedRows):[];return{roomTypeRowsData:a,mode:e.mode,dateList:convertDateListForRestrictionAndAmountView(e.dates,e.businessDate),dates:e.dates,clickedOnRoomTypeAndAmountCell:e.callBacksFromAngular.clickedOnRoomTypeAndAmountCell,showAvailability:e.showAvailability}},mapDispatchToRateManagerGridRightSideRowsRestrictionListAndAmountContainerContainer=function(e,t,a){var r=function(){};switch(e.mode){case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE:r=function(t,a,r){var n=e.dates[r],i=[e.roomTypeRowsData[a].id];return e.clickedOnRoomTypeAndAmountCell({roomTypeIDs:i,date:n})}}return _extends({onTdClick:r},e)},RateManagerGridRightSideRowsRestrictionListAndAmountContainer=connect(mapStateToRateManagerGridRightSideRowsRestrictionListAndAmountContainerProps,null,mapDispatchToRateManagerGridRightSideRowsRestrictionListAndAmountContainerContainer)(RateManagerGridRightSideRowsRestrictionListAndAmountComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateForRateManagerHierarchyHouseHeaderContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,restrictionSummary:t.convertDataForRestrictionListing(e.summary[0].houseRestrictionSummary,e.restrictionTypes,!0),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,cellClicked:e.callBacksFromAngular.clickedOnHierarchyHouseCell};return a},mapDispatchForRateManagerHierarchyHouseHeaderContainerProps=function(e,t){var a=function(t,a){var r=e.dates[a],n=[];return e.cellClicked({rateIDs:n,date:r})};return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerHierarchyHouseHeaderContainer=connect(mapStateForRateManagerHierarchyHouseHeaderContainerProps,null,mapDispatchForRateManagerHierarchyHouseHeaderContainerProps)(RateManagerGridRightSideHierarchyHeaderCellComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateForRateManagerHierarchyRateHeaderContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,restrictionSummary:t.convertDataForRestrictionListing(e.summary[0].rateRestrictionSummary,e.restrictionTypes,!0),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,cellClicked:e.callBacksFromAngular.clickedOnHierarchyRateCell};return a},mapDispatchForRateManagerHierarchyRateHeaderContainerProps=function(e,t){var a=function(t,a){var r=e.dates[a],n=[];return e.cellClicked({rateIDs:n,date:r})};return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerHierarchyRateHeaderContainer=connect(mapStateForRateManagerHierarchyRateHeaderContainerProps,null,mapDispatchForRateManagerHierarchyRateHeaderContainerProps)(RateManagerGridRightSideHierarchyHeaderCellComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateForRateManagerHierarchyRateTypeHeaderContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,restrictionSummary:t.convertDataForRestrictionListing(e.summary[0].rateTypeRestrictionSummary,e.restrictionTypes,!0),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,cellClicked:e.callBacksFromAngular.clickedOnHierarchyRateTypeCell};return a},mapDispatchForRateManagerHierarchyRateTypeHeaderContainerProps=function(e,t){var a=function(t,a){var r=e.dates[a],n=[];return e.cellClicked({rateTypeIDs:n,date:r})};return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerHierarchyRateTypeHeaderContainer=connect(mapStateForRateManagerHierarchyRateTypeHeaderContainerProps,null,mapDispatchForRateManagerHierarchyRateTypeHeaderContainerProps)(RateManagerGridRightSideHierarchyHeaderCellComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateForRateManagerHierarchyRoomTypeHeaderContainerProps=function(e){var t=new rvRateManagerRightSideContainerUtils,a={mode:e.mode,restrictionSummary:t.convertDataForRestrictionListing(e.summary[0].roomTypeRestrictionSummary,e.restrictionTypes,!0),dateList:t.convertDateListForRestrictionView(e.dates,e.businessDate,e.weekendDays),dates:e.dates,cellClicked:e.callBacksFromAngular.clickedOnHierarchyRoomTypeCell};return a},mapDispatchForRateManagerHierarchyRoomTypeHeaderContainerProps=function(e,t){var a=function(t,a){var r=e.dates[a],n=[];return e.cellClicked({roomTypeIDs:n,date:r})};return _extends({onTdClick:a},e,{refreshScrollers:function(){t({type:RM_RX_CONST.REFRESH_SCROLLERS})}})},RateManagerHierarchyRoomTypeHeaderContainer=connect(mapStateForRateManagerHierarchyRoomTypeHeaderContainerProps,null,mapDispatchForRateManagerHierarchyRoomTypeHeaderContainerProps)(RateManagerGridRightSideHierarchyHeaderCellComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},rvRateManagerRightSideContainerUtils=function(){var e=this;return e.convertDateListForRestrictionView=function(e,t,a){var r=[],n=null,i=null,o=!1,s=!1;return e.map(function(e){n=tzIndependentDate(e),i=n.toComponents().date,o=isWeekendDay(a,n),s=n<t,r.push({date:n,isWeekEnd:o,isPastDate:s})}),r},e.convertDataForRestrictionListing=function(e,t,a){t=t.map(function(e){return _extends({},e,RateManagerRestrictionTypes[e.value])});var r=_.pluck(t,"id"),n=_.object(r,t),i=RateManagerRestrictionTypes.MORE_RESTRICTIONS;return i.days=i.defaultText,e=e.map(function(e){return e.restrictionList=e.restrictionList.map(function(e,t){return a?e.length>RM_RX_CONST.MAX_RESTRICTION_IN_COLUMN?[_extends({},i)]:e.map(function(e){var t=_extends({},e,n[e.restriction_type_id]);return t.days&&t.days.length>1?(t.days=i.days,t.defaultText=i.defaultText,t.description=i.description):t.days&&1===t.days.length&&(t.days=t.days[0]),t}):e.length>=RM_RX_CONST.MAX_RESTRICTION_IN_COLUMN?[_extends({},i)]:e.map(function(e){return _extends({},e,n[e.restriction_type_id])})}),e})},{convertDateListForRestrictionView:e.convertDateListForRestrictionView,convertDataForRestrictionListing:e.convertDataForRestrictionListing}};sntRover.constant("rvRateManagerGroupByConstants",[{text:"Hierarchy (Parent/Child)",value:"HIERARCHY_PARENT_CHILD"}]),sntRover.constant("rvRateManagerOrderByConstants",{LOW_TO_HIGH:"Lowest Rate",HIGH_TO_LOW:"Highest Rate",ALPHABETICAL_A_Z:"Alphabetical A->Z",ALPHABETICAL_Z_A:"Alphabetical Z->A",CUSTOM_SEQUENCE:"Custom Sequence"}),sntRover.constant("rvRateManagerPaginationConstants",{allRate:{datePerPage:75,maxNumberOfDateColumnsDisplay:90,rowHeight:55,additionalRowsToPickFromPrevious:5,scrollDistanceToMoveAfterUpdatingAllRatesRow:10},scroll:{STILL:0,UP:1,RIGHT:2,BOTTOM:3,LEFT:4}}),sntRover.constant("rvRateManagerPopUpConstants",{RM_SINGLE_RATE_RESTRICTION_MODE:"RM_single_rate_restrctin_mode",RM_SINGLE_RATE_TYPE_RESTRICTION_MODE:"RM_single_rate_type_restriction_mode",RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE:"RM_multiple_rate_type_restriction_mode",RM_MULTIPLE_RATE_RESTRICTION_MODE:"RM_multiple_rate_restrctin_mode",RM_SINGLE_ROOMTYPE_RESTRICTION_MODE:"RM_single_roomtype_restriction_mode",RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE:"RM_multiple_roomtype_restrctin_mode",RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:"RM_single_rate_restrctin_single_roomtype_amount_mode",RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:"RM_single_rate_restrctin_multiple_roomtype_amount_mode"});var _Redux=Redux,createStore=_Redux.createStore,applyMiddleware=_Redux.applyMiddleware,compose=_Redux.compose,finalCreateStore=compose(applyMiddleware(ReduxThunk.default),window.devToolsExtension?window.devToolsExtension():function(e){return e})(createStore),configureStore=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{mode:RM_RX_CONST.NOT_CONFIGURED};return finalCreateStore(rateManagerRootReducer,e)},rateManagerActions={rateViewChanged:function(e){return{mode:RM_RX_CONST.RATE_VIEW_CHANGED}}},RM_RX_CONST={GRID_VIEW:"RM_Grid_View",GRAPH_VIEW:"RM_Graph_View",RATE_VIEW_WITH_ADDRESS:"Rate_View_With_Address",RATE_VIEW_CHANGED:"RM_Rate_View_Changed",ROOM_TYPE_VIEW_CHANGED:"RM_Room_Type_View_Changed",RATE_TYPE_VIEW_CHANGED:"RM_Rate_Type_View_Changed",SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:"RM_Single_Rate_Expandable_View_Changed",SHOW_NO_RESULTS:"RM_Show_No_Results",NO_RESULTS_FOUND_MODE:"RM_No_Results_Found_Mode",NOT_CONFIGURED_MODE:"RM_Not_Configured_Mode",RATE_VIEW_MODE:"RM_Rate_View",ROOM_TYPE_VIEW_MODE:"RM_Room_Type_View",RATE_TYPE_VIEW_MODE:"RM_Rate_Type_View",SINGLE_RATE_EXPANDABLE_VIEW_MODE:"RM_Single_Rate_Expandable_View",REFRESH_SCROLLERS:"RM_Refresh_Scrollers",SCROLLER_REFRESHED:"RM_Refresh_Scroller_done",REFRESH_SCROLLERS_ACTION:"RM_ACT_Refresh_Scrollers",OPEN_ALL:"RM_Open_All_Button_Clicked",CLOSE_ALL:"RM_Close_All_Button_Clicked",TOGGLE_EXPAND_COLLAPSE_ROW:"RM_Toggle_Expand_collapse_row",HIERARCHY_FROZEN_PANEL_TOGGLED:"RM_Toggle_Hierarchy_Frozen_Panel",ACT_SHOW_ACTIVITY_INDICATOR:"RM_Act_Show_Activity_Indicator",ACTIVATE_LOADER:"RM_Show_Loader",ACT_HIDE_ACTIVITY_INDICATOR:"RM_Act_Hide_Activity_Indicator",HIDE_LOADER:"RM_Hide_Loader",MAX_RESTRICTION_IN_COLUMN:3,CLOSED_RESTRICTION_VALUE:"CLOSED",VIEW_MODE_TEXT_MAPPINGS:{RM_Rate_View:"All Rates",RM_Room_Type_View:"All Room Types",RM_Rate_Type_View:"All Rate Types",RM_Single_Rate_Expandable_View:"All Room Types"},SHOW_AVAILABILITY:"RM_Show_Availability"},RateManagerRestrictionTypes={CLOSED:{className:"restriction-icon bg-red icon-cross",description:"Closed",defaultText:"",hasInputField:!1},CLOSED_ARRIVAL:{className:"restriction-icon bg-red icon-block",description:"Closed to Arrival",defaultText:"",hasInputField:!1},CLOSED_DEPARTURE:{className:"restriction-icon bg-red",description:"Closed to Departure",defaultText:"",hasInputField:!1},MIN_STAY_LENGTH:{className:"restriction-icon bg-blue",description:"Min Length of Stay",defaultText:"",hasInputField:!0},MAX_STAY_LENGTH:{className:"restriction-icon bg-blue-dark",description:"Max Length of Stay",defaultText:"",hasInputField:!0},MIN_STAY_THROUGH:{className:"restriction-icon bg-violet",description:"Min Stay Through",defaultText:"",hasInputField:!0},MIN_ADV_BOOKING:{className:"restriction-icon bg-green",description:"Min Advance Booking",defaultText:"",hasInputField:!0},MAX_ADV_BOOKING:{className:"restriction-icon bg-orange",description:"Max Advance Booking",defaultText:"",hasInputField:!0},MORE_RESTRICTIONS:{className:"restriction-icon bg-drk R",description:RM_RX_CONST.MAX_RESTRICTION_IN_COLUMN+" or more Restrictions",defaultText:"R",hasInputField:!0}},rateManagerEventsCountReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.eventsCount;default:return e.eventsCount}},rateManagerHouseAvailabilityReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.houseAvailability;default:return e.houseAvailability}},rateManagerRestrictionSummaryReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.restrictionSummaryData;default:return e}},rateManagerShowAvailabilityReducer=function(e,t){switch(t.type){case RM_RX_CONST.SHOW_AVAILABILITY:return t.showAvailability;default:return e.showAvailability}},rateManagerActionReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:case RM_RX_CONST.SHOW_NO_RESULTS:return"";case RM_RX_CONST.REFRESH_SCROLLERS:return RM_RX_CONST.REFRESH_SCROLLERS;case RM_RX_CONST.TOGGLE_EXPAND_COLLAPSE_ROW:return"";default:return e}},rateManagerBusinessDateReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.businessDate;default:return e}},rateManagerCallbacksFromAngularReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.callbacksFromAngular;default:return e}},rateManagerDatesReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.dates;default:return e}},rateManagerExpandedRowsReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:return[];case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:return[];case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return[];case RM_RX_CONST.TOGGLE_EXPAND_COLLAPSE_ROW:var a=e.indexOf(t.payLoad.index);return a===-1?[].concat(_toConsumableArray(e),[t.payLoad.index]):[].concat(_toConsumableArray(e.slice(0,a)),_toConsumableArray(e.slice(a+1)));default:return e}},rateManagerFlagsReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_WITH_ADDRESS:return t.flags;default:return e}},rateManagerListReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:return t.rateRestrictionData;case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:return t.roomTypeRestrictionData;case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:return t.rateTypeRestrictionData;case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.singleRateRestrictionData;default:return e}},rateManagerLoaderReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:case RM_RX_CONST.TOGGLE_EXPAND_COLLAPSE_ROW:return RM_RX_CONST.ACTIVATE_LOADER;case RM_RX_CONST.ACT_SHOW_ACTIVITY_INDICATOR:return RM_RX_CONST.ACTIVATE_LOADER;case RM_RX_CONST.ACT_HIDE_ACTIVITY_INDICATOR:return RM_RX_CONST.HIDE_LOADER;default:return e}},rateManagerModeReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:return RM_RX_CONST.RATE_VIEW_MODE;case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:return RM_RX_CONST.ROOM_TYPE_VIEW_MODE;case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:return RM_RX_CONST.RATE_TYPE_VIEW_MODE;case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_MODE;case RM_RX_CONST.SHOW_NO_RESULTS:return RM_RX_CONST.NO_RESULTS_FOUND_MODE;default:return e}},rateManagerPaginationStateDataReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.paginationStateData;default:return e}},rateManagerPanelClassReducer=function(e,t){switch(t.type){case RM_RX_CONST.HIERARCHY_FROZEN_PANEL_TOGGLED:return t.frozenPanelClosed?"":"opened ";default:return e.frozenPanelClass}},rateManagerMainClassReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:return t.activeHierarchyRestrictions>1?"calendar-rate-table-hierarchy-"+t.activeHierarchyRestrictions:"";case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.activeHierarchyRestrictions>1?"calendar-rate-table-hierarchy-"+(t.activeHierarchyRestrictions+1):"";default:return e.hierarchyRestrictionClass}},getValidRestrictionTypes=function(e){return _.chain(e).filter({activated:!0}).filter({editable:!1}).sortBy("id").value()},rateManagerRestrictionTypesReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return getValidRestrictionTypes(t.restrictionTypes);
default:return e}},rateManagerRootReducer=function(e,t){return{list:rateManagerListReducer(e.list,t),mode:rateManagerModeReducer(e.mode,t),dates:rateManagerDatesReducer(e.dates,t),summary:rateManagerRestrictionSummaryReducer(e.summary,t),flags:rateManagerFlagsReducer(e.flags,t),action:rateManagerActionReducer(e.action,t),businessDate:rateManagerBusinessDateReducer(e.businessDate,t),expandedRows:rateManagerExpandedRowsReducer(e.expandedRows,t),restrictionTypes:rateManagerRestrictionTypesReducer(e.restrictionTypes,t),loader:rateManagerLoaderReducer(e.loader,t),callBacksFromAngular:rateManagerCallbacksFromAngularReducer(e.callBacksFromAngular,t),scrollTo:rateManagerScrollToReducer(e.scrollTo,t),paginationState:rateManagerPaginationStateDataReducer(e.paginationState,t),isHierarchyHouseRestrictionEnabled:e.isHierarchyHouseRestrictionEnabled,isHierarchyRoomTypeRestrictionEnabled:e.isHierarchyRoomTypeRestrictionEnabled,isHierarchyRateTypeRestrictionEnabled:e.isHierarchyRateTypeRestrictionEnabled,isHierarchyRateRestrictionEnabled:e.isHierarchyRateRestrictionEnabled,hierarchyRestrictionClass:rateManagerMainClassReducer(e,t),frozenPanelClass:rateManagerPanelClassReducer(e,t),houseAvailability:rateManagerHouseAvailabilityReducer(e,t),weekendDays:rateManagerWeekendDaysReducer(e,t),showAvailability:rateManagerShowAvailabilityReducer(e,t),eventsCount:rateManagerEventsCountReducer(e,t)}},rateManagerScrollToReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.scrollTo;case RM_RX_CONST.CLEAR_SCROLL_TO:return null;default:return e}},rateManagerWeekendDaysReducer=function(e,t){switch(t.type){case RM_RX_CONST.RATE_VIEW_CHANGED:case RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED:case RM_RX_CONST.RATE_TYPE_VIEW_CHANGED:case RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED:return t.weekendDays;default:return e.weekendDays}};sntRover.constant("rvTwoMonthCalendarEventConstants",{TWO_MONTH_CALENDAR_DATE_UPDATED:"TwoMonthCalendarDateUpdated"}),sntRover.constant("rvRateManagerEventConstants",{UPDATE_RESULTS:"RM_update_results",CLOSE_FILTER_SECTION:"RM_close_filter_section",RELOAD_RESULTS:"RM_reload_results"}),angular.module("sntRover").service("RateMgrOccupancyGraphSrv",["$q","BaseWebSrvV2",function(e,t){this.fetch=function(a){var r=e.defer(),n="/api/daily_occupancies";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.setTargets=function(a){var r=e.defer(),n="/api/daily_occupancies/targets";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("RateMngrCalendarSrv",["$q","BaseWebSrvV2",function(e,t){var a=this;a.allRestrictionTypes=[],this.restrictionsIndependentOfDays=[],this.fetchAllRestrictionTypes=function(r,n,i){var i="/api/restriction_types",o=e.defer();return a.allRestrictionTypes.length>0?o.resolve(a.allRestrictionTypes):t.getJSON(i).then(function(e){for(var t in e.results)e.results[t].activated&&!e.results[t].editable&&(a.allRestrictionTypes.push(e.results[t]),["CLOSED","CLOSED_ARRIVAL","CLOSED_DEPARTURE"].indexOf(e.results[t].value)>=0&&a.restrictionsIndependentOfDays.push(e.results[t].id));o.resolve(e)},function(e){o.reject(e)}),o.promise},this.fetchSortPreferences=function(){var a=e.defer(),r="/api/sort_preferences/list_selections";return t.getJSON(r).then(function(e){a.resolve(e.rate_manager)},function(e){a.reject(e)}),a.promise},this.fetchSortOptions=function(){var a=e.defer(),r="/api/sort_preferences/";return t.getJSON(r).then(function(e){a.resolve(e.rate_manager)},function(e){a.reject(e)}),a.promise},this.updateRoomTypeOverride=function(a){a.date=a.selectedDate,a.rate_id=a.selectedRate;var r="/api/daily_rates/"+a.selectedRate+"/remove_custom_rate?",n=e.defer();return t.postJSON(r,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.isFetchingRooms=function(e){var t;return t=!!e&&"ROOMS"===e.roomrate,a.fetchingRooms=t,t},this.getUrlEnd=function(e,t){var a=e+"?from_date="+t.from_date+"&to_date="+t.to_date+"&per_page="+t.per_page+"&order_id="+t.order_id,r="";for(var n in t.rate_ids)r=r+"&rate_ids[]="+t.rate_ids[n];var i="";for(var n in t.rate_type_ids)i=i+"&rate_type_ids[]="+t.rate_type_ids[n];var o="";for(var n in t.name_card_ids)o=o+"&name_card_ids[]="+t.name_card_ids[n];return a+r+i+o},this.fetchCalendarData=function(t){var r="/api/daily_rates",n=a.isFetchingRooms(t);n&&(r+="/room_restrictions");var i=e.defer(),o=function(e){i.reject(e)};return a.fetchAllRestrictionTypes().then(a.getDailyRates(t,r,i,o),o),i.promise},this.getDailyRates=function(e,r,n,i){var o=a.getUrlEnd(r,e);t.getJSON(o).then(function(t){var i=a.isFetchingRooms(e);a.dailyRates=t,i&&(t.room_type_restrictions=t.result.room_types,a.dailyRates.results=t.result.room_types);var o=a.calculateRateViewCalData();i&&(o.room_type_restrictions=t.room_type_restrictions,o.total_room_types=t.room_type_restrictions[0].room_types.length),o.room_types_all=[],o.isChildRate=[];var s;if(t.results[0])for(var c in t.results[0].rates)s=t.results[0].rates[c],s.can_modify||o.isChildRate.push(s.id);if(i)for(var l in t.room_type_restrictions[0].room_types)o.room_types_all.push({room_type_id:t.room_type_restrictions[0].room_types[l].room_type.id,name:t.room_type_restrictions[0].room_types[l].room_type.name});if(1===o.data.length){var d={};d.from_date=e.from_date,d.to_date=e.to_date,d.id=o.data[0].id,d.rate=o.data[0].name,d.isHourly=o.data[0].is_hourly,a.fetchRoomTypeCalendarData(d,r,n)}else o.type="RATES_LIST",n.resolve(o)},i)},this.fetchRoomTypeCalendarData=function(t,r,n){"undefined"==typeof n&&(n=e.defer());var i=function(e){n.reject(e)};return a.fetchAllRestrictionTypes().then(a.getRoomTypeRates(t,r,n,i),i),n.promise},this.getRoomTypeRates=function(e,r,n,i){if("undefined"==typeof e.id)return void n.resolve({});if(r="/api/daily_rates/"+e.id,"undefined"!=typeof e.id&&"undefined"!=typeof e.rate){var o={};o.id=e.id,o.name=e.rate}delete e.id,delete e.rate,t.getJSON(r,e).then(function(e){a.roomTypeRates=e;var t=a.calculateRoomTypeViewCalData();t.type="ROOM_TYPES_LIST",t.room_type_restrictions=e.room_type_restrictions,t.selectedRateDetails=o,t.is_child=void 0!==e.can_modify&&!e.modify||e.is_child,t.parentRateName=e.parent_rate_name,n.resolve(t)},i)},this.updateRestrictions=function(a){var r="/api/daily_rates",n=e.defer();return t.postJSON(r,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.checkIfAnyHourlyRatePresent=function(e){var t=a.fetchingRooms;if(t)return!1;var r=!1;return angular.forEach(e,function(e){if(e.is_hourly===!0)return r=!0,!1}),r},this.calculateRoomTypeViewCalData=function(){var e={};this.hasAnyHourlyRate=this.checkIfAnyHourlyRatePresent(a.roomTypeRates.results[0].room_rates);var t={};angular.forEach(a.allRestrictionTypes,function(e){t[e.id]=a.getRestrictionUIElements(e)});var r=t.length,n={activated:!0,background_class:"bg-drk",description:"Has Restrictions",editable:!1,hideOnHourly:!1,isOnRate:!0,icon:"R",days:"R",id:r,value:"HAS_RESTRICTIONS"};t[r]=n,e.restriction_types=t;var i=[],o={},s=[];angular.forEach(a.roomTypeRates.results,function(e){i.push(e.date),_.each(e.rate_restrictions,function(e){_.indexOf(a.restrictionsIndependentOfDays,parseInt(e.restriction_type_id,10))>-1&&(e.days=null)}),o[e.date]=e.rate_restrictions;for(var t in e.room_rates){var r=e.room_rates[t],n=null;for(var c in s)s[c].id===r.room_type.id&&(n=s[c]);null===n&&(n={id:r.room_type.id,name:r.room_type.name,is_hourly:r.is_hourly},s.push(n));var l={};_.each(r.restrictions,function(e){_.indexOf(a.restrictionsIndependentOfDays,parseInt(e.restriction_type_id,10))>-1&&(e.days=null)}),l.restrictions=r.restrictions,l.single=r.rate_currency+"-"+r.single,l.double=r.rate_currency+"-"+r.double,l.extra_adult=r.rate_currency+"-"+r.extra_adult,l.child=r.rate_currency+"-"+r.child,l.isHourly=r.rate_currency+"-"+r.is_hourly,l.nightly=r.rate_currency+"-"+r.nightly_rate,n[e.date]=l}}),e.dates=i,e.rate_restrictions=o,e.data=s;var c=a.getCloseAllEnableDisableStatus(e.data,"ROOM_TYPE");return e.disableCloseAllBtn=!c.enableCloseAll,e.disableOpenAllBtn=!c.enableOpenAll,e},this.calculateRateViewCalData=function(){var e={};a.fetchingRooms||(this.hasAnyHourlyRate=this.checkIfAnyHourlyRatePresent(a.dailyRates.results[0].rates));var t={};angular.forEach(a.allRestrictionTypes,function(e){t[e.id]=a.getRestrictionUIElements(e)});var r=t.length,n={activated:!0,background_class:"bg-drk",description:"Has Restrictions",editable:!1,isOnRate:!0,hideOnHourly:!1,icon:"R",days:"R",id:r,value:"HAS_RESTRICTIONS"};t[r]=n,e.restriction_types=t;var i=[],o={},s=[];angular.forEach(a.dailyRates.results,function(e){i.push(e.date),o[e.date]=e.all_rate_restrictions;var t;t=a.fetchingRooms?"room_types":"rates";for(var r in e[t]){var n=e[t][r];a.fetchingRooms&&(n.name=n.room_type.name,n.id=n.room_type.id,n.is_hourly=!1,n.is_child=!1,n.is_suppress_rate_on=!1);var c=null;for(var l in s)s[l].id===n.id&&(c=s[l]);null===c&&(c={id:n.id,name:n.name,isHourly:n.is_hourly},s.push(c)),c[e.date]=n.restrictions}}),e.dates=i,e.all_rates=o,e.data=s;var c=a.getCloseAllEnableDisableStatus(e.data,"RATE_TYPE");return e.disableCloseAllBtn=!c.enableCloseAll,e.disableOpenAllBtn=!c.enableOpenAll,e},a.getCloseAllEnableDisableStatus=function(e,t){var r=-1,n={};n.enableOpenAll=!1,n.enableCloseAll=!1;for(var i in a.allRestrictionTypes)if("CLOSED"===a.allRestrictionTypes[i].value){r=a.allRestrictionTypes[i].id;break}for(var i in e){var o=e[i];for(var s in o)if("id"!==s&&"name"!==s&&"is_hourly"!==s&&"isHourly"!==s&&!(new Date(s).getTime()<new Date(a.businessDate).getTime())){var c=o[s];if("ROOM_TYPE"===t)var c=o[s].restrictions;var l=!1;for(var d in c)if(c[d].restriction_type_id===r){n.enableOpenAll=!0,l=!0;break}l===!1&&(n.enableCloseAll=!0)}}return n},this.getRestrictionUIElements=function(e){var t={};return t.icon="",t.hideOnHourly=!1,"CLOSED"===e.value&&(t.icon="icon-cross"),"CLOSED_ARRIVAL"===e.value&&(t.icon="icon-block"),t.background_class="",["CLOSED","CLOSED_ARRIVAL","CLOSED_DEPARTURE"].indexOf(e.value)>=0&&(t.background_class="bg-red"),"MIN_STAY_LENGTH"===e.value&&(t.background_class="bg-blue",a.hasAnyHourlyRate&&(t.hideOnHourly=!0)),"MAX_STAY_LENGTH"===e.value&&a.hasAnyHourlyRate&&(t.hideOnHourly=!0),"MIN_ADV_BOOKING"===e.value&&(t.background_class="bg-green"),"MIN_STAY_THROUGH"===e.value&&(t.background_class="bg-violet",a.hasAnyHourlyRate&&(t.hideOnHourly=!0)),t.id=e.id,t.description=e.description,t.value=e.value,t.activated=e.activated,t.editable=e.editable,t}}]),angular.module("sntRover").service("RMFilterOptionsSrv",["$q","BaseWebSrvV2",function(e,t){this.fetchRates=function(){var a=e.defer(),r="/api/rates?per_page=100&is_active=true";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchRateTypes=function(){var a=e.defer(),r="/api/rate_types/active";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchCompanyCard=function(a){var r=e.defer(),n="/api/accounts";return t.getJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchAllRates=function(a){var r=e.defer(),n="/api/rates?is_fully_configured=true&is_active=true";return t.getJSON(n).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("UpdatePriceAndRestrictionsSrv",["$q","BaseWebSrvV2",function(e,t){this.savePriceAndRestrictions=function(a){var r=e.defer(),n="/api/daily_rates";return t.postJSON(n,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};angular.module("sntRover").service("rvRateManagerCoreSrv",["$q","BaseWebSrvV2","rvRateManagerRestrictionsSrv","rvRateManagerHierarchyRestrictionsSrv",function(e,t,a,r){var n=this,i=this;this.activeRates=null,i.fetchMultipleRateInfo=function(e){var t=a.rateRestrictionsUrl(e);return e=_.omit(e,"restrictionType","hierarchialRateRestrictionRequired"),this.getJSON(t,e)},i.fetchRateWithAmount=function(e){var t="/api/daily_rates/rates_amount_by_date";return e=_.omit(e,"restrictionType","hierarchialRateRestrictionRequired"),this.getJSON(t,e)},i.fetchAllRoomTypesInfo=function(e){var t=a.roomTypeRestrictionUrl(e);return e=_.omit(e,"restrictionType","hierarchialRoomTypeRestrictionRequired"),this.getJSON(t,e)},i.fetchAllRateTypesInfo=function(r){var n=e.defer(),i=a.rateTypeRestrictionsUrl(r);return r=_.omit(r,"restrictionType","hierarchialRateTypeRestrictionRequired"),t.getJSON(i,r).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.fetchRateTypeList=function(){var e="/api/rate_types/active";return this.getJSON(e)},i.fetchSingleRateInfo=function(e){var t="/api/daily_rates/"+e.rate_id;return this.getJSON(t,_.omit(e,"rate_id"))},i.fetchSingleRateTypeInfo=function(e){var t="/api/daily_rates/rate_restrictions";return this.getJSON(t,e)},i.fetchRates=function(){var e="/api/rates/minimal";return this.getJSON(e)},i.fetchRestrictionTypes=function(){var e="/api/restriction_types";return this.getJSON(e,void 0,"results")},i.applyAllRestrictions=function(e){var t=a.getURLforApplyAllRestrictions(e);return e=a.processParamsforApplyAllRestrictions(e),n.postJSON(t,e)},i.fetchRateDetails=function(e){var t="/api/rates/"+e.rate_id;return n.getJSON(t)},i.fetchRoomTypes=function(){var e="/api/room_types.json?exclude_pseudo=true";return n.getJSON(e,void 0,"results")},i.removeCustomRate=function(e){var t="/api/daily_rates/remove_custom_rate";return n.postJSON(t,e)},i.updateSingleRateRestrictionData=function(e){var t=a.getURLforApplyAllRestrictions(e);return e=a.processParamsforApplyAllRestrictions(e),n.postJSON(t,e)},i.fetchCommonRestrictions=function(e){var t="/api/daily_rates/all_restrictions";return n.getJSON(t,e)},i.fetchActiveRestrictionsList=function(e){var t="/api/restriction_types";return n.getJSON(t,e)},i.fetchSingleRateDetailsAndRoomTypes=function(t){var a=[],r=e.defer(),n={};if(a.push(i.fetchSingleRateInfo(_.omit(t,"fetchRoomTypes","fetchCommonRestrictions","fetchRates")).then(function(e){n.roomTypeAndRestrictions=e.results})),t.fetchCommonRestrictions){var s=_extends({},_.pick(t,"from_date","to_date","varied_inclusive"),{"rate_ids[]":[t.rate_id]});a.push(i.fetchCommonRestrictions(s).then(function(e){n.commonRestrictions=e.results}))}return o(a,n,t),t.fetchRoomTypes&&a.push(i.fetchRoomTypes().then(function(e){n.roomTypes=e})),t.fetchRates&&a.push(i.fetchRates().then(function(e){n.rates=e.results})),a.push(i.fetchRoomTypeAvailability(t).then(function(e){n.roomTypeAvailability=e.results,n.weekendDays=e.weekend_days})),e.all(a).then(function(){r.resolve(n)}),r.promise},i.fetchRatesAndRoomTypes=function(t){var r=[],n=e.defer(),s={};if(r.push(i.fetchAllRoomTypesInfo(_.omit(t,"fetchRoomTypes","fetchCommonRestrictions")).then(function(e){s.roomTypeAndRestrictions=t.hierarchialRoomTypeRestrictionRequired?a.processRoomTypeRestrictionResponse(e.results):e.results})),t.fetchCommonRestrictions){var c=_.pick(t,"from_date","to_date","varied_inclusive");t.room_type_id&&(c["room_type_ids[]"]=[t.room_type_id]),r.push(i.fetchCommonRestrictions(c).then(function(e){s.commonRestrictions=e.results}))}return o(r,s,t),t.fetchRoomTypes&&r.push(i.fetchRoomTypes().then(function(e){s.roomTypes=e})),r.push(i.fetchRoomTypeAvailability(t).then(function(e){s.roomTypeAvailability=e.results,s.weekendDays=e.weekend_days})),e.all(r).then(function(e){n.resolve(s)}),n.promise},i.fetchRateTypes=function(t){var r=[],n=e.defer(),s={};if(r.push(i.fetchAllRateTypesInfo(_.omit(t,"fetchCommonRestrictions","fetchRateTypes")).then(function(e){s.rateTypeAndRestrictions=t.hierarchialRateTypeRestrictionRequired?a.processRateTypeRestrictionResponse(e.results):e.results,s.totalCount=e.total_count||e.results[0].rate_types.length})),t.fetchCommonRestrictions){var c=_.pick(t,"from_date","to_date","varied_inclusive");r.push(i.fetchCommonRestrictions(c).then(function(e){s.commonRestrictions=e.results}))}return o(r,s,t),t.fetchRateTypes&&r.push(i.fetchRateTypeList().then(function(e){s.rateTypes=e})),e.all(r).then(function(e){n.resolve(s)}),n.promise};var o=function(e,t,n){var i=_.pluck(_.where(a.activeHierarchyRestrictions(),{active:!0}),"level"),o={from_date:n.from_date,to_date:n.to_date,"levels[]":i};0!==i.length&&(t.panelRestrictions={},e.push(r.fetchHierarchyRestrictions(o).then(function(e){t.panelRestrictions.houseRestrictions=a.formatRestrictionsData(e.house,{forPanel:!0}),t.panelRestrictions.rateTypeRestrictions=a.formatRestrictionsData(e.rate_type,{forPanel:!0}),t.panelRestrictions.roomTypeRestrictions=a.formatRestrictionsData(e.room_type,{forPanel:!0}),t.panelRestrictions.rateRestrictions=a.formatRestrictionsData(e.rate,{forPanel:!0})})))};this.getJSON=function(a,r,n){r=_.omit(r,"restrictionType","hierarchialRateTypeRestrictionRequired");var i=e.defer();return t.getJSON(a,r).then(function(e){i.resolve(n?e[n]:e)},function(e){i.reject(e)}),i.promise},this.postJSON=function(a,r){var n=e.defer();return t.postJSON(a,r).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},this.fetchAllRestrictionsWithStatus=function(e){var t=a.getURLforAllRestrictionsWithStatus(e);return e=_.omit(e,"restrictionType","hierarchialRoomTypeRestrictionRequired","hierarchialRateTypeRestrictionRequired","hierarchialRateRestrictionRequired"),n.getJSON(t,e)},this.fetchRoomTypeWithRestrictionStatus=function(t){var r=[],i=e.defer(),o={},s=_.omit(t,"fetchRoomTypes");r.push(n.fetchAllRoomTypesInfo(s).then(function(e){o.roomTypeAndRestrictions=e.results}));var c=_.pick(t,"from_date","to_date","restrictionType","hierarchialRoomTypeRestrictionRequired");return t.room_type_id&&(c["room_type_ids[]"]=[t.room_type_id]),r.push(n.fetchAllRestrictionsWithStatus(c).then(function(e){o.restrictionsWithStatus=t.hierarchialRoomTypeRestrictionRequired?a.processRoomTypeRestrictionResponse(e.results):e.results})),t.fetchRoomTypes&&r.push(n.fetchRoomTypes().then(function(e){o.roomTypes=e})),e.all(r).then(function(){i.resolve(o)}),i.promise},this.fetchSingleRateTypeDetailsAndCommonRestrictions=function(t){var r=[],i=e.defer(),o={},s=_.omit(t,"fetchRoomTypes","fetchRates");r.push(n.fetchSingleRateTypeInfo(s).then(function(e){o.rateAndRestrictions=e.results}));var c=_.pick(t,"from_date","to_date","restrictionType","hierarchialRateTypeRestrictionRequired");return t.rate_type_id&&(c["rate_type_ids[]"]=[t.rate_type_id]),r.push(n.fetchAllRestrictionsWithStatus(c).then(function(e){o.restrictionsWithStatus=t.hierarchialRateTypeRestrictionRequired?a.processRateTypeRestrictionResponse(e.results):e.results})),t.fetchRoomTypes&&r.push(n.fetchRoomTypes().then(function(e){o.roomTypes=e})),t.fetchRates&&r.push(n.fetchRates().then(function(e){o.rates=e.results})),e.all(r).then(function(){i.resolve(o)}),i.promise},this.fetchSingleRateDetailsAndCommonRestrictions=function(t){var r=[],i=e.defer(),o={},s=_.omit(t,"fetchRoomTypes","fetchRates","hierarchialRateRestrictionRequired");r.push(n.fetchSingleRateInfo(s).then(function(e){o.roomTypeAndRestrictions=e.results}));var c=_extends({},_.pick(t,"from_date","to_date","hierarchialRateRestrictionRequired"),{"rate_ids[]":[t.rate_id]});return r.push(n.fetchAllRestrictionsWithStatus(c).then(function(e){if(t.hierarchialRateRestrictionRequired){var r=a.processRateRestrictionResponse(e.results,!0);o.restrictionsWithStatus=[{date:e.results[0].date,restrictions:r[0].rates[0].restrictions}]}else o.restrictionsWithStatus=e.results})),t.fetchRoomTypes&&r.push(n.fetchRoomTypes().then(function(e){o.roomTypes=e})),t.fetchRates&&r.push(n.fetchRates().then(function(e){o.rates=e.results})),e.all(r).then(function(){i.resolve(o)}),i.promise},this.fetchSingleRateRestrictionsAndAmountsDetails=function(t){var a=[],r=e.defer(),i={},o=_.omit(t,"fetchRoomTypes","fetchRates");a.push(n.fetchSingleRateInfo(o).then(function(e){i.roomTypeAndRestrictions=e.results}));var s=_extends({},_.pick(t,"from_date","to_date","restrictionType"),{"rate_ids[]":[t.rate_id]});return t.room_type_id&&(s["room_type_ids[]"]=[t.room_type_id]),a.push(n.fetchAllRestrictionsWithStatus(s).then(function(e){i.restrictionsWithStatus=e.results})),t.fetchRoomTypes&&a.push(n.fetchRoomTypes().then(function(e){i.roomTypes=e})),t.fetchRates&&a.push(n.fetchRates().then(function(e){i.rates=e.results})),e.all(a).then(function(){r.resolve(i)}),r.promise},this.fetchRateRestrictionDetailsAndCommonRestrictions=function(t){var a=[],r=e.defer(),n={},o=_.omit(t,"fetchRates","considerRateIDsInAllRestrictionStatusFetch");a.push(i.fetchMultipleRateInfo(o).then(function(e){n.dailyRateAndRestrictions=e.results,n.totalCount=e.total_count}));var s=_.pick(t,"from_date","to_date","name_card_ids[]","varied_inclusive","rate_type_ids[]","restrictionType");return t.considerRateIDsInAllRestrictionStatusFetch&&(s["rate_ids[]"]=t["rate_ids[]"]),a.push(i.fetchAllRestrictionsWithStatus(s).then(function(e){n.restrictionsWithStatus=e.results})),e.all(a).then(function(){r.resolve(n)}),r.promise},i.fetchRatesAndDailyRates=function(t){var r=[],n=e.defer(),s={},c=_.omit(t,"fetchRates","fetchCommonRestrictions","considerRateIDsInCommonRestriction");if(t.hierarchialRateRestrictionRequired&&r.push(i.fetchRateWithAmount(c).then(function(e){s.rateAmountList=e.results})),r.push(i.fetchMultipleRateInfo(c).then(function(e){s.dailyRateAndRestrictions=e.results,s.totalCount=e.total_count||e.results[0].rates.length})),t.fetchCommonRestrictions){var l=_extends({},_.pick(t,"from_date","to_date","name_card_ids[]","varied_inclusive"));t["rate_type_ids[]"]&&(l["rate_type_ids[]"]=t["rate_type_ids[]"]),t.considerRateIDsInCommonRestriction&&(l["rate_ids[]"]=t["rate_ids[]"]),r.push(i.fetchCommonRestrictions(l).then(function(e){s.commonRestrictions=e.results}))}return o(r,s,t),t.fetchRates&&r.push(i.fetchRates().then(function(e){s.rates=e.results})),e.all(r).then(function(){if(t.hierarchialRateRestrictionRequired){var e=a.concatRateWithAmount(s.rateAmountList,s.dailyRateAndRestrictions);s.dailyRateAndRestrictions=a.processRateRestrictionResponse(e)}n.resolve(s)}),n.promise},i.fetchHouseAvailability=function(a){var r="/api/availability_main",n=e.defer();return t.getJSON(r,a).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.fetchRoomTypeAvailability=function(a){var r="/api/availability/room_types",n=e.defer(),i={from_date:a.from_date,to_date:a.to_date,is_include_overbooking:!1};return t.getJSON(r,i).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.fetchEventsCount=function(a){var r="/api/house_events/count_per_day",n=e.defer(),i={start_date:a.from_date,end_date:a.to_date};return t.getJSON(r,i).then(function(e){var t={};t.eventsCount=e.data,n.resolve(t)},function(e){n.reject(e)}),n.promise},i.fetchHouseAvailabilityAndEventsCount=function(t){var a=e.defer(),r=[],n={};return r.push(i.fetchHouseAvailability(t).then(function(e){n.houseAvailability=e.results,n.weekendDays=e.weekend_days})),r.push(i.fetchEventsCount(t).then(function(e){n.eventsCount=e.eventsCount})),e.all(r).then(function(){a.resolve(n)}),a.promise},i.fetchHouseEventsByDate=function(a){var r="/api/house_events",n=e.defer();return t.getJSON(r,a).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}}]),angular.module("sntRover").service("rvRateManagerHierarchyRestrictionsSrv",["$q","BaseWebSrvV2",function(e,t){var a=this,r="/api/restrictions/house",n="/api/restrictions/room_types",i="/api/restrictions/rate_types",o="/api/restrictions/rates";a.saveHouseRestrictions=function(e){return t.postJSON(r,e)},a.saveRoomTypeRestrictions=function(e){return t.postJSON(n,e)},a.saveRateTypeRestrictions=function(e){return t.postJSON(i,e)},a.saveRateRestrictions=function(e){return t.postJSON(o,e)},a.fetchHierarchyRestrictions=function(e){return t.getJSON("/api/restrictions/hierarchy",e)},a.fetchAllRoomTypes=function(e){return t.getJSON("/api/room_types.json",e)},a.fetchAllRateTypes=function(e){return t.getJSON("/api/rate_types/active",e)},a.fetchAllRates=function(e){return t.getJSON("/api/rates",e)}}]),angular.module("sntRover").service("rvRateManagerRestrictionsSrv",["Toggles","rvRateManagerUtilitySrv",function(e,t){var a=this;a.hierarchyRestrictions={houseEnabled:e.isEnabled("hierarchical_house_restrictions"),roomTypeEnabled:e.isEnabled("hierarchical_room_type_restrictions"),rateTypeEnabled:e.isEnabled("hierarchical_rate_type_restrictions"),rateEnabled:e.isEnabled("hierarchical_rate_restrictions")},a.processRateRestrictionResponse=function(e,a){return _.each(e,function(e){_.each(e.rates,function(e){e.restrictions=t.generateOldGetApiResponseFormat(e.restrictions,e.locked_restrictions,a)})}),e},a.concatRateWithAmount=function(e,t){if(e.length>0){var a=0,r=0;for(a=0;a<e.length;a++){var n=[];for(r=0;r<e[a].rates.length;r++){var i=Object.assign(e[a].rates[r],t[a].rates[r]);n.push(i)}t[a].rates=n}}return t},a.activeHierarchyRestrictions=function(){return[{level:"House",active:a.hierarchyRestrictions.houseEnabled},{level:"RateType",active:a.hierarchyRestrictions.rateTypeEnabled},{level:"RoomType",active:a.hierarchyRestrictions.roomTypeEnabled},{level:"Rate",active:a.hierarchyRestrictions.rateEnabled}]},a.processRateTypeRestrictionResponse=function(e){return _.each(e,function(e){_.each(e.rate_types,function(e){e.restrictions=t.generateOldGetApiResponseFormat(e.restrictions)})}),e},a.processRoomTypeRestrictionResponse=function(e){return _.each(e,function(e){_.each(e.room_types,function(e){e.restrictions=t.generateOldGetApiResponseFormat(e.restrictions)})}),e},a.formatRestrictionsData=function(e,a){return a.forPanel&&_.each(e,function(e){e.restrictions=t.generateOldGetApiResponseFormatForPanel(e.restrictions)}),e},a.rateRestrictionsUrl=function(e){var t=e.hierarchialRateRestrictionRequired?"/api/restrictions/rates":"/api/daily_rates";return t},a.rateTypeRestrictionsUrl=function(e){var t=e.hierarchialRateTypeRestrictionRequired?"/api/restrictions/rate_types":"/api/daily_rates/rate_types";return t},a.roomTypeRestrictionUrl=function(e){return e.hierarchialRoomTypeRestrictionRequired?"/api/restrictions/room_types":"/api/daily_rates/room_restrictions"},a.getURLforAllRestrictionsWithStatus=function(e){var t="/api/daily_rates/all_restriction_statuses";return e.hierarchialRateTypeRestrictionRequired?t="/api/restrictions/rate_types":e.hierarchialRoomTypeRestrictionRequired?t="/api/restrictions/room_types":e.hierarchialRateRestrictionRequired&&(t="/api/restrictions/rates"),t},a.getURLforApplyAllRestrictions=function(e){var t="/api/daily_rates";return a.hierarchyRestrictions.houseEnabled&&"HOUSE"===e.restrictionType?t="/api/restrictions/house":e.hierarchialRateTypeRestrictionRequired?t="/api/restrictions/rate_types":e.hierarchialRoomTypeRestrictionRequired?t="/api/restrictions/room_types":e.hierarchialRateRestrictionRequired&&(t="/api/restrictions/rates"),t},a.processParamsforApplyAllRestrictions=function(e){return(a.hierarchyRestrictions.houseEnabled&&"HOUSE"===e.restrictionType||e.hierarchialRoomTypeRestrictionRequired||e.hierarchialRateTypeRestrictionRequired||e.hierarchialRateRestrictionRequired)&&(e=t.generateNewPostApiParams(e)),e}}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("sntRover").service("rvRateManagerUtilitySrv",[function(){var e=this;e.restrictionColorAndIconMapping=[{title:"CLOSED",iconClass:"icon-cross",bgClass:"bg-red",key:"closed",type:"boolean",value:null},{title:"CLOSED TO ARRIVAL",iconClass:"icon-block",bgClass:"bg-red",key:"closed_arrival",type:"boolean",value:null},{title:"CLOSED TO DEPARTURE",iconClass:"",bgClass:"bg-red",key:"closed_departure",type:"boolean",value:null},{title:"MIN LENGTH OF STAY",iconClass:"",bgClass:"bg-blue",key:"min_length_of_stay",type:"number",value:null},{title:"MAX LENGTH OF STAY",iconClass:"",bgClass:"bg-blue-dark",key:"max_length_of_stay",type:"number",value:null},{title:"MIN STAY THROUGH",iconClass:"",bgClass:"bg-violet",key:"min_stay_through",type:"number",value:null},{title:"MIN ADVANCE BOOKING",iconClass:"",bgClass:"bg-green",key:"min_advanced_booking",type:"number",value:null},{title:"MAX ADVANCE BOOKING",iconClass:"",bgClass:"bg-orange",key:"max_advanced_booking",type:"number",value:null}],e.repeatOnDatesList=[{name:"MON",value:1,isChecked:!1},{name:"TUE",value:2,isChecked:!1},{name:"WED",value:3,isChecked:!1},{name:"THU",value:4,isChecked:!1},{name:"FRI",value:5,isChecked:!1},{name:"SAT",value:6,isChecked:!1},{name:"SUN",value:0,isChecked:!1}],e.restrictionKeyToCodeMapping={closed:[1,"CLOSED"],closed_arrival:[2,"CLOSED_ARRIVAL"],closed_departure:[3,"CLOSED_DEPARTURE"],min_length_of_stay:[4,"MIN_STAY_LENGTH"],max_length_of_stay:[5,"MAX_STAY_LENGTH"],min_stay_through:[6,"MIN_STAY_THROUGH"],min_advanced_booking:[7,"MIN_ADV_BOOKING"],max_advanced_booking:[8,"MAX_ADV_BOOKING"]},e.restrictionCodeToKeyMapping={1:["closed","boolean","closed"],2:["closed_arrival","boolean","closed_arrival"],3:["closed_departure","boolean","closed_departure"],4:["min_length_of_stay","number","min_stay_length"],5:["max_length_of_stay","number","max_stay_length"],6:["min_stay_through","number","min_stay_through"],7:["min_advanced_booking","number","min_adv_booking"],8:["max_advanced_booking","number","max_adv_booking"]},e.weekDaysMapping={sun:[0],mon:[1],tue:[2],wed:[3],thu:[4],fri:[5],sat:[6]},e.checkLockedRestriction=function(e,t){t=t.toLowerCase();var a=!1;return e.length>0&&(a=_.contains(e,t)),a},e.generateOldGetApiResponseFormat=function(t,a,r){var n=[],i="",o="",s={};for(i in t)o=t[i],s={},"boolean"==typeof o&&o?(s.status="ON",s.restriction_type_id=e.restrictionKeyToCodeMapping[i][0],s.is_on_rate=!1,s.days=null,n.push(s)):"number"==typeof o?(s.status=null!==o?"ON":"",s.restriction_type_id=e.restrictionKeyToCodeMapping[i][0],s.is_on_rate=!!a&&e.checkLockedRestriction(a,e.restrictionKeyToCodeMapping[i][1]),s.days=o,n.push(s)):r&&null===o&&(s.status="",s.restriction_type_id=e.restrictionKeyToCodeMapping[i][0],s.is_on_rate=!!a&&e.checkLockedRestriction(a,e.restrictionKeyToCodeMapping[i][1]),s.days=null,n.push(s));return n},e.generateOldGetApiResponseFormatForPanel=function(t,a){var r=[],n="",i="",o={};for(n in t)i=t[n],o={},"object"!==("undefined"==typeof i?"undefined":_typeof(i))||_.isEmpty(i)||(o.status="ON",o.restriction_type_id=e.restrictionKeyToCodeMapping[n][0],o.is_on_rate=!!a&&e.checkLockedRestriction(a,e.restrictionKeyToCodeMapping[n][1]),void 0===i.length?o.days=null:o.days=i.map(function(e){return e.value}),r.push(o));return r},e.convertRestrictionsToNewApiFormat=function(t){var a={};return _.each(t,function(t){"boolean"===e.restrictionCodeToKeyMapping[t.restriction_type_id][1]?a[e.restrictionCodeToKeyMapping[t.restriction_type_id][0]]="add"===t.action:"number"===e.restrictionCodeToKeyMapping[t.restriction_type_id][1]&&(a[e.restrictionCodeToKeyMapping[t.restriction_type_id][0]]=parseInt(t.days))}),a},e.convertWeekDaysToNewApiFormat=function(t){var a=[],r="";for(r in t)a.push(e.weekDaysMapping[r][0]);return a},e.generateNewPostApiParams=function(t){var a={from_date:"",to_date:"",restrictions:{}};return t.details.length>0&&(a={from_date:t.details[0].from_date,to_date:t.details[1]?t.details[1].to_date:t.details[0].to_date,restrictions:e.convertRestrictionsToNewApiFormat(t.details[0].restrictions)},t.details[1]&&Object.keys(t.details[1].weekdays).length>0&&(a.weekdays=e.convertWeekDaysToNewApiFormat(t.details[1].weekdays)),t.rate_type_ids&&(a.rate_type_ids=t.rate_type_ids),t.room_type_id&&(a.room_type_ids=[t.room_type_id]),t.rate_id&&(a.rate_ids=[t.rate_id])),a},e.getSelectedWeekDays=function(e){var t=[];return _.each(e,function(e){e.isChecked&&t.push(e.value)}),t},e.getActiveRestrictionColorAndIconMapping=function(t){var a=[];return _.each(t,function(t){
_.each(e.restrictionColorAndIconMapping,function(r,n){t.id===e.restrictionKeyToCodeMapping[e.restrictionColorAndIconMapping[n].key][0]&&t.activated&&a.push(r)})}),a}}]),angular.module("sntRover").controller("rvDateRangeModalCtrl",["$scope","ngDialog","$filter","dateFilter","$rootScope","rvUtilSrv","rvTwoMonthCalendarEventConstants",function(e,t,a,r,n,i,o){e.updateClicked=function(){var t={fromDate:e.fromDate,toDate:e.toDate};e.$emit(o.TWO_MONTH_CALENDAR_DATE_UPDATED,t),e.closeDialog()};var s=function(t,a){e.toDate=new tzIndependentDate(i.get_date_from_date_picker(a)),e.fromDate=e.fromDate>e.toDate?e.toDate:e.fromDate},c=function(t,a){e.fromDate=new tzIndependentDate(i.get_date_from_date_picker(a)),e.toDate=e.fromDate>e.toDate?e.fromDate:e.toDate,e.toDateOptions.minDate=tzIndependentDate(e.fromDate),e.toDateOptions.maxDate=l(),e.toDate>e.toDateOptions.maxDate&&(e.toDate=e.toDateOptions.maxDate)},l=function(){if(_.isEmpty(e.maxRange))return"";var t=new tzIndependentDate(e.fromDate);return _.isUndefined(e.maxRange.year)||t.setFullYear(t.getFullYear()+e.maxRange.year),_.isUndefined(e.maxRange.month)||t.setMonth(t.getMonth()+e.maxRange.month),_.isUndefined(e.maxRange.day)||t.setDate(t.getDate()+e.maxRange.day),t.setDate(t.getDate()-1),t},d=function(){var t={firstDay:1,changeYear:!0,changeMonth:!0};e.fromDateOptions=Object.assign({onSelect:c},t),e.toDateOptions=Object.assign({minDate:tzIndependentDate(e.fromDate),maxDate:l(),onSelect:s},t)};!function(){var t=!!e.ngDialogData&&"fromDate"in e.ngDialogData&&"toDate"in e.ngDialogData;if(!t)return void console.error("Unable to initialize two month calendar, you may have missed the required params to initalize the calendar view");if(!_.isDate(e.ngDialogData.fromDate)||!_.isDate(e.ngDialogData.toDate))return void console.error("Unable to initialize two month calendar, from date or to date expecting a date object ");var a=e.ngDialogData;e.fromDate=new tzIndependentDate(a.fromDate),e.toDate=new tzIndependentDate(a.toDate),e.maxRange=_.isUndefined(a.maxRange)?{}:{year:a.maxRange.year,month:a.maxRange.month,day:a.maxRange.day},d()}()}]),sntRover.controller("rvRMHierarchyRestrictionsDatePickerCtrl",["$scope",function(e){var t=moment(e.restrictionObj.cellDate).add(1,"days"),a=moment(e.restrictionObj.cellDate).add(1,"years");e.date=tzIndependentDate(e.restrictionObj.cellDate),e.setUpData=function(){e.dateOptions={changeYear:!0,changeMonth:!0,minDate:tzIndependentDate(t),maxDate:tzIndependentDate(a),yearRange:"0:+1",onSelect:function(){e.restrictionObj.untilDate=e.date,e.$emit("UNTIL_DATE_CHANGED",e.date)}}},e.setUpData()}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};angular.module("sntRover").controller("rvRateManagerCtrl_",["$scope","$filter","$rootScope","rvRateManagerCoreSrv","rvRateManagerEventConstants","restrictionTypes","rvRateManagerPopUpConstants","ngDialog","$timeout","rvRateManagerPaginationConstants","Toggles",function(e,t,a,r,n,i,o,s,c,l,d){BaseCtrl.call(this,e);var R=[],u=0,p=[],m=[],h=[],T=[],f="";e.hierarchyRestrictions={houseEnabled:d.isEnabled("hierarchical_house_restrictions"),roomTypeEnabled:d.isEnabled("hierarchical_room_type_restrictions"),rateTypeEnabled:d.isEnabled("hierarchical_rate_type_restrictions"),rateEnabled:d.isEnabled("hierarchical_rate_restrictions")};var y=0,E=0,g=0,S=0,v=[],C=function(e){return t("date")(new tzIndependentDate(e),a.dateFormatForAPI)},D=function(a){var r=t("translate")(a);e.setTitle(r),e.heading=r,e.$emit("updateRoverLeftMenu","rateManager")},O=function(t){t.isHierarchyHouseRestrictionEnabled=e.hierarchyRestrictions.houseEnabled,Q(t),s.open({template:"/assets/partials/rateManager_/popup/rvRateManagerRateRestrictionPopup.html",scope:e,className:"ngdialog-theme-default",data:t,controller:"rvRateManagerRestrictionAndAmountPopupCtrl",closeByDocument:!1,closeByEscape:!1})},A=function(){e.$$phase||e.$digest()},M=function(){e.showTopBar=!1,e.selectedCardNames=[],e.selectedRateNames=[],e.selectedRateTypeNames=[],e.selectedAccountName=[],e.selectedAddress=[]};e.$on("showErrorMessage",function(t,a){e.errorMessage=a,A()});var N=function(e,t,a){v.push({headerData:e,bottomData:t,actionType:a})};a.$on("ngDialog.opened",function(e,t){setTimeout(function(){t.addClass("modal-show")},100)});var I=function(t){e.$emit(n.RELOAD_RESULTS)},b=function(t){t.rate_id=R[u].selectedRates[0].id;var a={params:t,onSuccess:I};e.callAPI(r.applyAllRestrictions,a)},L=function(t){e.$emit(n.RELOAD_RESULTS)},P=function(t){t.rate_id=R[u].selectedRates[0].id;var a={params:t,onSuccess:L};e.callAPI(r.applyAllRestrictions,a)},w=function(t){R[u].scrollDirection=l.scroll.STILL,z(),T=[],p=[],e.$emit(n.RELOAD_RESULTS)},H=function(t){var a={params:t,onSuccess:w};e.callAPI(r.applyAllRestrictions,a)},k=function(t){var a={params:t,onSuccess:w};e.callAPI(r.applyAllRestrictions,a)},G=function(t){e.$emit(n.UPDATE_RESULTS,R[u])},V=function(t){var a={params:t,onSuccess:G};e.callAPI(r.applyAllRestrictions,a)},x=function(t){e.$emit(n.UPDATE_RESULTS,R[u])},F=function(t){var a={params:t,onSuccess:x};e.callAPI(r.applyAllRestrictions,a)};e.$on(n.RELOAD_RESULTS,function(t,a){var r=_.has(a,"isFromPopup");return r?W(a):void c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0)});var W=function(t){var a=t.dialogData;switch(a.mode){case o.RM_SINGLE_RATE_RESTRICTION_MODE:Y(a);break;case o.RM_MULTIPLE_RATE_RESTRICTION_MODE:U(a);break;case o.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE:j(a);break;case o.RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE:$();break;case o.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE:c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0);break;case o.RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE:c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0);break;case o.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:B();break;case o.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:X()}},B=function(){et(R[u])},X=function(){et(R[u])},U=function(t){R[u].scrollDirection=l.scroll.STILL,z(),T=[],p=[],c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0)},Y=function(e){var t=e.rate.id;K(t)},j=function(e){var t=e.rateType.id;Z(t)},$=function(){c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0)},z=function(){var e=Math.ceil(y/g),t=R[u].allRate.currentPage,a=_.findWhere(T,{page:R[u].allRate.currentPage}),r=a.response.dailyRateAndRestrictions[0].rates.length,n=t===e,i=r<g;n&&i&&(R[u].allRate.currentPage--,R[u].allRate.currentPage<=0&&(R[u].allRate.currentPage=1))},q=function(t,a){var r=t.dailyRateAndRestrictions,i=t.commonRestrictions,o=tzIndependentDate(a.fromDate),s=tzIndependentDate(a.toDate),l=a.rateID,d=_.indexBy(r,"date"),p=_.indexBy(i,"date");T.map(function(e){e.response.dailyRateAndRestrictions.map(function(e){var t=_.findIndex(e.rates,{id:l}),a=tzIndependentDate(e.date),r=o<=a&&a<=s;t!==-1&&r&&(e.rates[t]=d[e.date].rates[0])}),i&&e.response.commonRestrictions.map(function(e){var t=tzIndependentDate(e.date),a=o<=t&&t<=s;a&&(e.restrictions=p[e.date].restrictions)})}),c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0)},J=function(t,a){var r=t.dailyRateAndRestrictions,i=t.commonRestrictions,o=tzIndependentDate(a.fromDate),s=tzIndependentDate(a.toDate),l=_.indexBy(r,"date"),d=_.indexBy(i,"date");T.map(function(e){e.response.dailyRateAndRestrictions.map(function(e){var t=_.findIndex(e.rates,{id:rateID}),a=tzIndependentDate(e.date),r=o<=a&&a<=s;t!==-1&&r&&(e.rates[t]=l[e.date].rates[0])}),e.response.commonRestrictions.map(function(e){var t=tzIndependentDate(e.date),a=o<=t&&t<=s;a&&(e.restrictions=d[e.date].restrictions)})}),c(function(){return e.$emit(n.UPDATE_RESULTS,R[u])},0)},K=function(t){var a=_.pluck(T,"fromDate").map(function(e){return tzIndependentDate(e)}),n=_.pluck(T,"toDate").map(function(e){return tzIndependentDate(e)}),i=C(_.min(a)),o=C(_.max(n)),s={from_date:i,to_date:o,fetchRates:!p.length,fetchCommonRestrictions:!ne(),"rate_ids[]":[t]},c=_.pluck(R[u].selectedRateTypes,"id");c.length&&(s["rate_type_ids[]"]=c),Q(s);var l={params:s,onSuccess:q,successCallBackParameters:{rateID:t,fromDate:i,toDate:o}};e.callAPI(r.fetchRatesAndDailyRates,l)},Z=function(t){var a=_.pluck(R,"fromDate").map(function(e){return tzIndependentDate(e)}),n=_.pluck(R,"toDate").map(function(e){return tzIndependentDate(e)}),i=C(_.min(a)),o=C(_.max(n)),s={from_date:i,to_date:o,fetchRateTypes:!h.length,fetchCommonRestrictions:!ne(),"rate_type_ids[]":[t]},c={params:s,onSuccess:J,successCallBackParameters:{rateTypeID:t,fromDate:i,toDate:o}};e.callAPI(r.fetchRateTypes,c)},Q=function(t){e.hierarchyRestrictions.rateTypeEnabled&&"RATE_TYPES"===e.chosenTab?t.hierarchialRateTypeRestrictionRequired=!0:e.hierarchyRestrictions.roomTypeEnabled&&"ROOM_TYPES"===e.chosenTab?t.hierarchialRoomTypeRestrictionRequired=!0:!e.hierarchyRestrictions.rateEnabled||"RATES"!==e.chosenTab&&"RATE_TYPES"!==e.chosenTab||(t.hierarchialRateRestrictionRequired=!0)},ee=function(t){var a={from_date:C(t.fromDate),to_date:C(t.toDate),order_id:t.orderBySelectedValue,fetchRateTypes:!h.length,fetchCommonRestrictions:!ne()};a.page=t.allRateTypes.currentPage,a.per_page=g;var n=_.pluck(t.selectedRateTypes,"id");n.length&&(a["rate_type_ids[]"]=n),Q(a);var i={params:a,onSuccess:te};e.callAPI(r.fetchRateTypes,i)},te=function(e){var t=e.rateTypeAndRestrictions[0].rate_types.length;E=e.totalCount,0===t?(M(),tt()):ae(e)},ae=function(t){var a=t.rateTypeAndRestrictions,r=t.commonRestrictions,i=t.panelRestrictions;h=h.length?h:t.rateTypes;var o=_.pluck(a,"date");ge(o);var s=re(o,a,r,h,i),c=s.rateTypeWithRestrictions;se(c,o,s.restrictionSummary),N(o,c,RM_RX_CONST.RATE_TYPE_VIEW_CHANGED),e.$broadcast(n.CLOSE_FILTER_SECTION)},re=function(e,t,a,r,n){var i=null,o=_.object(e,t),s=_.pluck(r,"id"),c=_.object(s,r),l=t[0].rate_types.map(function(t){return t.restrictionList=[],t.amountList=[],t=_extends({},t,c[t.id]),e.map(function(e){i=_.findWhere(o[e].rate_types,{id:t.id}),t.restrictionList.push(i.restrictions),null===i.amount?t.amountList.push(null):i.hasOwnProperty("amount")&&t.amountList.push(i.rate_currency+""+i.amount)}),_.omit(t,"restrictions")}),d=ne()?ie(e,n):[{restrictionList:e.map(function(e){return _.findWhere(a,{date:e}).restrictions})}];return{rateTypeWithRestrictions:l,restrictionSummary:d}},ne=function(){return e.hierarchyRestrictions.houseEnabled||e.hierarchyRestrictions.roomTypeEnabled||e.hierarchyRestrictions.rateTypeEnabled||e.hierarchyRestrictions.rateEnabled},ie=function(e,t,a){var r=[{houseRestrictionSummary:oe(e,t&&t.houseRestrictions),roomTypeRestrictionSummary:oe(e,t&&t.roomTypeRestrictions),rateTypeRestrictionSummary:oe(e,t&&t.rateTypeRestrictions),rateRestrictionSummary:oe(e,t&&t.rateRestrictions),allRoomTypeSummary:a?oe(e,a):[]}];return r},oe=function(e,t){var a;return a=t?e.map(function(e){return _.findWhere(t,{date:e}).restrictions}):e.map(function(e){return[]}),[{restrictionList:a}]},se=function(t,r,n){var o={type:RM_RX_CONST.RATE_TYPE_VIEW_CHANGED,restrictionSummaryData:[].concat(_toConsumableArray(n)),rateTypeRestrictionData:[].concat(_toConsumableArray(t)),businessDate:tzIndependentDate(a.businessDate),callbacksFromAngular:Te(),paginationStateData:{totalRows:E,perPage:g,page:R[u].allRateTypes.currentPage},dates:r,restrictionTypes:i,activeHierarchyRestrictions:it(),houseAvailability:[].concat(_toConsumableArray(e.houseAvailability)),weekendDays:[].concat(_toConsumableArray(e.weekendDays)),eventsCount:[].concat(_toConsumableArray(e.eventsCount))};st.dispatch(o),document.getElementById("rate-manager").scrollTop=0},ce=function(t){var a={from_date:C(t.fromDate),to_date:C(t.toDate),order_id:t.orderBySelectedValue,"name_card_ids[]":_.pluck(t.selectedCards,"id"),fetchRoomTypes:!m.length,fetchCommonRestrictions:!ne()};Q(a);var n={params:a,onSuccess:Oe};e.callAPI(r.fetchRatesAndRoomTypes,n)};e.clickedOnBackButton=function(){var t;if(R[u].fromLeftFilter=!1,"RATES"===f){e.isRateView=!0,e.isRateTypeView=!1,e.isRoomTypeView=!1;var a=R[u].selectedRates[0].id;R.splice(u,1),u-=1,v.splice(v.length-1,1),K(a),e.showBackButton=!1,t=_.where(v,{actionType:RM_RX_CONST.RATE_VIEW_CHANGED}),_.has(R[u].allRate,"scrollTo")&&(reduxActionForAllRateView.scrollTo=R[u].allRate.scrollTo,R[u].allRate=_.omit(R[u].allRate,"scrollTo"))}else if("RATE_TYPES"===f&&e.isRateView){e.isRateView=!1,e.isRateTypeView=!0,e.isRoomTypeView=!1,p=[],T=[],R.splice(u,1),u-=1,v.splice(v.length-1,1),ee(R[u]),e.showBackButton=!1;_.where(v,{actionType:RM_RX_CONST.RATE_TYPE_VIEW_CHANGED});_.has(R[u].allRate,"scrollTo")&&(reduxActionForAllRateTypeView.scrollTo=R[u].allRateTypes.scrollTo,R[u].allRateTypes=_.omit(R[u].allRateTypes,"scrollTo"))}else"RATE_TYPES"===f&&e.isRoomTypeView&&(e.isRateView=!0,e.isRateTypeView=!1,e.isRoomTypeView=!1,e.backButtonText="RATE TYPES",R.splice(u,1),u-=1,v.splice(v.length-1,1),T=[],Ae(R[u]),e.showBackButton=!0,t=_.where(v,{actionType:RM_RX_CONST.RATE_VIEW_CHANGED}),_.has(R[u].allRate,"scrollTo")&&(reduxActionForAllRateView.scrollTo=R[u].allRate.scrollTo,R[u].allRate=_.omit(R[u].allRate,"scrollTo")))};var le=function(e){var t=e.roomTypeIDs,a=e.date,r=R[u].selectedRates[0].id;return 0===t.length?ze(r,a):je(r,t[0],a)},de=function(t){e.$emit(n.RELOAD_RESULTS)},Re=function(e){st.dispatch({type:RM_RX_CONST.HIERARCHY_FROZEN_PANEL_TOGGLED,frozenPanelClosed:!!e})},ue=function(e){var t=(e.roomTypeIDs,e.date),a={date:t,hierarchyLevel:"RoomType"};he(a)},_e=function(e){var t=(e.rateTupeIDs,e.date),a={date:t,hierarchyLevel:"RateType"};he(a)},pe=function(e){var t=(e.rateIDs,e.date),a={date:t,hierarchyLevel:"Rate"};he(a)},me=function(e){var t=(e.rateIDs,e.date),a={date:t,hierarchyLevel:"House"};he(a)},he=function(t){s.open({template:"/assets/partials/rateManager_/popup/hierarchyRestriction/rvRateManagerHierarchyRestrictionPopup.html",scope:e,className:"",data:t,controller:"rvRateManagerHierarchyRestrictionsPopupCtrl",closeByDocument:!1,closeByEscape:!1})},Te=function(){return{singleRateViewCallback:Qe,singleRateTypeViewCallback:Ze,openAllCallbackForSingleRateView:b,closeAllCallbackForSingleRateView:P,closeAllRestrictionsForRateView:H,openAllRestrictionsForRateView:k,closeAllRestrictionsForRoomTypeView:V,openAllRestrictionsForRoomTypeView:F,clickedOnRateViewCell:Ge,clickedOnRoomTypeViewCell:Ue,clickedOnRoomTypeAndAmountCell:le,clickedOnRateTypeViewCell:ke,goToPrevPage:We,goToNextPage:Be,changedHeirarchyRestriction:de,handlePanelToggle:Re,clickedOnHierarchyRoomTypeCell:ue,clickedOnHierarchyRateTypeCell:_e,clickedOnHierarchyRateCell:pe,clickedOnHierarchyHouseCell:me,onDailyEventCountClick:_t}},fe=function(t){var a=[].concat(_toConsumableArray(t.dailyRateAndRestrictions)),r=t.commonRestrictions,i=t.panelRestrictions;p=p.length?p:t.rates;var o=_.pluck(a,"date");ge(o);var s=Ee(o,a,r,p,i),c=s.ratesWithRestrictions;ye(c,o,s.restrictionSummary),N(o,c,RM_RX_CONST.RATE_VIEW_CHANGED),e.$broadcast(n.CLOSE_FILTER_SECTION)},ye=function(t,r,n){var o={type:RM_RX_CONST.RATE_VIEW_CHANGED,rateRestrictionData:[].concat(_toConsumableArray(t)),restrictionSummaryData:[].concat(_toConsumableArray(n)),businessDate:tzIndependentDate(a.businessDate),callbacksFromAngular:Te(),paginationStateData:{totalRows:y,perPage:g,page:R[u].allRate.currentPage},dates:r,restrictionTypes:i,activeHierarchyRestrictions:it(),houseAvailability:[].concat(_toConsumableArray(e.houseAvailability)),weekendDays:[].concat(_toConsumableArray(e.weekendDays)),eventsCount:[].concat(_toConsumableArray(e.eventsCount))};_.has(R[u].allRate,"scrollTo")&&(o.scrollTo=R[u].allRate.scrollTo,R[u].allRate=_.omit(R[u].allRate,"scrollTo")),st.dispatch(o)},Ee=function(e,t,a,r,n){var i=null,o=_.object(e,t),s=_.pluck(r,"id"),c=_.object(s,r),l=t[0].rates.map(function(t){return t=_extends({},t,c[t.id]),t.restrictionList=[],t.amountList=[],e.map(function(e){i=_.findWhere(o[e].rates,{id:t.id}),t.restrictionList.push(i.restrictions),null===i.amount?t.amountList.push(null):i.hasOwnProperty("amount")&&t.amountList.push(i.rate_currency+""+i.amount)}),_.omit(t,"restrictions")}),d=ne()?ie(e,n):[{restrictionList:e.map(function(e){return _.findWhere(a,{date:e}).restrictions})}];return{ratesWithRestrictions:l,restrictionSummary:d}},ge=function(t){var a=[],r=0;if(e.fromDate=t[0],e.toDate=t[t.length-1],e.showTopBar=!0,e.selectedCardNames=_.pluck(R[u].selectedCards,"account_name"),e.selectedRateNames=_.pluck(R[u].selectedRates,"name"),e.selectedRateTypeNames=_.pluck(R[u].selectedRateTypes,"name"),e.selectedAccountName=_.pluck(R[u].selectedRates,"accountName"),e.selectedAddress=_.pluck(R[u].selectedRates,"address"),void 0===e.selectedAccountName[0])for(a=R[u].selectedCards,e.selectedCardNames=[],r=0;r<a.length;r++)0!==a[r].current_contracts.length&&e.selectedCardNames.push(a[r].account_name);A()},Se=function(e){var t=e.dailyRateAndRestrictions[0].rates.length;if(1===t&&_.has(R[u],"fromLeftFilter")&&R[u].fromLeftFilter){var a=p.length?p:e.rates;p=a,R[u].selectedRates=_.where(a,{id:e.dailyRateAndRestrictions[0].rates[0].id}),et(R[u])}else{if(0!==t){var r=_.pluck(e.dailyRateAndRestrictions,"date"),n={fromDate:r[0],toDate:r[r.length-1]},i=_.has(e,"commonRestrictions"),o=_.has(e,"panelRestrictions");if(i||o){var s=_.where(T,n);s.map(function(t){t.response.commonRestrictions=e.commonRestrictions})}else{var c=_.findWhere(T,n);_.has(c,"response")?e.commonRestrictions=c.response.commonRestrictions:console.error("response key or caching is missing from cachedRateAndRestrictionResponseData")}return T.push(_extends({},n,{page:R[u].allRate.currentPage,response:e})),y=e.totalCount,fe(e)}M(),tt()}},ve=function(e,t,a,r,n,i){var o=null,s=_.object(e,t),c=_.pluck(r,"id"),l=_.object(c,r),d=_.object(e,i),R=null,u=t[0].room_types.map(function(t){return t.restrictionList=[],t.amountList=[],t.availabilityList=[],t=_extends({},t,l[t.id]),e.map(function(e){o=_.findWhere(s[e].room_types,{id:t.id}),t.restrictionList.push(o.restrictions),null===o.amount?t.amountList.push(null):o.hasOwnProperty("amount")&&t.amountList.push(o.rate_currency+""+o.amount),R=_.findWhere(d[e].room_types,{id:t.id}),R&&null===R.availability?t.availabilityList.push(null):R&&R.hasOwnProperty("availability")&&t.availabilityList.push(R.availability)}),_.omit(t,"restrictions")}),p=ne()?ie(e,n):[{restrictionList:e.map(function(e){return _.findWhere(a,{date:e}).restrictions})}];return{roomTypeWithRestrictions:u,restrictionSummary:p}},Ce=function(t,r,n){var o={type:RM_RX_CONST.ROOM_TYPE_VIEW_CHANGED,restrictionSummaryData:[].concat(_toConsumableArray(n)),weekendDays:[].concat(_toConsumableArray(e.weekendDays)),roomTypeRestrictionData:[].concat(_toConsumableArray(t)),businessDate:tzIndependentDate(a.businessDate),callbacksFromAngular:Te(),dates:r,restrictionTypes:i,activeHierarchyRestrictions:it(),eventsCount:[].concat(_toConsumableArray(e.eventsCount))};st.dispatch(o)},De=function(t){var a=t.roomTypeAndRestrictions,r=t.commonRestrictions,i=t.panelRestrictions,o=t.roomTypeAvailability;e.weekendDays=t.weekendDays||[],m=m.length?m:t.roomTypes;var s=_.pluck(a,"date");ge(s);var c=ve(s,a,r,m,i,o),l=c.roomTypeWithRestrictions;Ce(l,s,c.restrictionSummary),e.$broadcast(n.CLOSE_FILTER_SECTION)},Oe=function(e){var t=e.roomTypeAndRestrictions[0].room_types;0===t?(M(),tt()):De(e)},Ae=function(t){var a=_.findWhere(T,{fromDate:C(t.fromDate),toDate:C(t.toDate),page:R[u].allRate.currentPage}),n=!ne();if(n&&a)return fe(a.response);var i=_.where(T,{fromDate:C(t.fromDate),toDate:C(t.toDate)});i.map(function(e){e.response.commonRestrictions&&e.response.commonRestrictions.length&&(n=!1)});var o={from_date:C(t.fromDate),to_date:C(t.toDate),order_id:t.orderID,"name_card_ids[]":_.pluck(t.selectedCards,"id"),group_by:t.groupBySelectedValue,fetchRates:!p.length,fetchCommonRestrictions:n};Q(o),t.selectedRateTypes.length&&(o["rate_type_ids[]"]=_.pluck(t.selectedRateTypes,"id")),t.selectedRates.length&&(o["rate_ids[]"]=_.pluck(t.selectedRates,"id"),n&&(o.considerRateIDsInCommonRestriction=!0)),o.page=t.allRate.currentPage,o.per_page=g;var s={params:o,onSuccess:Se};e.callAPI(r.fetchRatesAndDailyRates,s)},Me=function(e,t){var a=e.dailyRateAndRestrictions,r=e.restrictionsWithStatus[0].restrictions,n=p.length?p:e.rates,s=[];p=[].concat(_toConsumableArray(n));var c=t.rateIDs;n=n.filter(function(e){return c.indexOf(e.id)>-1&&e}),!n.length&&R[u].selectedRateTypes.length&&(s=R[u].selectedRateTypes);var l={rates:n,rateTypes:s,mode:o.RM_MULTIPLE_RATE_RESTRICTION_MODE,restrictionData:a,restrictionTypes:i,date:t.date,variedAndCommonRestrictions:r,isMultiple:!0};O(l)},Ne=function(t,a,n){var i={"rate_ids[]":a,"rate_type_ids[]":t,from_date:n,to_date:n,considerRateIDsInAllRestrictionStatusFetch:a.length>0},o={params:i,onSuccess:Me,successCallBackParameters:{rateIDs:a,date:n,rateTypeIDs:t}};e.callAPI(r.fetchRateRestrictionDetailsAndCommonRestrictions,o)},Ie=function(e,t){var a=e.roomTypeAndRestrictions,r=m.length?m:e.roomTypes,n=e.restrictionsWithStatus[0].restrictions,s=e.roomTypeAndRestrictions[0].room_types.map(function(e){return _extends({},e,_.findWhere(r,{id:e.id}))});m=r;var c={mode:o.RM_SINGLE_RATE_RESTRICTION_MODE,rate:_.findWhere(p,{id:t.rateID}),date:t.date,roomTypesAndPrices:s,restrictionData:a,restrictionTypes:i,variedAndCommonRestrictions:n,isMultiple:!1};O(c)},be=function(e,t){var a=e.roomTypeAndRestrictions,r=p.length?p:e.rates,n=e.restrictionsWithStatus[0].restrictions||e.restrictionsWithStatus[0].rate_types[0].restrictions,s=e.rateAndRestrictions[0].rates.map(function(e){return _extends({},e,_.findWhere(r,{id:e.id}))}),c={mode:o.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE,rateType:_.findWhere(h,{id:t.rateTypeID}),date:t.date,rateAndRestrictions:s,restrictionData:a,restrictionTypes:i,variedAndCommonRestrictions:n,isMultiple:!1};O(c)},Le=function(e,t){var a=e.roomTypeAndRestrictions,r=p.length?p:e.rates,n=e.restrictionsWithStatus[0].restrictions,s=e.rateAndRestrictions[0].rates.map(function(e){return _extends({},e,_.findWhere(r,{id:e.id}))}),c={mode:o.RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE,rateType:R[u].selectedRateTypes,date:t.date,rateAndRestrictions:s,restrictionData:a,restrictionTypes:i,variedAndCommonRestrictions:n,isMultiple:!0};O(c)},Pe=function(t,a){var n={from_date:a,to_date:a,rate_id:t,fetchRoomTypes:!m.length,fetchRates:!p.length};Q(n);var i={params:n,onSuccess:Ie,successCallBackParameters:{rateID:t,date:a}};e.callAPI(r.fetchSingleRateDetailsAndCommonRestrictions,i)},we=function(t,a){var n={from_date:a,to_date:a,rate_type_id:t,fetchRoomTypes:!m.length,fetchRates:!p.length};Q(n),n.hierarchialRateTypeRestrictionRequired&&_.omit(n,"fetchRoomTypes");var i={params:n,onSuccess:be,successCallBackParameters:{rateTypeID:t,date:a}};e.callAPI(r.fetchSingleRateTypeDetailsAndCommonRestrictions,i)},He=function(t,a){var n={from_date:a,to_date:a,fetchRoomTypes:!m.length,fetchRates:!p.length},i={params:n,onSuccess:Le,successCallBackParameters:{date:a}};e.callAPI(r.fetchSingleRateTypeDetailsAndCommonRestrictions,i)},ke=function(e){var t=e.rateTypeIDs,a=e.date;0===t.length?He([],a):we(t[0],a)},Ge=function(e){var t=e.rateIDs,a=e.date,r=[];if(0===t.length){var n=R[u].selectedRates;t=n.length?_.pluck(n,"id"):[],0===t.length&&(r=_.pluck(R[u].selectedRateTypes,"id")),Ne(r,t,a)}else Pe(t[0],a)},Ve=function(e,t){var a=e.roomTypeAndRestrictions,r=m.length?m:e.roomTypes,n=e.restrictionsWithStatus[0].restrictions||e.restrictionsWithStatus[0].room_types[0].restrictions,s=e.roomTypeAndRestrictions[0].room_types.map(function(e){return _extends({},e,_.findWhere(r,{id:e.id}))});m=r;var c={roomTypesAndPrices:s,restrictionData:a,restrictionTypes:i,mode:o.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE,roomType:_.findWhere(m,{id:t.roomTypeID}),date:t.date,variedAndCommonRestrictions:n,isMultiple:!1};O(c)},xe=function(t,a){var n={from_date:a,to_date:a,room_type_id:t,fetchRoomTypes:!m.length};Q(n);var i={params:n,onSuccess:Ve,successCallBackParameters:{roomTypeID:t,date:a}};e.callAPI(r.fetchRoomTypeWithRestrictionStatus,i)},Fe=function(e,t){var a=e.roomTypeAndRestrictions,r=e.restrictionsWithStatus[0].restrictions,n=m.length?m:e.roomTypes,s=e.roomTypeAndRestrictions[0].room_types.map(function(e){return _extends({},e,_.findWhere(n,{id:e.id}))});m=n;var c={roomTypesAndPrices:s,variedAndCommonRestrictions:r,restrictionData:a,restrictionTypes:i,mode:o.RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE,date:t.date,isMultiple:!0};O(c)},We=function(){R[u].fromLeftFilter=!1,e.isRateView?(R[u].allRate.currentPage--,Ae(R[u])):e.isRateTypeView&&(R[u].allRateTypes.currentPage--,ee(R[u]))},Be=function(){R[u].fromLeftFilter=!1,e.isRateView?(R[u].allRate.currentPage++,Ae(R[u])):e.isRateTypeView&&(R[u].allRateTypes.currentPage++,ee(R[u]))},Xe=function(t){var a={from_date:t,to_date:t,fetchRoomTypes:!m.length},n={params:a,onSuccess:Fe,successCallBackParameters:{date:t}};e.callAPI(r.fetchRoomTypeWithRestrictionStatus,n)},Ue=function(e){var t=e.roomTypeIDs,a=e.date;return 0===t.length?Xe(a):xe(t[0],a)},Ye=function(e,t){var a=m.length?m:e.roomTypes,r=p.length?p:e.rates,n=e.restrictionsWithStatus[0].restrictions,s=e.roomTypeAndRestrictions[0];m=a,p=r;var c={mode:o.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE,roomType:_.findWhere(m,{id:t.roomTypeID}),rate:_.findWhere(p,{id:t.rateID}),rates:p,date:t.date,restrictionTypes:i,roomTypePricesAndRestrictions:s,variedAndCommonRestrictions:n,isMultiple:!1};O(c)},je=function(t,a,n){var i={from_date:n,to_date:n,room_type_id:a,rate_id:t,fetchRoomTypes:!m.length,fetchRates:!p.length},o={params:i,onSuccess:Ye,successCallBackParameters:{roomTypeID:a,date:n,rateID:t}};e.callAPI(r.fetchSingleRateRestrictionsAndAmountsDetails,o)},$e=function(e,t){var a=m.length?m:e.roomTypes,r=p.length?p:e.rates,n=e.restrictionsWithStatus[0].restrictions,s=e.roomTypeAndRestrictions[0];m=a,p=r;var c={roomTypePricesAndRestrictions:s,variedAndCommonRestrictions:n,restrictionTypes:i,mode:o.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE,rate:_.findWhere(p,{id:t.rateID}),rates:p,date:t.date,isMultiple:!1};O(c)},ze=function(t,a){var n={from_date:a,to_date:a,rate_id:t,fetchRoomTypes:!m.length,fetchRates:!p.length},i={params:n,onSuccess:$e,successCallBackParameters:{date:a,rateID:t}};e.callAPI(r.fetchSingleRateRestrictionsAndAmountsDetails,i)},qe=function(e,t,a,r,n,i){var o=null,s=_.object(e,t),c=_.pluck(r,"id"),l=_.object(c,r),d=_.object(e,i),R=null,u=t[0].room_types.map(function(t){return t=_extends({},t,l[t.id]),t=_.pick(t,"id","name","restrictions"),t.restrictionList=[],t.rateDetails=[],t.availabilityList=[],e.map(function(e){o=_.findWhere(s[e].room_types,{id:t.id}),t.restrictionList.push(o.restrictions),t.rateDetails.push(_.omit(o,"restrictions","id","rateDetails","restrictionList")),R=_.findWhere(d[e].room_types,{id:t.id}),R&&null===R.availability?t.availabilityList.push(null):R&&R.hasOwnProperty("availability")&&t.availabilityList.push(R.availability)}),_.omit(t,"restrictions")}),p=ne()?ie(e,n,a):[{rateDetails:[],restrictionList:e.map(function(e){return _.findWhere(a,{date:e}).restrictions})}];return{roomTypeWithRestrictions:u,restrictionSummary:p}},Je=function(t,r,n){st.dispatch({type:RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED,singleRateRestrictionData:[].concat(_toConsumableArray(t)),restrictionSummaryData:[].concat(_toConsumableArray(n)),businessDate:tzIndependentDate(a.businessDate),callbacksFromAngular:Te(),restrictionTypes:i,dates:r,activeHierarchyRestrictions:it(),houseAvailability:[].concat(_toConsumableArray(e.houseAvailability)),weekendDays:[].concat(_toConsumableArray(e.weekendDays)),eventsCount:[].concat(_toConsumableArray(e.eventsCount))})},Ke=function(t){var a=t.roomTypeAndRestrictions,r=t.commonRestrictions,i=t.panelRestrictions,o=t.roomTypeAvailability;e.weekendDays=t.weekendDays||[],m=m.length?m:t.roomTypes;var s=a[0].room_types.length;if(0===s)return M(),void tt();var c=_.pluck(a,"date");ge(c);var l=qe(c,a,r,m,i,o),d=l.roomTypeWithRestrictions;Je(d,c,l.restrictionSummary),N(c,d,RM_RX_CONST.SINGLE_RATE_EXPANDABLE_VIEW_CHANGED),e.$broadcast(n.CLOSE_FILTER_SECTION)},Ze=function(t){R.push(_extends({},R[u],t,{fromLeftFilter:!1})),u+=1;var a=_extends({},R[u].allRate,{currentPage:1});R[u].allRate=a,delete R[u].allRateTypes,e.selectedRateTypeNames=_.pluck(R[u].selectedRateTypes,"name"),e.showBackButton=!0,e.isRateView=!0,e.isRateTypeView=!1,e.isRoomTypeView=!1;var r={allRate:a,chosenTab:"RATE_TYPES",fromDate:t.fromDate,toDate:t.toDate,fromLeftFilter:!1,selectedRateTypes:[{id:t.selectedRateTypes[0].id}],selectedRates:[]};Ae(r)},Qe=function(t){R.push(_extends({},R[u],t,{selectedRateTypes:[],fromLeftFilter:!1})),delete R[u].allRates,u+=1,e.selectedRateNames=_.pluck(R[u].selectedRates,"name"),e.selectedAccountName=_.pluck(R[u].selectedRates,"accountName"),e.selectedAddress=_.pluck(R[u].selectedRates,"address"),e.showBackButton=!0,e.isRateView=!1,e.isRateTypeView=!1,e.isRoomTypeView=!0,"RATE_TYPES"===f&&(e.backButtonText="RATES"),et(R[u])},et=function(t){var a={from_date:C(t.fromDate),to_date:C(t.toDate),order_id:t.orderBySelectedValue,rate_id:t.selectedRates[0].id,"name_card_ids[]":_.pluck(t.selectedCards,"id"),fetchRoomTypes:!m.length,fetchRates:!p.length,fetchCommonRestrictions:!0};Q(a);var n={params:a,onSuccess:Ke};e.callAPI(r.fetchSingleRateDetailsAndRoomTypes,n)},tt=function(){st.dispatch({type:RM_RX_CONST.SHOW_NO_RESULTS})},at=function(){var e=angular.element(".rate-manager-content")[0].offsetHeight,t=l.allRate;g=Math.ceil(e/t.rowHeight),g%5!==0&&(g+=5-g%5),S=g+t.additionalRowsToPickFromPrevious};e.$on(n.UPDATE_RESULTS,function(t,a){var r=_.has(a,"fromLeftFilter")&&a.fromLeftFilter;if(e.houseAvailability=[].concat(_toConsumableArray(a.houseAvailability)),e.weekendDays=[].concat(_toConsumableArray(a.weekendDays))||[],e.eventsCount=[].concat(_toConsumableArray(a.eventsCount)),e.isSingleRateSelected=!1,r)switch(m=[],h=[],T=[],f=a.chosenTab,a.scrollDirection=l.scroll.STILL,R=[_extends({},a)],u=0,e.showBackButton=!1,y=0,E=0,v=[],f){case"RATES":e.backButtonText="RATE",e.isRateView=!0,e.isRateTypeView=!1,e.isRoomTypeView=!1;break;case"RATE_TYPES":e.backButtonText="RATE TYPES",e.isRateView=!1,e.isRateTypeView=!0,e.isRoomTypeView=!1;break;case"ROOM_TYPES":e.isRateView=!1,e.isRateTypeView=!1,e.isRoomTypeView=!0}if(e.isRateView){if(r){var n=_extends({},R[u].allRate,{currentPage:1});R[u].allRate=n,a.allRate=n,T=[]}if(1===a.selectedRates.length)e.isSingleRateSelected=!0,et(a);else if(a.selectedRates.length>1){var i=_extends({},R[u].allRate,{currentPage:r?1:R[u].allRate.currentPage});R[u].allRate=i,a.allRate=i,r&&(y=0,T=[]),Ae(a)}else Ae(a)}else if(e.isRoomTypeView&&"ROOM_TYPES"===e.chosenTab)e.isRateView=!1,e.isRateTypeView=!1,e.isRoomTypeView=!0,ce(a);else if(e.isRoomTypeView&&"RATES"===e.chosenTab)e.isRateView=!1,e.isRateTypeView=!1,e.isRoomTypeView=!0,1===a.selectedRates.length&&et(a);else if(e.isRoomTypeView&&"RATE_TYPES"===e.chosenTab)e.isRateView=!1,e.isRateTypeView=!1,e.isRoomTypeView=!0,1===a.selectedRates.length&&et(a);else if(e.isRateTypeView){if(r){var o=_extends({},R[u].allRateTypes,{currentPage:1});R[u].allRateTypes=o,a.allRateTypes=o}ee(a)}});var rt=function(){var t={params:{},onSuccess:function(t){e.activeRestrictionsList=t.results}};e.callAPI(r.fetchActiveRestrictionsList,t)},nt=function(){e.showTopBar=!1,e.showBackButton=!1,e.selectedCardNames=[],e.selectedRateNames=[],e.selectedRateTypeNames=[],e.selectedAccountName=[],e.selectedAddress=[],e.fromDate=null,e.toDate=null,e.showAvailability=!0,e.viewingScreen=RM_RX_CONST.GRID_VIEW,e.activeRestrictionsList=[],it()&&rt()},it=function(){return(e.hierarchyRestrictions.houseEnabled&&1)+(e.hierarchyRestrictions.roomTypeEnabled&&1)+(e.hierarchyRestrictions.rateTypeEnabled&&1)+(e.hierarchyRestrictions.rateEnabled&&1)},ot={mode:RM_RX_CONST.NOT_CONFIGURED_MODE,isHierarchyHouseRestrictionEnabled:e.hierarchyRestrictions.houseEnabled,isHierarchyRoomTypeRestrictionEnabled:e.hierarchyRestrictions.roomTypeEnabled,isHierarchyRateTypeRestrictionEnabled:e.hierarchyRestrictions.rateTypeEnabled,isHierarchyRateRestrictionEnabled:e.hierarchyRestrictions.rateEnabled,showAvailability:!0},st=configureStore(ot),ct=ReactDOM,lt=ct.render,dt=ReactRedux,Rt=dt.Provider,ut=function(){return lt(React.createElement(Rt,{store:st
},React.createElement(RateManagerRootComponent,null)),document.querySelector("#rate-manager .rate-manager-content"))};e.toggleAvailability=function(){e.showAvailability=!e.showAvailability,e.$emit(n.RELOAD_RESULTS),st.dispatch({type:RM_RX_CONST.SHOW_AVAILABILITY,showAvailability:!!e.showAvailability})},e.shouldShowRoomTypeAvailabilityCheckbox=function(){return e.isRoomTypeView||e.isSingleRateSelected};var _t=function(t){e.selectedEventDisplayDate=t,s.open({template:"/assets/partials/rateManager_/listHouseEventsPopup.html",scope:e,controller:"rvRateManagerHouseEventsListPopupCtrl",className:"ngdialog-theme-default",closeByDocument:!1,closeByEscape:!0})};!function(){D("RATE_MANAGER_TITLE"),nt(),ut(),at()}()}]),angular.module("sntRover").controller("rvRateManagerHierarchyRestrictionSearchSetOnDetailsCtrl",["$scope","rvRateManagerHierarchyRestrictionsSrv","$timeout",function(e,t,a){BaseCtrl.call(this,e);var r="",n={},i=[],o=function(){e.setScroller("searchSetOnDetailsScroll")},s=function(){a(function(){e.refreshScroller("searchSetOnDetailsScroll")},500)};o(),s();var c=function(t){var a=t.results||t;"EDIT"===e.popUpView&&(_.each(a,function(t){_.each(e.selectedRestriction.setOnValuesList,function(r){t.id===r.id&&(e.searchObj.selectedList.push(t),a=a.filter(function(e){return e.id!==r.id}))})}),e.restrictionObj.selectedSetOnIds=_.pluck(e.searchObj.selectedList,"id")),e.searchObj.results=a,i=angular.copy(a)},l=function(){var t=function(e){c(e)},a=function(t){e.errorMessage=t},i={params:n,onSuccess:t,failureCallBack:a};e.callAPI(r,i)},d=function(){switch(e.searchObj={query:"",results:[],selectedList:[],headerLabel:"",noticeLabel:"",placeholder:"",isShowResults:!1},e.restrictionObj.selectedSetOnIds=[],e.ngDialogData.hierarchyLevel){case"RoomType":e.searchObj.headerLabel="Set on Room Type(s)",e.searchObj.noticeLabel="Applies to All Room Types!",e.searchObj.placeholder="Select or Search by Name/Code",r=t.fetchAllRoomTypes,n={exclude_pseudo:!0};break;case"RateType":e.searchObj.headerLabel="Set on Rate Type(s)",e.searchObj.noticeLabel="Applies to All Rate Types!",e.searchObj.placeholder="Select or Search by Rate Type Name",r=t.fetchAllRateTypes,n={};break;case"Rate":e.searchObj.headerLabel="Set on Rate(s)",e.searchObj.noticeLabel="Applies to All Rates!",e.searchObj.placeholder="Search by Rate Name or Code",r=t.fetchAllRates,n={is_fully_configured:!0,is_active:!0,exclude_locked_restriction_id:"number"===e.selectedRestriction.type?e.selectedRestriction.id:""}}l(),s(),e.$emit("REFRESH_FORM_SCROLL")},R=function(){e.restrictionObj.selectedSetOnIds=_.pluck(e.searchObj.selectedList,"id")};e.clickedOnResult=function(t){e.searchObj.selectedList.push(t),e.searchObj.query="",i=i.filter(function(e){return e.id!==t.id}),e.searchObj.results=i,R(),e.$emit("REFRESH_FORM_SCROLL"),e.searchObj.isShowResults=!1},e.clickedOnRemoveItem=function(t){i.push(e.searchObj.selectedList[t]),e.searchObj.selectedList.splice(t,1),R(),e.$emit("REFRESH_FORM_SCROLL")},e.clickedOnAllCheckBox=function(){e.restrictionObj.isSetOnAllActive=!e.restrictionObj.isSetOnAllActive,e.$emit("REFRESH_FORM_SCROLL"),e.restrictionObj.isSetOnAllActive&&(e.restrictionObj.selectedSetOnIds=[],e.searchObj.selectedList=[])},e.queryEntered=function(){e.$emit("REFRESH_FORM_SCROLL"),s();var t=[];e.searchObj.query&&e.searchObj.query.length>0?(t=i.filter(function(t){var a=isNaN(e.searchObj.query)&&t.name&&t.name.toUpperCase().includes(e.searchObj.query.toUpperCase())||isNaN(e.searchObj.query)&&t.code&&t.code.toUpperCase().includes(e.searchObj.query.toUpperCase());return a}),e.searchObj.results=t):e.searchObj.results=i,e.searchObj.isShowResults=!0},e.showResults=function(){e.searchObj.isShowResults=!0,s(),e.$emit("REFRESH_FORM_SCROLL")},e.hideResults=function(){e.searchObj.isShowResults=!1,e.$emit("REFRESH_FORM_SCROLL")},e.addListener("INIT_SET_ON_SEARCH",d)}]),angular.module("sntRover").controller("rvRateManagerHierarchyRestrictionsListCtrl",["$scope","$rootScope","rvRateManagerHierarchyRestrictionsSrv","rvRateManagerUtilitySrv","$timeout","rvRateManagerEventConstants",function(e,t,a,r,n,i){BaseCtrl.call(this,e);var o=function(){e.setScroller("hierarchyPopupListScroll")},s=function(){n(function(){e.refreshScroller("hierarchyPopupListScroll")},500)},c=function(e){var t=_.isEmpty(e),a=t?"EMPTY":"LIST";return a},l=function(){var t=function(t){switch(e.errorMessage="",e.ngDialogData.hierarchyLevel){case"House":e.restrictionObj.listData=t.house[0].restrictions,e.restrictionObj.noticeLabel="",e.restrictionObj.setOnCount=0;break;case"RoomType":e.restrictionObj.listData=t.room_type[0].restrictions,e.restrictionObj.noticeLabel="ALL ROOM TYPES",e.restrictionObj.setOnCount=t.room_types_count;break;case"RateType":e.restrictionObj.listData=t.rate_type[0].restrictions,e.restrictionObj.noticeLabel="ALL RATE TYPES",e.restrictionObj.setOnCount=t.rate_types_count;break;case"Rate":e.restrictionObj.listData=t.rate[0].restrictions,e.restrictionObj.noticeLabel="ALL RATES",e.restrictionObj.setOnCount=t.rates_count}e.popUpView=c(e.restrictionObj.listData),s()},r=function(t){e.errorMessage=t},n={from_date:e.ngDialogData.date,to_date:e.ngDialogData.date,"levels[]":e.ngDialogData.hierarchyLevel},i={params:n,onSuccess:t,failureCallBack:r};e.callAPI(a.fetchHierarchyRestrictions,i)};e.clickedOnListItem=function(t,a){if(!e.isPastDate()){var n={};e.popUpView="EDIT",e.selectedRestriction=_.find(r.restrictionColorAndIconMapping,function(e){return e.key===t}),e.selectedRestriction.activeGroupList=[],e.selectedRestriction.id=r.restrictionKeyToCodeMapping[e.selectedRestriction.key][0],"number"===e.selectedRestriction.type?(n=e.restrictionObj.listData[t][a],e.selectedRestriction.value=n.value,e.selectedRestriction.setOnValuesList=n.set_on_values,e.selectedRestriction.activeGroupList=e.restrictionObj.listData[t],e.selectedRestriction.activeGroupIndex=a):(n=e.restrictionObj.listData[t],e.selectedRestriction.value=null,e.selectedRestriction.setOnValuesList=n.set_on_values||[],e.selectedRestriction.activeGroupList.push(n),e.selectedRestriction.activeGroupIndex=0),e.restrictionObj.isRepeatOnDates=!1,e.selectedRestriction.activeGroupKey=t,e.$broadcast("INIT_SET_ON_SEARCH"),n.set_on_values.length===e.restrictionObj.setOnCount?e.restrictionObj.isSetOnAllActive=!0:e.restrictionObj.isSetOnAllActive=!1}};var d=function(t,n){var o={from_date:e.ngDialogData.date,to_date:e.ngDialogData.date,restrictions:t},s=a.saveHouseRestrictions;if(n.length>0)switch(e.ngDialogData.hierarchyLevel){case"RoomType":o.room_type_ids=n,s=a.saveRoomTypeRestrictions;break;case"RateType":o.rate_type_ids=n,s=a.saveRateTypeRestrictions;break;case"Rate":o.rate_ids=n,s=a.saveRateRestrictions}if(e.restrictionObj.isRepeatOnDates){var c=r.getSelectedWeekDays(e.restrictionObj.daysList);c.length>0&&(o.weekdays=c),o.to_date=e.restrictionObj.untilDate}var d=function(){l(),e.$emit(i.RELOAD_RESULTS)},R={params:o,successCallBack:d};e.callAPI(s,R)};e.clickedOnRemove=function(e,t,a){var r={},n=[];r[e]=t,a&&(n=_.pluck(a,"id")),d(r,n)},e.isPastDate=function(){return t.businessDate>e.ngDialogData.date};var R=function(){var t=e.selectedRestriction.key,a="number"===e.selectedRestriction.type&&null,r={},n=[];e.selectedRestriction.setOnValuesList&&(n=_.pluck(e.selectedRestriction.setOnValuesList,"id")),r[t]=a,d(r,n)};o(),l(),e.addListener("RELOAD_RESTRICTIONS_LIST",l),e.addListener("CLICKED_REMOVE_ON_DATES",R)}]),angular.module("sntRover").controller("rvRateManagerHierarchyRestrictionsPopupCtrl",["$scope","$rootScope","rvRateManagerEventConstants","ngDialog","rvRateManagerUtilitySrv","rvRateManagerHierarchyRestrictionsSrv","$timeout",function(e,t,a,r,n,i,o){BaseCtrl.call(this,e);var s=function(){e.setScroller("hierarchyPopupFormScroll")},c=function(){o(function(){e.refreshScroller("hierarchyPopupFormScroll")},500)},l=function(e){var t=_.isEmpty(e),a=t?"EMPTY":"LIST";return a},d=function(){e.header={date:"",hierarchyType:"",disableNewRestriction:!1},e.popUpView="LIST",e.selectedRestriction={},e.restrictionStylePack=[],e.restrictionObj={isRepeatOnDates:!1,daysList:n.repeatOnDatesList,cellDate:e.ngDialogData.date,untilDate:"",listData:e.ngDialogData.listData,selectedSetOnIds:[],isSetOnAllActive:!1}},R=function(){e.popUpView=l(e.restrictionObj.listData)};e.initiateNewRestrictionForm=function(t){t?(e.selectedRestriction=_.find(n.restrictionColorAndIconMapping,function(e){return e.key===t}),e.selectedRestriction.value=null,e.selectedRestriction.id=n.restrictionKeyToCodeMapping[e.selectedRestriction.key][0],e.restrictionStylePack=angular.copy(n.restrictionColorAndIconMapping)):(e.selectedRestriction={},e.selectedRestriction.activeGroupList=[],e.restrictionStylePack=n.getActiveRestrictionColorAndIconMapping(e.activeRestrictionsList)),e.popUpView="NEW",e.showRestrictionSelection=!1,e.$broadcast("INIT_SET_ON_SEARCH"),e.restrictionObj.isRepeatOnDates=!1,e.restrictionObj.isSetOnAllActive=!1};var u=function(){e.header.hierarchyType=e.ngDialogData.hierarchyLevel,e.header.date=moment(e.ngDialogData.date).format("dddd, MMMM DD"),e.header.disableNewRestriction=t.businessDate>e.ngDialogData.date};e.showPlaceholder=function(){return!e.selectedRestriction.type},e.disableSelectBox=function(){return"EDIT"===e.popUpView||"NEW"===e.popUpView&&e.selectedRestriction.activeGroupList&&e.selectedRestriction.activeGroupList.length>0},e.showNights=function(){return!e.showPlaceholder()&&"number"===e.selectedRestriction.type},e.toggleRestrictionSelection=function(){e.showRestrictionSelection=!e.showRestrictionSelection,c()},e.restrictionSelected=function(t){_.isEmpty(e.selectedRestriction)||(e.selectedRestriction.value=null),e.selectedRestriction=t,e.selectedRestriction.id=n.restrictionKeyToCodeMapping[e.selectedRestriction.key][0],e.toggleRestrictionSelection(),e.$broadcast("SCROLL_REFRESH_REPEAT_ON_DATES"),e.selectedRestriction.activeGroupList&&(e.selectedRestriction.activeGroupList=[],e.selectedRestriction.value=null),"Rate"===e.ngDialogData.hierarchyLevel&&e.$broadcast("INIT_SET_ON_SEARCH")};var p=function(){return e.restrictionObj&&e.restrictionObj.isRepeatOnDates&&""===e.restrictionObj.untilDate},m=function(){return"House"!==e.ngDialogData.hierarchyLevel&&!e.restrictionObj.isSetOnAllActive&&e.restrictionObj.selectedSetOnIds&&0===e.restrictionObj.selectedSetOnIds.length};e.validateForm=function(){var t;return t=!(e.showPlaceholder()||p()||m())&&("boolean"===e.selectedRestriction.type||"number"===e.selectedRestriction.type&&/^[1-9]\d*$/.test(e.selectedRestriction.value))},e.saveHierarchyRestriction=function(){var t={},r="";t[e.selectedRestriction.key]="number"!==e.selectedRestriction.type||Math.round(e.selectedRestriction.value);var o={from_date:e.ngDialogData.date,to_date:e.ngDialogData.date,associate_multiple:"House"!==e.ngDialogData.hierarchyLevel,restrictions:t};switch(e.ngDialogData.hierarchyLevel){case"House":r=i.saveHouseRestrictions;break;case"RoomType":o.room_type_ids=e.restrictionObj.isSetOnAllActive?[]:e.restrictionObj.selectedSetOnIds,r=i.saveRoomTypeRestrictions;break;case"RateType":o.rate_type_ids=e.restrictionObj.isSetOnAllActive?[]:e.restrictionObj.selectedSetOnIds,r=i.saveRateTypeRestrictions;break;case"Rate":o.rate_ids=e.restrictionObj.isSetOnAllActive?[]:e.restrictionObj.selectedSetOnIds,r=i.saveRateRestrictions}if(e.restrictionObj.isRepeatOnDates){var s=n.getSelectedWeekDays(e.restrictionObj.daysList);s.length>0&&(o.weekdays=s),o.to_date=e.restrictionObj.untilDate}var c=function(){e.$emit(a.RELOAD_RESULTS),e.$broadcast("RELOAD_RESTRICTIONS_LIST")},l={params:o,onSuccess:c};e.callAPI(r,l)},e.backToInitialScreen=function(){e.selectedRestriction={},R()},e.closeDialog=function(){t.modalClosing=!0,o(function(){r.close(),t.modalClosing=!1,window.scrollTo(0,0),document.getElementById("rate-manager").scrollTop=0,document.getElementsByClassName("pinnedLeft-list")[0].scrollTop=0},700)},e.clickedOnRepeatOnDates=function(){e.restrictionObj.isRepeatOnDates=!e.restrictionObj.isRepeatOnDates,e.$broadcast("CLICKED_REPEAT_ON_DATES")},e.getSetButtonLabel=function(){var t="Set";return"EDIT"===e.popUpView&&(t="Update"),e.restrictionObj.isRepeatOnDates&&(t="Set on date(s)"),t},e.getRemoveButtonLabel=function(){var t="Remove";return e.restrictionObj.isRepeatOnDates&&(t="Remove on date(s)"),t},e.disableRemoveButton=function(){return p()},e.clickedOnRemoveButton=function(){e.$broadcast("CLICKED_REMOVE_ON_DATES")},e.clickedOnAddNew=function(){e.initiateNewRestrictionForm(e.selectedRestriction.key),e.selectedRestriction.activeGroupIndex=null},e.clickedOnLeftRestrictionList=function(t){var a="";e.popUpView="EDIT","number"===e.selectedRestriction.type?(a=e.restrictionObj.listData[e.selectedRestriction.activeGroupKey][t],e.selectedRestriction.value=a.value,e.selectedRestriction.setOnValuesList=a.set_on_values,e.selectedRestriction.activeGroupIndex=t):(a=e.restrictionObj.listData[e.selectedRestriction.activeGroupKey],e.selectedRestriction.value=null,e.selectedRestriction.setOnValuesList=a.set_on_values||[],e.selectedRestriction.activeGroupIndex=0),e.restrictionObj.isRepeatOnDates=!1,e.$broadcast("INIT_SET_ON_SEARCH"),c(),a.set_on_values.length===e.restrictionObj.setOnCount?e.restrictionObj.isSetOnAllActive=!0:e.restrictionObj.isSetOnAllActive=!1};var h=function(){d(),s(),c(),u()};e.addListener("REFRESH_FORM_SCROLL",c),h()}]),angular.module("sntRover").controller("rvRateManagerHierarchyRestrictionsRepeatOnDatesCtrl",["$scope","ngDialog","$timeout",function(e,t,a){BaseCtrl.call(this,e),e.setScroller("repeatOnDatesScroller");var r=function(){a(function(){e.refreshScroller("repeatOnDatesScroller")},500)};e.checkedEachDay=function(t){e.restrictionObj.daysList[t].isChecked=!e.restrictionObj.daysList[t].isChecked};var n=function(){var t=!0;return _.each(e.restrictionObj.daysList,function(e){if(!e.isChecked)return t=!1}),t},i=function(){_.each(e.restrictionObj.daysList,function(e){e.isChecked=!0})},o=function(){_.each(e.restrictionObj.daysList,function(e){e.isChecked=!1})};e.generateButtonText=function(){var e="Select All";return n()&&(e="Clear All"),e},e.getButtonClass=function(){var e="brand-text";return n()&&(e="red-text"),e},e.clickedSelectAllOrClearAll=function(){n()?o():i()};var s={};e.addListener("UNTIL_DATE_CHANGED",function(){t.close(s.id)}),e.addListener("SCROLL_REFRESH_REPEAT_ON_DATES",function(){r()}),e.addListener("CLICKED_REPEAT_ON_DATES",function(){e.restrictionObj.isRepeatOnDates&&(r(),o(),e.restrictionObj.untilDate="")}),e.clickedUntilDate=function(){s=t.open({template:"/assets/partials/rateManager_/popup/hierarchyRestriction/rvRateManagerHierarchyRestrictionsDatePicker.html",controller:"rvRMHierarchyRestrictionsDatePickerCtrl",className:"single-date-picker",scope:e})}}]),sntRover.controller("rvRateManagerHouseEventsListPopupCtrl",["$scope","$rootScope","$timeout","rvRateManagerCoreSrv","ngDialog","$filter",function(e,t,a,r,n,i){BaseCtrl.call(this,e);var o="events-list-scroller",s=function(){var t={tap:!0,preventDefault:!1};e.setScroller(o,t)},c=function(){a(function(){e.refreshScroller(o)},100)},l=function(){var t=function(t){e.eventsData=t,c()},a=function(){e.eventsData=[]},n={onSuccess:t,onFailure:a,params:{date:e.selectedEventDisplayDate}};e.callAPI(r.fetchHouseEventsByDate,n)};e.closeDialog=function(){document.activeElement.blur(),t.modalClosing=!0,a(function(){n.close(),t.modalClosing=!1,window.scrollTo(0,0),document.getElementById("rate-manager").scrollTop=0,document.getElementsByClassName("pinnedLeft-list")[0].scrollTop=0,e.$apply()},700)};var d=function(){e.displayDate=i("date")(new tzIndependentDate(e.selectedEventDisplayDate),"EEEE, dd MMMM yyyy"),s(),l()};d()}]),angular.module("sntRover").controller("rvRateManagerLeftSideFilterCtrl",["$scope","$filter","ngDialog","rvUtilSrv","$rootScope","rvRateManagerOrderByConstants","rvTwoMonthCalendarEventConstants","rvRateManagerGroupByConstants","rvRateManagerEventConstants","RMFilterOptionsSrv","RateMngrCalendarSrv","$q","rvRateManagerCoreSrv",function(e,t,a,r,n,i,o,s,c,l,d,R,u){BaseCtrl.call(this,e),e.toggleFilterVisibility=function(){e.isFilterVisible=!e.isFilterVisible};var p=function(){e.refreshScroller("filter_details")},m=function(){e.setScroller("filter_details",{tap:!0,preventDefault:!1})},h=function(e){return t("date")(new tzIndependentDate(e),n.dateFormat)};e.$on(c.CLOSE_FILTER_SECTION,function(t){e.isFilterVisible=!1}),e.rateTypeSelected=function(){if(""!==e.selectedRateTypeID.trim){var t={id:parseInt(e.selectedRateTypeID)},a=_.findWhere(e.rateTypes,t),r=_.findIndex(e.selectedRateTypes,t)>-1;a&&!r&&e.selectedRateTypes.push(a),e.deleteAllSelectedCards()}},e.rateTypeSelectedFromRTT=function(){if(""!==e.selectedRateTypeIDFromRTT.trim){var t={id:parseInt(e.selectedRateTypeIDFromRTT)},a=_.findWhere(e.rateTypes,t),r=_.findIndex(e.selectedRateTypesFromRTT,t)>-1;a&&!r&&(e.selectedRateTypesFromRTT.push(a),p(),T("#selected-rate-type-list br")),e.deleteAllSelectedCards()}},e.deleteSelectedRateType=function(t){var a=_.findIndex(e.selectedRateTypes,{id:parseInt(t)});e.selectedRateTypes.splice(a,1),e.selectedRateTypeID="",p()},e.deleteSelectedRateTypeFromRTT=function(t){var a=_.findIndex(e.selectedRateTypesFromRTT,{id:parseInt(t)});e.selectedRateTypesFromRTT.splice(a,1),e.selectedRateTypeIDFromRTT="",p()},e.deleteAllSelectedRateTypes=function(){e.selectedRateTypes=[],e.selectedRateTypeID=""},e.deleteAllSelectedRateTypesFromRTT=function(){e.selectedRateTypesFromRTT=[],e.selectedRateTypeIDFromRTT=""};var T=function(t){var a=e.getScroller("filter_details");setTimeout(function(){a.scrollToElement(t,700)},301)};e.rateSelected=function(){if(""!==e.selectedRateID.trim){var t={id:parseInt(e.selectedRateID)},a=_.findWhere(e.rates,t),r=_.findIndex(e.selectedRates,t)>-1;a&&!r&&(e.selectedRates.push(a),p(),T("#selected-rate-list br")),e.deleteAllSelectedCards()}},e.deleteSelectedRate=function(t){var a=_.findIndex(e.selectedRates,{id:parseInt(t)});e.selectedRates.splice(a,1),e.selectedRateID="",p()},e.deleteAllSelectedRates=function(){e.selectedRates=[],e.selectedRateID="",p()},e.shouldShowRate=function(t){return""===e.selectedRateTypeID&&!e.selectedRateTypes.length||parseInt(e.selectedRateTypeID)===t.rate_type.id},e.deleteAllSelectedValues=function(){e.deleteAllSelectedRates(),e.deleteAllSelectedRateTypes(),e.deleteAllSelectedRateTypesFromRTT(),e.deleteAllSelectedCards()},e.$on(o.TWO_MONTH_CALENDAR_DATE_UPDATED,function(t,a){e.fromDate=a.fromDate,e.toDate=a.toDate,e.selectedDateRange=h(a.fromDate)+" to "+h(a.toDate)}),e.switchTabAndCorrespondingActions=function(t){switch(e.chosenTab=t,p(),T(".filters"),t){case"RATES":e.deleteAllSelectedRateTypesFromRTT();break;case"RATE_TYPES":e.deleteAllSelectedRates(),e.deleteAllSelectedRateTypes();break;case"ROOM_TYPES":e.deleteAllSelectedValues()}},e.getButtonText=function(){var t="";switch(e.chosenTab){case"RATES":t=0===e.selectedRates.length&&0===e.selectedCards.length?"Show All Rates":e.selectedCards.length>0?"Show Contract Rates":"Show Selected Rates";break;case"RATE_TYPES":t=0===e.selectedRateTypesFromRTT.length?"Show All Rate Types":"Show Selected Rate Types";break;case"ROOM_TYPES":t="Show All Room Types";break;default:t="Show All Rates"}return t},e.showCalendar=function(){var t={month:3},i={fromDate:new tzIndependentDate(n.businessDate),toDate:r.getFirstDayOfNextMonth(n.businessDate),maxRange:t};""!==e.selectedDateRange&&(i.fromDate=new tzIndependentDate(e.fromDate),i.toDate=new tzIndependentDate(e.toDate)),a.open({template:"/assets/partials/rateManager_/dateRangeModal/rvDateRangeModal.html",controller:"rvDateRangeModalCtrl",className:"ngdialog-theme-default calendar-modal",scope:e,data:i})};var f=function(){e.deleteAllSelectedRates(),e.deleteAllSelectedRateTypes(),e.deleteAllSelectedRateTypesFromRTT(),p()};e.cardSelected=function(t,a){if(e.selectedCards.length){var r=_.pluck(e.selectedCards,"id");r.indexOf(a.item.id)<0&&e.selectedCards.push(a.item)}else e.selectedCards.push(a.item);f(),e.chosenTab="RATES",y(),p(),T("#rm-selected-card-list span:last-child")},e.deleteSelectedCard=function(t){var a=_.findIndex(e.selectedCards,{id:parseInt(t)});e.selectedCards.splice(a,1),e.cardSearchText="",p()},e.deleteAllSelectedCards=function(){e.selectedCards=[],e.cardSearchText="",p()},e.shouldDisableShowRateButton=function(){return!e.fromDate||!e.toDate};var y=function(){e.$$phase||e.$digest()},E=function(){e.$emit("hideLoader")},g=function(){e.$emit("hideLoader"),e.$emit("showErrorMessage",["Sorry, something got wrong while trying to fill the rate, rate type, sorting preference values"])},S=function(t){e.orderBySelectedValue=t.id},v=function(t){e.orderByValues=t},C=function(t){e.rates=_.sortBy(t.results,"name")},D=function(t){e.rateTypes=_.sortBy(t,"name")},O=function(){var t=[];e.$emit("showLoader"),t.push(d.fetchSortOptions().then(v)),t.push(d.fetchSortPreferences().then(S)),t.push(l.fetchAllRates().then(C)),t.push(l.fetchRateTypes().then(D)),R.all(t).then(E,g)},A=function(t){var a;"RATES"===e.chosenTab&&(a=[]),"RATE_TYPES"===e.chosenTab&&(a=e.selectedRateTypesFromRTT);var r={fromDate:e.fromDate,toDate:e.toDate,orderID:e.orderBySelectedValue,groupBy:e.groupBySelectedValue,chosenTab:e.chosenTab,selectedRateTypes:a,selectedRates:e.selectedRates,selectedCards:e.selectedCards,fromLeftFilter:!0,houseAvailability:t.houseAvailability||[],weekendDays:t.weekendDays||[],eventsCount:t.eventsCount||[]};e.$emit(c.UPDATE_RESULTS,r)},M=function(){e.callAPI(u.fetchHouseAvailabilityAndEventsCount,{params:{from_date:t("date")(e.fromDate,n.dateFormatForAPI),to_date:t("date")(e.toDate,n.dateFormatForAPI),is_include_overbooking:!1},successCallBack:A})},N=function(){e.callAPI(u.fetchEventsCount,{params:{from_date:t("date")(e.fromDate,n.dateFormatForAPI),to_date:t("date")(e.toDate,n.dateFormatForAPI)},successCallBack:A})};e.clickedOnShowRates=function(){"RATES"===e.chosenTab||"RATE_TYPES"===e.chosenTab?M():N()};var I=function(){e.isFilterVisible=!0,e.fromDate=null,e.toDate=null,e.selectedDateRange="",e.orderBySelectedValue=null,e.orderByValues=[],e.orderByValueMappings=i,e.groupBySelectedValue="",e.groupByValues=s,e.chosenTab="RATES",e.rateTypes=[],e.selectedRateTypes=[],e.selectedRateTypeID="",e.selectedRateTypeIDFromRTT="",e.selectedRateTypesFromRTT=[],e.rates=[],e.selectedRates=[],e.selectedRateID="",e.selectedCards=[],e.cardSearchResults=[],e.cardSearchText=""};!function(){m(),I(),O(),p()}()}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};angular.module("sntRover").controller("rvRateManagerRestrictionAndAmountPopupCtrl",["$scope","$rootScope","rvRateManagerPopUpConstants","rvUtilSrv","$filter","rvRateManagerCoreSrv","rvRateManagerEventConstants","ngDialog",function(e,t,a,r,n,i,o,s){BaseCtrl.call(this,e),e.isEmpty=r.isEmpty,e.clickedOnWeekDaySelectAllButton=function(){return e.weekDayRepeatSelection.forEach(function(e){return e.selected=!0})},e.clickedOnWeekDaySelectNoneButton=function(){return e.weekDayRepeatSelection.forEach(function(e){return e.selected=!1})},e.showSelectNoneForWeekDaySelection=function(){return _.where(e.weekDayRepeatSelection,{selected:!0}).length===e.weekDayRepeatSelection.length};var c=function(e,t){return n("date")(new tzIndependentDate(e),t)},l=function(e){return c(e,t.dateFormatForAPI)},d=function(e){return c(e,"EEEE, dd MMMM yy")},R=["single","double","extra_adult","child"],u=["child_overridden","double_overridden","extra_adult_overridden","single_overridden"],p=["mon","tue","wed","thu","fri","sat","sun"],m=function(){var t={tap:!0,preventDefault:!1,deceleration:1e-4,shrinkScrollbars:"clip"};e.setScroller("scroller-restriction-list",t),e.setScroller("room-type-price-listing",t),e.setScroller("room-type-price-editing",t),e.setScroller("rate-price-listing",t)},h=function(){e.refreshScroller("scroller-restriction-list"),e.refreshScroller("room-type-price-listing"),e.refreshScroller("room-type-price-editing"),e.refreshScroller("rate-price-listing")},T=function(){return e.restrictionList.forEach(function(e){return e.selected=!1})},f=function(){e.$$phase||e.$digest()};e.clearUntilDate=function(){e.untilDate="",f()};var y=function(t){var a={dialogData:e.ngDialogData,isFromPopup:!0};e.$emit(o.RELOAD_RESULTS,a),e.closeDialog()};e.shouldShowApplyPriceCheckbox=function(){return[e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE,e.modeConstants.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE].indexOf(e.ngDialogData.mode)>-1&&["SINGLE_RATE_SINGLE_ROOM_TYPE_NIGHTLY_AMOUNT_EDIT","SINGLE_RATE_MULTIPLE_ROOM_TYPE_NIGHTLY_AMOUNT_EDIT","SINGLE_RATE_SINGLE_ROOM_TYPE_HOURLY_AMOUNT_EDIT","SINGLE_RATE_MULTIPLE_ROOM_TYPE_HOURLY_AMOUNT_EDIT"].indexOf(e.contentMiddleMode)>-1},e.shouldShowClearOverrideButton=function(){var t=!1,a=!1;return(!e.ngDialogData.rate||!e.ngDialogData.rate.based_on_rate_id)&&(a=[e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE].indexOf(e.ngDialogData.mode)>-1,u.map(function(a){_.has(e.priceDetails,a)&&e.priceDetails[a]&&(t=!0)}),a&&t)};var E=function(){switch(e.ngDialogData.mode){case e.modeConstants.RM_SINGLE_RATE_RESTRICTION_MODE:e.contentMiddleMode="ROOM_TYPE_PRICE_LISTING";break;case e.modeConstants.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE:e.contentMiddleMode="SINGLE_ROOM_TYPE_CHOOSE_RATE";break;case e.modeConstants.RM_MULTIPLE_RATE_RESTRICTION_MODE:e.contentMiddleMode="MULTIPLE_RATE_CHOOSE_RATE";break;case e.modeConstants.RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE:e.contentMiddleMode="MULTIPLE_ROOM_TYPE_CHOOSE_RATE";break;case e.modeConstants.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE:case e.modeConstants.RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE:e.contentMiddleMode="RATE_PRICE_LISTING";break;case e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:B();break;case e.modeConstants.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:Y()}};e.priceStartedToCustomize=function(t){switch(e.ngDialogData.mode){case e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:case e.modeConstants.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:r.isNumeric(e.priceDetails[t+"_changing_value"])?e.priceDetails[t]=e.priceDetailsCopy[t]:e.priceDetails[t+"_changing_value"]="",r.isNumeric(e.priceDetails[t])||(e.priceDetails[t]="")}h()},e.clickedOnApplyToAllOccupancies=function(t){_.without(R,t).map(function(a){e.priceDetails[a+"_changing_value"]=e.priceDetails[t+"_changing_value"],e.priceDetails[a+"_amount_operator"]=e.priceDetails[t+"_amount_operator"],e.priceDetails[a+"_amount_perc_cur_symbol"]=e.priceDetails[t+"_amount_perc_cur_symbol"]}),h()},e.clickedOnCancelRestrictionEditingButton=function(){T(),E()},e.clickedOnRestrictionSetButton=function(t){t.stopPropagation();var a=_.findWhere(e.restrictionList,{id:e.restrictionForShowingTheDetails.id}),n=e.restrictionForShowingTheDetails.value;return e.restrictionForShowingTheDetails.hasInputField&&(!r.isNumeric(n)||n<0)?void(e.errorMessage=["Please enter a valid number"]):(a.value=e.restrictionForShowingTheDetails.value,a.edited=!0,a.status="ON",T(),void E())},e.clickedOnRestrictionRemoveButton=function(){var t=_.findWhere(e.restrictionList,{id:e.restrictionForShowingTheDetails.id});t.value=null,t.edited=!0,t.status="OFF",T(),E()},e.clickedOnClearOverrideButton=function(){var t=e.ngDialogData,a={rate_id:t.rate.id,room_type_id:t.roomType.id,date:l(t.date)},r={params:a,onSuccess:y};e.callAPI(i.removeCustomRate,r)},e.closeDialog=function(){document.activeElement.blur(),e.$emit("hideLoader"),t.modalClosing=!0,setTimeout(function(){s.close(),t.modalClosing=!1,window.scrollTo(0,0),document.getElementById("rate-manager").scrollTop=0,document.getElementsByClassName("pinnedLeft-list")[0].scrollTop=0,e.$apply()},700)};var g=function(){var t=_.filter(e.restrictionList,function(e){return e.edited&&(e.status!==e.oldStatus||parseInt(e.value)!==parseInt(e.oldValue))});return t.map(function(e){return{action:"ON"===e.status?"add":"remove",restriction_type_id:e.id,days:e.value}})},S=function(t){var a=e.ngDialogData,n=g();if(!n.length)return!1;if(e.applyRestrictionsToDates){if(""===e.untilDate)return;t.details.push({from_date:l(r.addOneDay(tzIndependentDate(a.date))),to_date:l(e.untilDate),restrictions:n});var i=t.details.length-1;t.details[i].weekdays={},e.weekDayRepeatSelection.filter(function(e){return e.selected}).map(function(e){return t.details[i].weekdays[e.weekDay]=e.selected})}},v=function(t){var a=e.ngDialogData,r=g();r.length&&t.details.push({from_date:l(a.date),to_date:l(a.date),restrictions:r})},C=function(t){var a=e.ngDialogData;if(!_.isEqual(e.priceDetails,e.priceDetailsCopy)){t.details.push({from_date:l(a.date),to_date:l(a.date)});var r=t.details.length-1;R.map(function(e){return O(e,t.details[r])})}},D=function(t){var a=e.ngDialogData;if(e.applyPriceToDates){if(""===e.untilDate)return;t.details.push({from_date:l(r.addOneDay(tzIndependentDate(a.date))),to_date:l(e.untilDate)});var n=t.details.length-1;R.map(function(e){return O(e,t.details[n])}),t.details[n].weekdays={},e.weekDayRepeatSelection.filter(function(e){return e.selected}).map(function(e){return t.details[n].weekdays[e.weekDay]=e.selected})}},O=function(t,a){r.isNumeric(e.priceDetails[t+"_changing_value"])?a[t]={type:"%"===e.priceDetails[t+"_amount_perc_cur_symbol"]?"percent_diff":"amount_diff",value:parseFloat(e.priceDetails[t+"_amount_operator"]+e.priceDetails[t+"_changing_value"])}:e.priceDetails[t]&&(a[t]={type:"amount_new",value:parseFloat(e.priceDetails[t])})},A=function(){var t={},a=e.ngDialogData,r=a.mode;if(r===e.modeConstants.RM_SINGLE_RATE_RESTRICTION_MODE)t.rate_id=a.rate.id;else if(r===e.modeConstants.RM_MULTIPLE_RATE_RESTRICTION_MODE){var n=_.pluck(a.rates,"id");!n.length&&_.has(a,"rateTypes")&&a.rateTypes.length?t.rate_type_ids=_.pluck(a.rateTypes,"id"):t.rate_ids=n}t.details=[],a.hierarchialRateRestrictionRequired&&(t.hierarchialRateRestrictionRequired=!0),v(t),S(t);var o={params:t,onSuccess:y};e.callAPI(i.updateSingleRateRestrictionData,o)},M=function(){var t={},a=e.ngDialogData,r=a.mode;r===e.modeConstants.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE?(t.rate_type_ids=[],t.rate_type_ids.push(a.rateType.id)):t.rate_type_ids=_.pluck(a.rateType,"id"),t.details=[],a.hierarchialRateTypeRestrictionRequired&&(t.hierarchialRateTypeRestrictionRequired=!0),v(t),S(t);var n={params:t,onSuccess:y};e.callAPI(i.updateSingleRateRestrictionData,n)},N=function(){var t={},a=e.ngDialogData,r=a.mode;r===e.modeConstants.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE&&(t.room_type_id=a.roomType.id),t.details=[],a.hierarchialRoomTypeRestrictionRequired&&(t.hierarchialRoomTypeRestrictionRequired=!0),v(t),S(t);var n={params:t,onSuccess:y};e.callAPI(i.updateSingleRateRestrictionData,n)},I=function(){var t={},a=e.ngDialogData,r=a.mode;t.rate_id=a.rate.id,r===e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE&&(t.room_type_id=a.roomType.id),t.details=[],v(t),S(t),C(t),D(t);var n={params:t,onSuccess:y};e.callAPI(i.updateSingleRateRestrictionData,n)},b=function(t){e.parentRateName=t.name},L=function(t){var a={params:{rate_id:t},onSuccess:b};e.callAPI(i.fetchRateDetails,a)};e.clickedOnSetButton=function(t){switch(t.stopPropagation(),e.ngDialogData.mode){case e.modeConstants.RM_SINGLE_RATE_RESTRICTION_MODE:case e.modeConstants.RM_MULTIPLE_RATE_RESTRICTION_MODE:return A();case e.modeConstants.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE:case e.modeConstants.RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE:return N();case e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:case e.modeConstants.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:return I();case e.modeConstants.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE:case e.modeConstants.RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE:return M()}},e.changeRestrictionStatus=function(t){return"ON"!==t.status||t.hasInputField?"OFF"!==t.status||t.hasInputField?(e.contentMiddleMode="RESTRICTION_EDITING",T(),t.selected=!0,void(e.restrictionForShowingTheDetails=r.deepCopy(t))):(t.status="ON",void(t.edited=!0)):(t.status="OFF",void(t.edited=!0))};var P=function(t,a){var r=_.findWhere(a,{restriction_type_id:t.id
}),n={status:"OFF",value:"",isDisabled:e.isPastDate};if(r){var i="off"===r.status.toLowerCase(),o="on"===r.status.toLowerCase(),s="varied"===r.status.toLowerCase();n.isDisabled=e.isPastDate||r.is_on_rate,i||(o?(n.status="ON",n.value=Number.isInteger(r.days)?r.days:""):s&&(n.status="VARIED",n.value=RateManagerRestrictionTypes[t.value].hasInputField?"??":""))}return n},w=function(e,t){var a=getValidRestrictionTypes(e).map(function(e){return _extends({},e,RateManagerRestrictionTypes[e.value],P(e,t),{edited:!1})});return a=a.map(function(e){return e.oldStatus=e.status,e.oldValue=e.value,e})},H=function(){var a=e.ngDialogData;e.datePickerOptions={dateFormat:t.jqDateFormat,numberOfMonths:1,minDate:tzIndependentDate(r.addOneDay(tzIndependentDate(a.date))),maxDate:tzIndependentDate(tzIndependentDate(a.date).setFullYear(tzIndependentDate(a.date).getFullYear()+1)),defaultDate:tzIndependentDate(r.addOneDay(tzIndependentDate(a.date))),onSelect:function(t,a){e.untilDate=new tzIndependentDate(r.get_date_from_date_picker(a))}},e.untilDate=""},k=function(){var t=e.ngDialogData;e.header=t.rate.name,e.headerBottomLeftLabel=d(t.date),e.headerBottomRightLabel="All Room types",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),e.roomTypeAndPrices=t.roomTypesAndPrices,e.contentMiddleMode="ROOM_TYPE_PRICE_LISTING"},G=function(){var t=e.ngDialogData;e.header=t.rateType.name,e.headerBottomLeftLabel=d(t.date),e.headerBottomRightLabel="All Rates",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),e.rateAndRestrictions=t.rateAndRestrictions,e.contentMiddleMode="RATE_PRICE_LISTING"},V=function(){var t=e.ngDialogData;e.header="All Rate Types",e.headerBottomLeftLabel=d(t.date),e.headerBottomRightLabel="All Rates",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),e.rateAndRestrictions=t.rateAndRestrictions,e.contentMiddleMode="RATE_PRICE_LISTING"},x=function(){var t=e.ngDialogData;e.headerBottomLeftLabel="All Rates",e.header=d(tzIndependentDate(t.date)),e.headerBottomRightLabel="",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),_.findWhere(e.restrictionList,{status:"VARIED"})&&(e.headerNoticeOnRight="Restrictions vary across Rates!"),e.contentMiddleMode="MULTIPLE_RATE_CHOOSE_RATE"},F=function(){var t=e.ngDialogData;e.header=t.roomType.name,e.headerBottomLeftLabel=d(t.date),e.headerBottomRightLabel="",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),e.roomTypeAndPrices=t.roomTypesAndPrices,e.contentMiddleMode="SINGLE_ROOM_TYPE_CHOOSE_RATE"},W=function(){var t=e.ngDialogData;e.header=d(t.date),e.headerBottomLeftLabel="All Room types",e.headerBottomRightLabel="All Rates",e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),_.findWhere(e.restrictionList,{status:"VARIED"})&&(e.headerNoticeOnRight="Restrictions vary across Room Types!"),e.contentMiddleMode="MULTIPLE_ROOM_TYPE_CHOOSE_RATE"},B=function(){var t=e.ngDialogData,a=t.roomTypePricesAndRestrictions;if(t.rate.is_hourly?(e.contentMiddleMode="SINGLE_RATE_SINGLE_ROOM_TYPE_HOURLY_AMOUNT_EDIT",e.priceDetails=_extends({},a.room_types[0]),U("single",e.priceDetails),e.priceDetailsCopy=_extends({},e.priceDetails)):(e.contentMiddleMode="SINGLE_RATE_SINGLE_ROOM_TYPE_NIGHTLY_AMOUNT_EDIT",e.priceDetails=_extends({},a.room_types[0]),R.map(function(t){return U(t,e.priceDetails)}),e.priceDetailsCopy=_extends({},e.priceDetails)),t.rate.based_on_rate_id&&!t.rate.is_copied){e.contentMiddleMode="SINGLE_RATE_ROOM_TYPE_CHILD_RATE";var r=_.findWhere(t.rates,{id:t.rate.based_on_rate_id});r?e.parentRateName=r.name:L(t.rate.based_on_rate_id)}},X=function(){var t=e.ngDialogData;if(e.header=t.roomType.name,e.headerBottomLeftLabel=d(t.date),e.headerBottomRightLabel=t.rate.name,e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),_.findWhere(e.restrictionList,{status:"VARIED"})&&(e.headerNoticeOnRight="Restrictions vary across Room Types!"),B(),!t.rate.based_on_rate_id){var a="";u.map(function(t){e.priceDetails[t]&&(a="Rate Amounts marked with * are edited!")}),""!==a&&(e.headerNoticeOnRight=e.headerNoticeOnRight?e.headerNoticeOnRight+", "+a:a)}},U=function(e,a){a[e+"_amount_operator"]="+",a[e+"_amount_perc_cur_symbol"]=t.currencySymbol,a[e+"_changing_value"]=""},Y=function(){var t=e.ngDialogData,a=t.roomTypePricesAndRestrictions;if(t.rate.is_hourly?(e.contentMiddleMode="SINGLE_RATE_MULTIPLE_ROOM_TYPE_HOURLY_AMOUNT_EDIT",e.priceDetails=_extends({},a.room_types[0]),U("single",e.priceDetails),e.priceDetailsCopy=_extends({},e.priceDetails)):(e.contentMiddleMode="SINGLE_RATE_MULTIPLE_ROOM_TYPE_NIGHTLY_AMOUNT_EDIT",e.priceDetails={},R.map(function(t){return U(t,e.priceDetails)}),e.priceDetailsCopy=_extends({},e.priceDetails)),t.rate.based_on_rate_id&&!t.rate.is_copied){e.contentMiddleMode="SINGLE_RATE_ROOM_TYPE_CHILD_RATE";var r=_.findWhere(t.rates,{id:t.rate.based_on_rate_id});r?e.parentRateName=r.name:L(t.rate.based_on_rate_id)}},j=function(){var t=e.ngDialogData;e.header=d(t.date),e.headerBottomLeftLabel="All room types",e.headerBottomRightLabel=t.rate.name,e.isMultiple=t.isMultiple,e.restrictionList=w(t.restrictionTypes,t.variedAndCommonRestrictions),_.findWhere(e.restrictionList,{status:"VARIED"})&&(e.headerNoticeOnRight="Restrictions vary across Room Types!"),Y()},$=function(){switch(e.ngDialogData.mode){case e.modeConstants.RM_SINGLE_RATE_RESTRICTION_MODE:k();break;case e.modeConstants.RM_MULTIPLE_RATE_RESTRICTION_MODE:x();break;case e.modeConstants.RM_SINGLE_RATE_TYPE_RESTRICTION_MODE:G();break;case e.modeConstants.RM_MULTIPLE_RATE_TYPE_RESTRICTION_MODE:V();break;case e.modeConstants.RM_SINGLE_ROOMTYPE_RESTRICTION_MODE:F();break;case e.modeConstants.RM_MULTIPLE_ROOMTYPE_RESTRICTION_MODE:W();break;case e.modeConstants.RM_SINGLE_RATE_SINGLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:X();break;case e.modeConstants.RM_SINGLE_RATE_MULTIPLE_ROOMTYPE_RESTRICTION_AMOUNT_MODE:e.ngDialogData.isHierarchyRestrictionEnabled?x():j()}},z=function(){e.isPastDate=new tzIndependentDate(e.ngDialogData.date)<new tzIndependentDate(t.businessDate),e.header="",e.headerBottomLeftLabel="",e.headerBottomRightLabel="",e.headerNoticeOnRight="",e.roomTypeAndPrices=[],e.restrictionList=[],e.contentMiddleMode="",e.modeConstants=a,e.applyRestrictionsToDates=!1,e.applyPriceToDates=!1,e.weekDayRepeatSelection=p.map(function(e){return{weekDay:e,selected:!1}})};!function(){z(),$(),m(),H()}()}]);var DiaryLib=window.DiaryLib||Object.create(null);DiaryLib.Models=DiaryLib.Models||Object.create(null),DiaryLib.Util=DiaryLib.Util||Object.create(null),Model.prototype={constructor:Model,reset:function(){this.isUpdating=!1,this.isResolved=!1,this.isDirty=!1}},Time.prototype.convertToReferenceInterval=function(e){var t;return t=(this.minutes/e).toFixed()*e,this.minutes>45?(this.hours+=1,this.minutes=0):this.minutes=t,this.seconds=0,this.milliseconds=0,this},Time.prototype.getOffsetFromReference=function(e){var t;if(!(e instanceof Time))throw new Error("invalid parameter");return t=this.getTotalMilliseconds()-e.getTotalMilliseconds()},Time.prototype.getTotalMilliseconds=function(){return 1e4*(360*this.hours+6*this.minutes+this.seconds)+this.milliseconds},Time.prototype.convertMillisecondsToTime=function(e){return new Time(e)},Time.prototype.isAM=function(){return this.hours<12},Time.prototype.AMPM=function(){return this.isAM()?"AM":"PM"},Time.prototype.padZeroes=function(e){return e=+e,e<10?"0"+e:e},Time.prototype.toString=function(e){var t=this.padZeroes(this.hours),a=this.padZeroes(this.minutes),r="";return e&&(t%=12,0===t&&(t=12),r=this.AMPM()),t+":"+a+r},Time.prototype.toReservationFormat=function(e){var t;return t={hh:this.padZeroes(this.hours%12),mm:this.padZeroes(this.minutes),amPM:this.AMPM()},e?t:t.hh+":"+t.mm+" "+t.amPM},Time.prototype.toHourAndMinute=function(e,t){var a;return"undefined"==typeof t&&(t=12),"undefined"==typeof e&&(e=":"),a={hh:this.padZeroes(this.hours%t),mm:this.padZeroes(this.minutes)},a.hh+e+a.mm},Time.prototype.constructor=Time,String.prototype.toTimeComponent=function(e){var t,a,r=e.indexOf(":");if(r>-1&&(t=e.substr(0,r),r<e.length&&(a=e.substr(r+1))),t&&a)return Time({hours:t,minutes:a})},Date.prototype.toComponents=function(){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{date:{day:this.getDate(),weekday:e[this.getDay()],month:this.getMonth(),monthName:t[this.getMonth()],monthNameShort:a[this.getMonth()],year:this.getFullYear(),toDateString:function(){return this.year+"-"+(this.month+1)+"-"+(this.day.length<2?"0":"")+this.day},fromDate:function(){var e=this.toLocaleDateString().replace(/\//g,"-").split("-").reverse();return e.shift()+"-"+temp.reverse().join("-")},toShortDateString:function(){return this.monthNameShort+" "+(this.day<10?"0":"")+this.day}},time:new Time({milliseconds:this.getMilliseconds(),seconds:this.getSeconds(),minutes:this.getMinutes(),hours:this.getHours()})}};