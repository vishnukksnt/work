"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}angular.module("sntRover").service("RVNightlyDiaryRightFilterBarSrv",["$q","sntBaseWebSrv",function(e,t){var a=this;a.fetchRoomType=function(a){var r=e.defer(),o="/api/room_types.json?exclude_pseudo=true&exclude_suite=true";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},a.fetchFloorList=function(a){var r=e.defer(),o="/api/floors.json";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},a.getPreferences=function(){var a=e.defer(),r="/staff/preferences/room_assignment.json";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},a.fetchFilterList=function(t){var r=e.defer(),o=[],i={};return o.push(a.fetchFloorList(t).then(function(e){i.floors=e.floors})),o.push(a.fetchRoomType(t).then(function(e){i.rooms=e.results})),o.push(a.getPreferences().then(function(e){i.roomFeatures=e.data.room_features})),e.all(o).then(function(){r.resolve(i)}),r.promise}}]),angular.module("sntRover").service("RVNightlyDiaryRoomNumberSearchSrv",["$q","BaseWebSrvV2",function(e,t){this.fetchRoomSearchResults=function(a){var r=e.defer(),o="/api/nightly_diary/search_room";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("RVNightlyDiarySearchSrv",["$q","BaseWebSrvV2",function(e,t){var a=this;a.searchPerPage=50,a.page=1,a.fetchSearchResults=function(r){var o=e.defer(),i="search.json?per_page="+a.searchPerPage+"&page="+a.page+"&is_from_nightly_diary=true";return r.fakeDataToAvoidCache=new Date,t.getJSON(i,r).then(function(e){o.resolve(e.data)},function(e){o.reject(e)}),o.promise}}]),angular.module("sntRover").service("RVNightlyDiarySrv",["$q","sntBaseWebSrv","$rootScope",function(e,t,a){var r=this;this.updateCache=function(e){r.searchParamsCached=e},this.getCache=function(){return r.searchParamsCached},this.fetchRoomsList=function(a){var r=e.defer(),o="/api/nightly_diary/room_list";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchDatesList=function(a){var r=e.defer(),o=[],i="/api/nightly_diary/date_list",s={},n={};return s.start_date=a.start_date,s.no_of_days=a.no_of_days,t.getJSON(i,s).then(function(e){angular.forEach(e.dates,function(e){var t=tzIndependentDate(e),a=0===t.getDay()||6===t.getDay(),r={date:e,isWeekend:a};o.push(r)}),n={dates:o,hotelCheckinTime:e.hotel_checkin_time,hotelCheckoutTime:e.hotel_checkout_time},r.resolve(n)},function(e){r.reject(e)}),r.promise},this.fetchReservationsList=function(a){r.updateCache(a);var o=e.defer(),i="/api/nightly_diary/reservation_list",s={};return s.start_date=a.start_date,s.no_of_days=a.no_of_days,s.page=a.page,s.per_page=a.per_page,s.selected_room_type_ids=a.selected_room_type_ids,s.selected_floor_ids=a.selected_floor_ids,s.selected_room_feature_ids=a.selected_room_feature_ids,t.postJSON(i,s).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},this.checkUpdateAvaibale=function(a){var r="/staff/change_stay_dates/"+a.reservation_id+"/update.json",o={arrival_date:a.arrival_date,dep_date:a.dep_date},i=e.defer();return t.getJSON(r,o).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},this.validateStayChanges=function(a){var r="/api/nightly_diary/validate_stay_change",o=e.defer();return t.getJSON(r,a).then(function(e){o.resolve(e.result)},function(e){o.reject(e)}),o.promise},this.confirmUpdates=function(a){var r="/staff/change_stay_dates/"+a.reservation_id+"/confirm",o={arrival_date:a.arrival_date,dep_date:a.dep_date,room_number:a.room_number,authorize_credit_card:a.authorize_credit_card,is_from_diary:!0},i=e.defer();return t.postJSON(r,o).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},this.fetchRoomsListAndReservationList=function(t){var a=e.defer(),o={roomList:null,reservationList:null,dateList:null};return e.when().then(function(){return r.fetchRoomsList(t).then(function(e){o.roomList=e})}).then(function(){return t.page=o.roomList.page_number,r.fetchReservationsList(t).then(function(e){o.reservationList=e})}).then(function(){return r.fetchDatesList(t).then(function(e){o.dateList=e})}).then(function(){a.resolve(o)},function(e){a.reject(e)}),a.promise},this.fetchUnassignedReservationList=function(r){var o=e.defer(),i="/api/nightly_diary/unassigned_reservations",s=a.businessDate;return t.getJSON(i,r).then(function(e){angular.forEach(e.reservations,function(e){e.statusClass=e.arrival_date===s?"check-in":"no-status",e.fullName=e.last_name+" "+e.first_name}),o.resolve(e)},function(e){o.reject(e)}),o.promise},this.retrieveAvailableRooms=function(a){var r=e.defer(),o="/api/nightly_diary/retrieve_available_rooms";return t.postJSON(o,a).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},this.retrieveAvailableFreeSlots=function(a){var r=e.defer(),o="/api/nightly_diary/availability";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.assignRoom=function(a){var r=e.defer(),o="/staff/reservation/modify_reservation";return t.postJSON(o,a).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},this.fetchAvailableTimeSlots=function(a){var r=e.defer(),o="/api/nightly_diary/available_time_slots";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.unAssignRoom=function(a){var r=e.defer(),o="/api/reservations/"+a.id+"/unassign_room";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getPreferences=function(a){var r=e.defer(),o="/staff/preferences/room_assignment.json";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateBillingInformation=function(a){var r=e.defer(),o="api/bill_routings/update_dates";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.initiateAutoAssignRooms=function(e){var a="api/auto_room_assign_processes/auto_room_assignment";return t.postJSON(a,e)},this.fetchAutoAssignStatus=function(){var e="api/auto_room_assign_processes/status";return t.getJSON(e)},this.unlockRoomDiary=function(){var e="api/auto_room_assign_processes/unlock_diary";return t.postJSON(e)}}]),angular.module("sntRover").service("RVReservationBaseSearchSrv",["$q","rvBaseWebSrvV2","sntBaseWebSrv","dateFilter",function(e,t,a,r){var o=this;this.reservation={settings:{},roomTypes:{},businessDate:{}},this.rateDetailsList={},this.cache={config:{lifeSpan:3600},responses:{restrictionTypes:null,rateDetails:null,sortOrder:null,taxMeta:null,customMeta:null}},this.getRoomRatesDefaultView=function(){var e="ROOM_TYPE";return o.reservation.settings&&o.reservation.settings.default_rate_display_name&&("Recommended"===o.reservation.settings.default_rate_display_name?e="RECOMMENDED":"By Rate"===o.reservation.settings.default_rate_display_name&&(e="RATE")),e},this.getRoomTypeLevel=function(e){var t=-1;if(o.reservation.roomTypes){var a=_.find(o.reservation.roomTypes,{id:e});t=a.level}return t},this.timeSlots=[{value:"12:00 AM",label:"12:00 AM",fullDayValue:0},{value:"12:15 AM",label:"12:15 AM",fullDayValue:15},{value:"12:30 AM",label:"12:30 AM",fullDayValue:30},{value:"12:45 AM",label:"12:45 AM",fullDayValue:45},{value:"01:00 AM",label:"01:00 AM",fullDayValue:100},{value:"01:15 AM",label:"01:15 AM",fullDayValue:115},{value:"01:30 AM",label:"01:30 AM",fullDayValue:130},{value:"01:45 AM",label:"01:45 AM",fullDayValue:145},{value:"02:00 AM",label:"02:00 AM",fullDayValue:200},{value:"02:15 AM",label:"02:15 AM",fullDayValue:215},{value:"02:30 AM",label:"02:30 AM",fullDayValue:230},{value:"02:45 AM",label:"02:45 AM",fullDayValue:245},{value:"03:00 AM",label:"03:00 AM",fullDayValue:300},{value:"03:15 AM",label:"03:15 AM",fullDayValue:315},{value:"03:30 AM",label:"03:30 AM",fullDayValue:330},{value:"03:45 AM",label:"03:45 AM",fullDayValue:345},{value:"04:00 AM",label:"04:00 AM",fullDayValue:400},{value:"04:15 AM",label:"04:15 AM",fullDayValue:415},{value:"04:30 AM",label:"04:30 AM",fullDayValue:430},{value:"04:45 AM",label:"04:45 AM",fullDayValue:445},{value:"05:00 AM",label:"05:00 AM",fullDayValue:500},{value:"05:15 AM",label:"05:15 AM",fullDayValue:515},{value:"05:30 AM",label:"05:30 AM",fullDayValue:530},{value:"05:45 AM",label:"05:45 AM",fullDayValue:545},{value:"06:00 AM",label:"06:00 AM",fullDayValue:600},{value:"06:15 AM",label:"06:15 AM",fullDayValue:615},{value:"06:30 AM",label:"06:30 AM",fullDayValue:630},{value:"06:45 AM",label:"06:45 AM",fullDayValue:645},{value:"07:00 AM",label:"07:00 AM",fullDayValue:700},{value:"07:15 AM",label:"07:15 AM",fullDayValue:715},{value:"07:30 AM",label:"07:30 AM",fullDayValue:730},{value:"07:45 AM",label:"07:45 AM",fullDayValue:745},{value:"08:00 AM",label:"08:00 AM",fullDayValue:800},{value:"08:15 AM",label:"08:15 AM",fullDayValue:815},{value:"08:30 AM",label:"08:30 AM",fullDayValue:830},{value:"08:45 AM",label:"08:45 AM",fullDayValue:845},{value:"09:00 AM",label:"09:00 AM",fullDayValue:900},{value:"09:15 AM",label:"09:15 AM",fullDayValue:915},{value:"09:30 AM",label:"09:30 AM",fullDayValue:930},{value:"09:45 AM",label:"09:45 AM",fullDayValue:945},{value:"10:00 AM",label:"10:00 AM",fullDayValue:1e3},{value:"10:15 AM",label:"10:15 AM",fullDayValue:1015},{value:"10:30 AM",label:"10:30 AM",fullDayValue:1030},{value:"10:45 AM",label:"10:45 AM",fullDayValue:1045},{value:"11:00 AM",label:"11:00 AM",fullDayValue:1100},{value:"11:15 AM",label:"11:15 AM",fullDayValue:1115},{value:"11:30 AM",label:"11:30 AM",fullDayValue:1130},{value:"11:45 AM",label:"11:45 AM",fullDayValue:1145},{value:"12:00 PM",label:"12:00 PM",fullDayValue:1200},{value:"12:15 PM",label:"12:15 PM",fullDayValue:1215},{value:"12:30 PM",label:"12:30 PM",fullDayValue:1230},{value:"12:45 PM",label:"12:45 PM",fullDayValue:1245},{value:"01:00 PM",label:"01:00 PM",fullDayValue:1300},{value:"01:15 PM",label:"01:15 PM",fullDayValue:1315},{value:"01:30 PM",label:"01:30 PM",fullDayValue:1330},{value:"01:45 PM",label:"01:45 PM",fullDayValue:1345},{value:"02:00 PM",label:"02:00 PM",fullDayValue:1400},{value:"02:15 PM",label:"02:15 PM",fullDayValue:1415},{value:"02:30 PM",label:"02:30 PM",fullDayValue:1430},{value:"02:45 PM",label:"02:45 PM",fullDayValue:1445},{value:"03:00 PM",label:"03:00 PM",fullDayValue:1500},{value:"03:15 PM",label:"03:15 PM",fullDayValue:1515},{value:"03:30 PM",label:"03:30 PM",fullDayValue:1530},{value:"03:45 PM",label:"03:45 PM",fullDayValue:1545},{value:"04:00 PM",label:"04:00 PM",fullDayValue:1600},{value:"04:15 PM",label:"04:15 PM",fullDayValue:1615},{value:"04:30 PM",label:"04:30 PM",fullDayValue:1630},{value:"04:45 AM",label:"04:45 PM",fullDayValue:1645},{value:"05:00 PM",label:"05:00 PM",fullDayValue:1700},{value:"05:15 PM",label:"05:15 PM",fullDayValue:1715},{value:"05:30 PM",label:"05:30 PM",fullDayValue:1730},{value:"05:45 PM",label:"05:45 PM",fullDayValue:1745},{value:"06:00 PM",label:"06:00 PM",fullDayValue:1800},{value:"06:15 PM",label:"06:15 PM",fullDayValue:1815},{value:"06:30 PM",label:"06:30 PM",fullDayValue:1830},{value:"06:45 PM",label:"06:45 PM",fullDayValue:1845},{value:"07:00 PM",label:"07:00 PM",fullDayValue:1900},{value:"07:15 PM",label:"07:15 PM",fullDayValue:1915},{value:"07:30 PM",label:"07:30 PM",fullDayValue:1930},{value:"07:45 PM",label:"07:45 PM",fullDayValue:1945},{value:"08:00 PM",label:"08:00 PM",fullDayValue:2e3},{value:"08:15 PM",label:"08:15 PM",fullDayValue:2015},{value:"08:30 PM",label:"08:30 PM",fullDayValue:2030},{value:"08:45 PM",label:"08:45 PM",fullDayValue:2045},{value:"09:00 PM",label:"09:00 PM",fullDayValue:2100},{value:"09:15 PM",label:"09:15 PM",fullDayValue:2115},{value:"09:30 PM",label:"09:30 PM",fullDayValue:2130},{value:"09:45 PM",label:"09:45 PM",fullDayValue:2145},{value:"10:00 PM",label:"10:00 PM",fullDayValue:2200},{value:"10:15 PM",label:"10:15 PM",fullDayValue:2215},{value:"10:30 PM",label:"10:30 PM",fullDayValue:2230},{value:"10:45 PM",label:"10:45 PM",fullDayValue:2245},{value:"11:00 PM",label:"11:00 PM",fullDayValue:2300},{value:"11:15 PM",label:"11:15 PM",fullDayValue:2315},{value:"11:30 PM",label:"11:30 PM",fullDayValue:2330},{value:"11:45 PM",label:"11:45 PM",fullDayValue:2345}],this.fetchBaseSearchData=function(){var a=e.defer();if(o.fetchBussinessDate=function(){var e="/api/business_dates/active";return t.getJSON(e).then(function(e){o.reservation.businessDate=e.business_date,a.resolve(o.reservation)},function(e){a.reject(e)}),a.promise},o.fetchRoomTypes=function(){var e="api/room_types.json?exclude_pseudo=true&per_page=100";return t.getJSON(e).then(function(e){o.reservation.roomTypes=e.results,o.fetchBussinessDate()},function(e){a.reject(e)}),a.promise},isEmpty(o.reservation.settings)&&isEmpty(o.reservation.roomTypes)&&isEmpty(o.reservation.businessDate)){var r="/api/hotel_settings/show_hotel_reservation_settings";t.getJSON(r).then(function(e){o.reservation.settings=e,o.fetchRoomTypes()},function(e){a.reject(e)})}else a.resolve(o.reservation);return a.promise},this.fetchCompanyCard=function(a){var r=e.defer(),o="/api/accounts";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.autoCompleteCodes=function(a){var r=e.defer(),o="/api/code_search";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchCurrentTime=function(a){var r=e.defer(),o="/api/hotel_current_time";return t.getJSON(o).then(function(e){a&&"string"==typeof a&&(e.hotel_time.date=a),r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchAvailability=function(a){var r=e.defer(),o="/api/availability?from_date="+a.from_date+"&to_date="+a.to_date+"&override_restrictions=true";return a.company_id&&(o+="&company_id="+a.company_id),a.travel_agent_id&&(o+="&travel_agent_id="+a.travel_agent_id),a.group_id&&(o+="&group_id="+a.group_id),a.promotion_code&&(o+="&promotion_code="+encodeURI(a.promotion_code)),a.allotment_id&&(o+="&allotment_id="+encodeURI(a.allotment_id)),t.getJSON(o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchMinTime=function(){var a=e.defer(),r="/api/hourly_rate_min_hours";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchSortPreferences=function(){var a=e.defer(),r="/api/sort_preferences/list_selections";return null===o.cache.responses.sortOrder||Date.now()>o.cache.responses.sortOrder.expiryDate?t.getJSON(r).then(function(e){o.cache.responses.sortOrder={data:e.room_rates,expiryDate:Date.now()+1e3*o.cache.config.lifeSpan},a.resolve(e.room_rates)},function(e){a.reject(e)}):a.resolve(o.cache.responses.sortOrder.data),a.promise},this.fetchAddonsForRates=function(a){var r=e.defer(),o="/api/addons/rate_addons";return t.getJSON(o,a).then(function(e){r.resolve(e.rate_addons)},function(e){r.reject(e)}),r.promise},this.hasAnyConfiguredAddons=function(a){var r=e.defer(),o="/api/addons/configured";return t.getJSON(o,a).then(function(e){r.resolve(e.addons_configured)},function(e){r.reject(e)}),r.promise},this.getActivePromotions=function(){var a=e.defer(),r="/api/promotions?is_active=true";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchUserMemberships=function(a){var r=e.defer(),o="/staff/user_memberships.json?user_id="+a;return t.getJSON(o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},this.checkOverbooking=function(a){var r=e.defer(),o="/api/availability/overbooking_check";return t.getJSON(o,a).then(function(e){r.resolve(e.results)},function(e){r.reject(e)}),r.promise},this.checkDiaryAvailability=function(a){var r=e.defer(),o="/api/nightly_diary/availability";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchOrdinaryRates=function(a){var r=e.defer(),o="/api/availability/rates";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchContractRates=function(a){var r=e.defer(),o="/api/availability/contracts";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchGroupRates=function(a){var r=e.defer(),o=a.group_id||a.allotment_id,i="/api/availability/groups/"+o;return t.getJSON(i,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchRates=function(t){var a=e.defer(),r=[];return o.rates=[],t.group_id?r.push(o.fetchGroupRates(t).then(function(e){_.each(e.rates,function(e){null===e.id&&(e.id="_CUSTOM_"+t.group_id)}),o.rates=o.rates.concat(e.rates)})):(r.push(o.fetchOrdinaryRates(t).then(function(e){o.rates=o.rates.concat(e.rates)})),(t.company_id||t.travel_agent_id)&&r.push(o.fetchContractRates(t).then(function(e){_.each(e.rates,function(e){e.isCorporate=!0}),o.rates=o.rates.concat(e.rates)}))),e.all(r).then(function(){a.resolve(o.rates)},function(e){a.reject(e)}),a.promise},this.fetchRestricitonTypes=function(){var a=e.defer(),r="/api/restriction_types";return null===o.cache.responses.restrictionTypes||Date.now()>o.cache.responses.restrictionTypes.expiryDate?t.getJSON(r).then(function(e){e.results.push({id:98,value:"INVALID_PROMO",description:"PROMOTION INVALID",activated:!0}),e.results.push({id:99,activated:!0,value:"HOUSE_FULL",description:"NO HOUSE AVAILABILITY"});var t={};_.each(e.results,function(e){t[e.id]={key:e.value,value:["CLOSED","CLOSED_ARRIVAL","CLOSED_DEPARTURE","HOUSE_FULL","INVALID_PROMO"].indexOf(e.value)>-1?e.description:e.description+":"}}),o.cache.responses.restrictionTypes={data:t,expiryDate:Date.now()+1e3*o.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(o.cache.responses.restrictionTypes.data),a.promise};var i=function(e){var t=_.reject(e.rate_ids,function(e){return!!(o.rateDetailsList[e]&&Date.now()<o.rateDetailsList[e].expiryDate)});return t};this.fetchRatesDetails=function(a){var r=i(a),s=e.defer(),n="/api/rates/search.json",l={};return l.rate_ids=r,0===r.length?s.resolve({}):t.postJSON(n,l).then(function(e){_.each(e.results,function(e){o.rateDetailsList[e.id]={expiryDate:Date.now()+1e3*o.cache.config.lifeSpan,details:e}}),s.resolve(e.results)},function(e){s.reject(e)}),s.promise},this.fetchCustomRateConfig=function(){var a=e.defer(),r="api/rates/custom_group_rate_taxes";return null===o.cache.responses.customMeta||Date.now()>o.cache.responses.customMeta.expiryDate?t.getJSON(r).then(function(e){var t=e;o.cache.responses.customMeta={data:t,expiryDate:Date.now()+1e3*o.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(o.cache.responses.customMeta.data),a.promise},this.fetchRatesMeta=function(t){var a=e.defer(),r=[];return o["rates-restrictions"]={},r.push(o.fetchRestricitonTypes(t).then(function(e){o["rates-restrictions"].restrictions=e})),r.push(o.fetchCustomRateConfig().then(function(e){o["rates-restrictions"].customRates=e})),e.all(r).then(function(){a.resolve(o["rates-restrictions"])},function(e){a.reject(e)}),a.promise},this.fetchTaxInformation=function(){var a=e.defer(),r="api/rates/tax_information";return null===o.cache.responses.taxMeta||Date.now()>o.cache.responses.taxMeta.expiryDate?t.getJSON(r).then(function(e){var t=e.tax_codes;o.cache.responses.taxMeta={data:t,expiryDate:Date.now()+1e3*o.cache.config.lifeSpan},a.resolve(t)},function(e){a.reject(e)}):a.resolve(o.cache.responses.taxMeta.data),a.promise},this.fetchHouseAvailability=function(a){var r=e.defer(),o="api/availability/house";return t.getJSON(o,a).then(function(e){var t={};_.each(e.results,function(e){t[e.date]=e.availability}),r.resolve(t)},function(e){r.reject(e)}),r.promise},this.fetchHouseRestrictions=function(a){var r=e.defer(),o="/api/availability/house_restrictions";return t.getJSON(o,a).then(function(e){r.resolve(e.restrictions)},function(e){r.reject(e)}),r.promise},this.fetchTaxRateAddonMeta=function(t){var a=e.defer(),r=[];return o.meta={},r.push(o.fetchTaxInformation().then(function(e){o.meta.taxInfo=e})),r.push(o.fetchAddonsForRates(t).then(function(e){o.meta.rateAddons=e})),e.all(r).then(function(){a.resolve(o.meta)},function(e){a.reject(e)}),a.promise},this.fetchHotelReservationSettings=function(){var a=e.defer(),r="/api/hotel_settings/show_hotel_reservation_settings";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.searchForRates=function(a){var r=e.defer(),o={},i="/api/rates.json?&sort_dir=true&sort_field=rate";return o.query=a.query,o.per_page=25,o.page=1,t.getJSON(i,o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchRateDetailsForIds=function(a){var r=i(a),s=e.defer(),n="/api/rates/search.json",l={};return l.rate_ids=r,0===r.length?s.resolve({}):t.postJSON(n,l).then(function(e){_.each(e.results,function(e){o.rateDetailsList[e.id]={expiryDate:Date.now()+1e3*o.cache.config.lifeSpan,details:e}});var t=_.difference(a.rate_ids,r);_.each(t,function(t){e.results.push(o.rateDetailsList[t].details)}),s.resolve(e.results)},function(e){s.reject(e)}),s.promise},this.checkTimeBasedAvailabilityAPI=function(t){var r=e.defer(),o="api/availability/time_based_room_type_and_house_avl";return a.postJSON(o,t).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("RVReservationSummarySrv",["$q","rvBaseWebSrvV2",function(e,t){var a=this;this.reservationData={},this.reservationData.demographics={};var r={},o={},i={},s={},n={};this.fetchPaymentMethods=function(){var a=e.defer(),r="/staff/payments/addNewPayment.json";return t.getJSON(r).then(function(e){a.resolve(e.data)},function(e){a.reject(e)}),a.promise},this.fetchLengthSegments=function(){var a=e.defer();if(isEmpty(n)){var r="/api/segments?is_active=true";t.getJSON(r).then(function(e){n=e,a.resolve(e)},function(e){a.reject(e)})}else a.resolve(n);return a.promise},this.fetchDemographicMarketSegments=function(){var a=e.defer();if(isEmpty(r)){var o="/api/market_segments?is_active=true";t.getJSON(o).then(function(e){r=e,a.resolve(r)},function(e){a.reject(e)})}else a.resolve(r);return a.promise},this.fetchDemographicSources=function(){var a=e.defer();if(isEmpty(o)){var r="/api/sources?is_active=true";t.getJSON(r).then(function(e){o=e,a.resolve(o)},function(e){a.reject(e)})}else a.resolve(o);return a.promise},this.fetchDemographicOrigins=function(){var a=function(e){i.is_use_origins=e.is_use_origins,i.origins=[];for(var t in e.booking_origins)e.booking_origins[t].is_active&&i.origins.push(e.booking_origins[t]);r.resolve(i)},r=e.defer();if(isEmpty(i)){var o="/api/booking_origins";t.getJSON(o).then(function(e){a(e)},function(e){r.reject(e)})}else r.resolve(i);return r.promise},this.fetchDemographicReservationTypes=function(){var r=function(e){s=[],a.reservationData.demographics.reservationTypes=[];for(var t in e.reservation_types)e.reservation_types[t].is_active&&s.push(e.reservation_types[t]);o.resolve(s)},o=e.defer();if(isEmpty(s)){var i="/api/reservation_types.json?is_active=true";t.getJSON(i).then(function(e){r(e)},function(e){o.reject(e)})}else o.resolve(s);return o.promise},this.fetchInitialData=function(){var t=e.defer(),r={};return r.marketsData=a.fetchDemographicMarketSegments(),r.originsData=a.fetchDemographicOrigins(),r.sourcesData=a.fetchDemographicSources(),r.reservationTypesData=a.fetchDemographicReservationTypes(),r.segmentsData=a.fetchLengthSegments(),e.all(r).then(function(e){a.reservationData.demographics.is_use_markets=e.marketsData.is_use_markets,a.reservationData.demographics.markets=e.marketsData.markets,a.reservationData.demographics.is_use_origins=e.originsData.is_use_origins,a.reservationData.demographics.origins=e.originsData.origins,a.reservationData.demographics.is_use_sources=e.sourcesData.is_use_sources,a.reservationData.demographics.sources=e.sourcesData.sources,a.reservationData.demographics.is_use_segments=e.segmentsData.is_use_segments,a.reservationData.demographics.segments=e.segmentsData.segments,a.reservationData.demographics.reservationTypes=e.reservationTypesData,t.resolve(a.reservationData)},function(e){t.reject(e)}),t.promise},this.saveReservation=function(a){var r=e.defer(),o="/api/reservations";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateBillingInformation=function(a){var r=e.defer(),o="api/bill_routings/update_dates";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.sendConfirmationEmail=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId+"/email_confirmation";return delete a.reservationId,t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.sendHourlyConfirmationEmail=function(a){var r=e.defer(),o="/api/reservations/hourly_confirmation_emails?";return _.each(a.reservation_ids,function(e){o+="reservation_ids[]="+e+"&"}),_.each(a.emails,function(e){o+="emails[]="+encodeURIComponent(e)+"&"}),delete a.reservation_ids,delete a.emails,t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateReservation=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId;return t.putJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.paymentAction=function(a){var r=e.defer(),o="/api/ipage/store_payments";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.startPayment=function(a){var r=e.defer(),o="/api/cc/get_token";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchRooms=function(){var a=e.defer(),r="/api/rooms";return t.getJSON(r).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.getRateName=function(a){var r=e.defer(),o="/api/rates/"+a.id;return t.getJSON(o).then(function(e){r.resolve(e.name)},function(e){r.reject(e)}),r.promise},this.getRateDetails=function(a){var r=e.defer(),o="/api/rates/"+a.id;return t.getJSON(o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.getTaxDetails=function(a){var r=e.defer(),o="/api/rates/tax_information/";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchDefaultRoutingInfo=function(a){var r=e.defer(),o="/api/default_account_routings/routings_count/";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.applyDefaultRoutingToReservation=function(a){var r=e.defer(),o="/api/default_account_routings/attach_reservation";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchResservationConfirmationPrintData=function(a){var r=e.defer(),o="/api/reservations/"+a.reservation_id+"/confirmation_email_data";return t.getJSON(o,a).then(function(e){e.data.addons_list=e.data.addons?e.data.addons.toString():"",r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchResservationCancellationPrintData=function(a){var r=e.defer(),o="/api/reservations/"+a.reservation_id+"/cancellation_email_data";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateNoRoomMove=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId+"/update_no_room_move_flag";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateRestrictPost=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId+"/update_restrict_post_flag";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.saveTaxExempt=function(a){var r=e.defer(),o="/api/reservations/save_tax_exempt";return t.postJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.checkUpsellAvailability=function(a){var r=e.defer(),o="/api/reservations/"+a+"/upsell_availability";return t.getJSON(o).then(function(e){r.resolve(e.is_upsell_available)},function(e){r.reject(e)}),r.promise},this.updateCommission=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId+"/update_commission";return t.putJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.retrieveRoomPin=function(a){var r=e.defer(),o="/staff/reservation/get_room_pin";return t.getJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.updateBookerEmail=function(a){var r=e.defer(),o="/api/reservations/"+a.reservationId+"/update_booker_email";return t.putJSON(o,a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]),angular.module("sntRover").service("RVHkRoomStatusSrv",["$http","$q","rvBaseWebSrvV2","$window","BaseWebSrvV2","$rootScope","$vault",function(e,t,a,r,o,i,s){this.initFilters=function(){return{dirty:!1,pickup:!1,clean:!1,inspected:!1,out_of_order:!1,out_of_service:!1,exclude_out_of_order:!1,exclude_out_of_service:!1,vacant:!1,occupied:!1,stayover:!1,not_reserved:!1,arrival:!1,arrived:!1,dueout:!1,departed:!1,dayuse:!1,queued:!1,lateCheckout:!1,pre_checkin:!1,floorFilterSingle:"",floorFilterStart:"",floorFilterEnd:"",showAllFloors:!0,filterByWorkType:"",filterByEmployeeName:"",singleRoomType:"",query:"",page:1,perPage:r.innerWidth<599?25:50}},this.currentFilters=this.initFilters(),this.isInitialLoad=!0,this.defaultViewState=null;var n=this,l=function(e){var t=this.currentFilters,a=[],r=[],o=[],s=[],n=[],l=!1,u=!1,c={page:t.page,per_page:t.perPage};return t.query?(c.query=t.query,e.assignee_id?c.assignee_id=e.assignee_id:c.all_employees_selected=!0):((e.isStandAlone||i.isStandAlone)&&(this.isInitialLoad?(this.isInitialLoad=!1,e.work_type_id&&(c.work_type_id=e.work_type_id,t.filterByWorkType=e.work_type_id),e.assignee_id?(c.assignee_id=e.assignee_id,t.filterByEmployeeName=e.assignee_id):c.all_employees_selected=!0):(t.filterByWorkType&&(c.work_type_id=t.filterByWorkType),t.filterByEmployeeName?c.assignee_id=t.filterByEmployeeName:c.all_employees_selected=!0)),t.showAllFloors||(l=t.floorFilterStart||t.floorFilterSingle,u=t.floorFilterEnd||t.floorFilterSingle),_.each(this.roomTypes,function(e){e.isSelected&&n.push(e.id)}),t.vacant&&a.push("VACANT"),t.occupied&&a.push("OCCUPIED"),t.queued&&a.push("QUEUED"),t.lateCheckout&&a.push("LATE_CHECKOUT"),t.pre_checkin&&a.push("PRE_CHECKIN"),t.stayover&&r.push("STAY_OVER"),t.not_reserved&&r.push("NOT_RESERVED"),t.arrival&&r.push("ARRIVAL"),t.arrived&&r.push("ARRIVED"),t.dayuse&&r.push("DAY_USE"),t.dueout&&r.push("DUE_OUT"),t.departed&&r.push("DEPARTED"),t.dirty&&o.push("DIRTY"),t.clean&&o.push("CLEAN"),t.inspected&&o.push("INSPECTED"),t.pickup&&o.push("PICKUP"),t.out_of_order&&o.push("OUT_OF_ORDER"),t.out_of_service&&o.push("OUT_OF_SERVICE"),t.exclude_out_of_order&&s.push("OUT_OF_ORDER"),t.exclude_out_of_service&&s.push("OUT_OF_SERVICE"),a.length&&(c.reservation_status=a),r.length&&(c.front_office_status=r),o.length&&(c.house_keeping_status=o),s.length&&(c.exclude_service_status=s),n.length&&(c.room_type_ids=n),l&&(c.floor_start=l),u&&(c.floor_end=u)),c}.bind(this),u={};this.fetchRoomListPost=function(e){var a=t.defer(),r="/house/search.json",i=l(e);return o.postJSON(r,i).then(function(e){u=e.data,u.summary=e.data.summary;var t=s.get("LAST_ROOM_SERVICE");t=t?JSON.parse(t):{rooms:[],status:{}};var r,o;for(r=0,o=u.rooms.length;r<o;r++){var i=u.rooms[r];i.description=i.hk_status.description,i.is_occupied="true"===i.is_occupied,i.is_vip="true"===i.is_vip,n.setRoomStatusClass(i),
n.setReservationStatusClass(i),i.timeOrIn=v(i),i.timeOrOut=p(i),i.assigned_staff=f(i),i.ooOsTitle=D(i),t.rooms.length&&_.indexOf(t.rooms,i.id)>-1&&(i.service_status=$.extend({},i.service_status,t.status))}a.resolve(u)},function(e){a.reject(e)}),a.promise},this.fetchPayload=function(e){function a(e){d=e;var t={date:i.businessDate,employee_ids:[i.userId]};i.isMaintenanceStaff?this.fetchWorkAssignments(t).then(r.bind(this)):o.call(this)}function r(e){var t=e.employees.length&&e.employees[0]||null,a=t&&t.room_tasks&&t.room_tasks.length||!1;a?u=i.userId:(u=!1,l=!1),m=e,o.call(this)}function o(){l&&(c.work_type_id=l),u&&(c.assignee_id=u),_.extend(e,c,{initialLoad:!0}),this.fetchRoomListPost(e).then(s,function(e){n.reject(e)})}function s(e){var t={roomList:e,workTypes:d,assignments:m};n.resolve(t)}var n=t.defer(),e=e,l=!1,u=!1,c={},d={},m={};return e.isStandAlone||i.isStandAlone?this.fetchWorkTypes().then(a.bind(this)):o.call(this),n.promise};var c=[];this.fetchFloors=function(){var e=t.defer(),a="/api/floors.json";return c.length?e.resolve(c):o.getJSON(a).then(function(t){c=t.floors,e.resolve(c)},function(t){e.reject(t)}),e.promise},this.roomTypes=[],this.fetchRoomTypes=function(){var e="api/room_types?exclude_pseudo=true",a=t.defer();return n.roomTypes.length?a.resolve(n.roomTypes):o.getJSON(e).then(function(e){this.roomTypes=e.results,angular.forEach(this.roomTypes,function(e,t){e.isSelected=!1}),a.resolve(this.roomTypes)}.bind(this),function(e){a.reject(e)}),a.promise},this.resetRoomTypes=function(){return angular.forEach(this.roomTypes,function(e,t){e.isSelected=!1}),this.roomTypes},this.allRoomTypes=[],this.fetchAllRoomTypes=function(){var e="api/room_types",a=t.defer();return n.allRoomTypes.length?a.resolve(n.allRoomTypes):o.getJSON(e).then(function(e){this.allRoomTypes=e.results,angular.forEach(this.allRoomTypes,function(e,t){e.isSelected=!1}),a.resolve(this.allRoomTypes)}.bind(this),function(e){a.reject(e)}),a.promise};var d=[];this.fetchHKEmps=function(e){var a="/api/work_statistics/employees_list",r=t.defer();return d.length?r.resolve(d):o.getJSON(a,e).then(function(e){d=e.results,r.resolve(d)},function(e){r.reject(e)}),r.promise},this.checkRoomAssigned=function(e){var a="/house/search.json",r=t.defer();return o.getJSON(a,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.fetchActiveWorksheetEmp=function(){var e="/api/work_sheets/active",a=t.defer();return o.getJSON(e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise};var m=[];this.fetchWorkTypes=function(){var e=t.defer(),a="api/work_types";return m.length?e.resolve(m):o.getJSON(a).then(function(t){m=t.results,e.resolve(m)},function(t){e.reject(t)}),e.promise},this.fetchWorkAssignments=function(e){var a=t.defer(),r="api/work_assignments/assigned_rooms";return o.postJSON(r,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchHkStatusList=function(){var e=t.defer(),a="api/rooms/hk_status_list";return o.getJSON(a).then(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise},this.putHkStatusChange=function(e){var a=t.defer(),r="house/mass_change_hk_status";return o.putJSON(r,e).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},this.fetchAllRoomIDs=function(){var e=t.defer(),a="/house/room_ids_list";return o.getJSON(a).then(function(t){e.resolve(t.room_ids)},function(t){e.reject(t)}),e.promise},this.toggleFilter=function(e){this.currentFilters[e]=!this.currentFilters[e]},this.isListEmpty=function(){return!(u&&u.rooms&&u.rooms.length)},this.setRoomStatusClass=function(e){var t;if(t=e.hasOwnProperty("service_status")?"OUT_OF_SERVICE"===e.service_status.value||"OUT_OF_ORDER"===e.service_status.value:"OO"===e.hk_status.value||"OS"===e.hk_status.value||2===e.room_reservation_hk_status||3===e.room_reservation_hk_status,t||"true"!==u.checkin_inspected_only){if(!t){if("CLEAN"===e.hk_status.value||"INSPECTED"===e.hk_status.value)return void(e.roomStatusClass="clean");if("PICKUP"===e.hk_status.value)return void(e.roomStatusClass="pickup")}}else{if("INSPECTED"===e.hk_status.value)return void(e.roomStatusClass="clean");if("CLEAN"===e.hk_status.value||"PICKUP"===e.hk_status.value)return void(e.roomStatusClass="pickup")}if("DIRTY"===e.hk_status.value&&!t)return void(e.roomStatusClass="dirty");if("DO_NOT_DISTURB"===e.hk_status.value)return void(e.roomStatusClass="dnd");if(t){if(e.roomStatusClass="out",e.hk_status.oo_status){if("true"===u.checkin_inspected_only){if("INSPECTED"===e.hk_status.oo_status)return void(e.roomStatusClassWithOO="clean");if("CLEAN"===e.hk_status.oo_status||"PICKUP"===e.hk_status.oo_status)return void(e.roomStatusClassWithOO="pickup")}else{if("CLEAN"===e.hk_status.oo_status||"INSPECTED"===e.hk_status.oo_status)return void(e.roomStatusClassWithOO="clean");if("PICKUP"===e.hk_status.oo_status)return void(e.roomStatusClassWithOO="pickup")}if("DIRTY"===e.hk_status.oo_status)return void(e.roomStatusClassWithOO="dirty")}}else;},this.setReservationStatusClass=function(e){switch(e.room_reservation_status){case"Due out":e.leaveStatusClass="check-out",e.enterStatusClass="no-show";break;case"Stayover":e.leaveStatusClass="inhouse",e.enterStatusClass="no-show";break;case"Departed":e.leaveStatusClass="check-out",e.enterStatusClass="no-show";break;case"Arrival":e.leaveStatusClass="no-show",e.enterStatusClass="check-in";break;case"Arrived":e.leaveStatusClass="no-show",e.enterStatusClass="check-in";break;case"Due out / Arrival":e.leaveStatusClass="check-out",e.enterStatusClass="check-in";break;case"Departed / Arrival":e.leaveStatusClass="check-out",e.enterStatusClass="check-in";break;case"Arrived / Departed":e.leaveStatusClass="check-out",e.enterStatusClass="check-in";break;case"Due out / Departed":e.leaveStatusClass="check-out",e.enterStatusClass="check-out";break;case"Arrived / Day use / Due out":e.leaveStatusClass="check-out",e.enterStatusClass="no-show";break;case"Arrived / Day use / Due out / Departed":e.leaveStatusClass="check-out",e.enterStatusClass="check-out";break;default:e.leaveStatusClass="no-show",e.enterStatusClass="no-show"}"true"===e.is_late_checkout&&(e.leaveStatusClass="late-check-out")},this.setRoomStatus=function(e,t,a){var r=_.find(u.rooms,function(t){return parseInt(t.id)===e});r[t]=a,r.ooOsTitle=D(r),this.setRoomStatusClass(r)},this.setWorkStatus=function(e,t){var a=_.find(u.rooms,function(t){return parseInt(t.id)===e});a.hk_status.description=t.description,a.description=a.hk_status.description,a.hk_status.value=t.value,this.setRoomStatusClass(a)};var v=function(e){return e.room_reservation_status.indexOf("Arrived")>=0&&!(e.room_reservation_status.indexOf("Day use")>=0)?"IN":e.room_reservation_status.indexOf("Arrival")>=0?e.arrival_time:""},p=function(e){return e.room_reservation_status.indexOf("Departed")>=0?"OUT":e.room_reservation_status.indexOf("Due out")>=0?"true"===e.is_late_checkout?e.late_checkout_time:e.departure_time:""},f=function(e){if(!i.isStandAlone)return!1;var t={name:"Unassigned",class:"unassigned"};return e.canAssign=!0,e.room_tasks&&e.room_tasks.length&&(e.canAssign=!1,t.class="assigned",_.unique(_.pluck(_.pluck(e.room_tasks,"assignee_maid"),"id")).length>1?t.name="Multiple Assignees":t.name=e.room_tasks[0].assignee_maid.name),t};this.calculateAssignedStaff=f;var D=function(e){return e.hasOwnProperty("service_status")?"OUT_OF_SERVICE"===e.service_status.value?"Out of Service":"OUT_OF_ORDER"===e.service_status.value?"Out of Order":"":i.isStandAlone?2===e.room_reservation_hk_status?"Out of Service":3===e.room_reservation_hk_status&&"Out of Order":"OS"===e.hk_status.value?"Out of Service":"OO"===e.hk_status.value&&"Out of Order"}}]),angular.module("sntRover").service("RVHkRoomDetailsSrv",["$http","$q","rvBaseWebSrvV2","RVBaseWebSrv","$window","$filter","$vault",function(e,t,a,r,o,i,s){var n=this,l=200,u=function(e){var t=function(e){return 2===e?"OUT_OF_SERVICE":3===e?"OUT_OF_ORDER":"IN_SERVICE"};s.setOnce("LAST_ROOM_SERVICE",JSON.stringify({rooms:[].concat(e.room_id),status:{to_date:e.to_date,end_time:e.end_time,id:e.room_service_status_id,value:t(e.room_service_status_id)}}))};n.roomDetails={},n.fetch=function(a,r){var i=t.defer(),s="/house/room/"+a+".json";return e.get(s).then(function(e){var t=e.data;"success"===t.status?(n.roomDetails=t.data.room_details,i.resolve(n.roomDetails)):i.reject(t)},function(e){var t=e.data,a=e.status;401===a?o.location.href="/house/logout":i.reject(t)}),i.promise},n.updateHKStatus=function(a){var r=t.defer(),i="/house/change_house_keeping_status.json";return e({url:i,method:"POST",data:a}).then(function(e){var t=e.data;"success"===t.status||e.status===l?r.resolve(t.data):r.reject(t)},function(e){var t=e.data,a=e.status;401===a?o.location.href="/house/logout":r.reject(t)}),r.promise};var c=[];n.fetchAllServiceStatus=function(){var e=t.defer(),r="api/room_services/status_list";return c.length?e.resolve(c):a.getJSON(r).then(function(t){c=t.results,e.resolve(c)},function(t){e.reject(t)}),e.promise};var d=[];n.fetchMaintenanceReasons=function(){var e=t.defer(),r="api/maintenance_reasons";return d.length?e.resolve(d):a.getJSON(r).then(function(t){d=t.maintenance_reasons,e.resolve(d)},function(t){e.reject(t)}),e.promise},n.getRoomLog=function(e){var r=t.defer(),o="/api/room_actions/"+e.id+"/?page="+e.page+"&per_page="+e.per_page;return a.getJSON(o).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.getRoomServiceStatus=function(e){var r=t.defer(),o="/api/room_services/service_info.json?",s=tzIndependentDate(e.from_date),n=s.getFullYear(),l=s.getMonth(),u=tzIndependentDate(new Date(n,l+2,1));return e.to_date=i("date")(u,"yyyy-MM-dd"),a.getJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.postRoomServiceStatus=function(e){var r=t.defer(),o="api/room_services";return a.postJSON(o,e).then(function(t){u(e),r.resolve(t)},function(e){r.reject(e)}),r.promise},n.checkWhetherRoomStatusChangePossible=function(e){var r=t.defer(),o="/api/room_services/check_room_locked_or_assigned";return a.postJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.postCheckOutReservation=function(e){var r=t.defer(),o="api/reservations/"+e.id+"/checkout_from_house_keeping";return a.postJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.putRoomServiceStatus=function(e){var r=t.defer(),o="api/room_services/"+e.room_id;return a.putJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.putRoomInService=function(e){var r=t.defer(),o="api/room_services/"+e.room_id,i={room_service_status_id:e.inServiceID,from_date:e.from_date,to_date:e.to_date};return a.putJSON(o,i).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise};var m=[];n.getWorkTypes=function(){var e=t.defer(),r="api/work_types";return m.length?e.resolve(m):a.getJSON(r).then(function(t){m=t.results,e.resolve(m)},function(t){e.reject(t)}),e.promise},n.postRecordTime=function(e){var r=t.defer(),o="/api/work_assignments/record_time";return a.postJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},n.fetchRoomStatus=function(e){var r={from_date:i("date")(tzIndependentDate(new Date(e.year,e.month-1,1)),"yyyy-MM-dd"),to_date:i("date")(tzIndependentDate(new Date(e.year,e.month+1,1)),"yyyy-MM-dd"),room_id:e.room_id},o=t.defer(),s="/api/room_services/service_info.json?";return a.getJSON(s,r).then(function(e){o.resolve({service_status:e.service_status})},function(e){o.reject(e)}),o.promise},n.changeHouseKeepingStatus=function(e){var r=t.defer(),o="house/change_fo_status.json";return a.postJSON(o,e).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise}}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("sntRover").service("rvUtilSrv",["$filter","$rootScope",function(e,t){var a=this,r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},this.escapeNull=function(e,t){var a="";"undefined"!=typeof t&&null!==t&&(a=t);var r=null===e||"undefined"==typeof e?a:e;return r},this.isEmpty=function(e){return"number"==typeof e&&(e=e.toString()),""===this.escapeNull(e).trim()},this.stringify=function(e){return JSON.stringify(e)},this.getDatesBetweenTwoDates=function(e,t){for(var a=[];e<=t;)a.push(new Date(e)),e.setDate(e.getDate()+1);return a},this.getFormattedDatesBetweenTwoDates=function(t,a){for(var r=[],o=new Date(t);o<=a;)r.push(e("date")(o,"yyyy-MM-dd")),o.setDate(o.getDate()+1);return r},this.getDayBetweenTwoDates=function(e,t){for(var a=[],r=new Date(e);r<=t;)a.push(r.getDate()),r.setDate(r.getDate()+1);return a},this.getMonthFromDateString=function(e){return new Date(e).getMonth()},this.toMilliSecond=function(e){var t="undefined"==typeof e?"undefined":_typeof(e),a="";switch(t){case"string":a=new tzIndependentDate(e);break;case"object":a=e.getTime()}return a},this.addOneDay=function(e){return this.toMilliSecond(e)+864e5},this.getListOfKeyValuesFromAnArray=function(e,t){var a,r=[];return _.each(e,function(e){a={},_.each(t,function(t){a[t]=e[t]}),r.push(a)}),r},this.isNumeric=function(e){return!jQuery.isArray(e)&&e-parseFloat(e)+1>=0},this.convertToInteger=function(e,t){return t=t?t:0,a.isNumeric(e)?parseInt(e):t},this.convertToDouble=function(e,t){return t=t?t:0,a.isNumeric(e)?parseFloat(e):t},this.get_date_from_date_picker=function(e,t){return"undefined"==typeof t&&(t="/"),e.selectedYear+t+(e.selectedMonth+1)+t+e.selectedDay},this.getFirstDayOfNextMonth=function(e){var e=new tzIndependentDate(e),t=e.getFullYear(),a=e.getMonth();return tzIndependentDate(new Date(t,a+1,1))},this.getListForTimeSelector=function(e,t){var a=[],r=0,o=0,i=0,s=null,n="",l="";for(_.isUndefined(t)&&(t=12),_.isUndefined(e)&&(e=15);r<1440;r+=e)o=Math.floor(r/60),i=r%60,i<10&&(i="0"+i),s=o%24<12?"AM":"PM",n=(o<10?"0"+o:o)+":"+i,o%=t,(0===o&&12===t||0===o&&24===t&&r<=60)&&(o=12),l=o+":"+i,12===t&&(l+=" "+s),a.push({value:n,text:l});return a},this.checkDevice={any:function(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)},iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)},android:function(){return navigator.userAgent.match(/Android/i)}},this.roundToNextQuarter=function(e,t){var a=(t>45?++e%24:e).toString(),r=(15*((t+14)/15|0)%60).toString();return(2===a.length?a:"0"+a)+":"+(2===r.length?r:"0"+r)},this.isEmailValid=function(e){return e=_.isUndefined(e)||_.isNull(e)?"":e,e=e.replace(/\s+/g,""),/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)},this.retrieveFeatureDetails=function(e,t){var a=_.find(e,function(e){return e.feature_name===t});return a},this.generateTimeDuration=function(e,t,a){var r=15,o=0,i=1440-r,s=["AM","PM"],n=[],l="",u="",c="",d="",m={},a=a||0;e&&(o=60*e.split(":")[0]+1*e.split(":")[1]+1*a),t&&(i=60*t.split(":")[0]+1*t.split(":")[1]+1*a);for(var v=0;o<=i;v++)c=Math.floor(o/60),d=o%60,l=("00"===("0"+c%12).slice(-2)?"12":("0"+c%12).slice(-2))+":"+("0"+d).slice(-2)+" "+s[Math.floor(c/12)],u=("0"+c).slice(-2)+":"+("0"+d).slice(-2),m={12:l,24:u},n.push(m),o+=r;return n},this.extractHhMmAmPm=function(e){var t=parseInt(e.split(" ")[0].split(":")[0]),a=t>=12?"PM":"AM";return{ampm:a,hh:"00"===("0"+t%12).slice(-2)?"12":("0"+t%12).slice(-2),mm:e.split(" ")[0].split(":")[1]}},this.convertTimeHhMmAmPmTo24=function(e){var t=e.hh,a=e.mm,r=e.ampm;return"12"===t&&(t="00"),"PM"===r&&(t=parseInt(t,10)+12),t+":"+a},this.getDiaryMode=function(){var e="FULL",a=t.hotelDiaryConfig;return a.hourlyRatesForDayUseEnabled?"LIMITED"===a.mode&&(e="DAYUSE"):e="NIGHTLY",e},this.isWeekendDay=function(e,t){return _.contains(e,r[t.getDay()])},this.countryFlagLangMap={EN:"us",ES:"es",DE:"de",NL:"nl",FR:"fr",IT:"it"},this.translatableLangs=["EN","ES","FR"],this.langNameTranslations={EN:"English",DE:"Deutsch",FR:"Français",ES:"Español",JA:"日本",ZH:"中国人",NL:"Nederlands",IT:"Italiano",FI:"Suomalainen",SV:"Svenska",NN:"Norsk",DA:"Dansk",IS:"Íslensku",TR:"Türk",AR:"عربي",PT:"Português",PL:"Polskie",HU:"Magyar",BG:"български",TL:"Tagalog",CS:"Čeština",SK:"Slovensky",ET:"Eestlane",RO:"Română",UK:"Українська",SL:"Slovenščina",HR:"Hrvatski",SR:"Српски",EL:"Ελληνικά",TH:"ไทย",YUE:"粵語",CMN:"普通话",ID:"Indonesia",VI:"Tiếng Việt",KO:"한국인",HI:"हिंदी",RU:"Pусский",LV:"Latvietis",MS:"Melayu"}}]),angular.module("sntRover").controller("nightlyDiaryAutoAssignController",["$scope","RVNightlyDiarySrv",function(e,t){BaseCtrl.call(this,e);var a=function(){e.selectedRoomTypes=[],e.selectedFloors=[],e.showRoomTypes=!1,e.showFloors=!1,e.selectedReservations=o()},r=function(){e.selectedRoomTypes&&0!==e.selectedRoomTypes.length&&e.selectedRoomTypes.forEach(function(t){_.findWhere(e.diaryData.filterList.roomType,{id:t}).selected=!1}),e.selectedFloors&&0!==e.selectedFloors.length&&e.selectedFloors.forEach(function(t){_.findWhere(e.diaryData.filterList.floorList,{id:t}).selected=!1})},o=function(){var t=[],a=[];return 0===e.selectedRoomTypes.length?a=angular.copy(e.diaryData.unassignedReservationList.reservations):e.selectedRoomTypes.forEach(function(t){var r;(r=a).push.apply(r,_toConsumableArray(_.filter(e.diaryData.unassignedReservationList.reservations,{room_type_id:t})))}),a=_.reject(a,{is_hourly:!0}),a=_.reject(a,{is_suite_reservation:!0}),t=_.pluck(a,"reservation_id")};e.roomTypeSelected=function(t){t.selected=!t.selected,e.selectedRoomTypes=_.pluck(_.where(e.diaryData.filterList.roomType,{selected:!0}),"id"),e.selectedReservations=o()},e.floorSelected=function(t){t.selected=!t.selected,e.selectedFloors=_.pluck(_.where(e.diaryData.filterList.floorList,{selected:!0}),"id")},e.cancelAutoAssign=function(){r(),a(),e.diaryData.autoAssign={showHeader:!1,isLocked:!1,status:"",statusText:"",statusDescription:"",statusClass:""}},e.autoAssignRooms=function(){var o={reservation_ids:e.selectedReservations,room_type_ids:e.selectedRoomTypes,floor_ids:e.selectedFloors,apply_room_preferences:!0,process_date:e.diaryData.arrivalDate},i={params:o,successCallBack:function(t){r(),a(),e.$emit("SET_AUTO_ASSIGN_STATUS",t)},failureCallBack:function(t){t.httpStatus&&470===t.httpStatus&&e.$emit("REFRESH_AUTO_ASSIGN_STATUS")}};e.callAPI(t.initiateAutoAssignRooms,i)},e.refreshAutoAssignStatus=function(){e.$emit("REFRESH_AUTO_ASSIGN_STATUS")},e.unlockRoomDiary=function(){var a={successCallBack:function(t){t.is_diary_locked||(e.cancelAutoAssign(),e.$emit("REFRESH_DIARY_SCREEN"),e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST"))},failureCallBack:function(t){t.httpStatus&&470===t.httpStatus&&e.$emit("REFRESH_AUTO_ASSIGN_STATUS")}};e.callAPI(t.unlockRoomDiary,a)},e.addListener("INITIATE_AUTO_ASSIGN_CTRL",a)}]),angular.module("sntRover").controller("rvNightlyDiaryFilterbarSearchController",["$scope","$rootScope","$state","$stateParams","$filter","ngDialog","RVNightlyDiarySearchSrv",function(e,t,a,r,o,i,s){var n=this,l=function(){e.textInQueryBox="",e.diaryData.totalSearchResults=0,e.diaryData.reservationSearchResults=[]},u=null,c=function(t){e.$emit("hideLoader"),e.diaryData.reservationSearchResults=t.results,e.diaryData.totalSearchResults=t.total_count},d=function(t){e.$emit("hideLoader"),e.errorMessage=t},m=function(){var t={};t.query=e.textInQueryBox.trim(),t.from_date=e.diaryData.fromDate,t.to_date=e.diaryData.toDate,e.invokeApi(s.fetchSearchResults,t,c,d)};BaseCtrl.call(n,e),l(),e.getGuestName=function(e,t){return e.toUpperCase()+" "+t.toUpperCase()},e.getReservationClass=function(e){var t={CHECKING_IN:"check-in",PRE_CHECKIN:"pre-check-in",CANCELED:"cancel",CHECKEDOUT:"departed",CHECKING_OUT:"check-out",CHECKEDIN:"inhouse",NOSHOW:"no-show",NOSHOW_CURRENT:"no-show"};return e.toUpperCase()in t?t[e.toUpperCase()]:""},e.$watch("textInQueryBox",function(t){e.searchWords=[],t.length>=2&&(t.indexOf(",")!==-1?e.searchWords=t.split(","):t.indexOf(" ")!==-1?e.searchWords=t.split(" "):e.searchWords.push(t))}),e.queryEntered=function(){var t=e.textInQueryBox;return e.textInQueryBox=t.charAt(0).toUpperCase()+t.slice(1),0===e.textInQueryBox.length?void e.clearResults():void(e.textInQueryBox.length>=3&&(null!==u&&clearTimeout(u),u=setTimeout(function(){e.textInQueryBox.length>=3&&m()},800)))},e.clearResults=function(){e.textInQueryBox="",e.diaryData.reservationSearchResults=[],e.diaryData.totalSearchResults=0},e.clickedOnResultItem=function(t,a){e.$emit("UPDATE_RESERVATIONLIST",t,a)},e.addListener("CLOSE_SEARCH_RESULT",function(){e.clearResults()}),e.getPlaceholderText=function(){return window.innerWidth>1024?o("translate")("PLACEHOLDER_NIGHTLY_DIARY_SEARCH_FULL"):o("translate")("PLACEHOLDER_NIGHTLY_DIARY_SEARCH_SHORT")}}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};angular.module("sntRover").controller("rvNightlyDiaryMainController",["$scope","$rootScope","$state","$stateParams","$filter","roomsList","datesList","ngDialog","$timeout","reservationsList","RVNightlyDiarySrv","unassignedReservationList","rvPermissionSrv","rvUtilSrv","$interval","rvHouseEventsListSrv",function(e,t,a,r,o,i,s,n,l,u,c,d,m,v,p,f){BaseCtrl.call(this,e),document.removeEventListener("touchmove",window.touchmovepreventdefault,!1),document.removeEventListener("touchmove",window.touchmovestoppropogate,!1),e.$on("$destroy",function(){document.addEventListener("touchmove",window.touchmovepreventdefault,!1),document.addEventListener("touchmove",window.touchmovestoppropogate,!1)});var D="STAYCARD"===r.origin,h=21,y={},R=null,g=function(t){switch(e.diaryData.autoAssign.status=t.auto_room_assignment_status,e.diaryData.autoAssign.showHeader?e.diaryData.autoAssign.showHeader&&!e.diaryData.autoAssign.isLocked?e.diaryData.autoAssign.isLocked=t.is_diary_locked:e.diaryData.autoAssign.showHeader&&e.diaryData.autoAssign.isLocked&&(e.diaryData.autoAssign.showHeader=t.is_diary_locked,e.diaryData.autoAssign.isLocked=t.is_diary_locked,t.is_diary_locked||(Z(),Q())):(e.diaryData.autoAssign.showHeader=t.is_diary_locked,e.diaryData.autoAssign.isLocked=t.is_diary_locked),t.is_diary_locked&&e.diaryData.isEditReservationMode&&(X(),n.close(),e.diaryData.isReservationSelected=!1),t.is_diary_locked&&e.diaryData.isReservationSelected&&!_.isEmpty(e.diaryData.selectedUnassignedReservation)&&(n.close(),e.$broadcast("CANCEL_UNASSIGNED_RESERVATION")),e.diaryData.autoAssign.processDate=t.process_date?t.process_date:e.diaryData.arrivalDate,t.auto_room_assignment_status){case"pending":e.diaryData.autoAssign.statusText="Room auto assignment in progress",e.diaryData.autoAssign.statusDescription="Diary is locked until process is completed",e.diaryData.autoAssign.statusClass="";break;case"failed":e.diaryData.autoAssign.statusText="Room auto assignment failed",e.diaryData.autoAssign.statusDescription="0 Rooms Assigned",e.diaryData.autoAssign.statusClass="failed";break;case"partial":e.diaryData.autoAssign.statusText="Room auto assignment completed",e.diaryData.autoAssign.statusDescription="Some Reservations Remain Unassigned",e.diaryData.autoAssign.statusClass="semi-completed";break;case"completed":t.is_diary_locked?(e.diaryData.autoAssign.statusText="Room auto assignment completed",e.diaryData.autoAssign.statusDescription="Rooms Assigned to All Reservations",e.diaryData.autoAssign.statusClass="completed"):(e.diaryData.autoAssign.statusText="",e.diaryData.autoAssign.statusDescription="",e.diaryData.autoAssign.statusClass="",e.diaryData.autoAssign.processDate=e.diaryData.arrivalDate)}},S=function(){e.heading=o("translate")("MENU_ROOM_DIARY"),e.setTitle(o("translate")("MENU_ROOM_DIARY")),e.$emit("updateRoverLeftMenu","nightlyDiaryReservation");var a={};D?a=c.getCache():(r.start_date?a.start_date=moment(tzIndependentDate(r.start_date)).format(t.momentFormatForAPI):a.start_date=moment(tzIndependentDate(t.businessDate)).subtract(1,"days").format(t.momentFormatForAPI),a.no_of_days=7,a.page=1,a.per_page=50),e.diaryData={autoAssign:{showHeader:!1,isLocked:!1,status:"",statusText:"",statusDescription:"",statusClass:"",processDate:""},datesGridData:s.dates,businessDate:t.businessDate,diaryRoomsList:i.rooms,numberOfDays:a.no_of_days,fromDate:a.start_date,arrivalDate:a.start_date<=t.businessDate?t.businessDate:a.start_date,toDate:"",paginationData:{perPage:50,page:a.page,totalCount:i.total_count},hasMultipleMonth:!1,firstMonthDateList:[],secondMonthDateList:[],reservationsList:u,unassignedReservationList:d,hasOverlay:!1,isEditReservationMode:D,hideMoveButton:!1,showUnassignedPanel:!1,showUnassignedReservations:!1,selectedRoomTypes:[],selectedFloors:[],selectedRoomFeatures:[],isFromStayCard:!1,hideUnassignRoomButton:!0,filterList:{},hideRoomType:!0,hideFloorList:!0,isBookRoomViewActive:!1,showBookFilterPanel:!1,bookRoomViewFilter:{fromDate:null,toDate:null,arrivalTime:s.hotelCheckinTime,arrivalTimeList:[],departureTime:s.hotelCheckoutTime,departureTimeList:[],nights:1,hotelCheckinTime:s.hotelCheckinTime,hotelCheckoutTime:s.hotelCheckoutTime},availableSlotsForBookRooms:[],isAssignRoomViewActive:!1,isMoveRoomViewActive:!1,showSaveChangeButtonAfterShortenOrExtent:{arrivalChanged:!1,departureChanged:!1,show:!1},availableSlotsForAssignRooms:{availableRoomList:[],fromDate:null,nights:null},requireAuthorization:!1,isReservationSelected:!1,selectedUnassignedReservation:{},roomAssignmentFilters:{},isCancelledMoveOrAssign:!1,eventsCount:{}},e.currentSelectedReservation={},e.currentSelectedRoom={}};e.addListener("POLL_N_DIARY_AUTO_ASSIGN_STATUS",function(){R=p(se,2e3)}),e.addListener("STOP_N_DIARY_AUTO_ASSIGN_STATUS_POLLING",function(){p.cancel(R)}),S();var A=function(t){return{per_page:e.diaryData.paginationData.perPage,page:t?e.diaryData.paginationData.page+t:e.diaryData.paginationData.page,total_count:e.diaryData.paginationData.totalCount}},T=function(t){e.diaryData.paginationData.totalCount=t.roomList.total_count,e.diaryData.paginationData.page=t.roomList.page_number},E=function(t){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryErrorMessage.html",scope:e,className:"",closeByDocument:!1,closeByEscape:!1,data:{errorMessage:t}})},N=function(t){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryNoAvailableRooms.html",className:"",scope:e,data:{warningMessage:t,isRefresh:!1}})},O=function(t,a,o){var i=function(a){if(e.diaryData.diaryRoomsList=a.roomList.rooms,e.diaryData.reservationsList=a.reservationList,T(a),e.diaryData.datesGridData=a.dateList.dates,0===a.roomList.rooms.length&&l(function(){N("No available rooms found for selected criteria")},500),e.$broadcast("FETCH_COMPLETED_DATE_LIST_DATA"),e.diaryData.isBookRoomViewActive?re():fe(),t&&e.$broadcast("CLOSE_SEARCH_RESULT"),t&&o){var i=_.find(e.diaryData.reservationsList.rooms,function(e){return e.id===t}),s=_.find(i.reservations,function(e){return e.id===o}),n={id:t};L("",s,n),"TRIGGER_MOVE_ROOM"===r.action&&e.$broadcast("TRIGGER_MOVE_ROOM")}},s=_extends({},A(a),{start_date:e.diaryData.fromDate,no_of_days:e.diaryData.numberOfDays,selected_room_type_ids:e.diaryData.selectedRoomTypes,selected_floor_ids:e.diaryData.selectedFloors,selected_room_feature_ids:e.diaryData.selectedRoomFeatures});if(e.diaryData.isAssignRoomViewActive||e.diaryData.isMoveRoomViewActive){var n=e.diaryData.availableSlotsForAssignRooms.roomTypeId;s.selected_room_type_ids=[n],y=angular.copy(s),(e.diaryData.isAssignRoomViewActive||e.diaryData.isMoveRoomViewActive)&&a||(s.page=1)}else e.diaryData.isCancelledMoveOrAssign&&(s.page=y.page?y.page:1,e.diaryData.isCancelledMoveOrAssign=!1);t&&(s.room_id=t,e.diaryData.selectedRoomId=t);var u={params:s,successCallBack:i};e.callAPI(c.fetchRoomsListAndReservationList,u)},I=function(){X(),O(null,-1)},C=function(){X(),O(null,1)},P=function(){var t={type:"RESERVATION_SELECTED",selectedReservationId:e.currentSelectedReservation.id,reservationsList:e.diaryData.reservationsList.rooms,selectedRoomId:e.diaryData.selectedRoomId,currentSelectedReservation:e.currentSelectedReservation};de.dispatch(t)},L=function(t,a,r){if(!e.diaryData.isEditReservationMode){var o=_.findWhere(e.diaryData.diaryRoomsList,{id:r.id});e.diaryData.showSaveChangeButtonAfterShortenOrExtent.show=!1,e.diaryData.hideMoveButton=a.no_room_move,e.diaryData.hideUnassignRoomButton="CHECKEDIN"===a.status||"CHECKEDOUT"===a.status||"CHECKING_OUT"===a.status,e.diaryData.isEditReservationMode=!0,e.currentSelectedReservation=_extends({},a,{room_type_name:o.room_type_name}),e.currentSelectedRoom=r,e.diaryData.selectedRoomId=r.id,e.extendShortenReservationDetails={arrival_date:a.arrival_date,dep_date:a.dept_date,reservation_id:a.id,room_number:o.room_no},P(),l(function(){e.$apply()},10)}},b=function(){e.diaryData.isAssignRoomViewActive=!1,e.$broadcast("RESET_UNASSIGNED_LIST_SELECTION"),e.diaryData.availableSlotsForAssignRooms={}},M=function(){e.diaryData.isMoveRoomViewActive=!1,e.diaryData.availableSlotsForAssignRooms={},X(),O()},k=function(t,a,r,o){var i=function(){e.errorMessage="","ASSIGN"===r?e.$broadcast("SUCCESS_ROOM_ASSIGNMENT",t):"MOVE"===r&&M(),o&&n.close()},s=function(e){e.httpStatus&&470===e.httpStatus&&se()},l={reservation_id:a.reservationId,room_number:t.room_number,without_rate_change:!0,is_preassigned:!0,forcefully_assign_room:!1,is_from_nightly_diary:!0};o&&(l.arrival_time=o.arrival_time,l.departure_time=o.departure_time);var u={params:l,successCallBack:i,failureCallBack:s};e.callAPI(c.assignRoom,u)},F=function(t,a,r){e.setTimePopupData={type:r,roomDetails:t,reservationDetails:a,data:{}};var o=function(){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiarySetTimePopup.html",scope:e,className:"",closeByDocument:!1,closeByEscape:!1,controller:"rvNightlyDiarySetTimePopupCtrl"})},i=function(i){e.setTimePopupData.data=i,"MOVE"===r&&"CHECKEDIN"===a.reservationStatus&&"DIRTY"===t.room_ready_status?N("Cannot move occupied guest to a dirty room"):"ASSIGN"!==r&&"MOVE"!==r||!i.is_overlapping_reservations_exists?"ASSIGN"!==r&&"MOVE"!==r||i.is_overlapping_reservations_exists||k(t,a,r):o()},s={room_id:t.room_id,start_date:a.fromDate,no_of_days:h};"ASSIGN"!==r&&"MOVE"!==r||(s.reservation_id=a.reservationId,s.no_of_days=a.nights);var l={params:s,successCallBack:i};e.callAPI(c.fetchAvailableTimeSlots,l)},V=function(t,a){var r=!1;return null!==t.room_max_occupancy&&null!==a.reservationOccupancy?t.room_max_occupancy<a.reservationOccupancy&&(r=!0,e.max_occupancy=t.room_max_occupancy):null!==t.room_type_max_occupancy&&null!==a.reservationOccupancy&&t.room_type_max_occupancy<a.reservationOccupancy&&(r=!0,e.max_occupancy=t.room_type_max_occupancy),r},B=function(t,a){V(t,a)?n.openConfirm({template:"/assets/partials/nightlyDiary/rvNightlyDiaryMaxOccupancyPopup.html",className:"ngdialog-theme-default",scope:e}).then(function(){F(t,a,"ASSIGN")},function(){}):F(t,a,"ASSIGN")};e.addListener("SET_TIME_AND_SAVE",function(t,a){k(e.setTimePopupData.roomDetails,e.setTimePopupData.reservationDetails,e.setTimePopupData.type,a)});var w=function(t,a){V(t,a)?n.openConfirm({template:"/assets/partials/nightlyDiary/rvNightlyDiaryMaxOccupancyPopup.html",className:"ngdialog-theme-default",scope:e}).then(function(){F(t,a,"MOVE")},function(){}):F(t,a,"MOVE")},Y=function(){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryReservationWithUnassignedRoom.html",scope:e,className:"",closeByDocument:!1,closeByEscape:!1})},G=function(t){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryContinueWithBookPopup.html",scope:e,className:"",closeByDocument:!1,closeByEscape:!1,data:{callbackAction:t}})},x=function(e,t,r){var o=function(){var t="rover.reservation.staycard.mainCard.room-rates";a.go(t,{from_date:e.fromDate,to_date:e.toDate,arrivalTime:e.arrivalTime,departureTime:e.departureTime,fromState:"NIGHTLY_DIARY",room_type_id:e.room_type_id,selectedRoomId:e.room_id,selectedRoomNo:e.room_no,numNights:e.nights}),n.close()},i=v.getDiaryMode();"BOOK"===r?"FULL"===i&&t.unassigned_reservations_present&&t.availability<=0?Y():t.unassigned_reservations_present?G(o):o():"OVERBOOK"===r&&o();
},U=function(e,t,a){x(e,t,a)},H=function(){n.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryValidateStayChanges.html",scope:e,className:"",closeByDocument:!1,closeByEscape:!1,controller:"rvNightlyDiaryValidationStayCtrl"})},j=function(a,r){var o=function(o){e.popupData={data:o,showOverBookingButton:!1,message:"",diaryMode:v.getDiaryMode()};var i=!1;o.is_room_available&&""===o.message?i=!0:o.is_room_available&&o.is_no_restrictions_exist&&(!o.is_group_reservation||o.is_group_available)&&o.is_rate_available?(e.popupData.message=o.message,e.popupData.showOverBookingButton=!0,i=!0,H()):(e.popupData.message=o.message,H()),i&&(e.extendShortenReservationDetails={arrival_date:moment(a,t.dateFormat.toUpperCase()).format("YYYY-MM-DD"),dep_date:moment(r,t.dateFormat.toUpperCase()).format("YYYY-MM-DD"),reservation_id:e.currentSelectedReservation.id,room_number:e.currentSelectedReservation.room_no}),e.diaryData.requireAuthorization=o.require_cc_auth,e.diaryData.routingInfo=o.routing_info,e.extendShortenReservationDetails.authorize_credit_card=o.require_cc_auth},i={params:{new_arrival_date:moment(a,t.dateFormat.toUpperCase()).format("YYYY-MM-DD"),new_dep_date:moment(r,t.dateFormat.toUpperCase()).format("YYYY-MM-DD"),reservation_id:e.currentSelectedReservation.id,room_id:e.currentSelectedRoom.id},successCallBack:o};e.callAPI(c.validateStayChanges,i)};e.closeDialog=function(){X(),n.close()};var $=function(){return m.getPermissionValue("OVERRIDE_CC_AUTHORIZATION")},J=function(){X(),l(function(){O()},700),e.closeDialog()};e.continueWithoutCC=function(){J()},e.continueAfterSuccessAuth=function(){J()},e.closeBillingInfoPopup=function(){J()},e.updateBillingInformation=function(){var t=function(){J()},a={params:{from_date:e.extendShortenReservationDetails.arrival_date,to_date:e.extendShortenReservationDetails.dep_date,reservation_id:e.extendShortenReservationDetails.reservation_id,is_from_diary:!0},successCallBack:t};e.callAPI(c.updateBillingInformation,a)};var W=function(){n.open({template:"/assets/partials/reservation/alerts/rvShowBillingInformationPopup.html",className:"",closeByDocument:!1,scope:e})},z=function(){var t=function(t){var a=e.diaryData.routingInfo;e.diaryData.requireAuthorization&&e.isStandAlone?t.data.auth_status?(e.isInProgressScreen=!1,e.isSuccessScreen=!0,e.isFailureScreen=!1,e.cc_auth_amount=t.data.cc_auth_amount,e.cc_auth_code=t.data.cc_auth_code):(e.isInProgressScreen=!1,e.isSuccessScreen=!1,e.isFailureScreen=!0,e.cc_auth_amount=t.data.cc_auth_amount):a.incoming_from_room||a.out_going_to_room||a.out_going_to_comp_tra?W():J()};e.diaryData.requireAuthorization&&e.isStandAlone&&(e.isInProgressScreen=!0,e.isSuccessScreen=!1,e.isFailureScreen=!1,e.isCCAuthPermission=$(),n.open({template:"/assets/partials/bill/ccAuthorization.html",className:"",closeByDocument:!1,scope:e}));var a={params:e.extendShortenReservationDetails,successCallBack:t,failureCallBack:function(e){e.httpStatus&&470===e.httpStatus&&se()}};e.callAPI(c.confirmUpdates,a)},K=function(e,t){var a={type:"EXTEND_SHORTEN_RESERVATION",newArrivalPosition:e,newDeparturePosition:t};de.dispatch(a)},X=function(){if(e.diaryData.isEditReservationMode){e.diaryData.isEditReservationMode=!1,e.currentSelectedReservation={};var t={type:"CANCEL_RESERVATION_EDITING",reservationsList:e.diaryData.reservationsList.rooms,paginationData:angular.copy(e.diaryData.paginationData),currentSelectedReservation:e.currentSelectedReservation};de.dispatch(t)}},q=function(t,a){a?e.diaryData.showSaveChangeButtonAfterShortenOrExtent.arrivalChanged=t:e.diaryData.showSaveChangeButtonAfterShortenOrExtent.departureChanged=t,e.diaryData.showSaveChangeButtonAfterShortenOrExtent.arrivalChanged||e.diaryData.showSaveChangeButtonAfterShortenOrExtent.departureChanged?e.diaryData.showSaveChangeButtonAfterShortenOrExtent.show=!0:e.diaryData.showSaveChangeButtonAfterShortenOrExtent.show=!1};e.addListener("CANCEL_RESERVATION_EDITING",function(){X()}),e.addListener("SAVE_RESERVATION_EDITING",function(){z(),e.popupData&&!e.popupData.disableOverBookingButton&&n.close()}),e.addListener("UPDATE_RESERVATIONLIST",function(t,a,r){a&&e.$broadcast("RESET_RIGHT_FILTER_BAR"),X(),O(a,null,r)});var Q=function(a,r){b(),"REFRESH"!==r&&(e.diaryData.arrivalDate=e.diaryData.fromDate<=t.businessDate||"RESET"===r?t.businessDate:e.diaryData.fromDate),e.$broadcast("FETCH_UNASSIGNED_LIST_DATA"),e.$broadcast("RESET_UNASSIGNED_LIST_SELECTION")};e.addListener("UPDATE_UNASSIGNED_RESERVATIONLIST",Q),e.addListener("INITIATE_AUTO_ASSIGN",function(){e.$broadcast("INITIATE_AUTO_ASSIGN_CTRL"),e.diaryData.autoAssign.showHeader=!0}),e.addListener("REFRESH_DIARY_ROOMS_AND_RESERVATIONS",function(t,a){e.$broadcast("RESET_RIGHT_FILTER_BAR"),X(),O(a)});var Z=function(){e.diaryData.paginationData.page=1,O(),X()};e.addListener("REFRESH_DIARY_SCREEN",Z);var ee=function(){b(),e.$broadcast("RESET_RIGHT_FILTER_BAR"),e.diaryData.paginationData.page=1,O(),X()};e.addListener("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY",ee),e.addListener("SHOW_ASSIGN_ROOM_SLOTS",function(t,a){"MOVE_ROOM"===a.type?e.diaryData.isMoveRoomViewActive=!0:"ASSIGN_ROOM"===a.type&&(e.diaryData.isAssignRoomViewActive=!0),e.diaryData.availableSlotsForAssignRooms=a,O()}),e.addListener("HIDE_ASSIGN_ROOM_SLOTS",function(){e.diaryData.isAssignRoomViewActive=!1,e.diaryData.isMoveRoomViewActive=!1,e.diaryData.availableSlotsForAssignRooms={},O()}),e.addListener("TOGGLE_FILTER_TOP",function(t,a){e.$broadcast("TOGGLE_FILTER",a)}),e.addListener("APPLY_GUEST_PREFERENCE_FILTER_TOP",function(){e.$broadcast("APPLY_GUEST_PREFERENCE_FILTER")}),e.closeDialogAndRefresh=function(e){e&&ee(),n.close()},e.addListener("SHOW_ERROR_MESSAGE",function(e,t){E(t)});var te=function(){return m.getPermissionValue("OVERBOOK_HOUSE")},ae=function(){return m.getPermissionValue("OVERBOOK_ROOM_TYPE")},re=function(){if(e.diaryData.isBookRoomViewActive){e.diaryData.rightFilter="RESERVATION_FILTER";var t=e.diaryData.bookRoomViewFilter,a=function(a){e.errorMessage="",e.diaryData.availableSlotsForBookRooms=a,e.diaryData.availableSlotsForBookRooms.fromDate=t.fromDate,e.diaryData.availableSlotsForBookRooms.toDate=t.toDate,e.diaryData.availableSlotsForBookRooms.nights=t.nights,e.diaryData.availableSlotsForBookRooms.arrivalTime=t.arrivalTime,e.diaryData.availableSlotsForBookRooms.departureTime=t.departureTime,e.diaryData.availableSlotsForBookRooms.canOverbookHouse=te(),e.diaryData.availableSlotsForBookRooms.canOverbookRoomType=ae(),0===a.rooms.length&&N("No available rooms found for selected criteria"),e.diaryData.availableSlotsForAssignRooms.hasOwnProperty("reservationId")?(b(),O()):fe()},r={params:{start_date:t.fromDate,end_date:t.toDate,start_time:t.arrivalTime,end_time:t.departureTime,page:e.diaryData.paginationData.page,per_page:e.diaryData.paginationData.perPage,selected_room_type_ids:e.diaryData.selectedRoomTypes,selected_floor_ids:e.diaryData.selectedFloors,selected_room_feature_ids:e.diaryData.selectedRoomFeatures},successCallBack:a};e.callAPI(c.retrieveAvailableFreeSlots,r)}else O()};e.addListener("TOGGLE_BOOK_AVAILABLE",re);var oe=parseInt(r.reservation_id)||"",ie=parseInt(r.room_id)||"";"SELECT_RESERVATION"===r.action||"TRIGGER_MOVE_ROOM"===r.action?O(ie,null,oe):"SELECT_UNASSIGNED_RESERVATION"===r.action&&l(function(){e.diaryData.rightFilter="UNASSIGNED_RESERVATION",e.$broadcast("SELECT_UNASSIGNED_RESERVATION",oe)},1e3),e.addListener("CLICKED_UNASSIGNED_RESERVATION",function(t,a){l(function(){e.diaryData.isEditReservationMode=!0,e.currentSelectedReservation={},e.currentSelectedReservation=a},1e3)}),e.addListener("CANCEL_UNASSIGNED_RESERVATION_MAIN",function(){e.$broadcast("CANCEL_UNASSIGNED_RESERVATION")}),e.addListener("SET_AUTO_ASSIGN_STATUS",function(e,t){g(t)});var se=function(){c.fetchAutoAssignStatus().then(g)};e.addListener("REFRESH_AUTO_ASSIGN_STATUS",se);var ne=function(a){t.isStandAlone&&n.open({template:"/assets/partials/diary/rvDiaryUpdateRoomStatusAndServicePopup.html",className:"ngdialog-theme-default",closeByDocument:!0,controller:"rvDiaryRoomStatusAndServiceUpdatePopupCtrl",data:a,scope:e})},le=function(){return{goToPrevPage:I,goToNextPage:C,selectReservation:L,extendShortenReservation:K,checkReservationAvailability:j,clickedAssignRoom:B,clickedMoveRoom:w,clickedBookRoom:U,showOrHideSaveChangesButton:q,showRoomStatusAndServiceUpdatePopup:ne}},ue=function(){var t=c.getCache(),a=t.currentSelectedReservation;"UNASSIGNED_RESERVATION"===a.type?l(function(){e.diaryData.rightFilter="UNASSIGNED_RESERVATION",e.$broadcast("SELECT_UNASSIGNED_RESERVATION",a.reservation_id,a.arrival_date)},500):(e.currentSelectedReservationId=t.currentSelectedReservationId,e.diaryData.selectedRoomId=t.currentSelectedRoomId),e.diaryData.unassignedReservationList=t.unassignedReservationList,e.currentSelectedReservation=t.currentSelectedReservation,e.diaryData.hideUnassignRoomButton=!0,a&&a.status&&(e.diaryData.hideUnassignRoomButton="CHECKEDIN"===a.status||"CHECKEDOUT"===a.status||"CHECKING_OUT"===a.status),(t.selected_floor_ids&&t.selected_floor_ids.length>0||t.selected_room_type_ids&&t.selected_room_type_ids.length>0)&&(e.diaryData.isFromStayCard=!0,e.diaryData.filterList=t.filterList,e.diaryData.selectedRoomCount=t.selectedRoomCount,e.diaryData.selectedFloorCount=t.selectedFloorCount,e.diaryData.hideRoomType=t.hideRoomType,e.diaryData.hideFloorList=t.hideFloorList)};D&&ue();var ce={roomsList:i.rooms,reservationsList:u.rooms,availableSlotsForAssignRooms:{},isAssignRoomViewActive:!1,isMoveRoomViewActive:!1,diaryInitialDayOfDateGrid:e.diaryData.fromDate,numberOfDays:e.diaryData.numberOfDays,currentBusinessDate:t.businessDate,callBackFromAngular:le(),paginationData:e.diaryData.paginationData,selectedReservationId:e.currentSelectedReservationId,selectedRoomId:e.diaryData.selectedRoomId,isFromStayCard:D,currentSelectedReservation:e.currentSelectedReservation,dateFormat:t.dateFormat,isPmsProductionEnvironment:t.isPmsProductionEnv,diaryMode:v.getDiaryMode()},de=configureDiaryStore(ce),me=ReactDOM,ve=me.render,pe=ReactRedux,_e=pe.Provider,fe=function(){var a={type:"DIARY_VIEW_CHANGED",numberOfDays:e.diaryData.numberOfDays,reservationsList:e.diaryData.reservationsList.rooms,isAssignRoomViewActive:e.diaryData.isAssignRoomViewActive,isMoveRoomViewActive:e.diaryData.isMoveRoomViewActive,availableSlotsForAssignRooms:e.diaryData.availableSlotsForAssignRooms,isBookRoomViewActive:e.diaryData.isBookRoomViewActive,availableSlotsForBookRooms:e.diaryData.availableSlotsForBookRooms,roomsList:e.diaryData.diaryRoomsList,diaryInitialDayOfDateGrid:e.diaryData.fromDate,currentBusinessDate:t.businessDate,callBackFromAngular:le(),paginationData:e.diaryData.paginationData,selectedReservationId:e.currentSelectedReservation.id,selectedRoomId:e.diaryData.selectedRoomId,diaryMode:v.getDiaryMode()};de.dispatch(a)},De=function(){return ve(React.createElement(_e,{store:de},React.createElement(NightlyDiaryRootContainer,null)),document.querySelector("#nightlyDiaryMain"))};e.showHouseEventsListPopup=function(t,a){t&&(e.selectedEventDisplayDate=a,n.open({template:"/assets/partials/popups/rvHouseEventsListPopup.html",scope:e,controller:"rvHouseEventsListPopupCtrl",className:"ngdialog-theme-default",closeByDocument:!1,closeByEscape:!0}))},e.addListener("UPDATE_EVENTS_COUNT",function(){he(e.diaryData.fromDate,e.diaryData.toDate)});var he=function(t,a){var r=function(t){e.diaryData.eventsCount=t,De()},o=function(){e.diaryData.eventsCount={},De()};e.callAPI(f.fetchHouseEventsCount,{params:{start_date:t,end_date:a},onSuccess:r,onFailure:o})};!function(){var e=r.start_date||moment(tzIndependentDate(t.businessDate)).subtract(1,"days").toDate(),a=moment(tzIndependentDate(e)).add(6,"days"),i=o("date")(a.toDate(),t.dateFormatForAPI);e=o("date")(tzIndependentDate(e),t.dateFormatForAPI),he(e,i)}()}]),angular.module("sntRover").controller("rvNightlyDiaryRightFilterBarController",["$scope","RVNightlyDiaryRightFilterBarSrv","RVNightlyDiarySrv","ngDialog",function(e,t,a,r){BaseCtrl.call(this,e);var o=function(){if(_.isEmpty(e.diaryData.filterList)){var a=function(t){e.diaryData.selectedRoomCount=0,e.diaryData.selectedFloorCount=0,e.diaryData.selectedRoomFeaturesCount=0,e.diaryData.filterList.roomType=t.rooms,e.diaryData.filterList.floorList=t.floors,e.diaryData.filterList.roomFeatures=t.roomFeatures},r={params:{},successCallBack:a};e.callAPI(t.fetchFilterList,r)}};e.toggleRoomSelection=function(t){e.diaryData.filterList.roomType[t].isSelected=!e.diaryData.filterList.roomType[t].isSelected,e.diaryData.filterList.roomType[t].isSelected?e.diaryData.selectedRoomCount++:e.diaryData.selectedRoomCount--},e.toggleFloorSelection=function(t){e.diaryData.filterList.floorList[t].isSelected=!e.diaryData.filterList.floorList[t].isSelected,e.diaryData.filterList.floorList[t].isSelected?e.diaryData.selectedFloorCount++:e.diaryData.selectedFloorCount--},e.applyCommonFilter=function(){var t=[],a=[],r=function(e){return e.forEach(function(e){e.isSelected&&t.push(e.id)}),t},o=function(e){return e.forEach(function(e){e.isSelected&&a.push(e.id)}),a},i=function(t){var a=[];return t&&!e.diaryData.isReservationSelected&&t.forEach(function(e){e.items.forEach(function(e){e.selected&&a.push(e.id)})}),a};e.diaryData.selectedRoomTypes=r(e.diaryData.filterList.roomType),e.diaryData.selectedFloors=o(e.diaryData.filterList.floorList),e.diaryData.selectedRoomFeatures=i(e.diaryData.filterList.roomFeatures),e.$emit("REFRESH_DIARY_SCREEN")};var i=function(){var t=e.diaryData.filterList.roomType,a=e.diaryData.filterList.floorList,r=e.diaryData.filterList.roomFeatures;t&&t.length>0&&t.forEach(function(e){e.isSelected=!1}),a&&a.length>0&&a.forEach(function(e){e.isSelected=!1}),r&&r.length>0&&r.forEach(function(e){e.items.forEach(function(e){e.selected=!1})}),e.diaryData.selectedRoomTypes=[],e.diaryData.selectedFloors=[],e.diaryData.selectedRoomFeatures=[],e.diaryData.selectedFloorCount=0,e.diaryData.selectedRoomCount=0,e.diaryData.selectedRoomFeaturesCount=0};e.addListener("RESET_RIGHT_FILTER_BAR",function(){i()}),e.clearCommonFilter=function(){i()},e.isShowRightFilter=function(){return window.innerWidth>1599||window.innerWidth<=1599&&"RESERVATION_FILTER"===e.diaryData.rightFilter?"visible":""};var s=function(){var t=e.diaryData.roomAssignmentFilters,o={};"MOVE_ROOM"===t.type?(o=e.currentSelectedReservation,e.diaryData.selectedUnassignedReservation={},screen.width<1600&&e.$emit("TOGGLE_FILTER_TOP","RESERVATION_FILTER")):"ASSIGN_ROOM"===t.type&&(o=e.diaryData.selectedUnassignedReservation);var i=function(a){e.errorMessage="";var i=a.rooms.length;if(0===i)r.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryNoAvailableRooms.html",className:"",scope:e,data:{warningMessage:"No Available Rooms"}}),screen.width<1600&&"ASSIGN_ROOM"===t.type&&t.count>0&&e.$emit("TOGGLE_FILTER_TOP","RESERVATION_FILTER");else{var s={availableRoomList:a.rooms,fromDate:o.arrival_date,nights:o.no_of_nights||o.number_of_nights,reservationId:o.reservation_id||o.id,reservationStatus:o.status,roomTypeId:t.roomTypeId,type:t.type,reservationOccupancy:a.reservation_occupancy};e.$emit("SHOW_ASSIGN_ROOM_SLOTS",s),e.diaryData.isReservationSelected=!1,screen.width<1600&&"ASSIGN_ROOM"===t.type&&e.$emit("TOGGLE_FILTER_TOP","UNASSIGNED_RESERVATION")}},s=function(t){e.errorMessage=t,"Suite Room Type Assigned"===t[0]&&r.open({template:"/assets/partials/nightlyDiary/rvNightlyDiarySuiteRooms.html",className:"",scope:e})},n={reservation_id:o.reservation_id||o.id,selected_room_type_ids:[t.roomTypeId],selected_room_features:t.roomFeatureIds,floor_id:t.floorId,is_from_diary:!0},l={params:n,successCallBack:i,failureCallBack:s};e.callAPI(a.retrieveAvailableRooms,l)};e.closeDialogAndRefresh=function(){e.diaryData.isAssignRoomViewActive&&e.$emit("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY"),r.close()};var n=function(){var t=e.diaryData.roomAssignmentFilters.room_features;_.each(t,function(e){_.each(e.items,function(e){e.selected=!1})}),e.diaryData.roomAssignmentFilters.roomFeatureIds=[],e.diaryData.roomAssignmentFilters.count=0},l=function(){var t=[],a=[];t=e.diaryData.isReservationSelected?e.diaryData.roomAssignmentFilters.room_features:e.diaryData.filterList.roomFeatures,_.each(t,function(e){_.each(e.items,function(e){e.selected&&a.push(e.id)})}),e.diaryData.isReservationSelected?(e.diaryData.roomAssignmentFilters.count=a.length,e.diaryData.roomAssignmentFilters.roomFeatureIds=a):(e.diaryData.selectedRoomFeatures=a,e.diaryData.selectedRoomFeaturesCount=a.length)};e.setSelectionForFeature=function(t,a){var r=[];if(r=e.diaryData.isReservationSelected?e.diaryData.roomAssignmentFilters.room_features:e.diaryData.filterList.roomFeatures,!r[t].multiple_allowed)for(var o=0;o<r[t].items.length;o++)a!==o&&(r[t].items[o].selected=!1);r[t].items[a].selected=!r[t].items[a].selected},e.clearGuestPreferenceFilter=function(){e.diaryData.roomAssignmentFilters.floorId="",n()},e.applyGuestPreferenceFilter=function(){l(),s()},e.addListener("APPLY_GUEST_PREFERENCE_FILTER",function(){l(),s()}),o()}]),angular.module("sntRover").controller("rvNightlyDiaryRoomNumberSearchController",["$scope","$filter","$rootScope","RVNightlyDiaryRoomNumberSearchSrv",function(e,t,a,r){BaseCtrl.call(this,e);var o=function(){BaseCtrl.call(this,e),e.diaryData.textInQueryBox="",e.diaryData.totalRoomNumberSearchResults=0,e.diaryData.showSearchResultsArea=!1,e.diaryData.roomNumberSearchResults=[]},i=null,s=function(t){e.$emit("hideLoader"),e.diaryData.roomNumberSearchResults=t.rooms,e.diaryData.totalRoomNumberSearchResults=t.total_count},n=function(t){e.errorMessage=t},l=function(){var t={};t.query=e.diaryData.textInQueryBox.trim(),e.invokeApi(r.fetchRoomSearchResults,t,s,n)};o(),e.clearResults=function(){e.diaryData.textInQueryBox="",e.diaryData.showSearchResultsArea=!1,e.diaryData.roomNumberSearchResults=[],e.diaryData.totalRoomNumberSearchResults=0},e.queryEntered=function(){a.isSingleDigitSearch||e.diaryData.textInQueryBox.length>2?(e.diaryData.showSearchResultsArea=!0,null!==i&&clearTimeout(i),i=setTimeout(function(){0!==e.diaryData.textInQueryBox.length?l():e.$apply(function(){e.diaryData.showSearchResultsArea=!1,e.diaryData.roomNumberSearchResults=[],e.diaryData.totalRoomNumberSearchResults=0})},800)):(e.diaryData.showSearchResultsArea=!1,e.diaryData.roomNumberSearchResults=[],e.diaryData.totalRoomNumberSearchResults=0)},e.addListener("CLOSE_SEARCH_RESULT",function(){e.clearResults()})}]),angular.module("sntRover").controller("rvNightlyDiaryRoomNumberSearchResultController",["$scope","$filter",function(e,t){BaseCtrl.call(this,e),e.gotoSelectedRoom=function(t){e.$emit("UPDATE_RESERVATIONLIST",t.id),e.diaryData.reservationSearchResults=[]}}]),sntRover.controller("rvNightlyDiarySetTimePopupCtrl",["$scope","ngDialog","rvUtilSrv",function(e,t,a){var r=function(){e.setTimePopupData.selectedArrivalTime=e.setTimePopupData.data.min_arrival_time,e.setTimePopupData.selectedDepartureTime=e.setTimePopupData.data.max_departure_time,e.setTimePopupData.arrivalTimeList=a.generateTimeDuration(e.setTimePopupData.data.min_arrival_time,null),e.setTimePopupData.departureTimeList=a.generateTimeDuration(null,e.setTimePopupData.data.max_departure_time)};e.saveAndContinueClicked=function(){var t=e.setTimePopupData,a={};a={arrival_time:t.selectedArrivalTime,departure_time:t.selectedDepartureTime},e.$emit("SET_TIME_AND_SAVE",a)},e.closeSetTimePopup=function(){t.close()},r()}]),angular.module("sntRover").controller("rvNightlyDiaryTopEditBarController",["$scope","$state","RVNightlyDiarySrv","ngDialog",function(e,t,a,r){BaseCtrl.call(this,e),e.cancelEditReservation=function(){e.$emit("CANCEL_RESERVATION_EDITING"),e.diaryData.isReservationSelected=!1},e.closeDialogAndRefresh=function(){e.$emit("CANCEL_RESERVATION_EDITING"),r.close()},e.saveEditedReservation=function(){e.$emit("SAVE_RESERVATION_EDITING")},e.goToStayCard=function(r,o){var i=a.getCache();i.currentSelectedReservationId=r.id,i.currentSelectedRoomId=o.id,i.currentSelectedReservation=r,i.filterList=e.diaryData.filterList,i.selectedRoomCount=e.diaryData.selectedRoomCount,i.selectedFloorCount=e.diaryData.selectedFloorCount,i.hideRoomType=e.diaryData.hideRoomType,i.hideFloorList=e.diaryData.hideFloorList,i.selected_floor_ids=e.diaryData.selectedFloors,i.selected_room_type_ids=e.diaryData.selectedRoomTypes,i.unassignedReservationList=e.diaryData.unassignedReservationList,a.updateCache(i),t.go("rover.reservation.staycard.reservationcard.reservationdetails",{id:r.id,confirmationId:r.confirm_no,isrefresh:!0})},e.moveRoomButtonClick=function(){e.diaryData.isReservationSelected=!0,e.diaryData.roomAssignmentFilters={};var t=function(t){e.diaryData.roomAssignmentFilters=t.data,e.diaryData.roomAssignmentFilters.roomTypeId=_.findWhere(e.diaryData.diaryRoomsList,{id:e.diaryData.selectedRoomId}).room_type_id,e.diaryData.roomAssignmentFilters.floorId="",e.diaryData.roomAssignmentFilters.roomFeatureIds=[],e.diaryData.roomAssignmentFilters.type="MOVE_ROOM",e.$emit("APPLY_GUEST_PREFERENCE_FILTER_TOP")},r=function(t){e.$emit("SHOW_ERROR_MESSAGE",t[0])},o={reservation_id:e.currentSelectedReservation.id},i={params:o,successCallBack:t,failureCallBack:r};e.callAPI(a.getPreferences,i)},e.cancelMoveRoomButtonClick=function(){e.diaryData.isCancelledMoveOrAssign=!0,e.diaryData.isReservationSelected=!1,e.$emit("HIDE_ASSIGN_ROOM_SLOTS")},e.unAssignRoomButtonClick=function(){var t=function(){e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST","REFRESH"),e.$emit("UPDATE_RESERVATIONLIST")},r=function(t){return t.httpStatus&&470===t.httpStatus?void e.$emit("REFRESH_AUTO_ASSIGN_STATUS"):void e.$emit("SHOW_ERROR_MESSAGE",t[0])},o={id:e.currentSelectedReservation.id,is_from_diary:!0},i={params:o,successCallBack:t,failureCallBack:r};e.callAPI(a.unAssignRoom,i)},e.addListener("TRIGGER_MOVE_ROOM",function(){e.moveRoomButtonClick()}),e.cancelEditUnassignedReservation=function(){e.$emit("CANCEL_UNASSIGNED_RESERVATION_MAIN")}}]),angular.module("sntRover").controller("rvNightlyDiaryTopFilterBarController",["$scope","$rootScope","$state","$stateParams","$filter","ngDialog","rvUtilSrv","rvPermissionSrv",function(e,t,a,r,o,i,s,n){BaseCtrl.call(this,e);var l=!1,u=15,c=function(e,t,a,r){var i=tzIndependentDate(e);return r&&(t-=1),a?i.setDate(i.getDate()+t):i.setDate(i.getDate()-t),i=o("date")(i,"yyyy-MM-dd")},d=function(){var t=tzIndependentDate(e.diaryData.fromDate),a=tzIndependentDate(e.diaryData.toDate),r=!1;if(t.getMonth()!==a.getMonth()&&(r=!0,21===e.diaryData.numberOfDays)){var o=!1;e.diaryData.firstMonthDateList=[],e.diaryData.secondMonthDateList=[],angular.forEach(e.diaryData.datesGridData,function(t){var a=tzIndependentDate(t.date);1===a.getDate()&&(o=!0),o?e.diaryData.secondMonthDateList.push(t):e.diaryData.firstMonthDateList.push(t)})}return r},m=function(){e.diaryData.fromDate=o("date")(tzIndependentDate(e.diaryData.fromDate),"yyyy-MM-dd"),e.diaryData.toDate=c(e.diaryData.fromDate,e.diaryData.numberOfDays,!0,!0),e.diaryData.firstMonthDateList=[],e.diaryData.secondMonthDateList=[],e.diaryData.hasMultipleMonth=!1,e.diaryData.rightFilter="RESERVATION_FILTER"},v=function(){var a=e.diaryData.bookRoomViewFilter;t.businessDate>e.diaryData.fromDate?a.fromDate=t.businessDate:a.fromDate=e.diaryData.fromDate,a.toDate=moment(tzIndependentDate(a.fromDate)).add(1,"days").format(t.momentFormatForAPI),a.arrivalTimeList=s.generateTimeDuration(),a.departureTimeList=s.generateTimeDuration(),a.arrivalTime=a.hotelCheckinTime,a.departureTime=a.hotelCheckoutTime,e.diaryData.rightFilter="RESERVATION_FILTER"};e.clickedDatePicker=function(t){e.clickedFrom=t,i.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryDatePicker.html",controller:"RVNightlyDiaryTopFilterDatePickerController",className:"single-date-picker",scope:e})},e.addListener("DATE_CHANGED",function(a,r){var o=e.diaryData.bookRoomViewFilter;if("MAIN_FILTER"===r){var i=!0;7===e.diaryData.numberOfDays?e.diaryData.toDate=c(e.diaryData.fromDate,7,i,!0):e.diaryData.toDate=c(e.diaryData.fromDate,21,i,!0),e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST"),e.$emit("UPDATE_RESERVATIONLIST"),e.$emit("UPDATE_EVENTS_COUNT"),l=!0;var n=moment(t.businessDate).diff(moment(e.diaryData.fromDate),"days");e.diaryData.isBookRoomViewActive&&n>6&&e.toggleBookedOrAvailable()}else o.fromDate===o.toDate?(o.arrivalTime="09:00",o.departureTime="17:00",o.arrivalTimeList=s.generateTimeDuration(null,o.departureTime,u*-1),o.departureTimeList=s.generateTimeDuration(o.arrivalTime,null,u)):"BOOK_FILTER_ARRIVAL"!==r&&"BOOK_FILTER_DEPARTURE"!==r||(o.arrivalTime!==o.hotelCheckinTime&&(o.arrivalTime=o.hotelCheckinTime),o.departureTime!==o.hotelCheckoutTime&&(o.departureTime=o.hotelCheckoutTime),o.arrivalTimeList=s.generateTimeDuration(),o.departureTimeList=s.generateTimeDuration())}),e.addListener("FETCH_COMPLETED_DATE_LIST_DATA",function(){e.diaryData.hasMultipleMonth=d()}),e.toggleSwitchMode=function(){var t=!0;21===e.diaryData.numberOfDays?(e.diaryData.toDate=c(e.diaryData.fromDate,7,t,!0),e.diaryData.numberOfDays=7):(e.diaryData.toDate=c(e.diaryData.fromDate,21,t,!0),e.diaryData.numberOfDays=21),e.$emit("UPDATE_EVENTS_COUNT"),e.$emit("UPDATE_RESERVATIONLIST")};var p=function(t){var a=angular.copy(tzIndependentDate(e.diaryData.fromDate)),r=t;t||(r=!0),7===e.diaryData.numberOfDays?(e.diaryData.fromDate=c(a,7,t,!1),e.diaryData.toDate=c(e.diaryData.fromDate,7,r,!0)):(e.diaryData.fromDate=c(a,21,t,!1),e.diaryData.toDate=c(e.diaryData.fromDate,21,r,!0)),l=!0};e.clickedDateLeftShift=function(){var t=!1;p(t),e.$emit("UPDATE_EVENTS_COUNT"),e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST"),e.$emit("UPDATE_RESERVATIONLIST")},e.clickedDateRightShift=function(){var t=!0;p(t),e.$emit("UPDATE_EVENTS_COUNT"),e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST"),e.$emit("UPDATE_RESERVATIONLIST")},e.clickedResetButton=function(){e.diaryData.fromDate=moment(tzIndependentDate(t.businessDate)).subtract(1,"days").format(t.momentFormatForAPI),m(),e.$emit("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY"),e.$emit("UPDATE_UNASSIGNED_RESERVATIONLIST","RESET"),e.$emit("HIDE_ASSIGN_ROOM_SLOTS"),e.diaryData.showBookFilterPanel&&e.diaryData.isBookRoomViewActive&&e.toggleBookedOrAvailable()},e.toggleFilter=function(t){var a=e.diaryData.selectedRoomTypes.length>0||e.diaryData.selectedFloors.length>0;a&&e.diaryData.rightFilter!==t&&"UNASSIGNED_RESERVATION"===t&&!e.diaryData.isReservationSelected?e.$emit("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY"):"RESERVATION_FILTER"===t&&e.diaryData.isAssignRoomViewActive&&!e.diaryData.isReservationSelected&&e.$emit("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY"),window.innerWidth<1280&&e.diaryData.rightFilter===t?e.diaryData.rightFilter="":e.diaryData.rightFilter!==t&&(e.diaryData.rightFilter=t)},e.addListener("TOGGLE_FILTER",function(t,a){e.toggleFilter(a)}),e.toggleHourlyNightly=!1,e.navigateToHourlyDiary=function(){var r=e.diaryData.fromDate,o=moment(tzIndependentDate(t.businessDate)).subtract(1,"days").format(t.momentFormatForAPI);e.diaryData.fromDate!==o||l||(r=t.businessDate),a.go("rover.diary",{checkin_date:r,origin:"NIGHTLY_DIARY"}),e.toggleHourlyNightly=!0},e.hideToggleMenu=function(){var e=t.hotelDiaryConfig,a=!1;return e.dayUseEnabled||(a=!0),a};var _=function(){return n.getPermissionValue("CREATE_RESERVATION")};e.disableAvlToggle=function(){var a=!1,r=moment(t.businessDate).diff(moment(e.diaryData.fromDate),"days");return(!e.diaryData.isBookRoomViewActive&&r>6||!_())&&(a=!0),a},e.disableLeftDateShift=function(){var a=!1,r=moment(t.businessDate).diff(moment(e.diaryData.fromDate),"days");return e.diaryData.isBookRoomViewActive&&r>=0&&(a=!0),a},e.toggleBookedOrAvailable=function(){e.diaryData.showBookFilterPanel=!e.diaryData.showBookFilterPanel,e.diaryData.showBookFilterPanel&&v(),e.diaryData.isBookRoomViewActive&&(e.diaryData.isBookRoomViewActive=!e.diaryData.isBookRoomViewActive,e.$emit("TOGGLE_BOOK_AVAILABLE"))},e.clickedFindRooms=function(){e.diaryData.isBookRoomViewActive=!0,e.diaryData.bookRoomViewFilter.nights=moment(e.diaryData.bookRoomViewFilter.toDate).diff(moment(e.diaryData.bookRoomViewFilter.fromDate),"days"),e.$emit("TOGGLE_BOOK_AVAILABLE")},e.arrivalTimeChanged=function(){var t=e.diaryData.bookRoomViewFilter;t.fromDate===t.toDate&&(t.departureTimeList=s.generateTimeDuration(t.arrivalTime,null,u))},e.departureTimeChanged=function(){var t=e.diaryData.bookRoomViewFilter;t.fromDate===t.toDate&&(t.arrivalTimeList=s.generateTimeDuration(null,t.departureTime,u*-1))},e.checkForResFilterActiveClass=function(){return window.innerWidth>=1280&&window.innerWidth<=1599&&""===e.diaryData.rightFilter&&(e.diaryData.rightFilter="RESERVATION_FILTER"),window.innerWidth>1599||"RESERVATION_FILTER"===e.diaryData.rightFilter},e.checkForUnassignedResActiveClass=function(){return window.innerWidth>1599||"UNASSIGNED_RESERVATION"===e.diaryData.rightFilter},m()}]),sntRover.controller("RVNightlyDiaryTopFilterDatePickerController",["$scope","$rootScope","ngDialog",function(e,t,a){var r="",o="",i=92;"MAIN_FILTER"===e.clickedFrom?e.date=e.diaryData.fromDate:"BOOK_FILTER_ARRIVAL"===e.clickedFrom?(e.date=e.diaryData.bookRoomViewFilter.fromDate,r=tzIndependentDate(e.diaryData.fromDate)>tzIndependentDate(t.businessDate)?tzIndependentDate(e.diaryData.fromDate):tzIndependentDate(t.businessDate),o=tzIndependentDate(e.diaryData.toDate)):"BOOK_FILTER_DEPARTURE"===e.clickedFrom&&(e.date=e.diaryData.bookRoomViewFilter.toDate,r=e.diaryData.bookRoomViewFilter.fromDate,o=moment(tzIndependentDate(e.diaryData.bookRoomViewFilter.fromDate)).add(i,"days").format(t.momentFormatForAPI)),e.setUpData=function(){e.dateOptions={changeYear:!0,changeMonth:!0,minDate:tzIndependentDate(r),maxDate:tzIndependentDate(o),yearRange:"-100:+5",onSelect:function(){"MAIN_FILTER"===e.clickedFrom?e.diaryData.fromDate=e.date:"BOOK_FILTER_ARRIVAL"===e.clickedFrom?(e.diaryData.bookRoomViewFilter.fromDate=e.date,e.diaryData.bookRoomViewFilter.toDate=moment(tzIndependentDate(e.date)).add(1,"days").format(t.momentFormatForAPI)):"BOOK_FILTER_DEPARTURE"===e.clickedFrom&&(e.diaryData.bookRoomViewFilter.toDate=e.date),e.$emit("DATE_CHANGED",e.clickedFrom),a.close()}}},e.setUpData()}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};angular.module("sntRover").controller("rvNightlyDiaryUnassignedListController",["$scope","$rootScope","RVNightlyDiarySrv","ngDialog",function(e,t,a,r){BaseCtrl.call(this,e),e.diaryData.selectedUnassignedReservation={},e.businessDate=t.businessDate,e.searchQuery="";var o=angular.copy(e.diaryData.unassignedReservationList.reservations),i=function(t){e.diaryData.isEditReservationMode&&"UNASSIGNED_RESERVATION"!==e.currentSelectedReservation.type&&e.$emit("CANCEL_RESERVATION_EDITING"),e.diaryData.isReservationSelected=!0,e.diaryData.selectedUnassignedReservation=t,e.diaryData.roomAssignmentFilters={};var r=function(a){e.diaryData.roomAssignmentFilters=a.data,e.diaryData.roomAssignmentFilters.roomTypeId=t.room_type_id,e.diaryData.roomAssignmentFilters.floorId="",e.diaryData.roomAssignmentFilters.roomFeatureIds=[],e.diaryData.roomAssignmentFilters.type="ASSIGN_ROOM",e.$emit("APPLY_GUEST_PREFERENCE_FILTER_TOP")},o={reservation_id:t.reservation_id},i={params:o,successCallBack:r};e.callAPI(a.getPreferences,i)},s=function(){e.diaryData.selectedUnassignedReservation={},e.diaryData.isReservationSelected=!1,e.diaryData.isCancelledMoveOrAssign=!0,e.$emit("RESET_RIGHT_FILTER_BAR_AND_REFRESH_DIARY")};e.clickedUnassignedItem=function(t){var a=e.diaryData.unassignedReservationList.reservations[t];if(a.reservation_id===e.diaryData.selectedUnassignedReservation.reservation_id)s();else{i(a);var r=_extends({},a,{id:a.reservation_id,guest_details:{full_name:a.fullName,image:""},type:"UNASSIGNED_RESERVATION"});e.$emit("CLICKED_UNASSIGNED_RESERVATION",r)}},e.addListener("SUCCESS_ROOM_ASSIGNMENT",function(){var t=e.diaryData.unassignedReservationList.reservations;t=_.reject(t,function(t){return t.reservation_id===e.diaryData.selectedUnassignedReservation.reservation_id}),e.diaryData.unassignedReservationList.reservations=[],e.diaryData.unassignedReservationList.reservations=t,
e.diaryData.selectedUnassignedReservation={},o=angular.copy(t),e.$emit("HIDE_ASSIGN_ROOM_SLOTS"),e.$emit("CANCEL_UNASSIGNED_RESERVATION_MAIN")});var n=function(t){var r=function(a){if(e.errorMessage="",e.diaryData.unassignedReservationList=a,o=angular.copy(a.reservations),e.searchQuery="",t){var r=e.diaryData.unassignedReservationList.reservations,s=_.find(r,function(e){return e.reservation_id===t});s?i(s):(e.diaryData.selectedUnassignedReservation={},e.diaryData.isReservationSelected=!1,e.$emit("CANCEL_RESERVATION_EDITING"))}},s={date:e.diaryData.arrivalDate},n={params:s,successCallBack:r};e.callAPI(a.fetchUnassignedReservationList,n)};e.addListener("RESET_UNASSIGNED_LIST_SELECTION",function(){e.diaryData.selectedUnassignedReservation={},e.diaryData.isReservationSelected=!1}),e.addListener("FETCH_UNASSIGNED_LIST_DATA",function(){n()}),e.addListener("UNASSIGNED_LIST_DATE_CHANGED",function(){n(),e.diaryData.isAssignRoomViewActive&&s()}),e.clickedDatePicker=function(){r.open({template:"/assets/partials/nightlyDiary/rvNightlyDiaryDatePicker.html",controller:"RVNightlyDiaryUnassignedListDatePickerController",className:"single-date-picker",scope:e})},e.clickedDateLeftShift=function(){e.diaryData.arrivalDate=moment(tzIndependentDate(e.diaryData.arrivalDate)).subtract(1,"days").format(t.momentFormatForAPI),n(),e.diaryData.isAssignRoomViewActive&&s()},e.clickedDateRightShift=function(){e.diaryData.arrivalDate=moment(tzIndependentDate(e.diaryData.arrivalDate)).add(1,"days").format(t.momentFormatForAPI),n(),e.diaryData.isAssignRoomViewActive&&s()},e.isShowUnassignedList=function(){return window.innerWidth>1599||window.innerWidth<=1599&&"UNASSIGNED_RESERVATION"===e.diaryData.rightFilter?"visible":""},e.addListener("SELECT_UNASSIGNED_RESERVATION",function(t,a,r){e.diaryData.arrivalDate=r,n(a)}),e.addListener("CANCEL_UNASSIGNED_RESERVATION",function(){s()}),e.searchUnassignedList=function(){var t=[];e.searchQuery&&e.searchQuery.length>0?(t=o.filter(function(t){var a=isNaN(e.searchQuery)&&t.fullName.toUpperCase().includes(e.searchQuery.toUpperCase())||!isNaN(e.searchQuery)&&t.confirm_no.toString().includes(e.searchQuery);return a}),e.diaryData.unassignedReservationList.reservations=t):n()},e.initiateAutoAssign=function(){e.$emit("INITIATE_AUTO_ASSIGN")},e.enableAutoAssign=function(){return"FULL"!==t.hotelDiaryConfig.mode&&!_.isEmpty(e.diaryData.unassignedReservationList)&&0!==e.diaryData.unassignedReservationList.reservations.length},e.clearQuery=function(){e.searchQuery="",e.searchUnassignedList()}}]),sntRover.controller("RVNightlyDiaryUnassignedListDatePickerController",["$scope","$rootScope","ngDialog",function(e,t,a){var r=e.diaryData.fromDate<t.businessDate?t.businessDate:e.diaryData.fromDate,o=e.diaryData.toDate;e.date=e.diaryData.arrivalDate,e.setUpData=function(){e.dateOptions={changeYear:!0,changeMonth:!0,minDate:tzIndependentDate(r),maxDate:tzIndependentDate(o),onSelect:function(){e.diaryData.arrivalDate=e.date,e.$emit("UNASSIGNED_LIST_DATE_CHANGED"),a.close()}}},e.setUpData()}]),sntRover.controller("rvNightlyDiaryValidationStayCtrl",["$scope","rvPermissionSrv",function(e,t){var a=function(){return t.getPermissionValue("OVERBOOK_HOUSE")},r=function(){return t.getPermissionValue("OVERBOOK_ROOM_TYPE")},o=function(){var t=!e.popupData.data.is_house_available,o=!e.popupData.data.is_room_type_available,i=a(),s=r(),n=i&&s,l="";return l=t&&o&&n?"HOUSE_AND_ROOMTYPE_OVERBOOK":o&&s&&(!t||t&&i)?"ROOMTYPE_OVERBOOK":t&&i&&(!o||o&&s)?"HOUSE_OVERBOOK":"NO_PERMISSION_TO_OVERBOOK"};e.popupData.showOverBookingButton&&(e.popupData.disableOverBookingButton="NO_PERMISSION_TO_OVERBOOK"===o()),e.clickedOverBookButton=function(){e.$emit("SAVE_RESERVATION_EDITING")}}]),angular.module("sntRover").controller("rvDiaryRoomStatusAndServiceUpdatePopupCtrl",["$scope","$rootScope","ngDialog","RVHkRoomStatusSrv","RVHkRoomDetailsSrv","$timeout","$filter","rvUtilSrv",function(e,t,a,r,o,i,s,n){BaseCtrl.call(this,e);var l="roomStatusServiceUpdateScroller",u=15,c=12,d=1,m="FULL"===n.getDiaryMode();e.closeDialog=function(){a.close()},e.setActiveSection=function(t){e.currentActiveSection=t,"service"===t&&i(function(){e.refreshScroller(l)},1e3)},e.getClassNameByHkStatus=function(e,a){var r="";return"IN_SERVICE"!==a?r="unavailable":"CLEAN"===e&&t.useInspectedRoomStatus?r="clean not-inspected":"CLEAN"!==e||t.useInspectedRoomStatus?"INSPECTED"===e?r="inspected":"DIRTY"===e?r="dirty":"PICKUP"===e?r="pickup":"DO_NOT_DISTURB"===e&&(r="dnd"):r="clean",r};var v=function(t){var a=_.find(e.hkStatusList,{value:t});return a&&a.id||""},p=function(){e.callAPI(r.fetchHkStatusList,{onSuccess:function(a){e.hkStatusList=a,t.isStandAlone&&!m&&e.roomInfo.is_occupied||(e.hkStatusList=_.reject(e.hkStatusList,function(e){return"DO_NOT_DISTURB"===e.value})),e.returnStatusList=_.reject(e.hkStatusList,function(e){return"DO_NOT_DISTURB"===e.value})}}),e.callAPI(o.fetchAllServiceStatus,{onSuccess:function(t){e.serviceList=t,d=_.find(e.serviceList,{value:"IN_SERVICE"}).id}})},f=function(){e.callAPI(o.fetchMaintenanceReasons,{onSuccess:function(t){e.maintenanceReasonsList=t}})},D=function(a,r,i){e.callAPI(o.fetchRoomStatus,{params:{room_id:e.roomInfo.id,year:a,month:r},onSuccess:function(a){if(angular.extend(e.serviceStatus,a.service_status),!i){var r=e.serviceStatus[y(tzIndependentDate(t.businessDate))];e.serviceStatusDetails.room_service_status_id=r.id,e.serviceStatusDetails.reason_id=r.maintenance_reason_id||"",e.serviceStatusDetails.comment=r.comments,e.serviceStatusDetails.return_status_id=r.return_status_id||""}!angular.isUndefined(i)&&i.id?$("#"+i.id).datepicker("refresh"):$(".ngmodal-uidate-wrap").datepicker("refresh")}})},h=function(){e.setClass=function(t){return[!0,e.serviceStatus[s("date")(tzIndependentDate(t),"yyyy-MM-dd")]&&e.serviceStatus[s("date")(tzIndependentDate(t),"yyyy-MM-dd")].id>1?"room-out":""]};var a={dateFormat:t.jqDateFormat,numberOfMonths:1,changeYear:!0,changeMonth:!0,beforeShow:function(){$("#ui-datepicker-div").addClass("reservation hide-arrow"),$('<div id="ui-datepicker-overlay">').insertAfter("#ui-datepicker-div"),setTimeout(function(){$("body").find("#ui-datepicker-overlay").on("click",function(){$("#room-out-from").blur(),$("#room-out-to").blur()})},100)},onClose:function(){$("#ui-datepicker-div").removeClass("reservation hide-arrow"),$("#ui-datepicker-overlay").off("click").remove()}},r=function(){tzIndependentDate(e.serviceStatusDetails.from_date)>tzIndependentDate(e.serviceStatusDetails.to_date)&&(e.serviceStatusDetails.to_date=s("date")(tzIndependentDate(e.serviceStatusDetails.from_date),"yyyy-MM-dd")),e.untilDateOptions.minDate=s("date")(tzIndependentDate(e.serviceStatusDetails.from_date),t.dateFormat)};e.fromDateOptions=angular.extend({minDate:s("date")(t.businessDate,t.dateFormat),onSelect:r,beforeShowDay:e.setClass,onChangeMonthYear:function(e,t,a){D(e,t,a)}},a),e.untilDateOptions=angular.extend({minDate:s("date")(t.businessDate,t.dateFormat),onSelect:r,beforeShowDay:e.setClass,onChangeMonthYear:function(e,t,a){D(e,t,a)}},a)},y=function(e){return s("date")(new tzIndependentDate(e),t.dateFormatForAPI)};e.isRoomStatusSectionActive=function(){return"room"===e.currentActiveSection},e.updateRoomStatus=function(t){e.callAPI(o.updateHKStatus,{params:{room_no:t,hkstatus_id:v(e.statusInfo.hkStatus)},onSuccess:function(){e.$emit("REFRESH_DIARY_ROOMS_AND_RESERVATIONS",e.roomInfo.room_id),e.closeDialog()},onFailure:function(t){e.errorMessage=t}})},e.isInService=function(){return e.serviceStatusDetails.room_service_status_id===d},e.onServiceStatusChange=function(){e.refreshScroller(l)},e.shouldShowTimeSelector=function(){return(t.isHourlyRateOn||"FULL"===t.hotelDiaryConfig.mode)&&!e.isInService()},e.updateServiceStatus=function(){var t=function(){e.$emit("REFRESH_DIARY_ROOMS_AND_RESERVATIONS",e.roomInfo.room_id),e.closeDialog()},a={from_date:y(e.serviceStatusDetails.from_date),to_date:y(e.serviceStatusDetails.to_date),begin_time:"",end_time:"",reason_id:e.serviceStatusDetails.reason_id,comment:e.serviceStatusDetails.comment,room_service_status_id:e.serviceStatusDetails.room_service_status_id,return_status_id:e.serviceStatusDetails.return_status_id};e.shouldShowTimeSelector()&&(a.begin_time=e.serviceStatusDetails.begin_time,a.end_time=e.serviceStatusDetails.end_time),a.room_id=e.roomInfo.id,e.invokeApi(o.postRoomServiceStatus,a,t)};var R=function(){e.currentActiveSection="room",e.roomInfo=e.ngDialogData,e.serviceStatusDetails={comment:"",reason_id:"",end_time:"",begin_time:"",room_service_status_id:"",from_date:tzIndependentDate(t.businessDate),to_date:tzIndependentDate(t.businessDate)},e.statusInfo={hkStatus:e.roomInfo.hk_status,serviceStatus:e.roomInfo.service_status||e.roomInfo.room_service_status},e.todayDate=tzIndependentDate(t.businessDate),p(),f(),D(tzIndependentDate(t.businessDate).getFullYear(),tzIndependentDate(t.businessDate).getMonth()),h(),e.setScroller(l),e.timeSelectorList=n.getListForTimeSelector(u,c),e.serviceStatus={}};R()}]);var _Redux=Redux,createStore=_Redux.createStore,applyMiddleware=_Redux.applyMiddleware,compose=_Redux.compose,finalCreateStore=compose(applyMiddleware(ReduxThunk.default),window.devToolsExtension?window.devToolsExtension():function(e){return e})(createStore),configureDiaryStore=function(e){return finalCreateStore(nightlyDiaryRootReducer,e)},NIGHTLY_DIARY_CONST={RESERVATION_ROW_WIDTH:840,DAYS_7:7,DAYS_21:21,DAYS_POSITION_ADD_7:15,DAYS_POSITION_ADD_21:10,DAYS_7_OFFSET:15,EXTEND_7_DAYS:10,EXTEND_21_DAYS:5,PADDING:5},callBackReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case"DIARY_VIEW_CHANGED":return t.callBackFromAngular;case"RESERVATION_SELECTED":return e.callBackFromAngular;default:return e.callBackFromAngular}},nightlyDiaryReservationsListReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case"DIARY_VIEW_CHANGED":case"RESERVATION_SELECTED":return t.reservationsList;default:return e.reservationsList}},nightlyDiaryRoomsListReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case"DIARY_VIEW_CHANGED":return t.roomsList;default:return e.roomsList}},nightlyDiaryRootReducer=function(e,t){return{roomsList:nightlyDiaryRoomsListReducer(e,t),reservationsList:nightlyDiaryReservationsListReducer(e,t),diaryInitialDayOfDateGrid:"DIARY_VIEW_CHANGED"===t.type?t.diaryInitialDayOfDateGrid:e.diaryInitialDayOfDateGrid,numberOfDays:"DIARY_VIEW_CHANGED"===t.type?t.numberOfDays:e.numberOfDays,currentBusinessDate:"DIARY_VIEW_CHANGED"===t.type?t.currentBusinessDate:e.currentBusinessDate,isAssignRoomViewActive:t.isAssignRoomViewActive,isMoveRoomViewActive:t.isMoveRoomViewActive,availableSlotsForAssignRooms:t.availableSlotsForAssignRooms,isBookRoomViewActive:t.isBookRoomViewActive,availableSlotsForBookRooms:t.availableSlotsForBookRooms,callBackFromAngular:callBackReducer(e,t),paginationData:paginationDataReducer(e,t),selectedReservationId:"RESERVATION_SELECTED"===t.type||"CANCEL_RESERVATION_EDITING"===t.type?t.selectedReservationId:e.selectedReservationId,currentSelectedReservation:"RESERVATION_SELECTED"===t.type||"CANCEL_RESERVATION_EDITING"===t.type?t.currentSelectedReservation:e.currentSelectedReservation,selectedRoomId:"DIARY_VIEW_CHANGED"===t.type||"RESERVATION_SELECTED"===t.type?t.selectedRoomId:e.selectedRoomId,isFromStayCard:e.isFromStayCard,dateFormat:e.dateFormat,newArrivalPosition:"EXTEND_SHORTEN_RESERVATION"===t.type?t.newArrivalPosition:"",newDeparturePosition:"EXTEND_SHORTEN_RESERVATION"===t.type?t.newDeparturePosition:"",isPmsProductionEnvironment:e.isPmsProductionEnvironment,diaryMode:e.diaryMode}},paginationDataReducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];switch(t.type){case"DIARY_VIEW_CHANGED":return t.paginationData;case"CANCEL_RESERVATION_EDITING":return t.paginationData;default:return e.paginationData}},GoToNextPageButtonComponent=function(e){var t=e.goToNextButtonClicked,a=e.nextPageItemCount;return React.createElement("div",{className:"grid-pagination bottom"},React.createElement("button",{type:"button",className:"button blue",onClick:function(e){return t(e)}},"Next "+a+" Rooms"))},_React=React,PropTypes=_React.PropTypes;GoToNextPageButtonComponent.propTypes={goToNextButtonClicked:PropTypes.func,NextPageItemCount:PropTypes.number};var GoToPreviousPageButtonComponent=function(e){var t=e.goToPrevButtonClicked,a=e.perPage;return React.createElement("div",{className:"grid-pagination top"},React.createElement("button",{type:"button",className:"button blue",onClick:function(e){return t(e)}},"Prev "+a+" Rooms"))},_React=React,PropTypes=_React.PropTypes;GoToPreviousPageButtonComponent.propTypes={goToPrevButtonClicked:PropTypes.func,perPage:PropTypes.number};var _React=React,createClass=_React.createClass,NightlyDiaryAssignRoomComponent=createClass({getStyles:function(){var e=this.props.uar_data.style.width,t=this.props.uar_data.style.transform,a={width:e,transform:t};return a},render:function(){var e=this;return React.createElement("div",{style:this.getStyles(),className:"reservation unassigned",onClick:function(){return e.props.assignRoom(e.props.roomDetails,e.props.availableSlotsForAssignRooms)}},React.createElement("div",{className:"reservation-data"},"ASSIGN",React.createElement("span",{className:"name"},this.props.roomDetails.room_number)))}}),_React=React,createClass=_React.createClass,NightlyDiaryBookRoomComponent=createClass({getStyles:function(){var e=this.props.uar_data.style.width,t=this.props.uar_data.style.transform,a={width:e,transform:t};return a},getClassName:function(){var e="reservation unassigned ";return"OVERBOOK"===this.props.type?e+="overbook":"OVERBOOK_DISABLED"===this.props.type&&(e+="overbook-disabled disable-element"),e},getButtonName:function(){var e="OVERBOOK";return"BOOK"===this.props.type&&(e="BOOK"),e},render:function(){var e=this;return React.createElement("div",{style:this.getStyles(),className:this.getClassName(),onClick:function(){return e.props.bookRoom(e.props.roomDetails,e.props.roomTypeDetails,e.props.type)}},React.createElement("div",{className:"reservation-data"},React.createElement("span",{className:"name"},this.getButtonName()," ",this.props.roomDetails.room_no)))}}),_React=React,createClass=_React.createClass,NightlyDiaryHourlyComponent=createClass({render:function(){return React.createElement("div",{style:{width:this.props.hourly_data.style.width,transform:this.props.hourly_data.style.transform},className:this.props.hourly_data.reservationClass},React.createElement("div",{className:"reservation-data"},React.createElement("span",{className:"day-stay-icon"})))}}),_React=React,createClass=_React.createClass,NightlyDiaryMoveRoomComponent=createClass({getStyles:function(){var e=this.props.uar_data.style.width,t=this.props.uar_data.style.transform,a={width:e,transform:t};return a},render:function(){var e=this;return React.createElement("div",{style:this.getStyles(),className:"reservation unassigned",onClick:function(){return e.props.moveRoom(e.props.roomDetails,e.props.availableSlotsForAssignRooms)}},React.createElement("div",{className:"reservation-data"},"MOVE TO",React.createElement("span",{className:"name"},this.props.roomDetails.room_number)))}}),isRoomAvailable=function(e,t,a){var r=[],o=[],i=!1,s={},n={},l="BOOK",u=t.diaryMode,c={},d=function(){var e=c.house_availability<=0&&c.unassigned_reservations_present,a=n.availability<=0&&n.unassigned_reservations_present,r=t.availableSlotsForBookRooms.canOverbookHouse,o=t.availableSlotsForBookRooms.canOverbookRoomType,i=r&&o,s="";return s=e&&a&&i?"HOUSE_AND_ROOMTYPE_OVERBOOK":a&&o&&(!e||e&&r)?"ROOMTYPE_OVERBOOK":e&&r&&(!a||a&&o)?"HOUSE_OVERBOOK":"NO_PERMISSION_TO_OVERBOOK"};return"BOOK"===a?(r=t.availableSlotsForBookRooms.rooms,o=t.availableSlotsForBookRooms.room_types,c=t.availableSlotsForBookRooms.house):"ASSIGN"!==a&&"MOVE"!==a||(r=t.availableSlotsForAssignRooms.availableRoomList),r.forEach(function(t){t.room_id===e&&(i=!0,s=t)}),i&&"ASSIGN"===a?React.createElement(NightlyDiaryAssignRoomContainer,{roomDetails:s}):i&&"MOVE"===a?React.createElement(NightlyDiaryMoveRoomContainer,{roomDetails:s}):!(!i||"BOOK"!==a)&&(o.forEach(function(e){e.room_type_id===s.room_type_id&&(n=e)}),s.fromDate=t.availableSlotsForBookRooms.fromDate,s.toDate=t.availableSlotsForBookRooms.toDate,s.nights=t.availableSlotsForBookRooms.nights,s.arrivalTime=t.availableSlotsForBookRooms.arrivalTime,s.departureTime=t.availableSlotsForBookRooms.departureTime,"FULL"===u?l="BOOK":"NIGHTLY"!==u&&"DAYUSE"!==u||(l=n.availability>0&&c.house_availability>0?"BOOK":"NO_PERMISSION_TO_OVERBOOK"===d()?"OVERBOOK_DISABLED":"OVERBOOK"),React.createElement(NightlyDiaryBookRoomContainer,{roomDetails:s,roomTypeDetails:n,type:l}))},NightlyDiaryReservationsListComponent=function(e){var t=e.reservationsListToComponent,a=e.roomRowClass,r=e.showAssignRooms,o=e.showMoveRooms,i=e.showBookRooms,s=e.state;return React.createElement("div",{className:a},t.map(function(e){return React.createElement("div",{className:e.roomClass},e.reservations.length>0?e.reservations.map(function(t){return React.createElement(NightlyDiaryReservationContainer,{reservation:t,room:e,overlapCount:t.overlapCount,isHourlyPresent:e.hourly_reservations.length})}):"",e.ooo_oos_details.length>0?e.ooo_oos_details.map(function(t){return React.createElement(NightlyDiaryOutOfOrderOutOfServiceContainer,{ooo_oos:t,room:e})}):"",r?isRoomAvailable(e.id,s,"ASSIGN"):"",o?isRoomAvailable(e.id,s,"MOVE"):"",i?isRoomAvailable(e.id,s,"BOOK"):"",e.hourly_reservations.length>0?e.hourly_reservations.map(function(t){return React.createElement(NightlyDiaryHourlyContainer,{hourlyItem:t,isNightlyPresent:e.reservations.length})}):"")}))},_React=React,PropTypes=_React.PropTypes;NightlyDiaryReservationsListComponent.propTypes={reservationsListToComponent:PropTypes.array.isRequired};var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_React=React,PropTypes=_React.PropTypes,NightlyDiaryRoomsListComponent=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={selectedRoom:null},a}return _inherits(t,e),_createClass(t,[{key:"setSelectedRoom",value:function(e){this.setState({selectedRoom:e===this.state.selectedRoom?null:e})}},{key:"showRoomStatusUpdatePopup",value:function(e){this.props.showUpdateRoomStatusAndServicePopup(e)}},{key:"renderRoom",value:function(e,t){var a=this.state.selectedRoom===t,r=e.isSuitesAvailable?React.createElement("span",{className:"suite-room",onClick:this.setSelectedRoom.bind(this,t)},React.createElement("span",{className:"icons icon-suite-white"})):null;return React.createElement("div",{className:e.main_room_class,key:t},React.createElement("span",{className:e.room_class,onClick:this.showRoomStatusUpdatePopup.bind(this,e)},e.room_no),React.createElement("span",{className:"room-type"},e.room_type_name),React.createElement("div",{className:"suites"},r,a?React.createElement(NightlyDiaryRoomsSuitTooltipComponent,{suites:e.suite_room_details}):null))}},{key:"render",value:function(){return React.createElement("div",{className:"grid-rooms"},this.props.roomListToComponent.map(this.renderRoom.bind(this)))}}]),t}(React.Component);NightlyDiaryRoomsListComponent.propTypes={roomListToComponent:PropTypes.array.isRequired};var _React=React,PropTypes=_React.PropTypes,NightlyDiaryRoomsSuitTooltipComponent=function(e){var t=e.suites;return React.createElement("div",{className:"suites-rooms top"},React.createElement("strong",null,"Suite Rooms"),React.createElement("div",{className:"rooms"},t.map(function(e){return React.createElement("span",{className:"suite-room"},React.createElement("span",{className:"icons icon-suite-white"}),e.room_no)})))};NightlyDiaryRoomsSuitTooltipComponent.propTypes={suites:PropTypes.array.isRequired};var _React=React,createClass=_React.createClass,PropTypes=_React.PropTypes,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,NightlyDiaryRootComponent=createClass({scrollToPos:function(e){var t=document.getElementById("diary-nightly-grid");t.scrollTop=e},scrollToNthelement:function(e){var t=document.getElementsByClassName("room not-clickable")[0].clientHeight,a=e*t;this.scrollToPos(a)},componentDidUpdate:function(){this.scrollToNthelement(this.props.index)},render:function(){return React.createElement("div",{className:"grid-inner"},void 0!==this.props.selectedReservationId&&""!==this.props.selectedReservationId?React.createElement(NightlyDiaryStayRangeContainer,null):"",React.createElement("div",{id:"diary-nightly-grid",className:this.props.ClassForRootDiv},React.createElement("div",{className:"wrapper"},this.props.showPrevPageButton?React.createElement(GoToPreviousPageButtonContainer,null):"",this.props.showNextPageButton?React.createElement(GoToNextPageButtonContainer,null):"",React.createElement(NightlyDiaryRoomsListContainer,null),React.createElement(NightlyDiaryReservationsListContainer,null))))}});NightlyDiaryRootComponent.propTypes={showNextPageButton:PropTypes.bool.isRequired,showPrevPageButton:PropTypes.bool.isRequired,ClassForRootDiv:PropTypes.string.isRequired,scrollTo:PropTypes.object};var NightlyDiaryStayRangeComponent=createClass({getInitialState:function(){var e=this.props.currentSelectedReservation,t=parseInt(e.arrivalPosition)+e.duration,a=this.props.numberOfDays===NIGHTLY_DIARY_CONST.DAYS_21?NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21:NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7,r=this.props.numberOfDays,o=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/r,i=parseInt(e.arrivalPositionInt)+NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/r-a;return{isArrivalDragging:!1,isDepartureDragging:!1,mouseClikedX:0,mouseLastPositionX:0,arrivalStyle:e.arrivalStyle,departureStyle:e.departureStyle,departureDate:e.deptDate,arrivalPosition:parseInt(e.arrivalPosition),arrivalDate:e.arrivalDate,maxArrivalFlagPos:Math.min(t,NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH)-o,minArrivalFlagPos:NIGHTLY_DIARY_CONST.DAYS_7_OFFSET,maxDepartureFlagPos:(r-1)*(NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/r),minDepartureFlagPos:Math.max(i,a),departurePosition:t,reservationDuration:e.duration,daysMode:r,oneDayWidth:o,dateFormat:e.dateFormat,oneNightDeparturePosition:i,isZeroNightReservation:e.arrivalDate===e.deptDate}},componentDidMount:function(){var e=this;this.isTouchEnabled="ontouchstart"in window,this.mouseStartingEvent=this.isTouchEnabled?"touchstart":"mousedown",this.mouseMovingEvent=this.isTouchEnabled?"touchmove":"mousemove",this.mouseLeavingEvent=this.isTouchEnabled?"touchend":"mouseup";var t=this.flagarea;this.arrivalFlag.addEventListener(this.mouseStartingEvent,function(t){return e.arrivalFlagMouseDown(t)}),this.departureFlag.addEventListener(this.mouseStartingEvent,function(t){return e.departureFlagMouseDown(t)}),t.addEventListener(this.mouseMovingEvent,function(t){return e.mouseMove(t)}),t.addEventListener(this.mouseLeavingEvent,function(t){return e.mouseLeave(t)}),t.addEventListener("mouseleave",function(t){return e.mouseLeave(t)})},arrivalFlagMouseDown:function(e){var t=this.state;e.preventDefault(),e.stopPropagation(),e=this.isTouchEnabled?e.changedTouches[0]:e,t.isArrivalDragging=!0,t.mouseClikedX=e.clientX,t.mouseLastPositionX=e.clientX},departureFlagMouseDown:function(e){var t=this.state;e.preventDefault(),e.stopPropagation(),e=this.isTouchEnabled?e.changedTouches[0]:e,t.isDepartureDragging=!0,t.mouseClikedX=e.clientX,t.mouseLastPositionX=e.clientX},mouseMove:function(e){e.preventDefault(),e.stopPropagation(),e=this.isTouchEnabled?e.changedTouches[0]:e;var t=this.state,a=e.clientX-this.state.mouseLastPositionX;t.isArrivalDragging&&this.moveArrivalFlag(a),t.isDepartureDragging&&this.moveDepartureFlag(a),this.state.mouseLastPositionX=e.clientX},mouseLeave:function(e){var t=this.state,a=this.flagarea;e.preventDefault(),e.stopPropagation(),t.isArrivalDragging&&(t.isArrivalDragging=!1,setTimeout(this.calculateArrivalDate,500)),t.isDepartureDragging&&(t.isDepartureDragging=!1,setTimeout(this.calculateDepartureDate,500)),a.removeEventListener(this.mouseMovingEvent,function(){}),a.removeEventListener(this.mouseLeavingEvent,function(){}),this.updateFlagRanges()},moveArrivalFlag:function(e){var t=this.state,a=this.props,r=parseInt(a.currentSelectedReservation.arrivalPosition),o=t.arrivalPosition-r,i=Math.ceil(o/t.oneDayWidth),s=t.arrivalPosition+e,n=moment(a.currentSelectedReservation.arrivalDate,t.dateFormat.toUpperCase()).add(i-1,"days").format(t.dateFormat.toUpperCase());s<t.minArrivalFlagPos&&(s=t.minArrivalFlagPos),s>t.maxArrivalFlagPos&&(s=t.maxArrivalFlagPos),t.isArrivalDragging&&(this.props.extendShortenReservation(s,t.departurePosition),this.setState({arrivalStyle:{transform:"translateX("+s+"px)"},arrivalPosition:s,arrivalDate:n}))},moveDepartureFlag:function(e){var t=this.state,a=this.props,r=t.departurePosition+e,o=parseInt(a.currentSelectedReservation.arrivalPosition)+a.currentSelectedReservation.duration,i=t.departurePosition-o,s=Math.ceil(i/t.oneDayWidth),n=moment(a.currentSelectedReservation.deptDate,t.dateFormat.toUpperCase()).add(s-1,"days").format(t.dateFormat.toUpperCase());r>t.maxDepartureFlagPos&&(r=t.maxDepartureFlagPos),r<t.minDepartureFlagPos&&(r=t.minDepartureFlagPos),t.isDepartureDragging&&(this.props.extendShortenReservation(t.arrivalPosition,r),this.setState({departureStyle:{transform:"translateX("+r+"px)"},departurePosition:r,departureDate:n}))},calculateDepartureDate:function(){var e=this.state,t=this.props,a=parseInt(t.currentSelectedReservation.arrivalPosition)+t.currentSelectedReservation.duration,r=e.departurePosition-a,o=Math.round(r/e.oneDayWidth),i=a+o*e.oneDayWidth,s=e.isZeroNightReservation?o+1:o,n=moment(t.currentSelectedReservation.deptDate,e.dateFormat.toUpperCase()).add(s,"days").format(e.dateFormat.toUpperCase());0!==o||0===o&&r<0?t.showOrHideSaveChangesButton(!0):t.showOrHideSaveChangesButton(!1),e.departurePosition===e.oneNightDeparturePosition?(n=t.currentSelectedReservation.isArrivalFlagVisible?e.arrivalDate:moment(t.currentSelectedReservation.deptDate,e.dateFormat.toUpperCase()).add(parseInt(s)-1,"days").format(e.dateFormat.toUpperCase()),i=e.oneNightDeparturePosition):i+=this.props.numberOfDays===NIGHTLY_DIARY_CONST.DAYS_21?NIGHTLY_DIARY_CONST.EXTEND_21_DAYS:NIGHTLY_DIARY_CONST.EXTEND_7_DAYS,t.extendShortenReservation(e.arrivalPosition,i),t.checkReservationAvailability(e.arrivalDate,n),this.setState({departureStyle:{transform:"translateX("+i+"px)"},departurePosition:i,departureDate:n})},calculateArrivalDate:function(){var e=this.state,t=this.props,a=parseInt(t.currentSelectedReservation.arrivalPosition),r=e.arrivalPosition-a,o=Math.round(r/e.oneDayWidth),i=a+o*e.oneDayWidth,s=moment(t.currentSelectedReservation.arrivalDate,e.dateFormat.toUpperCase()).add(o,"days").format(e.dateFormat.toUpperCase());0!==o?t.showOrHideSaveChangesButton(!0,!0):t.showOrHideSaveChangesButton(!1,!0),t.extendShortenReservation(i,e.departurePosition),t.checkReservationAvailability(s,e.departureDate),this.setState({arrivalStyle:{transform:"translateX("+i+"px)"},arrivalPosition:i,arrivalDate:s})},updateFlagRanges:function(){this.state.maxArrivalFlagPos=this.state.departurePosition-this.state.oneDayWidth,this.state.minDepartureFlagPos=this.state.arrivalPosition+this.state.oneDayWidth-(this.props.numberOfDays===NIGHTLY_DIARY_CONST.DAYS_21?NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21:NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7)},render:function(){var e=this,t=this.state.arrivalStyle,a=this.state.departureStyle,r=this.props.currentSelectedReservation.class;return React.createElement("div",{className:r,ref:function(t){return e.flagarea=t}},React.createElement("a",{style:t,className:this.props.currentSelectedReservation.arrivalClass},React.createElement("span",{className:"title",ref:function(t){return e.arrivalFlag=t}},"Arrival",React.createElement("span",{className:"date"},this.state.arrivalDate)),React.createElement("span",{className:"line"})),React.createElement("a",{style:a,className:this.props.currentSelectedReservation.departureClass},React.createElement("span",{className:"title",ref:function(t){return e.departureFlag=t}},"Departure",React.createElement("span",{className:"date"},this.state.departureDate)),React.createElement("span",{className:"line"})))}}),_React=React,PropTypes=_React.PropTypes;NightlyDiaryStayRangeComponent.propTypes={currentSelectedReservation:PropTypes.currentSelectedReservation};var _React=React,createClass=_React.createClass,PropTypes=_React.PropTypes,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,OutOfOrderOutOfServiceComponent=createClass({render:function(){return React.createElement("div",{style:this.props.ooo_oos.style,className:this.props.classForDiv},"OUT_OF_SERVICE"===this.props.ooo_oos_data.hk_service_status?React.createElement("span",{className:"name","data-initials":"OOS"},"Out Of Service"):React.createElement("span",{className:"name","data-initials":"OOO"},"Out Of Order"))}}),_React=React,createClass=_React.createClass,PropTypes=_React.PropTypes,_ReactDOM=ReactDOM,findDOMNode=_ReactDOM.findDOMNode,ReservationComponent=createClass({setClassName:function(){return this.props.isAssignRoomViewActive||this.props.showAvailableOnly?this.props.reservation.reservationClass+" overlay":this.props.reservation.reservationClass},render:function(){var e=this;return this.props.isFromStayCard&&this.props.selectedReservationId===this.props.reservation.id?React.createElement("div",{style:this.props.reservation.style,className:this.setClassName(),onTouchEnd:function(){return e.props.selectReservation("",e.props.reservation,e.props.selectedRoom)},onClick:function(){return e.props.selectReservation("",e.props.reservation,e.props.selectedRoom)}},React.createElement("div",{className:"reservation-data"},this.props.reservation.isReservationDayStay?React.createElement("span",{className:"day-stay-icon"}):"",this.props.reservation.isReservationDayStay||1===this.props.reservation.numberOfNightsVisibleInGrid&&(this.props.reservation.no_room_move||this.props.reservation.belongs_to_group||this.props.reservation.belongs_to_allotment)?React.createElement("span",{className:"name","data-initials":this.props.reservation.guest_details.short_name},this.props.reservation.guest_details.short_name):0===this.props.reservation.numberOfNightsVisibleInGrid?React.createElement("span",{className:"name","data-initials":this.props.reservation.guest_details.short_name},this.props.reservation.guest_details.short_name):React.createElement("span",{className:"name"},this.props.reservation.guest_details.full_name),this.props.reservation.is_vip?React.createElement("span",{className:"vip"},"VIP"):""),this.props.reservation.belongs_to_allotment||this.props.reservation.belongs_to_group||this.props.reservation.no_room_move||this.props.reservation.is_suite_reservation?React.createElement("div",{className:"reservation-icons"},this.props.reservation.no_room_move?React.createElement("span",{className:"icons icon-diary-lock"}):"",this.props.reservation.belongs_to_group?React.createElement("span",{className:"icons icon-group-large"}):"",this.props.reservation.belongs_to_allotment?React.createElement("span",{className:"icons icon-allotment-large"}):"",this.props.reservation.is_suite_reservation?React.createElement("span",{className:"suite-room"},this.props.reservation.suite_room_details.map(function(e){return React.createElement("span",null,React.createElement("span",{className:"icons icon-suite-white"}),e.room_no)})):""):""):React.createElement("div",{style:this.props.reservation.style,className:this.setClassName(),onTouchEnd:function(t){return e.props.selectReservation(t,e.props.reservation,e.props.selectedRoom)},onClick:function(t){return e.props.selectReservation(t,e.props.reservation,e.props.selectedRoom);
}},React.createElement("div",{className:"reservation-data"},this.props.reservation.isReservationDayStay?React.createElement("span",{className:"day-stay-icon"}):"",this.props.reservation.isReservationDayStay||1===this.props.reservation.numberOfNightsVisibleInGrid&&(this.props.reservation.no_room_move||this.props.reservation.belongs_to_group||this.props.reservation.belongs_to_allotment)&&this.props.gridDays===NIGHTLY_DIARY_CONST.DAYS_7||this.props.reservation.numberOfNightsVisibleInGrid<=2&&(this.props.reservation.no_room_move||this.props.reservation.belongs_to_group||this.props.reservation.belongs_to_allotment)&&this.props.gridDays===NIGHTLY_DIARY_CONST.DAYS_21?React.createElement("span",{className:"name","data-initials":this.props.reservation.guest_details.short_name},this.props.reservation.guest_details.short_name):0===this.props.reservation.numberOfNightsVisibleInGrid?React.createElement("span",{className:"name","data-initials":this.props.reservation.guest_details.short_name},this.props.reservation.guest_details.short_name):React.createElement("span",{className:"name"},this.props.reservation.guest_details.full_name," "),this.props.reservation.is_vip?React.createElement("span",{className:"vip"},"VIP"):""),this.props.reservation.belongs_to_allotment||this.props.reservation.belongs_to_group||this.props.reservation.no_room_move||this.props.reservation.is_suite_reservation?React.createElement("div",{className:"reservation-icons"},this.props.reservation.no_room_move?React.createElement("span",{className:"icons icon-diary-lock"}):"",this.props.reservation.belongs_to_group?React.createElement("span",{className:"icons icon-group-large"}):"",this.props.reservation.belongs_to_allotment?React.createElement("span",{className:"icons icon-allotment-large"}):"",this.props.reservation.is_suite_reservation?React.createElement("span",{className:"suite-room"},this.props.reservation.suite_room_details.map(function(e){return React.createElement("span",null,React.createElement("span",{className:"icons icon-suite-white"}),e.room_no)})):""):"")}}),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateNextPageItemCount=function(e){var t=Math.ceil(e.paginationData.totalCount/e.paginationData.perPage);return e.paginationData.page===t-1?e.paginationData.totalCount-e.paginationData.perPage*e.paginationData.page:e.paginationData.perPage},mapStateToNightlyDiaryGoToNextPageButtonContainerProps=function(e){return{goToNextPage:e.callBackFromAngular.goToNextPage,nextPageItemCount:calculateNextPageItemCount(e)}},mapDispatchToNightlyDiaryGoToNextPageButtonContainer=function(e){var t=function(){};return t=function(){return e.goToNextPage()},_extends({goToNextButtonClicked:t},e)},GoToNextPageButtonContainer=connect(mapStateToNightlyDiaryGoToNextPageButtonContainerProps,null,mapDispatchToNightlyDiaryGoToNextPageButtonContainer)(GoToNextPageButtonComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,mapStateToNightlyDiaryGoToPreviousPageButtonContainerProps=function(e){return{goToPrev:e.callBackFromAngular.goToPrevPage,perPage:e.paginationData.perPage}},mapDispatchToNightlyDiaryGoToPreviousPageButtonContainer=function(e){var t=function(){};return t=function(){return e.goToPrev()},_extends({goToPrevButtonClicked:t},e)},GoToPreviousPageButtonContainer=connect(mapStateToNightlyDiaryGoToPreviousPageButtonContainerProps,null,mapDispatchToNightlyDiaryGoToPreviousPageButtonContainer)(GoToPreviousPageButtonComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateAssignRoomPositionAndDuration=function(e,t,a){var r=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/a,o=tzIndependentDate(e),i=tzIndependentDate(t.fromDate),s=864e5,n=i.getTime()-o.getTime(),l=Math.abs(n/s),u=0;l>0&&(u=l*r),l>=0&&(a===NIGHTLY_DIARY_CONST.DAYS_7?u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));var c=0,d=t.nights<=1?1:t.nights;c=d*r;var m={};return m.numberOfNightsVisibleInGrid=d,m.style={},m.style.width=c+"px",m.style.transform="translateX("+u+"px)",m},mapStateToNightlyDiaryAssignRoomContainerProps=function(e){return{uar_data:calculateAssignRoomPositionAndDuration(e.diaryInitialDayOfDateGrid,e.availableSlotsForAssignRooms,e.numberOfDays),assignRoom:e.callBackFromAngular.clickedAssignRoom,availableSlotsForAssignRooms:e.availableSlotsForAssignRooms}},NightlyDiaryAssignRoomContainer=connect(mapStateToNightlyDiaryAssignRoomContainerProps)(NightlyDiaryAssignRoomComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateBookRoomPositionAndDuration=function(e,t,a){var r=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/a,o=tzIndependentDate(e),i=tzIndependentDate(t.fromDate),s=864e5,n=i.getTime()-o.getTime(),l=n/s,u=0;l>0&&(u=l*r),l>=0&&(a===NIGHTLY_DIARY_CONST.DAYS_7?u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));var c=t.nights<=1?1:t.nights,d=c*r;d-=a===NIGHTLY_DIARY_CONST.DAYS_7&&0===t.nights?NIGHTLY_DIARY_CONST.DAYS_7_OFFSET:a===NIGHTLY_DIARY_CONST.DAYS_7?NIGHTLY_DIARY_CONST.EXTEND_7_DAYS/2:a===NIGHTLY_DIARY_CONST.DAYS_21&&0===t.nights?NIGHTLY_DIARY_CONST.DAYS_7_OFFSET/2:NIGHTLY_DIARY_CONST.EXTEND_21_DAYS/2;var m={};return m.numberOfNightsVisibleInGrid=c,m.style={},m.style.width=d+"px",m.style.transform="translateX("+u+"px)",m},mapStateToNightlyDiaryBookRoomContainerProps=function(e){return{uar_data:calculateBookRoomPositionAndDuration(e.diaryInitialDayOfDateGrid,e.availableSlotsForBookRooms,e.numberOfDays),bookRoom:e.callBackFromAngular.clickedBookRoom,availableSlotsForBookRooms:e.availableSlotsForBookRooms,diaryMode:e.diaryMode}},NightlyDiaryBookRoomContainer=connect(mapStateToNightlyDiaryBookRoomContainerProps)(NightlyDiaryBookRoomComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateHourlyRoomsPositionAndDuration=function(e,t,a,r){var o=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/r,i=tzIndependentDate(e),s=tzIndependentDate(t.arrival_date),n=s.getTime()-i.getTime(),l=864e5,u=n/l,c=u*o;t.status=t.is_pre_checkin?"PRE_CHECKIN":t.status;var d=getReservationStatusClass(t.status),m=r===NIGHTLY_DIARY_CONST.DAYS_21?30:60,v={};return v.style={},v.style.width=m+"px",v.style.transform="translateX("+c+"px)",a?v.reservationClass="reservation dayuse "+d+" overlap-0":v.reservationClass="reservation dayuse "+d,v},mapStateToNightlyDiaryHourlyContainerProps=function(e,t){return{hourly_data:calculateHourlyRoomsPositionAndDuration(e.diaryInitialDayOfDateGrid,t.hourlyItem,t.isNightlyPresent,e.numberOfDays),state:e}},NightlyDiaryHourlyContainer=connect(mapStateToNightlyDiaryHourlyContainerProps)(NightlyDiaryHourlyComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateMoveRoomPositionAndDuration=function(e,t,a){var r=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/a,o=tzIndependentDate(e),i=tzIndependentDate(t.fromDate),s=864e5,n=i.getTime()-o.getTime(),l=n/s,u=0;l>0&&(u=l*r),l>=0&&(a===NIGHTLY_DIARY_CONST.DAYS_7?u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(u+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));var c=0,d=t.nights<=1?1:t.nights;l<0?(d+=l,c=d*r+10):(c=d*r,a===NIGHTLY_DIARY_CONST.DAYS_7?c-=NIGHTLY_DIARY_CONST.EXTEND_7_DAYS/2:a===NIGHTLY_DIARY_CONST.DAYS_21&&(c-=NIGHTLY_DIARY_CONST.EXTEND_21_DAYS/2));var m={};return m.numberOfNightsVisibleInGrid=d,m.style={},m.style.width=c+"px",m.style.transform="translateX("+u+"px)",m},mapStateToNightlyDiaryMoveRoomContainerProps=function(e){return{uar_data:calculateMoveRoomPositionAndDuration(e.diaryInitialDayOfDateGrid,e.availableSlotsForAssignRooms,e.numberOfDays),moveRoom:e.callBackFromAngular.clickedMoveRoom,availableSlotsForAssignRooms:e.availableSlotsForAssignRooms}},NightlyDiaryMoveRoomContainer=connect(mapStateToNightlyDiaryMoveRoomContainerProps)(NightlyDiaryMoveRoomComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateOutOfOrderOutOfServicePositionAndDuration=function(e,t,a){var r=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/a,o=tzIndependentDate(e),i=tzIndependentDate(t.start_date),s=tzIndependentDate(t.end_date),n=o.getTime()+24*(a-1)*60*60*1e3,l=864e5,u=i.getTime()-o.getTime(),c=0;u>0?c=Math.abs(u/l):u<0&&(c=-1);var d=0;c>0&&(d=c*r),c>=0&&(a===NIGHTLY_DIARY_CONST.DAYS_7?d+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(d+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));var m=0,v=Math.abs((s.getTime()-i.getTime())/l);if(s.getTime()>=o.getTime()&&s.getTime()<=n&&i.getTime()!==s.getTime())i.getTime()<o.getTime()&&(v=Math.abs((s.getTime()-o.getTime())/l)),v+=1,m=v*r,i.getTime()>=o.getTime()&&(a===NIGHTLY_DIARY_CONST.DAYS_7?m-=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(m-=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));else if(i.getTime()===s.getTime())a===NIGHTLY_DIARY_CONST.DAYS_7?m=r-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(m=r-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21);else if(s.getTime()>n){var p=Math.abs((n-i.getTime())/l),_=0;a===NIGHTLY_DIARY_CONST.DAYS_7?(_=p+1,m=r*_-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7):a===NIGHTLY_DIARY_CONST.DAYS_21&&(_=p+1,m=r*_-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21)}var f={};return f.numberOfNightsVisibleInGrid=v,f.style={},f.style.width=m+"px",f.style.transform="translateX("+d+"px)",f},mapStateToNightlyDiaryOutOfOrderOutOfServiceContainerProps=function(e,t){return{ooo_oos:calculateOutOfOrderOutOfServicePositionAndDuration(e.diaryInitialDayOfDateGrid,t.ooo_oos,e.numberOfDays),ooo_oos_data:t.ooo_oos,classForDiv:"OUT_OF_SERVICE"===t.ooo_oos.hk_service_status?"reservation oos":"reservation ooo",gridDays:e.numberOfDays}},NightlyDiaryOutOfOrderOutOfServiceContainer=connect(mapStateToNightlyDiaryOutOfOrderOutOfServiceContainerProps)(OutOfOrderOutOfServiceComponent),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_ReactRedux=ReactRedux,connect=_ReactRedux.connect,calculateReservationDurationAndPosition=function(e,t,a){var r=NIGHTLY_DIARY_CONST.RESERVATION_ROW_WIDTH/a,o=tzIndependentDate(e),i=tzIndependentDate(t.arrival_date),s=tzIndependentDate(t.dept_date),n=o.getTime()+24*(a-1)*60*60*1e3,l=864e5,u=i.getTime()-o.getTime(),c=0;u>0?c=Math.abs(u/l):u<0&&(c=-1);var d=0;c>0&&(d=c*r),c>=0&&(a===NIGHTLY_DIARY_CONST.DAYS_7?d+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(d+=NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21));var m=0,v=!0,p=Math.abs((s.getTime()-i.getTime())/l);if(s.getTime()>=o.getTime()&&s.getTime()<=n&&i.getTime()!==s.getTime())i.getTime()<o.getTime()&&(p=Math.abs((s.getTime()-o.getTime())/l)),m=p*r,0===d?m+=5:d>0&&(m-=5);else if(i.getTime()===s.getTime())a===NIGHTLY_DIARY_CONST.DAYS_7?m=r-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7:a===NIGHTLY_DIARY_CONST.DAYS_21&&(m=r-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21);else if(s.getTime()>n){var _=Math.abs((n-i.getTime())/l),f=0;v=!1,a===NIGHTLY_DIARY_CONST.DAYS_7?(f=_+1,m=r*f-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_7):a===NIGHTLY_DIARY_CONST.DAYS_21&&(f=_+1,m=r*f-NIGHTLY_DIARY_CONST.DAYS_POSITION_ADD_21)}var D={};return D.durationOfReservation=m,D.reservationPosition=d,D.numberOfNightsVisibleInGrid=p,D.isArrivalFlagVisible=!(u<0),D.isDepartureFlagVisible=v,D},getReservationClasses=function(e,t,a,r){var o=tzIndependentDate(a),i=tzIndependentDate(t),s=tzIndependentDate(e.arrival_date),n=tzIndependentDate(e.dept_date),l=o.getTime()+24*(r-1)*60*60*1e3,u="";i.getTime()>=o.getTime()&&i.getTime()<=l&&n.getTime()<i.getTime()&&(u="passed");var c="";return s.getTime()===n.getTime()&&(c="day-stay"),u+" "+c},findIsReservationDayStay=function(e){return 0===e.number_of_nights},findIsReservationFuture=function(e,t){var a=tzIndependentDate(e.arrival_date),r=tzIndependentDate(t),o=!1;return a.getTime()>r.getTime()&&(o=!0),o},convertReservationsListReadyToComponent=function(e,t,a,r,o,i,s,n,l,u,c){var d=calculateReservationDurationAndPosition(r,e,o),m=d.durationOfReservation+"px";e.numberOfNightsVisibleInGrid=d.numberOfNightsVisibleInGrid,e.duration=d.durationOfReservation,e.arrivalPositionInt=d.reservationPosition,e.arrivalPosition=d.reservationPosition+"px",e.departurePosition=d.durationOfReservation+d.reservationPosition+"px",e.departurePositionInt=d.durationOfReservation+d.reservationPosition,e.isArrivalFlagVisible=d.isArrivalFlagVisible,e.isDepartureFlagVisible=d.isDepartureFlagVisible;var v=findIsReservationFuture(e,i),p=findIsReservationDayStay(e);e.status=e.is_pre_checkin?"PRE_CHECKIN":e.status;var _=v?v?"future":"":getReservationStatusClass(e.status),f=getReservationClasses(e,i,r,o);null===e.guest_details.first_name&&null===e.guest_details.last_name&&(e.guest_details.last_name="Pending",e.guest_details.first_name=""),e.guest_details.full_name=e.guest_details.first_name+" "+e.guest_details.last_name,e.guest_details.short_name=e.guest_details.first_name.substring(0,1)+"."+e.guest_details.last_name.substring(0,1),e.isReservationDayStay=p;var D="";if(e.style={},e.style.width=m,e.style.transform="translateX("+d.reservationPosition+"px)",e.id===s&&c.id===u&&(D="editing",""!==n||""!==l)){var h=l-n;e.style.width=h,e.style.transform="translateX("+n+"px)"}return a&&t++,e.reservationClass="reservation "+_+" "+f+" "+D+" overlap-"+t,e},mapStateToNightlyDiaryReservationContainerProps=function(e,t){return{reservation:convertReservationsListReadyToComponent(t.reservation,t.overlapCount,t.isHourlyPresent,e.diaryInitialDayOfDateGrid,e.numberOfDays,e.currentBusinessDate,e.selectedReservationId,e.newArrivalPosition,e.newDeparturePosition,e.selectedRoomId,t.room,e),selectReservation:e.callBackFromAngular.selectReservation,selectedReservationId:e.selectedReservationId,selectedRoom:t.room,isFromStayCard:e.isFromStayCard,gridDays:e.numberOfDays,newArrivalPosition:e.newArrivalPosition,newDeparturePosition:e.newDeparturePosition,isAssignRoomViewActive:e.isAssignRoomViewActive,showAvailableOnly:e.isBookRoomViewActive}},mapDispatchToNightlyDiaryReservationContainerProps=function(e){var t=function(){};return t=function(){return e.selectReservation()},_extends({selectReservation:t},e)},NightlyDiaryReservationContainer=connect(mapStateToNightlyDiaryReservationContainerProps,null,mapDispatchToNightlyDiaryReservationContainerProps)(ReservationComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertRowReadyToComponent=function(e,t,a){return e.map(function(e){0!==e.reservations.length&&(e.maxOverlap=_.max(e.reservations,function(e){return e.overlapCount}).overlapCount),e.hourly_reservations.length>0&&e.maxOverlap++,e.id===t?e.roomClass=e.maxOverlap>=0?"grid-row highlighted overlap-"+e.maxOverlap:"grid-row highlighted":e.roomClass=e.maxOverlap>=0?"grid-row overlap-"+e.maxOverlap:"grid-row"}),e},mapStateToNightlyDiaryReservationsListContainerProps=function(e){return{reservationsListToComponent:convertRowReadyToComponent(e.reservationsList,e.selectedRoomId,e),roomRowClass:"grid-reservations firstday-"+getWeekDayName(new tzIndependentDate(e.diaryInitialDayOfDateGrid).getDay(),3),selectedReservationId:e.selectedReservationId,selectedRoomId:e.selectedRoomId,showAssignRooms:e.isAssignRoomViewActive,showMoveRooms:e.isMoveRoomViewActive,showBookRooms:e.isBookRoomViewActive,state:e}},NightlyDiaryReservationsListContainer=connect(mapStateToNightlyDiaryReservationsListContainerProps)(NightlyDiaryReservationsListComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertRoomsListReadyToComponent=function(e,t,a){return e.map(function(e,r){switch(e.room_class="IN_SERVICE"===e.service_status?"room-number "+e.hk_status:"room-number out",e.main_room_class=e.id===t?"room not-clickable highlighted":"room not-clickable",e.hk_status){case"CLEAN":e.main_room_class+=" clean";break;case"DIRTY":e.main_room_class+=" dirty";break;case"INSPECTED":e.main_room_class+=" inspected";break;case"PICKUP":e.main_room_class+=" pickup";break;case"DO_NOT_DISTURB":e.main_room_class+=" dnd"}e.main_room_class+="CLEAN"!==e.hk_status||e.is_inspected?"":" not-inspected","OUT_OF_ORDER"!==e.service_status&&"OUT_OF_SERVICE"!==e.service_status||(e.main_room_class="room unavailable"),e.isSuitesAvailable=e.suite_room_details.length>0;var o=[],i=a.reservationsList[r];0!==i.reservations.length&&(_.each(i.reservations,function(e){o.push(e.arrival_date)}),o=_.unique(o),_.each(o,function(e){var t=0;_.each(i.reservations,function(a){e===a.arrival_date&&(a.overlapCount=t,t++)})}),e.maxOverlap=_.max(i.reservations,function(e){return e.overlapCount}).overlapCount,i.hourly_reservations.length>0&&e.maxOverlap++),e.maxOverlap>=0&&(e.main_room_class+=" overlap-"+e.maxOverlap)}),e},mapStateToNightlyDiaryRoomsListContainerProps=function(e){return{roomListToComponent:convertRoomsListReadyToComponent(e.roomsList,e.selectedRoomId,e),selectedRoomId:e.selectedRoomId,showUpdateRoomStatusAndServicePopup:e.callBackFromAngular.showRoomStatusAndServiceUpdatePopup}},NightlyDiaryRoomsListContainer=connect(mapStateToNightlyDiaryRoomsListContainerProps)(NightlyDiaryRoomsListComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,getNextPageButtonStatus=function(e){var t=e.paginationData.totalCount,a=e.paginationData.perPage,r=e.paginationData.page;return a*r<t},getPrevPageButtonStatus=function(e){return 1!==e.paginationData.page},getClassForRootDiv=function(e){return getNextPageButtonStatus(e)&&getPrevPageButtonStatus(e)?"grid-content scrollable dual-pagination scroll-vertical":getPrevPageButtonStatus(e)?"grid-content scrollable top-pagination scroll-vertical":getNextPageButtonStatus(e)?"grid-content scrollable bottom-pagination scroll-vertical":"grid-content scrollable scroll-vertical"},getRoomIndex=function(e,t){return _.findLastIndex(t,{id:e})},calculateScrollIndex=function(e){var t=getRoomIndex(e.selectedRoomId,e.roomsList);return t===-1?0:getPrevPageButtonStatus(e)?t+1:t-10},mapStateToNightlyDiaryRootContainerProps=function(e){return{showNextPageButton:getNextPageButtonStatus(e),showPrevPageButton:getPrevPageButtonStatus(e),ClassForRootDiv:getClassForRootDiv(e),index:calculateScrollIndex(e),page:e.paginationData.page,selectedReservationId:e.selectedReservationId,selectedRoom:e.selectedRoom}},mapDispatchToNightlyDiaryGoToPreviousPageButtonContainer=function(e){return e},NightlyDiaryRootContainer=connect(mapStateToNightlyDiaryRootContainerProps,null,mapDispatchToNightlyDiaryGoToPreviousPageButtonContainer)(NightlyDiaryRootComponent),_ReactRedux=ReactRedux,connect=_ReactRedux.connect,convertCurrentSelectedReservation=function(e,t,a,r){var o="grid-stay-range";return r&&(o+=" disable-element"),t&&(e.arrivalStyle={},e.departureStyle={},e.arrivalStyle.transform="translateX("+e.arrivalPosition+")",e.departureStyle.transform="translateX("+e.departurePosition+")",e.arrivalDate=moment(e.arrival_date,"YYYY-MM-DD").format(a.toUpperCase()),e.deptDate=moment(e.dept_date,"YYYY-MM-DD").format(a.toUpperCase()),e.class=o,e.arrivalClass=e.isArrivalFlagVisible?"handle arrival left":"handle arrival left hidden",e.departureClass=e.isDepartureFlagVisible?"handle departure":"handle departure hidden",e.dateFormat=a),e},mapStateToNightlyDiaryStayRangeContainerProps=function(e){return{currentSelectedReservation:convertCurrentSelectedReservation(e.currentSelectedReservation,e.selectedReservationId,e.dateFormat,e.isMoveRoomViewActive),extendShortenReservation:e.callBackFromAngular.extendShortenReservation,showOrHideSaveChangesButton:e.callBackFromAngular.showOrHideSaveChangesButton,checkReservationAvailability:e.callBackFromAngular.checkReservationAvailability,numberOfDays:e.numberOfDays,isPmsProductionEnvironment:e.isPmsProductionEnvironment,isMoveRoomViewActive:e.isMoveRoomViewActive}},NightlyDiaryStayRangeContainer=connect(mapStateToNightlyDiaryStayRangeContainerProps)(NightlyDiaryStayRangeComponent);